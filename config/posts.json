{
  "posts": [
    {
      "content": "## å­—ç¬¦é›†å’Œç¼–ç \n\nå­—ç¬¦é›†ï¼šæ˜¯ä¸€ä¸ªç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰æŠ½è±¡å­—ç¬¦çš„é›†åˆã€‚å­—ç¬¦æ˜¯å„ç§æ–‡å­—å’Œç¬¦å·çš„æ€»ç§°ï¼ŒåŒ…æ‹¬å„å›½å®¶æ–‡å­—ã€æ ‡ç‚¹ç¬¦å·ã€å›¾å½¢ç¬¦å·ã€æ•°å­—ç­‰ã€‚\n\nå­—ç¬¦ç¼–ç ï¼šåœ¨ç¬¦å·é›†åˆä¸äºŒè¿›åˆ¶ä¹‹é—´å»ºç«‹å¯¹åº”å…³ç³»\n\nå¸¸ç”¨çš„å­—ç¬¦é›†ï¼šASCIIå­—ç¬¦é›†ã€GB2312å­—ç¬¦é›†ã€BIG5å­—ç¬¦é›†ã€GBKå­—ç¬¦é›†ã€GB18030å­—ç¬¦é›†ã€Unicodeå­—ç¬¦é›†ç­‰ã€‚\n\n<!-- more -->\n\n### ASCIIå­—ç¬¦é›†\n\n![](https://xuhang.github.io/post-images/1733747863179.png)\n\nASCIIç è¡¨åªç”¨äº†ä¸€ä¸ªå­—èŠ‚çš„ä½7bitæ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œä¸€å…±128ä¸ªï¼Œåªèƒ½æ˜¾ç¤ºç°ä»£ç¾å›½è‹±è¯­ï¼ŒåŒä¸ºè‹±è¯­å›½å®¶çš„è‹±å›½çš„è‹±é•‘ç¬¦å·ï¿¡ä¹Ÿæ²¡æœ‰æ”¶å½•ã€‚æ¬§æ´²å„å›½çº·çº·ä¸ºæ–¹ä¾¿è‡ªå·±çš„ä½¿ç”¨ï¼Œå¯¹å‰©ä¸‹çš„128ä½è¿›è¡Œäº†æ‰©å±•ï¼Œä½†æ˜¯æ¯ä¸ªå›½å®¶è®¾è®¡çš„åˆéƒ½ä¸ä¸€æ ·ï¼Œä¸ºäº†ç»“æŸè¿™ç§æ··ä¹±çš„å±€é¢ï¼Œäºæ˜¯åœ¨ASCIIç è¡¨çš„åŸºç¡€ä¸Šæ‰©å±•å‡ºäº†EASCIIï¼ˆExtended ASCIIï¼‰ç è¡¨ã€‚\n\n![](https://xuhang.github.io/post-images/1733747880005.png)\n\n### GB2312ã€GBKã€GB18030å­—ç¬¦é›†\n\nGB 2312-1980ï¼Œå…¨ç§°ã€Šä¿¡æ¯äº¤æ¢ç”¨æ±‰å­—ç¼–ç å­—ç¬¦é›† åŸºæœ¬é›†ã€‹ï¼Œç”±å›½å®¶æ ‡å‡†æ€»å±€äº1980å¹´3æœˆ9å·å‘å¸ƒï¼Œ1981å¹´5æœˆ1æ—¥å®æ–½ï¼Œé€šè¡Œäºå¤§é™†ã€‚æ–°åŠ å¡ç­‰åœ°ä¹Ÿä½¿ç”¨æ­¤ç¼–ç ã€‚å®ƒæ˜¯ä¸€ä¸ªç®€åŒ–å­—çš„ç¼–ç è§„èŒƒï¼Œä¹ŸåŒ…æ‹¬å…¶ä»–çš„ç¬¦å·ã€å­—æ¯ã€æ—¥æ–‡å‡åç­‰ï¼Œå…±7445ä¸ªå›¾å½¢å­—ç¬¦ï¼Œå…¶ä¸­æ±‰å­—å 6763ä¸ªã€‚\n\nGB2312é‡‡ç”¨ä¸€ç§å«åŒºä½ç çš„æ–¹å¼è¿›è¡Œç¼–ç ï¼Œé‡Œé¢æ¯ä¸€ä¸ªå­—ç¬¦éƒ½æ˜¯å°†å­—ç¬¦æ‰€åœ¨çš„åŒºå’Œä½åˆ†åˆ«ä¸`xA0`è¿›è¡ŒåŠ æ³•è®¡ç®—ï¼Œå¾—åˆ°çš„ä¸¤ä¸ªå­—èŠ‚å°±æ˜¯è¿™ä¸ªå­—ç¬¦å¯¹åº”çš„æœºä½ç ã€‚æ¯ä¸ªå­—èŠ‚ä»`A0`~`FF`ï¼ˆä¸è€ƒè™‘é¦–ä½ï¼‰æœ‰94ç§å¯èƒ½ï¼Œæ‰€ä»¥ç†è®ºä¸ŠGB2312ä¸€å…±å¯ä»¥å®¹çº³94*94=8836ä¸ªå­—ç¬¦ã€‚\n\nåœ¨94ä¸ªåŒºä¸­åˆè¿›ä¸€æ­¥æŒ‰æ ‡ç‚¹ã€å‡åã€å­—æ¯ç­‰è¿›è¡Œåˆ†åŒº\n\n| åŒº     | æè¿°                               |\n| ------ | ---------------------------------- |\n| 01     | ä¸­æ–‡æ ‡ç‚¹ã€æ•°å­¦ç¬¦å·ä»¥åŠä¸€äº›ç‰¹æ®Šå­—ç¬¦ |\n| 02     | åºå·                               |\n| 03     | å…¨è§’è¥¿æ–‡å­—ç¬¦                       |\n| 04     | æ—¥æ–‡å¹³å‡å                         |\n| 05     | æ—¥æ–‡ç‰‡å‡å                         |\n| 06     | å¸Œè…Šå­—æ¯è¡¨                         |\n| 07     | ä¿„æ–‡å­—æ¯è¡¨                         |\n| 08     | ä¸­æ–‡æ‹¼éŸ³å­—æ¯è¡¨                     |\n| 09     | åˆ¶è¡¨ç¬¦å·                           |\n| 10-15  | æœªå®šä¹‰                             |\n| 16ï¼55 | ä¸€çº§æ±‰å­—ï¼ˆä»¥æ‹¼éŸ³å­—æ¯æ’åºï¼‰         |\n| 56ï¼87 | äºŒçº§æ±‰å­—ï¼ˆä»¥éƒ¨é¦–ç¬”ç”»æ’åºï¼‰         |\n| 88ï¼94 | æœªå®šä¹‰                             |\n\n[GBKç¼–ç è¡¨](https://www.qqxiuzi.cn/zh/hanzi-gb2312-bianma.php)\n\nä»¥ç¬¬ä¸€ä¸ªæ±‰å­—`å•Š`ä¸ºä¾‹ï¼Œ`å•Š`æ˜¯16åŒº01ä½ï¼ŒåŒºä½ç 1601ï¼ˆğŸ‘ˆåè¿›åˆ¶ï¼‰ï¼Œåˆ†åˆ«å’Œ`xA0`ç›¸åŠ å¾—`xB0 xA1`ï¼Œæ‰€ä»¥`å•Š`åœ¨GB2312ä¸‹çš„æœºä½ç æ˜¯`B0A1`ã€‚GB2312é‡Œè¿˜åŒ…å«äº†ASCIIç è¡¨é‡Œçš„æ ‡ç‚¹ç¬¦å·å’Œæ•°å­—ï¼Œä½†æ˜¯åŒæ ·å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œè¿™å°±æ˜¯å…¨è§’ç¬¦å·ã€‚\n\nGBKæ˜¯åœ¨GB2312çš„åŸºç¡€ä¸Šè¿›è¡Œçš„æ‰©å±•ï¼Œå‘ä¸‹å…¼å®¹GB2312ï¼Œä¸æ˜¯å›½å®¶æ ‡å‡†ï¼Œç›¸ä¼ ç”±å¾®è½¯ååŠ©å®Œæˆã€‚\n\nGBKçš„ç¼–ç èŒƒå›´`x8140 ~ xFEFE`ï¼Œæ€»è®¡23940 ä¸ªç ä½ï¼Œæ”¶å½•æ±‰å­—21003 ä¸ªï¼Œå›¾å½¢ç¬¦å·883 ä¸ªã€‚\n\nGB18030å…¨ç§°ã€Šä¿¡æ¯æŠ€æœ¯ ä¸­æ–‡ç¼–ç å­—ç¬¦é›†ã€‹ï¼Œæ˜¯[ä¸­åäººæ°‘å…±å’Œå›½](https://baike.baidu.com/item/ä¸­åäººæ°‘å…±å’Œå›½)[å›½å®¶æ ‡å‡†](https://baike.baidu.com/item/å›½å®¶æ ‡å‡†)æ‰€è§„å®šçš„å˜é•¿å¤šå­—èŠ‚å­—ç¬¦é›†ã€‚å®Œå…¨å…¼å®¹GB2312ï¼ŒåŸºæœ¬å…¼å®¹GBKã€‚\n\n- é‡‡ç”¨å˜é•¿å¤š[å­—èŠ‚](https://baike.baidu.com/item/å­—èŠ‚)ç¼–ç ï¼Œæ¯ä¸ªå­—å¯ä»¥ç”±1ä¸ªï¼ˆå…¼å®¹ASCIIï¼‰ã€2ä¸ªï¼ˆå…¼å®¹GBKï¼‰æˆ–4ä¸ªå­—èŠ‚ç»„æˆã€‚\n- ç¼–ç ç©ºé—´åºå¤§ï¼Œæœ€å¤šå¯å®šä¹‰161ä¸‡ä¸ªå­—ç¬¦ã€‚\n- å®Œå…¨æ”¯æŒUnicodeï¼Œæ— éœ€åŠ¨ç”¨é€ å­—åŒºå³å¯æ”¯æŒä¸­å›½å›½å†…[å°‘æ•°æ°‘æ—](https://baike.baidu.com/item/å°‘æ•°æ°‘æ—)æ–‡å­—ã€ä¸­æ—¥éŸ©å’Œç¹ä½“æ±‰å­—ä»¥åŠ[emoji](https://baike.baidu.com/item/emoji)ç­‰å­—ç¬¦ã€‚\n\n### Unicodeå­—ç¬¦é›†å’ŒUTF-8ç¼–ç \n\nç™¾åº¦ç™¾ç§‘ï¼šUnicodeæ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿçš„å­—ç¬¦ç¼–ç æ–¹æ¡ˆçš„å±€é™è€Œäº§ç”Ÿçš„ï¼Œå®ƒä¸ºæ¯ç§è¯­è¨€ä¸­çš„æ¯ä¸ªå­—ç¬¦è®¾å®šäº†ç»Ÿä¸€å¹¶ä¸”å”¯ä¸€çš„äºŒè¿›åˆ¶ç¼–ç ï¼Œä»¥æ»¡è¶³è·¨è¯­è¨€ã€è·¨å¹³å°è¿›è¡Œæ–‡æœ¬è½¬æ¢ã€å¤„ç†çš„è¦æ±‚ã€‚1990å¹´å¼€å§‹ç ”å‘ï¼Œ1994å¹´æ­£å¼å…¬å¸ƒã€‚\n\nUnicodeåªè§„å®šäº†æ¯ä¸ªå­—ç¬¦å¯¹åº”çš„ç ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰è§„å®šæ€ä¹ˆå‚¨å­˜ã€‚\n\nç¼–ç å®ç°ï¼šUTF-8ã€UTF-16ã€UTF-32\n\nUTF-8æ˜¯1~4å­—èŠ‚çš„å¯å˜é•¿ç¼–ç æ–¹å¼ï¼ŒUTF-16æ˜¯2æˆ–4å­—èŠ‚ç¼–ç æ–¹å¼ï¼ŒUTF-32æ˜¯4å­—èŠ‚å®šé•¿ç¼–ç \n\nUTF-8ç¼–ç è§„åˆ™ï¼š\n\n1. å•å­—èŠ‚çš„ç¬¦å·ï¼Œå­—èŠ‚ç¬¬ä¸€ä½æ˜¯0ï¼Œè¿™é‡Œç ç‚¹å’ŒASCIIç æ˜¯ä¸€è‡´çš„\n2. å¯¹äºNå­—èŠ‚çš„ç¬¦å·ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰Nä½æ˜¯1ï¼ŒN+1ä½æ˜¯0ï¼Œåé¢N-1ä¸ªå­—èŠ‚çš„å‰ä¸¤ä½éƒ½æ˜¯10ï¼Œå…¶ä½™ä½ç”¨è¯¥å­—ç¬¦çš„Unicodeç ç‚¹è¡¥é½ï¼Œä¸è¶³ä½è¡¥0\n\n| Unicodeç ç‚¹(16è¿›åˆ¶) | UTF-8ç¼–ç æ–¹å¼(2è¿›åˆ¶)                |\n| ------------------- | ----------------------------------- |\n| 0 - 7F              | 0xxxxxxx                            |\n| 80 - 7FF            | 110xxxxx 10xxxxxx                   |\n| 800 - FFFF          | 1110xxxx 10xxxxxx 10xxxxxx          |\n| 1 0000 - 10 FFFF    | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |\n\n> ANSIå¹¶ä¸æ˜¯æŸä¸€ç§ç‰¹å®šçš„å­—ç¬¦ç¼–ç ï¼Œè€Œæ˜¯åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ï¼ŒANSIè¡¨ç¤ºä¸åŒçš„ç¼–ç ã€‚åœ¨å›½å†…ANSIè¡¨ç¤ºGBKï¼Œåœ¨å°æ¹¾ANSIè¡¨ç¤ºBIG-5ï¼Œåœ¨ç¾å›½ANSIè¡¨ç¤ºASCII\n\n#### Big endian or Little endian\n\nå¤§ç«¯ï¼ˆBig endianï¼‰æ›´ç¬¦åˆäººçš„ç›´è§‚è¯»å–ï¼Œæ¯”å¦‚0x12345678å­˜å‚¨çš„å°±æ˜¯ 0x12 0x34 0x56 0x78ï¼Œç¬¦å·ä½çš„åˆ¤å®šå›ºå®šä¸ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå®¹æ˜“åˆ¤æ–­æ­£è´Ÿã€‚TCP/IPåè®®è§„å®šäº†å¿…é¡»å¤§ç«¯ä¼ è¾“ï¼Œæ‰€ä»¥åˆå«ç½‘ç»œå­—èŠ‚åºã€‚\n\nå°ç«¯ï¼ˆLittle endianï¼‰å¼ºåˆ¶è½¬æ¢æ•°æ®ä¸éœ€è¦è°ƒæ•´å­—èŠ‚å†…å®¹ï¼Œ1ã€2ã€4å­—èŠ‚çš„å­˜å‚¨æ–¹å¼ä¸€æ ·ã€‚Intelçš„å¤§é‡CPUéƒ½é‡‡ç”¨å°ç«¯å­—èŠ‚åºï¼Œæ‰€ä»¥åˆå«ä¸»æœºå­—èŠ‚åºã€‚\n\n#### BOM ï¼ˆbyte order markï¼‰\n\nç”¨æ¥æ ‡è¯†å¤§ç«¯å­˜å‚¨è¿˜æ˜¯å°ç«¯å­˜å‚¨ï¼ŒUTF-8ä¸éœ€è¦BOMï¼Œä¼šåœ¨æ–‡ä»¶å¤´éƒ¨æ’å…¥3ä¸ªå­—èŠ‚`EF BB BF`ï¼Œä¼šå¯¹linuxä¸Šè„šæœ¬æ‰§è¡Œé€ æˆå½±å“ï¼ˆä¼šç ´å#!æ ‡è¯†ï¼‰ã€‚BOMä¸»è¦æ˜¯ç”¨æ¥æ ‡æ³¨UTF-16å’ŒUTF-32çš„ï¼Œwindows 7è®°äº‹æœ¬ä¸Šçš„Unicodeå…¶å®æ˜¯UTF-16å°ç«¯ä¿å­˜ï¼Œwindows 10 å·²ç»ä¿®æ”¹ä½UTF-16 LEå’ŒUTF-16 BEã€‚\n\nä¸åŒç¼–ç æ–¹å¼å¤´éƒ¨æ’å…¥çš„BOM\n\n| BOM         | Encoding               |\n| ----------- | ---------------------- |\n| EF BB BF    | UTF-8                  |\n| FE FF       | UTF-16 (big-endian)    |\n| FF FE       | UTF-16 (little-endian) |\n| 00 00 FE FF | UTF-32 (big-endian)    |\n| FF FE 00 00 | UTF-32 (little-endian) |\n\n`FEFF`æ˜¯ä¸€ä¸ªå«åšZERO WIDTH NO-BREAK SPACEï¼Œæ˜¯ä¸€ä¸ªä¸å¯è¯»çš„ç¬¦å·ï¼Œå› ä¸ºFFåˆšå¥½æ¯”FEå¤§1ï¼ŒFFFEåˆä¸å­˜åœ¨ï¼Œæ‰€ä»¥ç”¨è¿™ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºç¼–ç çš„å¤§å°ç«¯ã€‚\n\n## ä¹±ç \n\n### é”Ÿæ–¤æ‹·\n\nä¹±ç çš„å‡ºç°æ˜¯ç”±äºå­—ç¬¦çš„ç¼–ç å’Œè§£ç ä½¿ç”¨äº†ä¸å…¼å®¹çš„æ ¼å¼\n\nåœ¨å¤„ç†æ˜¾ç¤ºå­—ç¬¦æ—¶ï¼Œå¯¹äºæ— æ³•æ˜¾ç¤ºçš„ç¬¦å·ï¼ŒUnicodeä¼šç”¨0xFFFDæ¥è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯ï¿½ï¼Œç”¨UTF-8è¡¨ç¤ºæ˜¯`EF BF BD`ï¼Œå½“æœ‰ä¸¤ä¸ªè¿ç»­çš„æ— æ³•æ˜¾ç¤ºçš„å­—ç¬¦ï¿½ï¿½ï¼ˆ`EF BF BD EF BF BD`ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨GBKè§£ç å°±ä¼šå˜æˆ3ä¸ªå­—ç¬¦ï¼Œå°±å¯¹åº”é”Ÿæ–¤æ‹·ä¸‰ä¸ªæ±‰å­—ã€‚\n\n### çƒ«çƒ«çƒ« vs å±¯å±¯å±¯\n\nåœ¨VC çš„debugæ¨¡å¼ä¸‹ï¼Œåœ¨æ ˆä¸­æ–°åˆ†é…çš„å†…å­˜ä¼šåˆå§‹åŒ–ä¸º`0xCC`ï¼Œåœ¨å †ä¸­æ–°åˆ†é…çš„å†…å­˜ä¼šåˆå§‹åŒ–ä¸º`0xCD`ï¼Œè¿™æ—¶æ‰“å°å‡ºæ¥åˆ†åˆ«å¯¹åº”çƒ«å’Œå±¯\n\n### è®°äº‹æœ¬å’Œè”é€šçš„çŸ›ç›¾ï¼ˆwin7ï¼‰\n\næ‰“å¼€è®°äº‹æœ¬ï¼Œè¾“å…¥è”é€šä¸¤ä¸ªæ±‰å­—ï¼Œç”¨é»˜è®¤çš„ANSIï¼ˆGBKï¼‰ä¿å­˜ï¼Œå†æ¬¡æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ä¼šå‘ç°å‡ºç°ä¹±ç ï¿½ï¿½ã€‚\n\né¦–å…ˆçœ‹ä¸€ä¸‹â€œè”é€šâ€çš„GBKç¼–ç ï¼š`C1 AA CD A8`\n\nå…¶äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯`1100 0001  1010 1010  1100 1101  1010 1000`\n\nå…¶äºŒè¿›åˆ¶å½¢å¼`110x xxxx 10xx xxxx`åŒ¹é…äº†UTF-8çš„2å­—èŠ‚è¡¨ç¤ºå½¢å¼ï¼Œæ‰€ä»¥è®°äº‹æœ¬æ¨æµ‹æ˜¯UTF-8çš„ç¼–ç ï¼Œä½†æ˜¯åˆä¸å­˜åœ¨å¯¹åº”çš„UTF-8ç¼–ç çš„å­—ç¬¦ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤ºUnicodeçš„æ›¿æ¢å­—ç¬¦ï¿½\n\n> ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡ºç°ï¿½æ—¶è¯´æ˜æ˜¯ä»¥UTF-8çš„ç¼–ç æ–¹å¼æ‰“å¼€/è¯»å–çš„æ–‡ä»¶ï¼Œè€Œæ–‡ä»¶æœ¬èº«ä¸æ˜¯ä»¥UTF-8ä¿å­˜çš„ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¹±ç ã€‚è¿™ä¸ªæ—¶å€™åº”è¯¥ä»¥å…¶ä»–ç¼–ç æ–¹å¼é‡æ–°æ‰“å¼€ï¼Œè€Œä¸æ˜¯å¦å­˜ä¸ºä¿®æ”¹ç¼–ç ï¼Œå¦åˆ™å°±ä¼šå‡ºç°é”Ÿæ–¤æ‹·ã€‚\n\n## é€ å­—\n\nwin+Ræ‰“å¼€è¿è¡Œçª—å£ï¼Œè¾“å…¥eudceditï¼Œæ‰“å¼€ä¸“ç”¨å­—ç¬¦ç¼–è¾‘ç¨‹åº\n\n![](https://xuhang.github.io/post-images/1733747908216.png)\n\nåœ¨é€‰æ‹©ä»£ç åŒºåŸŸé€‰æ‹©ä¸€ä¸ªç ç‚¹ä¹‹åç‚¹å‡»ç¡®å®šï¼Œè¿™é‡Œç ç‚¹å¯¹åº”çš„æ˜¯GBKçš„ç ç‚¹ï¼Œéœ€è¦åˆ‡æ¢æˆUnicodeæ˜¾ç¤º\n\n![](https://xuhang.github.io/post-images/1733747950742.png)\n\nåœ¨ç¼–è¾‘åŒºåŸŸç”»å‡ºä½ æƒ³è¦çš„ç¬¦å·ï¼Œç„¶åç‚¹å‡»ç¼–è¾‘â†’ä¿å­˜å­—ç¬¦ï¼Œè®°ä½è¿™é‡Œçš„ä»£ç ï¼Œä¸Šé¢æ˜¯E047\n\nç„¶åæ‰“å¼€å­—ç¬¦æ˜ å°„è¡¨\n\n![](https://xuhang.github.io/post-images/1733747961204.png)\n\nç„¶åå¤åˆ¶æ‰€é€‰æ‹©çš„å­—ç¬¦ï¼Œæ‰“å¼€notepadç²˜è´´ï¼Œä¿å­˜æ–‡ä»¶\n\n> è¿™ä¸ªç¬¦å·å¯ä»¥å¤åˆ¶ç²˜è´´åˆ°windowsè‡ªå¸¦çš„ä¸€äº›è½¯ä»¶ä¸Šï¼ŒåŒ…æ‹¬Microsoft Edgeæµè§ˆå™¨ã€OfficeåŠå…¬ã€è®°äº‹æœ¬ç­‰ï¼ŒIDEAä»£ç ç¼–è¾‘åŒºç²˜è´´æ˜¾ç¤ºå…¶Unicodeç ç‚¹ï¼Œé€šè¿‡è¾“å‡ºå¯ä»¥æ˜¾ç¤ºè¯¥ç¬¦å·ã€‚ä½†æ˜¯ä¸æ”¯æŒå¤åˆ¶åˆ°Chromeæµè§ˆå™¨å’Œå…¶ä»–çš„ç¼–è¾‘å™¨æ¯”å¦‚VS Code\n\nç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€åˆšæ‰çš„æ–‡ä»¶\n\n![](https://xuhang.github.io/post-images/1733747975384.png)\n\nå¯ä»¥çœ‹åˆ°ANSIé»˜è®¤ä½¿ç”¨çš„UTF-8ç¼–ç ï¼Œå’Œåˆšæ‰çš„ä»£ç è¿›è¡Œä¸‹è½¬æ¢ï¼ŒE047è½åœ¨UTF-8ç¬¬3æ¡£ï¼Œæ‰€ä»¥æ˜¯3å­—èŠ‚\n\nE0 -> 1110 0000\n\n47 -> 0100 0111\n\n3å­—èŠ‚æ¨¡æ¿ï¼š`1110 ____ 10__ ____ 10__ ____`ä»å³å¾€å·¦å¡«å†²ï¼š`1110 1110 1000 0001 1000 0111`è½¬æˆåå…­è¿›åˆ¶ï¼š`EE 81 87`",
      "data": {
        "title": "æ±‰å­—çš„ç¼–ç ",
        "date": "2024-12-09 20:37:05",
        "tags": [
          "charset",
          "å­—ç¬¦ç¼–ç ",
          "unicode"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/han-zi-de-bian-ma.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## å­—ç¬¦é›†å’Œç¼–ç \n\nå­—ç¬¦é›†ï¼šæ˜¯ä¸€ä¸ªç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰æŠ½è±¡å­—ç¬¦çš„é›†åˆã€‚å­—ç¬¦æ˜¯å„ç§æ–‡å­—å’Œç¬¦å·çš„æ€»ç§°ï¼ŒåŒ…æ‹¬å„å›½å®¶æ–‡å­—ã€æ ‡ç‚¹ç¬¦å·ã€å›¾å½¢ç¬¦å·ã€æ•°å­—ç­‰ã€‚\n\nå­—ç¬¦ç¼–ç ï¼šåœ¨ç¬¦å·é›†åˆä¸äºŒè¿›åˆ¶ä¹‹é—´å»ºç«‹å¯¹åº”å…³ç³»\n\nå¸¸ç”¨çš„å­—ç¬¦é›†ï¼šASCIIå­—ç¬¦é›†ã€GB2312å­—ç¬¦é›†ã€BIG5å­—ç¬¦é›†ã€GBKå­—ç¬¦é›†ã€GB18030å­—ç¬¦é›†ã€Unicodeå­—ç¬¦é›†ç­‰ã€‚",
      "fileName": "han-zi-de-bian-ma"
    },
    {
      "content": "## Spring AOP æ³¨è§£\n\nåœ¨ä½¿ç”¨springæ¡†æ¶æ—¶,é€šå¸¸ç”¨å®ƒçš„aopæ¥è®°å½•æ—¥å¿—,ä½†åœ¨spring mvcé‡‡ç”¨@Controlleræ³¨è§£æ—¶,å¯¹Controllerè¿›è¡ŒAopæ‹¦æˆªä¸èµ·ä½œç”¨,åŸå› æ˜¯è¯¥æ³¨è§£çš„Controllerå·²è¢«springå®¹å™¨å†…éƒ¨ä»£ç†äº†.\n\néœ€è¦å¯¹org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapterè¿›è¡ŒAopæ‰èƒ½èµ·ä½œç”¨.ç»è¿‡å¤šæ¬¡æµ‹è¯•å¯è¡Œ.\n\n<!-- more -->\n\n```java\npackage com.autoabacus.dal.controller;  \nimport org.aspectj.lang.ProceedingJoinPoint;  \nimport org.aspectj.lang.annotation.Around;  \nimport org.aspectj.lang.annotation.Aspect;  \nimport org.springframework.stereotype.Component;  \n@Component  \n@Aspect  \npublic class Aop {  \n    public Aop() {  \n        System.out.println(\"Aop\");  \n    }  \n    // @Around(\"within(org.springframework.web.bind.annotation.support.HandlerMethodInvoker..*)\")  \n    @Around(\"execution(* org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(..))\")  \n    public Object aa(ProceedingJoinPoint pjp)  throws Throwable   \n    {  \n        try {  \n            Object retVal = pjp.proceed();  \n            System.out.println(retVal);  \n            return retVal;  \n        } catch (Exception e) {  \n            System.out.println(\"å¼‚å¸¸\");  \n            return null;  \n        }  \n    }  \n}\n```\n\nController:\n\n```java\npackage com.autoabacus.dal.controller;  \nimport org.springframework.stereotype.Controller;  \nimport org.springframework.web.bind.annotation.RequestMapping;  \n@Controller    \npublic class WelcomeController {  \n    @RequestMapping  \n    public void welcome() {  \n        if (true)  \n            throw new RuntimeException(\"fdsafds\");  \n    }    \n}  \n```\n\n## jQuery è‡ªå®šä¹‰é€‰æ‹©å™¨\n\n```javascript\n$(document).ready(function() {\n    $.extend($.expr[':'], {\n        moreThen1000px: function(a) {\n            return $(a).width() > 1000;\n        }\n    });\n    $('.widthDiv:moreThen1000px').click(function() {\n        alert('The element that you have clicked is over 1000 pixels wide');\n    });\n});\n```\n\n## HTMLæ–‡å­—è‡ªåŠ¨è£å‰ª\n\n```html\n<a style=\"text-overflow: ellipsis;overflow: hidden;white-space: nowrap;width: 100%;display: inline-block;\">æ–‡å­—è‡ªåŠ¨è£å‰ª</a>\n```\n\n## FIREFOXå›¾ç‰‡å ä½ç¬¦\n\n```css\n@-moz-document url-prefix(http), url-prefix(file) {\n    img:-moz-broken{\n        -moz-force-broken-image-icon:1;\n        width:220px;\n        height:220px;\n    }\n}\n```\n\n## JAVASCRIPTè½»é‡æ¨¡æ¿\n\n```javascript\nfunction tmpl(template, data) {\n    return template.replace(/\\{([\\*\\w\\.]*)\\}/g, function(str, key) {\n        var keys = key.split(\".\");\n        var rep = '_300*300';\n        //å¦‚æœæœ‰å½¢å¦‚â€œ_300*300â€çš„keyï¼Œåˆ™ä½œä¸ºå›¾ç‰‡çš„å¤§å°ï¼Œå¹¶ä»keysä¸­ç§»é™¤\n        for(var i=0; i<keys.length; i++){\n            if(/_\\d{1,4}\\*\\d{1,4}/.test(keys[i])){\n                rep = keys.splice(i,1);\n                break;\n            }\n        }\n        /*if(keys.length>2) {\n            var ss = keys[1];\n            if(/_\\d{1,4}\\*\\d{1,4}/.test(ss)){\n                rep = keys.splice(1,1);\n            }\n        }*/\n        var v = data[keys.shift()];\n        for (var i = 0, l = keys.length; i < l; i++) v = v[keys[i]];\n        v = (typeof v !== \"undefined\" && v !== null) ? v : \"\";\n        if(strEndsWith(v.toString(), \".jpg\") || strEndsWith(v.toString(), \".JPG\") || strEndsWith(v.toString(), \".webp\")){\n            v = v.replace(/\\.(jpg|JPG|webp)$/, rep+\"$&\");\n        }\n        return v;\n    });\n    function strEndsWith(str, suffix) {\n        return str.match(suffix+\"$\")==suffix;\n    }\n}\n```\næ³¨é‡Šï¼š\n```javascript\nfunction tmpl(template, data) {\n    return template.replace(/\\{([\\w\\.]*)\\}/g, function(str, key, idx, ori) {//str-åŒ¹é…æ­£åˆ™ï¼Œkey-åŒ¹é…æ‹¬å·å†…ï¼Œidx-åŒ¹é…æ­£åˆ™çš„stråœ¨åŸå­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼Œori-åŸå§‹å­—ç¬¦ä¸²\n        var keys = key.split(\".\");\n        //shiftæŠŠæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä»å…¶ä¸­åˆ é™¤ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼\n        var v = data[keys.shift()];\n        for (var i = 0, l = keys.length; i < l; i++) v = v[keys[i]];\n        v = (typeof v !== \"undefined\" && v !== null) ? v : \"\";\n        return v;\n    });\n}\n```\n\n## åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•å¼‚æ­¥åŠ è½½çš„jsè„šæœ¬\n\nå¦‚æœé¡µé¢åœ¨è¯·æ±‚ä¹‹åè¿”å›çš„æ˜¯éœ€è¦æ’å…¥åœ¨åŸé¡µé¢ä¸­çš„ä»£ç ï¼Œè¿™äº›ä»£ç é€šå¸¸é™¤äº†å•¦HTMLä»£ç è¿˜ä¼šå¸¦ç€ä¸€äº›JSè„šæœ¬ã€‚è¿™äº›è„šæœ¬é€šå¸¸ä¸ä¼šåœ¨Sourceæ ä¸­æ˜¾ç¤ºï¼Œå¯¼è‡´è°ƒè¯•è¿™äº›è„šæœ¬ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œé™¤äº†åœ¨ä»£ç ä¸­æ’å…¥`debugger;`è¿˜å¯ä»¥åœ¨è„šæœ¬çš„æœ€åï¼ˆ`</script>`ä¹‹å‰ï¼‰åŠ ä¸Šæ ‡ç­¾`//# sourceURL=xxx.js`ï¼Œè¿™æ ·åœ¨æµè§ˆå™¨çš„è°ƒè¯•çª—å£é€‰æ‹©æ‰“å¼€æ–‡ä»¶ï¼ˆå¿«æ·é”®`Ctrl + P`ï¼‰è¾“å…¥xxxä»£è¡¨çš„åå­—å³å¯æ‰“å¼€è°ƒè¯•ã€‚\n\n## Springä¸­æ³¨å…¥æšä¸¾ç±»å‹çš„å±æ€§å€¼\n\n```xml\n<bean id=\"databaseId\" class=\"java.lang.Integer\">\n    <constructor-arg type=\"int\" value=\"#{T(com.yhd.kaleido.kedis.domain.KedisPool).${redis.databasePool}.id}\" />\n</bean>\n```\n\n## ConcurrentModificationException\n\n`foreach loop`è°ƒç”¨çš„å…¶å®æ˜¯`Iterator`è¿­ä»£å™¨ï¼Œ`Iterator`å†…éƒ¨ç»´æŠ¤`expectedModCount`ï¼Œ`ArrayList`ç»´æŠ¤`modCount`ã€‚åªæœ‰è°ƒç”¨`Iterator`çš„`remove`æ–¹æ³•ä¼šä¿è¯`expectedModCount`å’Œ`modCount`ä¼šç›¸ç­‰ï¼Œè€Œè°ƒç”¨`ArrayList`çš„`remove`æ–¹æ³•åªä¿®æ”¹`modCount`ï¼Œ`foreach loop`éå†å…ƒç´ æ—¶è°ƒç”¨`next()`ï¼Œä¼šè§¦å‘`checkForComodification()`ï¼Œæ­¤æ–¹æ³•ä¸­`expectedModCountï¼=modCount`ä¼šæŠ›å‡º`ConcurrentModificationException`ã€‚ \n\n## LinuxæŸ¥çœ‹è¿æ¥çš„åˆ›å»ºæ—¶é—´\n\næŸ¥çœ‹sshåˆ°ipåœ°å€221.234.44.52è¿æ¥çš„åˆ›å»ºæ—¶é—´ï¼š\n\n1. `netstat -npt | grep 221.234.44.52  `\n2. è®°å½•ç»“æœä¸­çš„pidå’Œport\n3. æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„è¿™ä¸ªè¿æ¥çš„æ–‡ä»¶åï¼š`lsof -p PID | grep PORT `\n4. ç»“æœä¸­æœ‰è¡¨ç¤ºè¿›ç¨‹åœ¨è¿™ä¸ªç«¯å£ä¸Šçš„è¿æ¥çš„æ–‡ä»¶ç¼–å· ï¼šxxxu\n5. æŸ¥çœ‹æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ï¼š`ll /proc/PID/fd/xxx`\n6. ç»“æœæ ¼å¼ç±»ä¼¼`lrwx------ 1 root root 64 Jul 28 14:38 170 -> socket:[788102217]`\n7. æŸ¥çœ‹socketå¯¹åº”inodeä¿¡æ¯`netstat -altp | egrep -i 'Inode|788102217'`\n\n## Linuxä¸­æ ‡å‡†è¾“å…¥è¾“å‡º\n\næ ‡å‡†è¾“å…¥0    ä»é”®ç›˜è·å¾—è¾“å…¥ /proc/self/fd/0 \n\næ ‡å‡†è¾“å‡º1    è¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰ /proc/self/fd/1 \n\né”™è¯¯è¾“å‡º2    è¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰ /proc/self/fd/2 \n\n \n\n/dev/nullä»£è¡¨linuxçš„ç©ºè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€æœ‰å¾€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œä¿—ç§°â€œé»‘æ´â€ \n\n+ `2>/dev/null`æ„æ€å°±æ˜¯æŠŠé”™è¯¯è¾“å‡ºåˆ°â€œé»‘æ´â€ \n+ `>/dev/null 2>&1`é»˜è®¤æƒ…å†µæ˜¯1ï¼Œä¹Ÿå°±æ˜¯ç­‰åŒäº1>/dev/null 2>&1ã€‚æ„æ€å°±æ˜¯æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°â€œé»‘æ´â€ï¼Œè¿˜æŠŠé”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º1ï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½è¿›äº†â€œé»‘æ´â€ \n+ `2>&1 >/dev/null`æ„æ€å°±æ˜¯æŠŠé”™è¯¯è¾“å‡º2é‡å®šå‘åˆ°æ ‡å‡†å‡ºä¹¦1ï¼Œä¹Ÿå°±æ˜¯å±å¹•ï¼Œæ ‡å‡†è¾“å‡ºè¿›äº†â€œé»‘æ´â€ï¼Œä¹Ÿå°±æ˜¯æ ‡å‡†è¾“å‡ºè¿›äº†é»‘æ´ï¼Œé”™è¯¯è¾“å‡ºæ‰“å°åˆ°å±å¹• \n\nå…³äºè¿™é‡Œâ€&â€çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£2>/dev/nullé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œé‚£ä¹ˆ2>&1ï¼Œè¿™é‡Œå¦‚æœå»æ‰äº†&å°±æ˜¯æŠŠé”™è¯¯è¾“å‡ºç»™äº†æ–‡ä»¶1äº†ï¼Œç”¨äº†&æ˜¯è¡¨æ˜1æ˜¯æ ‡å‡†è¾“å‡ºã€‚\n\n## Linux è®¾ç½®å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é—´\n\n```bash\ncommand & pid=$!;sleep 2;kill -9 $pid\n```\n\n## JSå¯æ‹–æ‹½å…ƒç´ \n\n``` javascript\nfunction pauseEvent(e) {\n    if (e.stopPropagation) e.stopPropagation();\n    if (e.preventDefault) e.preventDefault();\n    e.cancelBubble = true;\n    e.returnValue = false;\n    return false;\n}\nlet dragableTar;\nlet winHeight = window.screen.height, winWidth = window.screen.width;\nlet startX,\n    startY,\n    currentLeft,\n    currentTop,\n    flag = 0;\ndocument.body.onmousedown = function (e) {\n    let tar = e.target;\n    if (tar.tagName == 'INPUT' || tar.tagName == 'A') {\n        return;\n    }\n\n    pauseEvent(e);\n    while (tar.parentNode) {\n        tar = tar.parentNode;\n        if (tar == document.body) {\n            break;\n        }\n        if (tar.className && tar.className.indexOf('dragable') >= 0) {\n            dragableTar = tar;\n            startX = e.clientX;\n            startY = e.clientY;\n            currentLeft = dragableTar.offsetLeft;ã€€ã€€//é€šè¿‡å¯¹è±¡è·å–å¯¹è±¡çš„åæ ‡\n            currentTop = dragableTar.offsetTop;\n            break;\n        }\n    }\n    let callback = (e) => {\n        if (dragableTar) {\n            let tarWidth = dragableTar.clientWidth||dragableTar.offsetWidth;\n            let tarHeight = dragableTar.clientHeight||dragableTar.offsetHeight;\n\n            let x = e.clientX;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//e.clientXæ˜¯ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶ï¼Œå³æ˜¯é¼ æ ‡ç‚¹å‡»æ—¶çš„Xè½´ä¸Šçš„åæ ‡\n            let y = e.clientY;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//e.clientYæ˜¯ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶ï¼Œå³æ˜¯é¼ æ ‡ç‚¹å‡»æ—¶çš„Yè½´ä¸Šçš„åæ ‡\n            let distanceX = x - startX;ã€€ã€€ã€€ã€€//Xè½´ä¸Šè·å¾—ç§»åŠ¨çš„å®é™…è·ç¦»\n            let distanceY = y - startY;ã€€ã€€ã€€ã€€ã€€//Yè½´ä¸Šè·å¾—ç§»åŠ¨çš„å®é™…è·ç¦»\n\n            let tarLeft = distanceX + currentLeft;\n            if (tarLeft >= 0 && tarLeft + tarWidth <= winWidth) {\n                dragableTar.style.left = (tarLeft) + \"px\";ã€€ã€€//currentLeftä¸‹é¢çš„æ–¹æ³•ä¼šæœ‰è§£é‡Šï¼Œéœ€è¦æ³¨æ„æœ€åè¦æ·»åŠ PXå•ä½ï¼Œå¦‚æœç»™leftèµ‹å€¼ä¼šç ´åæ–‡æ¡£æµï¼Œä¸åŠ å•ä½å°±ä¼šæ— æ•ˆ\n            }\n            let tarTop = distanceY + currentTop;\n            if (tarTop >= 0 && tarTop + tarHeight <= winHeight) {\n                dragableTar.style.top = (distanceY + currentTop) + \"px\";\n            }\n        }\n    }\n\n    console.log(dragableTar)\n    document.addEventListener('mousemove',callback);\n    document.addEventListener('mouseup', () => {\n        console.log('é¼ æ ‡UP')\n        document.removeEventListener('mousemove',callback);\n        if (tar.id == 'musicController') {\n            updateThumbnail(tar.offsetLeft, tar.offsetTop);\n        }\n        // pauseEvent(e);\n        dragableTar = null;\n    });\n```\n\n## åœ¨MyBatisä¸­å¼•ç”¨å¸¸é‡\n\n```xml\n${@å…¨ç±»å$å†…éƒ¨ç±»@å¸¸é‡å}\n${@com.wyouquan.coupon.entity.MarketingCouponDictionary$DeleteStatus@NOT_DELETED}\n```\n\n## SpringMVCå¤åˆå‚æ•°æ³¨å…¥å’ŒMybatiså¤åˆå‚æ•°ä½¿ç”¨\n\næ¥æ”¶å‚æ•°çš„Beanå®šä¹‰\n\n```java\npublic class Page {\n    private long total;\n    private Map<String, Object> paramMap;\n    private int limit;\n    private int offset;\n    private String orderBy;\n    ...\n}\n```\n\nè¦ä¼ é€’limitå’Œoffsetçš„åŒæ—¶ï¼Œè¿˜è¦å¾€paramMapé‡Œæ³¨å…¥å‚æ•°\n\nrequestè¯·æ±‚å¤´çš„`contentType`å€¼ä¸º`application/x-www-form-urlencoded`\n\nä¼ é€’çš„JSONå‚æ•°å€¼ä¸º\n\n```json\n{\n    'limit': 10,\n    'offset': 0,\n    'paramMap[type]': 1,\n    'orderBy': 'name'\n}\n```\n\nè¿™æ ·Controllerå±‚æ¥æ”¶åˆ°çš„å‚æ•°Pageä¸­çš„Mapé‡Œå°±åŒ…å«äº†æŒ‡å®šçš„å€¼ã€‚\n\nåœ¨Daoå±‚ä½¿ç”¨å¤åˆå‚æ•°Pageæ ¹æ®å¯¹è±¡çš„ä½¿ç”¨è§„åˆ™ï¼Œç”¨`.`è°ƒç”¨å³å¯\n\n```xml\nSELECT <include refid=\"Base_Column_List\"/>\nFROM marketing_coupons_dictionary\n<trim prefix=\"WHERE\" prefixOverrides=\"AND |OR \">\n    <if test=\"page.paramMap.type != null\">\n        dictionary_type = #{page.paramMap.type} AND\n    </if>\n    is_delete = ${@com.wyouquan.coupon.entity.MarketingCouponDictionary$DeleteStatus@NOT_DELETED}\n</trim>\n<if test=\"page.orderBy != null\">\n    ORDER BY #{page.orderBy}\n</if>\n<if test=\"page.offset != null and page.limit != null\">\n    LIMIT #{page.offset}, #{page.limit}\n</if>\n```\n\n## Shardingsphere 3.1.0åˆ†é¡µBug\n\nShardingSphereåœ¨3.1.0çš„ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ²¡æœ‰é…ç½®åˆ†è¡¨çš„æŸ¥è¯¢ï¼ŒlimitæŸ¥è¯¢ä¼šé»˜è®¤æŠŠå‰Næ¡è®°å½•éƒ½æŸ¥è¯¢å‡ºæ¥å†åšå¤„ç†ï¼Œæ¯”å¦‚limit 20, 10ï¼Œshardingsphereä¼šæŠŠæ‰€æœ‰åˆ†è¡¨çš„å‰30æ¡è®°å½•éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œå†æ•´åˆæ•°æ®é€‰æ‹©10æ¡ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰é…ç½®åˆ†è¡¨çš„æŸ¥è¯¢ï¼Œé»˜è®¤è¿”å›30æ¡è®°å½•ã€‚è¿™ä¸€bugåœ¨4.0.0-RC1ä¿®å¤ï¼Œä½†æ˜¯4.0.0ä¹‹å‰çš„ç‰ˆæœ¬çš„packageæ˜¯`shardingsphere.io`ï¼Œ4.0.0çš„ç‰ˆæœ¬packageæ˜¯`org.apache.shardingsphere`ï¼Œå¹¶ä¸”å‘½åç©ºé—´çš„schemaæ–‡ä»¶ä¹Ÿæœ‰ç›¸åº”çš„å˜åŒ–ï¼Œå¦‚æœIDEAæŠ¥æ‰¾ä¸åˆ°å‘½åç©ºé—´çš„æ–‡ä»¶é”™è¯¯ï¼Œéœ€è¦é¢å¤–å¯¼å…¥namespaceçš„åŒ…ã€‚\n\n```xml\n<!-- ShardingSphereåŒ… -->\n<dependency>\n    <groupId>org.apache.shardingsphere</groupId>\n    <artifactId>sharding-jdbc-core</artifactId>\n    <version>${shardingsphere.version}</version>\n</dependency>\n<!-- å‘½åç©ºé—´çš„åŒ… -->\n<dependency>\n    <groupId>org.apache.shardingsphere</groupId>\n    <artifactId>sharding-jdbc-spring-namespace</artifactId>\n    <version>${shardingsphere.version}</version>\n</dependency>\n```\n\n## MySQL 8.xç™»é™†å¤±è´¥`caching_sha2_password`\n\n8.0.4ç‰ˆæœ¬ä»¥ä¸Šï¼Œmysqlé»˜è®¤æˆæƒæ’ä»¶æ”¹æˆäº†caching_sha2_passwordæ¨¡å¼ï¼Œæ‰€ä»¥å®é™…è®¾ç½®çš„å¯†ç æ˜¯è¢«è½¬æ¢è¿‡çš„ã€‚ç”¨å¦‚ä¸‹æ–¹æ³•è§£å†³é—®é¢˜ï¼š\n\nå‘½ä»¤è¡Œç™»é™†MySQLä¹‹åï¼Œæ‰§è¡Œå‘½ä»¤ï¼š`ALTER USER 'username'@'ip_address' IDENTIFIED WITH mysql_native_password BY 'password';`\n\næ¯”å¦‚ï¼š`alter user 'root'@'%' identified with mysql_native_password by '123456';`\n\nä¿®æ”¹ä¹‹åå³å¯ç™»é™†ã€‚\n\n## MySQLæŸ¥è¯¢åˆ†ç»„çš„å‰Næ¡è®°å½•\n\næ¡ˆä¾‹ï¼šæŸ¥è¯¢å­¦ç”Ÿæˆç»©è¡¨`stu`ä¸­ï¼Œå„ç­ï¼ˆ`class`ï¼‰å„ç§‘ç›®ï¼ˆ`subject`ï¼‰çš„å‰10åï¼š\n\n```mysql\nSELECT * FROM `stu` AS a WHERE 10 > (SELECT COUNT(*) FROM `stu` WHERE class = a.class AND `subject` = a.`subject` AND score < a.score) ORDER BY a.class ASC,a.subject ASC,a.score DESC\n```\n\næ€»ç»“ï¼šæŸ¥è¯¢è¡¨ä¸­ï¼Œåˆ†ç»„1ï¼ˆå„ç­ï¼‰ã€åˆ†ç»„2ä¸‹ï¼ˆå„ç§‘ç›®ï¼‰ï¼ŒæŒ‰æ¡ä»¶ï¼ˆæˆç»©ï¼‰é™åºçš„å‰Nï¼ˆ10ï¼‰åï¼š\n\n```mysql\nSELECT * FROM è¡¨ AS a WHERE N > (SELECT COUNT(*) FROM è¡¨ WHERE åˆ†ç»„1=a.åˆ†ç»„1 AND åˆ†ç»„2=a.åˆ†ç»„2 AND æ¡ä»¶ < a.æ¡ä»¶) ORDER BY a.åˆ†ç»„1, a.åˆ†ç»„2, a.æ¡ä»¶ DESC\n```\n\n## JAVASCRIPTå˜é‡ä½œç”¨åŸŸ\n\n```javascript\nvar a = 10;\nfunction foo() {\n    console.log(a);\n    var a = 20;\n}\nfoo();\n```\n\nä¸Šè¿°ä»£ç æ‰“å°å€¼ä¸º`undefined`ï¼ŒåŸå› æ˜¯`var`å…³é”®å­—å£°æ˜çš„å˜é‡ä¼šè¢«æå‡ï¼Œå¹¶åœ¨å†…å­˜ä¸­åˆ†é…å€¼`undefined`ï¼Œå…·ä½“åˆå§‹åŒ–æ˜¯å‘ç”Ÿåœ¨èµ‹å€¼çš„åœ°æ–¹ã€‚å¦å¤–`var`å£°æ˜çš„å˜é‡ä½œç”¨åŸŸæ˜¯å‡½æ•°åŸºæœ¬çš„ï¼Œ`let`å’Œ`const`æ˜¯å—çº§åˆ«çš„ã€‚\n\næ‰€ä»¥åœ¨æ‰§è¡Œä¸Šè¿°foo()å‡½æ•°æ—¶ï¼Œåœ¨æ‰“å°å˜é‡`a`æ—¶ï¼Œå‡½æ•°å†…éƒ¨ç”¨`var`å£°æ˜å˜é‡ï¼Œä¼šåœ¨æ‰“å°ä¹‹å‰å±€éƒ¨å˜é‡ä¼šæå‡å¹¶åˆ†é…`undefined`ï¼Œæ‰§è¡Œåˆ°`var a = 20`æ—¶æ‰ä¼šåˆ†é…å…·ä½“å€¼ã€‚\n\n`let`å’Œ`const`å£°æ˜çš„å˜é‡ä¸ä¼šè¢«æå‡ï¼Œåªæœ‰æ‰§è¡Œåˆ°å£°æ˜çš„åœ°æ–¹æ‰èƒ½è®¿é—®ï¼Œæå‰è®¿é—®ä¼šæŠ›å‡º`ReferenceError`å¼‚å¸¸ã€‚ä¸‹é¢çš„ä»£ç ä¼šæŠ›å‡º`ReferenceError`å¼‚å¸¸ï¼š\n\n```javascript\nvar a = 10;\nfunction foo() {\n    console.log(a);\n    let a = 20;\n}\nfoo();\n```\n\n## Pythonå›¾ç‰‡å­—ç¬¦è¯†åˆ«tesserocrå¼‚å¸¸`RuntimeError: Failed to init API, possibly an invalid tessdata path: D:\\Python36\\/tessdata/`\n\n```python\nimport tesserocr\nfrom PIL import Image\nimage = Image.open('C:\\\\Users\\\\Administrator\\\\Desktop\\\\a.jpg')\nprint(tesserocr.image_to_text(image))\n```\n\nå°†Tesseract-OCRå®‰è£…è·¯å¾„ä¸‹çš„`tessdata`æ–‡ä»¶å¤¹æ‹·è´åˆ°pythonçš„å®‰è£…è·¯å¾„ä¸‹å³å¯ã€‚\n\n## javaç¨‹åºæ‰§è¡Œä¼šå¯åŠ¨çš„çº¿ç¨‹\n\n```java\npublic  static Thread[] findAllThread(){\n    ThreadGroup currentGroup =Thread.currentThread().getThreadGroup();\n    while (currentGroup.getParent()!=null){\n        // è¿”å›æ­¤çº¿ç¨‹ç»„çš„çˆ¶çº¿ç¨‹ç»„\n        currentGroup=currentGroup.getParent();\n    }\n    //æ­¤çº¿ç¨‹ç»„ä¸­æ´»åŠ¨çº¿ç¨‹çš„ä¼°è®¡æ•°\n    int noThreads = currentGroup.activeCount();\n    Thread[] lstThreads = new Thread[noThreads];\n    //æŠŠå¯¹æ­¤çº¿ç¨‹ç»„ä¸­çš„æ‰€æœ‰æ´»åŠ¨å­ç»„çš„å¼•ç”¨å¤åˆ¶åˆ°æŒ‡å®šæ•°ç»„ä¸­ã€‚\n    currentGroup.enumerate(lstThreads);\n    for (Thread thread : lstThreads) {\n        System.out.println(\"çº¿ç¨‹æ•°é‡ï¼š\"+noThreads+\" \" +\n                \"çº¿ç¨‹idï¼š\" + thread.getId() + \n                \" çº¿ç¨‹åç§°ï¼š\" + thread.getName() + \n                \" çº¿ç¨‹çŠ¶æ€ï¼š\" + thread.getState());\n    }\n    return lstThreads;\n}\n```\n\nè¾“å‡ºï¼š\n\n```\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š2 çº¿ç¨‹åç§°ï¼šReference Handler çº¿ç¨‹çŠ¶æ€ï¼šWAITING\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š3 çº¿ç¨‹åç§°ï¼šFinalizer çº¿ç¨‹çŠ¶æ€ï¼šWAITING\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š4 çº¿ç¨‹åç§°ï¼šSignal Dispatcher çº¿ç¨‹çŠ¶æ€ï¼šRUNNABLE\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š5 çº¿ç¨‹åç§°ï¼šAttach Listener çº¿ç¨‹çŠ¶æ€ï¼šRUNNABLE\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š1 çº¿ç¨‹åç§°ï¼šmain çº¿ç¨‹çŠ¶æ€ï¼šRUNNABLE\nçº¿ç¨‹æ•°é‡ï¼š6 çº¿ç¨‹idï¼š6 çº¿ç¨‹åç§°ï¼šMonitor Ctrl-Break çº¿ç¨‹çŠ¶æ€ï¼šRUNNABLE\n```\n\n| çº¿ç¨‹ | **æ‰€å±**     | **è¯´æ˜**     |\n| ------------------- | ------------ | ------------------------- |\n| ==Attach Listener==| JVM          | Attach Listenerçº¿ç¨‹æ˜¯è´Ÿè´£æ¥æ”¶åˆ°å¤–éƒ¨çš„å‘½ä»¤ï¼Œè€Œå¯¹è¯¥å‘½ä»¤è¿›è¡Œæ‰§è¡Œçš„å¹¶ä¸”å§ç»“æœè¿”å›ç»™å‘é€è€…ã€‚é€šå¸¸æˆ‘ä»¬ä¼šç”¨ä¸€äº›å‘½ä»¤å»è¦æ±‚jvmç»™æˆ‘ä»¬ä¸€äº›åé¦ˆä¿¡æ¯ï¼Œå¦‚ï¼šjava -versionã€jmapã€jstackç­‰ç­‰ã€‚å¦‚æœè¯¥çº¿ç¨‹åœ¨jvmå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£ä¹ˆï¼Œåˆ™ä¼šåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰§è¡Œjvmå‘½ä»¤æ—¶ï¼Œå¾—åˆ°å¯åŠ¨ã€‚ |\n| ==Signal Dispatcher== | JVM          | å‰é¢æˆ‘ä»¬æåˆ°ç¬¬ä¸€ä¸ªAttach Listenerçº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™signal dispatherçº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚signal dispatherçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚ |\n| CompilerThread0  | JVM          | ç”¨æ¥è°ƒç”¨JITingï¼Œå®æ—¶ç¼–è¯‘è£…å¸classã€‚é€šå¸¸ï¼Œjvmä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œä¾‹å¦‚ï¼šCompilerThread1 |\n| ConcurrentMark-SweepGCThread| JVM          | å¹¶å‘æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„CMS GCï¼‰çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºè€å¹´ä»£åƒåœ¾å›æ”¶ã€‚psï¼šå¯ç”¨è¯¥åƒåœ¾å›æ”¶å™¨ï¼Œéœ€è¦åœ¨jvmå¯åŠ¨å‚æ•°ä¸­åŠ ä¸Šï¼š-XX:+UseConcMarkSweepGC |\n| DestroyJavaVM| JVM          | æ‰§è¡Œmain()çš„çº¿ç¨‹åœ¨mainæ‰§è¡Œå®Œåè°ƒç”¨JNIä¸­çš„jni_DestroyJavaVM()æ–¹æ³•å”¤èµ·DestroyJavaVMçº¿ç¨‹ã€‚  JVMåœ¨JbossæœåŠ¡å™¨å¯åŠ¨ä¹‹åï¼Œå°±ä¼šå”¤èµ·DestroyJavaVMçº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjavaçº¿ç¨‹å’Œnativeçº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½JVMã€‚çº¿ç¨‹é€€å‡ºæ—¶ï¼Œéƒ½ä¼šåˆ¤æ–­è‡ªå·±å½“å‰æ˜¯å¦æ˜¯æ•´ä¸ªJVMä¸­æœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€šçŸ¥DestroyJavaVMçº¿ç¨‹å¸è½½JVMã€‚psï¼šæ‰©å±•ä¸€ä¸‹ï¼š1.å¦‚æœçº¿ç¨‹é€€å‡ºæ—¶åˆ¤æ–­è‡ªå·±ä¸ä¸ºæœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œé‚£ä¹ˆè°ƒç”¨thread->exit(false)ï¼Œå¹¶åœ¨å…¶ä¸­æŠ›å‡ºthread_endäº‹ä»¶ï¼Œjvmä¸é€€å‡ºã€‚2.å¦‚æœçº¿ç¨‹é€€å‡ºæ—¶åˆ¤æ–­è‡ªå·±ä¸ºæœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œé‚£ä¹ˆè°ƒç”¨before_exit()æ–¹æ³•ï¼ŒæŠ›å‡ºä¸¤ä¸ªäº‹ä»¶ï¼š äº‹ä»¶1ï¼šthread_endçº¿ç¨‹ç»“æŸäº‹ä»¶ã€äº‹ä»¶2ï¼šVMçš„deathäº‹ä»¶ã€‚ç„¶åè°ƒç”¨thread->exit(true)æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æŠŠçº¿ç¨‹ä»active listå¸ä¸‹ï¼Œåˆ é™¤çº¿ç¨‹ç­‰ç­‰ä¸€ç³»åˆ—å·¥ä½œæ‰§è¡Œå®Œæˆåï¼Œåˆ™é€šçŸ¥æ­£åœ¨ç­‰å¾…çš„DestroyJavaVMçº¿ç¨‹æ‰§è¡Œå¸è½½JVMæ“ä½œã€‚ |\n| ContainerBackgroundProcessor| JBOSS        | å®ƒæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹,åœ¨jbossæœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å°±åˆå§‹åŒ–äº†,ä¸»è¦å·¥ä½œæ˜¯å®šæœŸå»æ£€æŸ¥æœ‰æ²¡æœ‰Sessionè¿‡æœŸ.è¿‡æœŸåˆ™æ¸…é™¤.å‚è€ƒï¼šhttp://liudeh-009.iteye.com/blog/1584876 |\n| ConfigClientNotifier| ConfigServer | ConfigServeræœåŠ¡ç«¯å½“æœ‰é…ç½®å˜æ›´æ—¶ï¼Œå°±ä¼šå°†æœ€æ–°çš„é…ç½®æ¨é€åˆ°ConfigServerå®¢æˆ·ç«¯çš„ä¸€ä¸ªæ•°æ®åˆ—é˜Ÿä¸­ï¼ŒConfigClientNotifierçº¿ç¨‹ç”¨äºå®šæœŸæ£€æŸ¥è¯¥æ•°æ®åˆ—é˜Ÿä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™å°†æ•°æ®åˆ†å‘åˆ°è®¢é˜…è¯¥æ•°æ®çš„ç»„ä»¶å»åšä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ï¼štairå’Œhsfçš„æ•°æ®éƒ½è®¢é˜…äº†ConfigServeræ•°æ®æº,å½“ConfigClientNotifierçº¿ç¨‹å‘ç°æ•°æ®æœ‰æ›´æ–°æ—¶ï¼Œå°±è§¦å‘åšæ•°æ®åˆ†å‘ç‰¹å®šç‰¹å®šä¿¡å·æ ‡è¯†å°†æ•°æ®åˆ†å‘åˆ°ç›¸åº”çš„è®¢é˜…è€…ã€‚ |\n| ConfigClientWorker-Default| ConfigServer | åŒ…æ‹¬ä¸»åŠ¨å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ï¼ˆä¸»è¦æ˜¯è®¢é˜…å’Œå‘å¸ƒçš„æ•°æ®ï¼‰å’Œæ¥æ”¶æœåŠ¡å™¨æ¨é€è¿‡æ¥çš„æ•°æ®ï¼ˆä¸»è¦æ˜¯è®¢é˜…æ•°æ®çš„å€¼ï¼‰ ã€‚ |\n| Dispatcher-Thread-3| Log4j        | Log4jå…·æœ‰å¼‚æ­¥æ‰“å°æ—¥å¿—çš„åŠŸèƒ½ï¼Œéœ€è¦å¼‚æ­¥æ‰“å°æ—¥å¿—çš„Appenderéƒ½éœ€è¦æ³¨å†Œåˆ°AsyncAppenderå¯¹è±¡é‡Œé¢å»ï¼Œç”±AsyncAppenderè¿›è¡Œç›‘å¬ï¼Œå†³å®šä½•æ—¶è§¦å‘æ—¥å¿—æ‰“å°æ“ä½œã€‚AsyncAppenderå¦‚æœç›‘å¬åˆ°å®ƒç®¡è¾–èŒƒå›´å†…çš„Appenderæœ‰æ‰“å°æ—¥å¿—çš„æ“ä½œï¼Œåˆ™ç»™è¿™ä¸ªAppenderç”Ÿæˆä¸€ä¸ªç›¸åº”çš„eventï¼Œå¹¶å°†è¯¥eventä¿å­˜åœ¨ä¸€ä¸ªbuffueråŒºåŸŸå†…ã€‚ Dispatcher-Thread-3çº¿ç¨‹è´Ÿè´£åˆ¤æ–­è¿™ä¸ªeventç¼“å­˜åŒºæ˜¯å¦å·²ç»æ»¡äº†ï¼Œå¦‚æœå·²ç»æ»¡äº†ï¼Œåˆ™å°†ç¼“å­˜åŒºå†…çš„æ‰€æœ‰eventåˆ†å‘åˆ°Appenderå®¹å™¨é‡Œé¢å»ï¼Œé‚£äº›æ³¨å†Œä¸Šæ¥çš„Appenderæ”¶åˆ°è‡ªå·±çš„eventåï¼Œåˆ™å¼€å§‹å¤„ç†è‡ªå·±çš„æ—¥å¿—æ‰“å°å·¥ä½œã€‚Dispatcher-Thread-3çº¿ç¨‹æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚ |\n| ==Finalizerçº¿ç¨‹==| JVM          | è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨mainçº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼›å…³äºFinalizerçº¿ç¨‹çš„å‡ ç‚¹ï¼š1)åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼›2)è¯¥çº¿ç¨‹ä¹Ÿæ˜¯daemonçº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–édaemonçº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œfinalize()æ–¹æ³•ï¼ŒJVMä¹Ÿä¼šé€€å‡ºï¼›3) JVMåœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆFinalizerå¯¹è±¡ï¼ˆReferenceçš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ReferenceQueueï¼Œç”±Finalizerçº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥Finalizerå¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼›4) JVMä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œfinalize()æ–¹æ³•å‘¢ï¼Ÿå¦‚æœJVMçš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´GCçº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹GCçº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ï¼› |\n| Gang worker#0| JVM          | JVMç”¨äºåšæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼ˆmonir gcï¼‰çš„ä¸€ä¸ªçº¿ç¨‹ã€‚#å·åé¢æ˜¯çº¿ç¨‹ç¼–å·ï¼Œä¾‹å¦‚ï¼šGang worker#1 |\n| GC Daemon | JVM          | GC Daemonçº¿ç¨‹æ˜¯JVMä¸ºRMIæä¾›è¿œç¨‹åˆ†å¸ƒå¼GCä½¿ç”¨çš„ï¼ŒGC Daemonçº¿ç¨‹é‡Œé¢ä¼šä¸»åŠ¨è°ƒç”¨System.gc()æ–¹æ³•ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡ŒFull GCã€‚ å…¶åˆè¡·æ˜¯å½“RMIæœåŠ¡å™¨è¿”å›ä¸€ä¸ªå¯¹è±¡åˆ°å…¶å®¢æˆ·æœºï¼ˆè¿œç¨‹æ–¹æ³•çš„è°ƒç”¨æ–¹ï¼‰æ—¶ï¼Œå…¶è·Ÿè¸ªè¿œç¨‹å¯¹è±¡åœ¨å®¢æˆ·æœºä¸­çš„ä½¿ç”¨ã€‚å½“å†æ²¡æœ‰æ›´å¤šçš„å¯¹å®¢æˆ·æœºä¸Šè¿œç¨‹å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œæˆ–è€…å¦‚æœå¼•ç”¨çš„â€œç§Ÿå€Ÿâ€è¿‡æœŸå¹¶ä¸”æ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨å°†åƒåœ¾å›æ”¶è¿œç¨‹å¯¹è±¡ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ç°åœ¨jvmå¯åŠ¨å‚æ•°éƒ½åŠ ä¸Šäº†-XX:+DisableExplicitGCé…ç½®ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªçº¿ç¨‹åªæœ‰æ‰“é…±æ²¹çš„ä»½äº†ã€‚ |\n| IdleRemover | JBOSS        | Jbossè¿æ¥æ± æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼Œè¯¥çº¿ç¨‹æ¯è¿‡ä¸€æ®µæ—¶é—´éƒ½ä¼šè¢«Jbosså”¤èµ·ï¼Œç”¨äºæ£€æŸ¥å’Œé”€æ¯è¿æ¥æ± ä¸­ç©ºé—²å’Œæ— æ•ˆçš„è¿æ¥ï¼Œç›´åˆ°å‰©ä½™çš„è¿æ¥æ•°å°äºç­‰äºå®ƒçš„æœ€å°å€¼ã€‚ |\n| Java2D Disposer| JVM          | è¿™ä¸ªçº¿ç¨‹ä¸»è¦æœåŠ¡äºawtçš„å„ä¸ªç»„ä»¶ã€‚è¯´èµ·è¯¥çº¿ç¨‹çš„ä¸»è¦å·¥ä½œèŒè´£å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹Disposerç±»æ˜¯å¹²å˜›çš„ã€‚Disposeræä¾›ä¸€ä¸ªaddRecordæ–¹æ³•ã€‚å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯å‰å†åšä¸€äº›å–„åå·¥ä½œï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥è°ƒç”¨Disposer#addRecordæ–¹æ³•ï¼Œå°†è¿™ä¸ªå¯¹è±¡å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„DisposerRecordæ¥å£å®ç°ç±»ï¼Œä¸€èµ·ä¼ å…¥è¿›å»ï¼Œè¿›è¡Œæ³¨å†Œã€‚Disposerç±»ä¼šå”¤èµ·â€œJava2D Disposerâ€çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šæ‰«æå·²æ³¨å†Œçš„è¿™äº›å¯¹è±¡æ˜¯å¦è¦è¢«å›æ”¶äº†ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨è¯¥å¯¹è±¡å¯¹åº”çš„DisposerRecordå®ç°ç±»é‡Œé¢çš„disposeæ–¹æ³•ã€‚Disposerå®é™…ä¸Šä¸é™äºåœ¨awtåº”ç”¨åœºæ™¯ï¼Œåªæ˜¯awté‡Œé¢çš„å¾ˆå¤šç»„ä»¶éœ€è¦è®¿é—®å¾ˆå¤šæ“ä½œç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ï¼Œè¿™äº›ç»„ä»¶åœ¨è¢«å›æ”¶æ—¶ï¼Œéœ€è¦å…ˆé‡Šæ”¾è¿™äº›èµ„æºã€‚ |\n| FelixDispatchQueue | Sofa         | è¯¥çº¿ç¨‹ä¼šåœ¨sofaå¯åŠ¨æ—¶ä¼šå”¤èµ·è¯¥çº¿ç¨‹,è¯¥çº¿ç¨‹ç”¨äºåˆ†å‘OSGIäº‹ä»¶åˆ°Declarative Services ä¸­å»å‘å¸ƒï¼ŒæŸ¥æ‰¾ï¼Œç»‘å®šç›®æ ‡æœåŠ¡ã€‚å…¶å®ï¼Œæˆ‘ä»¬æ¥å£é…ç½®çš„serviceå’Œreferenceå°±æ¶‰åŠåˆ°æœåŠ¡çš„å‘å¸ƒã€æŸ¥æ‰¾å’Œç»‘å®šå·¥ä½œã€‚  Declarative Services ä¸»è¦å·¥ä½œèŒè´£æ˜¯æ–¹ä¾¿åœ°å¯¹æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å’ŒçŠ¶æ€è¿›è¡Œç›‘å¬å’Œç®¡ç†ã€‚OSGIä½¿ç”¨äº‹ä»¶ç­–ç•¥å»è°ƒç”¨Declarative Servicesä¸­çš„æœåŠ¡ã€‚ |\n| InsttoolCacheScheduler_QuartzSchedulerThread| Quartz       | InsttoolCacheScheduler_QuartzSchedulerThreadæ˜¯Quartzçš„ä¸»çº¿ç¨‹ï¼Œå®ƒä¸»è¦è´Ÿè´£å®æ—¶çš„è·å–ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹è¦è§¦å‘çš„è§¦å‘å™¨ï¼Œç„¶åæ‰§è¡Œè§¦å‘å™¨ç›¸å…³è”çš„ä½œä¸šã€‚åŸç†å¤§è‡´å¦‚ä¸‹ï¼šSpringå’ŒQuartzç»“åˆä½¿ç”¨çš„åœºæ™¯ä¸‹ï¼ŒSpring IOCå®¹å™¨åˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºå¹¶åˆå§‹åŒ–Quartzçº¿ç¨‹æ± ï¼ˆTreadPoolï¼‰ï¼Œå¹¶å¯åŠ¨å®ƒã€‚åˆšå¯åŠ¨æ—¶çº¿ç¨‹æ± ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å¤–ç•Œç»™ä»–åˆ†é…Runnableï¼ˆæŒæœ‰ä½œä¸šå¯¹è±¡çš„çº¿ç¨‹ï¼‰ã€‚ç»§è€Œæ¥ç€åˆå§‹åŒ–å¹¶å¯åŠ¨Quartzçš„ä¸»çº¿ç¨‹ï¼ˆInsttoolCacheScheduler_QuartzSchedulerThreadï¼‰ï¼Œè¯¥çº¿ç¨‹è‡ªå¯åŠ¨åå°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ã€‚ç­‰å¾…å¤–ç•Œç»™å‡ºå·¥ä½œä¿¡å·ä¹‹åï¼Œè¯¥ä¸»çº¿ç¨‹çš„runæ–¹æ³•æ‰å®è´¨ä¸Šå¼€å§‹å·¥ä½œã€‚runä¸­ä¼šè·å–JobStoreä¸­ä¸‹ä¸€æ¬¡è¦è§¦å‘çš„ä½œä¸šï¼Œæ‹¿åˆ°ä¹‹åä¼šä¸€ç›´ç­‰å¾…åˆ°è¯¥ä½œä¸šçš„çœŸæ­£è§¦å‘æ—¶é—´ï¼Œç„¶åå°†è¯¥ä½œä¸šåŒ…è£…æˆä¸€ä¸ªJobRunShellå¯¹è±¡ï¼ˆè¯¥å¯¹è±¡å®ç°äº†Runnableæ¥å£ï¼Œå…¶å®çœ‹æ˜¯ä¸Šé¢TreadPoolä¸­ç­‰å¾…å¤–ç•Œåˆ†é…ç»™ä»–çš„Runnableï¼‰ï¼Œç„¶åå°†åˆšåˆ›å»ºçš„JobRunShelläº¤ç»™çº¿ç¨‹æ± ï¼Œç”±çº¿ç¨‹æ± è´Ÿè´£æ‰§è¡Œä½œä¸šã€‚çº¿ç¨‹æ± æ”¶åˆ°Runnableåï¼Œä»çº¿ç¨‹æ± ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨Runnableï¼Œåå°„è°ƒç”¨JobRunShellä¸­çš„runæ–¹æ³•ï¼Œrunæ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åï¼ŒTreadPoolå°†è¯¥çº¿ç¨‹å›æ”¶è‡³ç©ºé—²çº¿ç¨‹ä¸­ã€‚ |\n| InsttoolCacheScheduler_Worker-2| Quartz       | InsttoolCacheScheduler_Worker-2çº¿ç¨‹å°±æ˜¯ThreadPoolçº¿ç¨‹çš„ä¸€ä¸ªç®€å•å®ç°ï¼Œå®ƒä¸»è¦è´Ÿè´£åˆ†é…çº¿ç¨‹èµ„æºå»æ‰§è¡ŒInsttoolCacheScheduler_QuartzSchedulerThreadçº¿ç¨‹äº¤ç»™å®ƒçš„è°ƒåº¦ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯JobRunShellï¼‰ã€‚ |\n| java.util.concurrent.ThreadPoolExecutor$Worker| JVM          |                                                              |\n| JBossLifeThread| Jboss        | Jbossä¸»çº¿ç¨‹å¯åŠ¨æˆåŠŸï¼Œåº”ç”¨ç¨‹åºéƒ¨ç½²å®Œæ¯•ä¹‹åå°†JBossLifeThreadçº¿ç¨‹å®ä¾‹åŒ–å¹¶ä¸”startï¼ŒJBossLifeThreadçº¿ç¨‹å¯åŠ¨æˆåŠŸä¹‹åå°±å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä»¥ä¿æŒJboss Javaè¿›ç¨‹å¤„äºå­˜æ´»ä¸­ã€‚ æ‰€å¾—æ¯”è¾ƒé€šä¿—ä¸€ç‚¹ï¼Œå°±æ˜¯Jbosså¯åŠ¨æµç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç»“æŸï¼Ÿå°±æ˜¯å› ä¸ºæœ‰è¿™ä¸ªçº¿ç¨‹holdä¸»äº†å®ƒã€‚ç‰›bå§ï½ï½ |\n| JBoss System Threads(1)-1| Jboss        | è¯¥çº¿ç¨‹æ˜¯ä¸€ä¸ªsocketæœåŠ¡ï¼Œé»˜è®¤ç«¯å£å·ä¸ºï¼š1099ã€‚ä¸»è¦ç”¨äºæ¥æ”¶å¤–éƒ¨naming serviceï¼ˆJboss JNDIï¼‰è¯·æ±‚ã€‚ |\n| JCA PoolFiller| Jboss        | è¯¥çº¿ç¨‹ä¸»è¦ä¸ºJBosså†…éƒ¨æä¾›è¿æ¥æ± çš„æ‰˜ç®¡ã€‚ ç®€å•ä»‹ç»ä¸€ä¸‹å·¥ä½œåŸç† ï¼šJbosså†…éƒ¨å‡¡æ˜¯æœ‰è¿œç¨‹è¿æ¥éœ€æ±‚çš„ç±»ï¼Œéƒ½éœ€è¦å®ç°ManagedConnectionFactoryæ¥å£ï¼Œä¾‹å¦‚éœ€è¦åšJDBCè¿æ¥çš„XAManagedConnectionFactoryå¯¹è±¡ï¼Œå°±å®ç°äº†è¯¥æ¥å£ã€‚ç„¶åå°†XAManagedConnectionFactoryå¯¹è±¡ï¼Œè¿˜æœ‰å…¶å®ƒä¿¡æ¯ä¸€èµ·åŒ…è£…åˆ°InternalManagedConnectionPoolå¯¹è±¡é‡Œé¢ï¼Œæ¥ç€å°†InternalManagedConnectionPooläº¤ç»™PoolFillerå¯¹è±¡é‡Œé¢çš„åˆ—é˜Ÿè¿›è¡Œç®¡ç†ã€‚  JCA PoolFillerçº¿ç¨‹ä¼šå®šæœŸåˆ¤æ–­åˆ—é˜Ÿå†…æ˜¯å¦æœ‰éœ€è¦åˆ›å»ºå’Œç®¡ç†çš„InternalManagedConnectionPoolå¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™è°ƒç”¨è¯¥å¯¹è±¡çš„fillToMinæ–¹æ³•ï¼Œè§¦å‘å®ƒå»åˆ›å»ºç›¸åº”çš„è¿œç¨‹è¿æ¥ï¼Œå¹¶ä¸”å°†è¿™ä¸ªè¿æ¥ç»´æŠ¤åˆ°å®ƒç›¸åº”çš„è¿æ¥æ± é‡Œé¢å»ã€‚ |\n| JDWP Event Helper Thread| JVM          | JDWPæ˜¯é€šè®¯äº¤äº’åè®®ï¼Œå®ƒå®šä¹‰äº†è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•ç¨‹åºä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ ¼å¼ã€‚å®ƒè¯¦ç»†å®Œæ•´åœ°å®šä¹‰äº†è¯·æ±‚å‘½ä»¤ã€å›åº”æ•°æ®å’Œé”™è¯¯ä»£ç ï¼Œä¿è¯äº†å‰ç«¯å’Œåç«¯çš„JVMTIå’ŒJDIçš„é€šä¿¡é€šç•…ã€‚ è¯¥çº¿ç¨‹ä¸»è¦è´Ÿè´£å°†JDIäº‹ä»¶æ˜ å°„æˆJVMTIä¿¡å·ï¼Œä»¥è¾¾åˆ°è°ƒè¯•è¿‡ç¨‹ä¸­æ“ä½œJVMçš„ç›®çš„ã€‚ |\n| JDWP TransportListener: dt_socket| JVM          | è¯¥çº¿ç¨‹æ˜¯ä¸€ä¸ªJava Debuggerçš„ç›‘å¬å™¨çº¿ç¨‹ï¼Œè´Ÿè´£å—ç†å®¢æˆ·ç«¯çš„debugè¯·æ±‚ã€‚é€šå¸¸æˆ‘ä»¬ä¹ æƒ¯å°†å®ƒçš„ç›‘å¬ç«¯å£è®¾ç½®ä¸º8787ã€‚ |\n| Low MemoryDetector| JVM          | è¿™ä¸ªçº¿ç¨‹æ˜¯è´Ÿè´£å¯¹å¯ä½¿ç”¨å†…å­˜è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°å¯ç”¨å†…å­˜ä½ï¼Œåˆ†é…æ–°çš„å†…å­˜ç©ºé—´ã€‚ |\n| process reaper| JVM          | è¯¥çº¿ç¨‹è´Ÿè´£å»æ‰§è¡Œä¸€ä¸ªOSå‘½ä»¤è¡Œçš„æ“ä½œã€‚                         |\n| ==Reference Handler==| JVM          | JVMåœ¨åˆ›å»ºmainçº¿ç¨‹åå°±åˆ›å»ºReference Handlerçº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ã€‚ |\n| SurrogateLockerThread(CMS)| JVM          | è¿™ä¸ªçº¿ç¨‹ä¸»è¦ç”¨äºé…åˆCMSåƒåœ¾å›æ”¶å™¨ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä¸»è¦è´Ÿè´£å¤„ç†GCè¿‡ç¨‹ä¸­ï¼ŒJavaå±‚çš„Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸jvmå†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚è¿™é‡Œå¯¹å®ƒä»¬çš„å®ç°ç¨å¾®åšä¸€ä¸‹ä»‹ç»ï¼šè¿™é‡Œæ‹¿WeakHashMapåšä¾‹å­ï¼Œå°†ä¸€äº›å…³é”®ç‚¹å…ˆåˆ—å‡ºæ¥ï¼ˆæˆ‘ä»¬åé¢ä¼šå°†è¿™äº›å…³é”®ç‚¹å…¨éƒ¨ä¸²èµ·æ¥ï¼‰ï¼š1.   æˆ‘ä»¬çŸ¥é“HashMapç”¨Entry[]æ•°ç»„æ¥å­˜å‚¨æ•°æ®çš„ï¼ŒWeakHashMapä¹Ÿä¸ä¾‹å¤–,å†…éƒ¨æœ‰ä¸€ä¸ªEntry[]æ•°ç»„ã€‚2.    WeakHashMapçš„Entryæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æ„ä¸ºEntry->WeakReference->Referenceã€‚3.   Referenceé‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºpending_lock.  æ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ã€‚4.   Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingã€‚5. Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandlerçš„çº¿ç¨‹ï¼Œå®ƒåœ¨staticå—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®Œæˆåå¤„äºwaitçŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ªLockåŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ã€‚6.   å¦å¤–ï¼ŒWeakHashMapé‡Œé¢è¿˜å®ä¾‹åŒ–äº†ä¸€ä¸ªReferenceQueueåˆ—é˜Ÿï¼Œè¿™ä¸ªåˆ—é˜Ÿçš„ä½œç”¨ï¼Œåé¢ä¼šæåˆ°ã€‚7.   ä¸Šé¢å…³é”®ç‚¹å°±ä»‹ç»å®Œæ¯•äº†ï¼Œä¸‹é¢æˆ‘ä»¬æŠŠä»–ä»¬ä¸²èµ·æ¥ã€‚  å‡è®¾ï¼ŒWeakHashMapå¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ã€‚JVMåœ¨è¿›è¡ŒCMS GCçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªConcurrentMarkSweepThreadï¼ˆç®€ç§°CMSTï¼‰çº¿ç¨‹å»è¿›è¡ŒGCï¼ŒConcurrentMarkSweepThreadçº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªSurrogateLockerThreadï¼ˆç®€ç§°SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLTå¯åŠ¨ä¹‹åï¼Œå¤„äºç­‰å¾…é˜¶æ®µã€‚CMSTå¼€å§‹GCæ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™SLTè®©å®ƒå»è·å–Javaå±‚Referenceå¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ç›´åˆ°CMS GCå®Œæ¯•ä¹‹åï¼ŒJVMä¼šå°†WeakHashMapä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„WeakReferenceå®¹å™¨å¯¹è±¡æ”¾å…¥åˆ°Referenceçš„pendingå±æ€§å½“ä¸­ï¼ˆæ¯æ¬¡GCå®Œæ¯•ä¹‹åï¼Œpendingå±æ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸ºnulläº†ï¼‰ï¼Œç„¶åé€šçŸ¥SLTé‡Šæ”¾å¹¶ä¸”notifyå…¨å±€é”:Lockã€‚æ­¤æ—¶æ¿€æ´»äº†ReferenceHandlerçº¿ç¨‹çš„runæ–¹æ³•ï¼Œä½¿å…¶è„±ç¦»waitçŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚ReferenceHandlerè¿™ä¸ªçº¿ç¨‹ä¼šå°†pendingä¸­çš„æ‰€æœ‰WeakReferenceå¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ªWeakReferenceå±äºæŸä¸ªWeakHashMapå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ReferenceQueueåˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ã€‚å½“æˆ‘ä»¬ä¸‹æ¬¡ä»WeakHashMapå¯¹è±¡é‡Œé¢getã€putæ•°æ®æˆ–è€…è°ƒç”¨sizeæ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMapå°±ä¼šå°†ReferenceQueueåˆ—é˜Ÿä¸­çš„WeakReferenceä¾ä¾pollå‡ºæ¥å»å’ŒEntry[]æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜è¿™ä¸ªEntryæ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢«GCæ‰äº†ï¼Œé‚£ä¹ˆå°†Entry[]å†…çš„Entryå¯¹è±¡å‰”é™¤æ‰ã€‚ |\n| taskObjectTimerFactory| JVM          | é¡¾åæ€ä¹‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚å½“æˆ‘ä»¬æŠŠä¸€ä¸ªä»»åŠ¡äº¤ç»™Timerå¯¹è±¡ï¼Œå¹¶ä¸”å‘Šè¯‰å®ƒæ‰§è¡Œæ—¶é—´ï¼Œå‘¨æœŸæ—¶é—´åï¼ŒTimerå°±ä¼šå°†è¯¥ä»»åŠ¡æ”¾å…¥ä»»åŠ¡åˆ—é˜Ÿï¼Œå¹¶ä¸”é€šçŸ¥taskObjectTimerFactoryçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼ŒtaskObjectTimerFactoryçº¿ç¨‹ä¼šå°†çŠ¶æ€ä¸ºå–æ¶ˆçš„ä»»åŠ¡ä»ä»»åŠ¡åˆ—é˜Ÿä¸­ç§»é™¤ï¼Œå¦‚æœä»»åŠ¡æ˜¯éé‡å¤æ‰§è¡Œç±»å‹çš„ï¼Œåˆ™åœ¨æ‰§è¡Œå®Œè¯¥ä»»åŠ¡åï¼Œå°†å®ƒä»ä»»åŠ¡åˆ—é˜Ÿä¸­ç§»é™¤ï¼Œå¦‚æœè¯¥ä»»åŠ¡æ˜¯éœ€è¦é‡å¤æ‰§è¡Œçš„ï¼Œåˆ™è®¡ç®—å‡ºå®ƒä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚ |\n| VM Periodic Task Thread| JVM          | è¯¥çº¿ç¨‹æ˜¯JVMå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”±WatcherThreadåˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¯¥çº¿ç¨‹åœ¨JVMå†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æ§ã€JVMè¿è¡ŒçŠ¶å†µç›‘æ§ï¼Œè¿˜æœ‰æˆ‘ä»¬ç»å¸¸éœ€è¦å»æ‰§è¡Œä¸€äº›jstatè¿™ç±»å‘½ä»¤æŸ¥çœ‹gcçš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼šjstat -gcutil 23483 250 7 è¿™ä¸ªå‘½ä»¤å‘Šè¯‰jvmåœ¨æ§åˆ¶å°æ‰“å°PIDä¸ºï¼š23483çš„gcæƒ…å†µï¼Œé—´éš”250æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œä¸€å…±æ‰“å°7æ¬¡ã€‚ |\n| VM Thread| JVM          | è¿™ä¸ªçº¿ç¨‹å°±æ¯”è¾ƒç‰›bäº†ï¼Œæ˜¯jvmé‡Œé¢çš„çº¿ç¨‹æ¯ä½“ï¼Œæ ¹æ®hotspotæºç ï¼ˆvmThread.hppï¼‰é‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¸ªçš„VMçº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº›VMæ“ä½œï¼ˆå¦‚ï¼Œæ¸…æ‰«åƒåœ¾ç­‰ï¼‰ã€‚åœ¨ VMThreadçš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªVMOperationQueueåˆ—é˜Ÿï¼Œæ‰€æœ‰çš„VMçº¿ç¨‹æ“ä½œ(vm_operation)éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThreadæœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„loopå‡½æ•°(å…·ä½“å¯ä»¥å‚è€ƒï¼šVMThread.cppé‡Œé¢çš„void VMThread::loop())ï¼Œè¯¥loopå‡½æ•°ä»VMOperationQueueåˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡(VM_Operation)ï¼Œå¹¶ä¸”è°ƒç”¨VM_Operation->evaluateå‡½æ•°å»æ‰§è¡Œè¯¥æ“ä½œç±»å‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚psï¼šVMæ“ä½œç±»å‹è¢«å®šä¹‰åœ¨vm_operations.hppæ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€ThreadDumpã€PrintThreadsã€GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦..æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è‡ªå·±å»æŸ¥çœ‹æºæ–‡ä»¶ã€‚ |\n\n## Markdownç”»ç±»å›¾\n\n~~~markdown\n``` mermaid\nclassDiagram\n  classA --|> classB : ç»§æ‰¿\n  classC --* classD : ç»„æˆ\n  classE --o classF : é›†åˆ\n  classG --> classH : å…³è”\n  classI -- classJ : å®çº¿è¿æ¥\n  classK ..> classL : ä¾èµ–\n  classM ..|> classN : å®ç°\n  classO .. classP : è™šçº¿è¿æ¥\n```\n~~~\n\n``` mermaid\nclassDiagram\n  classA --|> classB : ç»§æ‰¿\n  classC --* classD : ç»„æˆ\n  classE --o classF : é›†åˆ\n  classG --> classH : å…³è”\n  classI -- classJ : å®çº¿è¿æ¥\n  classK ..> classL : ä¾èµ–\n  classM ..|> classN : å®ç°\n  classO .. classP : è™šçº¿è¿æ¥\n```\n\n---\n\n\n\n``` mermaid\nclassDiagram\n\tBird --|> Animal: ç»§æ‰¿\n\tWing \"2\" --> \"1\" Bird: ç»„åˆ\n\tAnimal ..> Oxygen: ä¾èµ–\n\tAnimal ..> Water: ä¾èµ–\n\tclass Animal {\n\t\t<<interface>>\n\t\t+ Life life\n\t\t+ Breathe(Oxygen)\n\t\t+ Reproduction()\n\t}\n\tclass Bird {\n\t\t+ feature\n\t\t+ beak\n\t\t+ layEgg() Egg\n\t}\n```\n\n## Cè¯­è¨€printfçš„å ä½ç¬¦\n\n1. å®½åº¦é™å®š\n\n   `printf(\"%5d\\n\", 123)`ï¼Œé»˜è®¤==å³å¯¹é½==ï¼Œé•¿åº¦ä¸º5ï¼Œå‰é¢è¡¥2ä½ç©ºæ ¼\n\n   `printf(\"%-5d\\n\", 123)`ï¼Œé•¿åº¦å‰åŠ ä¸ªå‡å·-ï¼Œæ”¹ä¸ºå·¦å¯¹é½ï¼Œåé¢è¡¥2ä½ç©ºæ ¼\n\n2. æ˜¾ç¤ºæ­£è´Ÿå·\n\n   è´Ÿæ•°å‰é¢æ€»æ˜¯æ˜¾ç¤ºå‡å·-ï¼Œæ­£æ•°é»˜è®¤ä¸æ˜¾ç¤ºåŠ å·+ï¼Œ`printf(\"%+d\\n\", 12)`åˆ™ä¼šæ˜¾ç¤ºåŠ å·+\n\n3. å°æ•°å®½åº¦\n\n   `printf(\"%.2f\\n\", 2.7814)`è¡¨ç¤ºä¿ç•™2ä½æœ‰æ•ˆå°æ•°\n\n   `printf(\"%10.4f\\n\", 3.14)`è¡¨ç¤ºå°æ•°æ•´ä½“é•¿åº¦ä¸º10ä½ï¼Œå°æ•°éƒ¨åˆ†ä¸º4ä¸ºï¼Œæ•´æ•°éƒ¨åˆ†ä¸º5ä½ï¼ˆå°æ•°ç‚¹å 1ä½ï¼‰ï¼Œå·¦å¯¹é½\n\n   `printf(\"%*.*f\\n\", 10, 4, 3.14)`ä¸­10å’Œ4æ›¿æ¢å ä½ç¬¦ä¸­çš„æ˜Ÿå·*ï¼Œæ•ˆæœåŒä¸Š\n\n4. åˆ‡å‰²å­—ç¬¦\n\n   `printf(\"%.5s\", \"Hello World\")`è¾“å‡ºå­—ç¬¦ä¸²Hello Worldçš„å‰5ä¸ªå­—ç¬¦\n\n## Cè¯­è¨€çš„forå¾ªç¯ä½œç”¨åŸŸ\n\n`for`çš„å¾ªç¯æ¡ä»¶éƒ¨åˆ†æ˜¯ä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸï¼Œè·Ÿå¾ªç¯ä½“å†…éƒ¨ä¸æ˜¯åŒä¸€ä¸ªä½œç”¨åŸŸã€‚\n\n```c\nfor (int i = 0; i < 5; i++) {\n  int i = 999;\n  printf(\"%d\\n\", i);\n}\n\nprintf(\"%d\\n\", i); // éæ³•\n```\n\nä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ`for`çš„å¾ªç¯å˜é‡æ˜¯`i`ï¼Œå¾ªç¯ä½“å†…éƒ¨ä¹Ÿå£°æ˜äº†ä¸€ä¸ªå˜é‡`i`ï¼Œä¼šä¼˜å…ˆè¯»å–ã€‚ä½†ç”±äºå¾ªç¯æ¡ä»¶éƒ¨åˆ†æ˜¯ä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥å¾ªç¯ä½“å†…éƒ¨çš„`i`ä¸ä¼šä¿®æ”¹æ‰å¾ªç¯å˜é‡`i`ï¼Œå› æ­¤è¿™æ®µä»£ç çš„è¿è¡Œç»“æœå°±æ˜¯æ‰“å°5æ¬¡`999`ã€‚\n\n## MacOSå®¡æŸ¥WebViews\n\nè¾“å…¥å‘½ä»¤\n\n```shell\ndefaults write [NSGlobalDomainæ›¿æ¢æˆå¯¹åº”çš„å…¨å±€å‘½åç©ºé—´] WebkitDeveloperExtras -bool true\ndefaults write -g WebkitDeveloperExtras -bool YES\n```\n\né‡å¯ç”µè„‘ä¹‹åå°±å¯ä»¥åœ¨MacOSä¸Šåƒè°ƒè¯•ç½‘é¡µä¸€æ ·å®¡æ ¸å…ƒç´ ï¼ˆå³é”®ï¼‰ã€‚\n\n## Java Webåº”ç”¨ä¸­æŸ¥æ‰¾èµ„æºçš„è·¯å¾„\n\nåœ¨Java Webåº”ç”¨ä¸­é€šè¿‡`ServletContext.getResource(String path)`æˆ–è€…`ServletContext.getResourceAsStream(String path)`è·å–èµ„æºï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªä»¥`/`å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œè¯¥è·¯å¾„æ˜¯ç›¸å¯¹äºä¸Šä¸‹æ–‡çš„æ ¹è·¯å¾„ï¼Œæˆ–è€…Webåº”ç”¨çš„`WEB-INF/lib`ç›®å½•ä¸‹çš„jaråŒ…ä¸­çš„`META-INF/resources`ç›®å½•ã€‚ä½†æ˜¯`WEB-INF/lib`ä¸‹jaråŒ…çš„æŸ¥æ‰¾é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚\n\n## æ­£åˆ™åŒ¹é…Emoji\n\n```javascript\n /(\\ud83c[\\udf00-\\udfff])|(\\ud83d[\\udc00-\\ude4f\\ude80-\\udeff])|[\\u2600-\\u2B55]/\n```\n\nè¿™æ˜¯ä¸€éƒ¨åˆ†Emojiçš„UnicodeèŒƒå›´å€¼ï¼Œä½†æ˜¯Emojiæ˜¯ä¸æ–­åœ¨æ–°å¢çš„ï¼Œæ‰€ä»¥ä¸Šé¢çš„æ­£åˆ™å¯¹äºä¸€äº›è¾ƒæ–°çš„Emojiæ˜¯æ— æ³•åŒ¹é…çš„ã€‚\n\nç±»ä¼¼`\\d`,`\\W`,`\\s`è¿™ç±»è½¬ä¹‰å­—ç¬¦ï¼Œ`\\p`å’Œ`\\P`ä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®ŠUnicodeè½¬ä¹‰å­—ç¬¦ï¼Œè¡¨ç¤º**ä¸€ç»„**Unicodeå­—ç¬¦ï¼Œä½¿ç”¨æ—¶åœ¨åé¢åŠ ä¸Š`/u`å¯åŠ¨Unicodeæ„ŸçŸ¥æ¨¡å¼ã€‚\n\n`/\\p{Hex_Digit}/u` è¡¨ç¤ºåŒ¹é…åå…­è¿›åˆ¶çš„å­—ç¬¦ã€‚\n\n`/\\p{Extended_Pictographic}/u` è¡¨ç¤ºEmojiè¡¨æƒ…\n\n`/\\p{Emoji}/u` è™½ç„¶æŒ‡å®šçš„Emojiï¼Œä½†æ˜¯`123456789*#`è¿™äº›å€¼ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯Emojiã€‚",
      "data": {
        "title": "å¼€å‘æ—¥å¿—",
        "date": "2024-12-08 11:35:42",
        "tags": [
          "debug",
          "Java"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/kai-fa-ri-zhi.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## Spring AOP æ³¨è§£\n\nåœ¨ä½¿ç”¨springæ¡†æ¶æ—¶,é€šå¸¸ç”¨å®ƒçš„aopæ¥è®°å½•æ—¥å¿—,ä½†åœ¨spring mvcé‡‡ç”¨@Controlleræ³¨è§£æ—¶,å¯¹Controllerè¿›è¡ŒAopæ‹¦æˆªä¸èµ·ä½œç”¨,åŸå› æ˜¯è¯¥æ³¨è§£çš„Controllerå·²è¢«springå®¹å™¨å†…éƒ¨ä»£ç†äº†.\n\néœ€è¦å¯¹org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapterè¿›è¡ŒAopæ‰èƒ½èµ·ä½œç”¨.ç»è¿‡å¤šæ¬¡æµ‹è¯•å¯è¡Œ.",
      "fileName": "kai-fa-ri-zhi"
    },
    {
      "content": "## ä¸‹è½½\n\nApache James 3.xé…ç½®å’Œ2.xæœ‰è¾ƒå¤§åŒºåˆ«ï¼Œç½‘ä¸Šçš„æ–‡æ¡£å¤§å¤šåŸºäº2.xï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä½¿ç”¨2.xç‰ˆæœ¬ã€‚\n\n<!-- more -->\n\n```bash\nwget http://mirrors.tuna.tsinghua.edu.cn/apache//james/server/james-binary-2.3.2.1.tar.gz\n```\n\n> 3.xå¯åŠ¨çš„æ—¶å€™ç»å¸¸ä¼šæŠ¥`'priority' init parameter is compulsory`å¼‚å¸¸ï¼Œè¿™é‡Œå¯èƒ½æ˜¯å› ä¸ºé…ç½®æ–‡ä»¶é‡Œæœ¬åº”è¯¥æ˜¯<priority>å…ƒç´ çš„åœ°æ–¹é…ç½®æˆäº†<value>å¯¼è‡´çš„ã€‚ä¿®æ”¹`conf/mailetcontainer.xml`æ–‡ä»¶ä¸­\n>\n> ```xml\n> <mailet matcher=\"All\" class=\"WithPriority\">\n> \t<value>8</value>\n> </mailet>\n> ```\n>\n> ä¸º\n>\n> ```xml\n> <mailet matcher=\"All\" class=\"WithPriority\">\n> \t<value>8</value>\n> \t<priority>8</priority>\n> </mailet>\n> ```\n\n## é…ç½®\n\nç„¶åè§£å‹ä¹‹åè¿è¡Œ`bin/run.sh`(éœ€è¦ç»™æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™ chmod +x *.sh)\n\né¦–æ¬¡è¿è¡Œä¹‹åä¼šæŠŠ`apps/james.sar`æ–‡ä»¶è§£å‹ï¼Œç„¶åä¿®æ”¹è§£å‹åçš„æ–‡ä»¶é‡Œçš„é…ç½®`apps/james/SAR-INF/config.xml`å³å¯ã€‚\n\n### 1ã€ä¿®æ”¹postmaster\n\n```xml\n<config>\n   <James>\n      <postmaster>admin@steamfavor.com</postmaster>\n       ...\n    </James>\n</config>\n```\n\nå½“æœ‰é”™è¯¯é‚®ä»¶æ—¶ï¼Œä¼šç»Ÿä¸€æœ‰è¯¥è´¦æˆ·å¤„ç†ï¼Œç±»ä¼¼å…¶ä»–é‚®ä»¶æœåŠ¡å•†æä¾›çš„`catch-all`æœåŠ¡ã€‚\n\n### 2ã€ä¿®æ”¹servername\n\n```xml\n<config>\n   <James>\n       <servernames autodetect=\"false\" autodetectIP=\"false\">\n           <servername>steamfavor.com</servername>\n       </servernames>\n```\n\nservernameå¡«ç”³è¯·çš„åŸŸåï¼ŒåŒæ—¶éœ€è¦å…³é—­autodetectå’ŒautodetectIP\n\n> æ³¨å†Œå®ŒåŸŸåä¹‹åï¼Œéœ€è¦æ·»åŠ å‡ ä¸ªè§£æï¼š\n>\n> Aç±»ï¼šmail -> é‚®ä»¶æœåŠ¡å™¨IP\n>\n> Aç±»ï¼špop3 -> é‚®ä»¶æœåŠ¡å™¨IP\n>\n> Aç±»ï¼šsmtp -> é‚®ä»¶æœåŠ¡å™¨IP\n>\n> MXï¼š@ -> mail.steamfavor.com\n\n### 3ã€ä¿®æ”¹é‚®ä»¶å­˜å‚¨ä¸ºMysql\n\næ‰“å¼€ä¸‹é¢çš„é…ç½®\n\n```xml\n<inboxRepository>\n    <repository destinationURL=\"db://maildb/inbox/\" type=\"MAIL\"/>\n</inboxRepository>\n```\n\næ³¨é‡Šæ‰é»˜è®¤çš„æ–‡ä»¶ä¿å­˜é…ç½®\n\n```xml\n<inboxRepository>\n    <repository destinationURL=\"file://var/mail/inboxes/\" type=\"MAIL\"/>\n</inboxRepository>\n```\n\næ‰“å¼€æ•°æ®åº“çš„é…ç½®å¹¶æ³¨é‡Šæ‰é»˜è®¤ä»¥æ–‡ä»¶ä¿å­˜çš„é…ç½®\n\n```xml\n<database-connections>\n    <data-source name=\"maildb\" class=\"org.apache.james.util.dbcp.JdbcDataSource\">\n        <driver>com.mysql.jdbc.Driver</driver>\n        <dburl>jdbc:mysql://127.0.0.1:3306/caesar?autoReconnect=true&amp;characterEncoding=latin1&amp;useConfigs=maxPerformance</dburl>\n        <user>root</user>\n        <password>123456</password>\n        <max>20</max>\n    </data-source>\n</database-connections>\n```\n\n### 4ã€ä¿®æ”¹dnsserver\n\né…ç½®é‚®ä»¶æœåŠ¡å™¨çš„dnsserver\n\n```xml\n<dnsserver>\n    <servers>\n        <server>114.114.114.114</server>\n        <server>8.8.8.8</server>\n        <server>8.8.4.4</server>\n    </servers>\n    <autodiscover>false</autodiscover>\n    <authoritative>false</authoritative>\n    <maxcachesize>50000</maxcachesize>\n</dnsserver>\n```\n\n### 5ã€å¼€å¯è¿œç¨‹ç®¡ç†\n\nå¼€å¯è¿œç¨‹ç®¡ç†å¯ä»¥è¿œç¨‹é€šè¿‡4555ç«¯å£å¯¹ç”¨æˆ·æ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ ç”¨æˆ·ï¼Œåˆ é™¤ç”¨æˆ·ï¼Œä¿®æ”¹å¯†ç ç­‰ã€‚éœ€è¦é…ç½®å±•ç¤ºçš„åç§°å’Œç™»é™†çš„ç”¨æˆ·åå’Œå¯†ç ã€‚\n\n```xml\n<remotemanager enabled=\"true\">\n    <port>4555</port>\n    <handler>\n        <helloName autodetect=\"false\">steamfavor.com</helloName>\n        <administrator_accounts>\n            <account login=\"root\" password=\"xh123456**\"/>\n        </administrator_accounts>\n        <connectiontimeout> 60000 </connectiontimeout>\n    </handler>\n</remotemanager>\n```\n\n### 6ã€å¼€å¯pop3æœåŠ¡\n\né»˜è®¤ç›‘å¬110ç«¯å£ï¼ŒSSLç«¯å£995ï¼Œé…ç½®æœåŠ¡å™¨åç§°ã€‚\n\n```xml\n<pop3server enabled=\"true\">\n    <port>110</port>\n    <handler>\n        <helloName autodetect=\"false\">steamfavor.com</helloName>\n        <connectiontimeout>120000</connectiontimeout>\n    </handler>\n</pop3server>\n```\n\n### 7ã€å¼€å¯smtpæœåŠ¡\n\né»˜è®¤ç›‘å¬25ç«¯å£\n\n```xml\n<smtpserver enabled=\"true\">\n    <port>25</port>\n    <handler>\n        <helloName autodetect=\"true\">myMailServer</helloName>\n        <connectiontimeout>360000</connectiontimeout>\n        <maxmessagesize>0</maxmessagesize>\n    </handler>\n</smtpserver>\n```\n\né…ç½®å®Œæˆåï¼Œé‡æ–°å¯åŠ¨jamesæœåŠ¡å™¨ã€‚",
      "data": {
        "title": "Jamesé‚®ä»¶æœåŠ¡å™¨æ­å»º",
        "date": "2024-12-08 11:28:09",
        "tags": [
          "James",
          "é‚®ä»¶æœåŠ¡å™¨"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/james-you-jian-fu-wu-qi-da-jian.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## ä¸‹è½½\n\nApache James 3.xé…ç½®å’Œ2.xæœ‰è¾ƒå¤§åŒºåˆ«ï¼Œç½‘ä¸Šçš„æ–‡æ¡£å¤§å¤šåŸºäº2.xï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä½¿ç”¨2.xç‰ˆæœ¬ã€‚",
      "fileName": "james-you-jian-fu-wu-qi-da-jian"
    },
    {
      "content": "## Manifest\nChromeæ‰©å±•çš„Manifestå¿…é¡»åŒ…å«`name`ã€`version`å’Œ`manifest_version`å±æ€§ï¼Œå¯¹äºåº”ç”¨æ¥è¯´ï¼Œè¿˜å¿…é¡»åŒ…å«`app`å±æ€§ã€‚\n<!-- more -->\n\nManifest.jsonæ¨¡æ¿ï¼š\n```javascript\n{\n    \"app\": {\n        \"background\": {\n            \"scripts\": [\"background.js\"]\n        }\n    },\n    \"manifest_version\": 2,\n    \"name\": \"My Extension\",\n    \"version\": \"versionString\",\n    \"default_locale\": \"en\",\n    \"description\": \"A plain text description\",\n    \"icons\": {\n        \"16\": \"images/icon16.png\",\n        \"48\": \"images/icon48.png\",\n        \"128\": \"images/icon128.png\"\n    },\n    \"browser_action\": {\n        \"default_icon\": {\n            \"19\": \"images/icon19.png\",\n            \"38\": \"images/icon38.png\"\n        },\n        \"default_title\": \"Extension Title\",\n        \"default_popup\": \"popup.html\"\n    },\n    \"page_action\": {\n        \"default_icon\": {\n            \"19\": \"images/icon19.png\",\n            \"38\": \"images/icon38.png\"\n        },\n        \"default_title\": \"Extension Title\",\n        \"default_popup\": \"popup.html\"\n    },\n    \"background\": {\n        \"scripts\": [\"background.js\"]\n    },\n    \"content_scripts\": [\n        {\n            \"matches\": [\"http://www.google.com/*\"],\n            \"css\": [\"mystyles.css\"],\n            \"js\": [\"jquery.js\", \"myscript.js\"]\n        }\n    ],\n    \"options_page\": \"options.html\",\n    \"permissions\": [\n        \"*://www.google.com/*\"\n    ],\n    \"web_accessible_resources\": [\n        \"images/*.png\"\n    ]\n}\n```\n\né€šè¿‡Chromeæ‰©å±•æˆ‘ä»¬å¯ä»¥å¯¹ç”¨æˆ·å½“å‰æµè§ˆçš„é¡µé¢è¿›è¡Œæ“ä½œï¼Œå®é™…ä¸Šå°±æ˜¯å¯¹ç”¨æˆ·å½“å‰æµè§ˆé¡µé¢çš„DOMè¿›è¡Œæ“ä½œã€‚é€šè¿‡Manifestä¸­çš„`content_scripts`å±æ€§å¯ä»¥æŒ‡å®šå°†å“ªäº›è„šæœ¬ä½•æ—¶æ³¨å…¥åˆ°å“ªäº›é¡µé¢ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®è¿™äº›é¡µé¢åï¼Œç›¸åº”è„šæœ¬å³å¯è‡ªåŠ¨è¿è¡Œï¼Œä»è€Œå¯¹é¡µé¢DOMè¿›è¡Œæ“ä½œã€‚\n\nManifestçš„content_scriptså±æ€§å€¼ä¸ºæ•°ç»„ç±»å‹ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ å¯ä»¥åŒ…å«matchesã€exclude_matchesã€cssã€jsã€run_atã€all_framesã€include_globså’Œexclude_globsç­‰å±æ€§ã€‚å…¶ä¸­matcheså±æ€§å®šä¹‰äº†å“ªäº›é¡µé¢ä¼šè¢«æ³¨å…¥è„šæœ¬ï¼Œexclude_matchesåˆ™å®šä¹‰äº†å“ªäº›é¡µé¢ä¸ä¼šè¢«æ³¨å…¥è„šæœ¬ï¼Œcsså’Œjså¯¹åº”è¦æ³¨å…¥çš„æ ·å¼è¡¨å’ŒJavaScriptï¼Œrun_atå®šä¹‰äº†ä½•æ—¶è¿›è¡Œæ³¨å…¥ï¼Œall_frameså®šä¹‰è„šæœ¬æ˜¯å¦ä¼šæ³¨å…¥åˆ°åµŒå…¥å¼æ¡†æ¶ä¸­ï¼Œinclude_globså’Œexclude_globsåˆ™æ˜¯å…¨å±€URLåŒ¹é…ï¼Œæœ€ç»ˆè„šæœ¬æ˜¯å¦ä¼šè¢«æ³¨å…¥ç”±matchesã€exclude_matchesã€include_globså’Œexclude_globsçš„å€¼å…±åŒå†³å®šã€‚ç®€å•çš„è¯´ï¼Œå¦‚æœURLåŒ¹é…mathceså€¼çš„åŒæ—¶ä¹ŸåŒ¹é…include_globsçš„å€¼ï¼Œä¼šè¢«æ³¨å…¥ï¼›å¦‚æœURLåŒ¹é…exclude_matchesçš„å€¼æˆ–è€…åŒ¹é…exclude_globsçš„å€¼ï¼Œåˆ™ä¸ä¼šè¢«æ³¨å…¥ã€‚\n\n## è·¨åŸŸè¯·æ±‚ï¼š\n| URL                                      | è¯´æ˜      | æ˜¯å¦å…è®¸è¯·æ±‚ |\n| ---------------------------------------- | ------- | ------ |\n| http://a.example.com/<br/>http://a.example.com/a.txt | åŒåŸŸä¸‹     | å…è®¸     |\n| http://a.example.com/<br/>http://a.example.com/b/a.txt | åŒåŸŸä¸‹ä¸åŒç›®å½• | å…è®¸     |\n| http://a.example.com/<br/>http://a.example.com:8080/a.txt | åŒåŸŸä¸‹ä¸åŒç«¯å£ | ä¸å…è®¸    |\n| http://a.example.com/<br/>https://a.example.com/a.txt | åŒåŸŸä¸‹ä¸åŒåè®® | ä¸å…è®¸    |\n| http://a.example.com/<br/>http://b.example.com/a.txt | ä¸åŒåŸŸä¸‹    | ä¸å…è®¸    |\n| http://a.example.com/<br/>http://a.foo.com/a.txt | ä¸åŒåŸŸä¸‹    | ä¸å…è®¸    |\n\nGoogleå…è®¸Chromeæ‰©å±•åº”ç”¨ä¸å¿…å—é™äºè·¨åŸŸé™åˆ¶ã€‚ä½†å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œéœ€è¦åœ¨Manifestçš„`permissions`å±æ€§ä¸­å£°æ˜éœ€è¦è·¨åŸŸçš„æƒé™ã€‚\n```javascript\n{\n    ...\n    \"permissions\": [\n        \"*://*.wikipedia.org/*\"\n    ]\n}\n```\n\n## å¸¸é©»åå°\nåœ¨Manifestä¸­æŒ‡å®šbackgroundåŸŸå¯ä»¥ä½¿æ‰©å±•å¸¸é©»åå°ã€‚backgroundå¯ä»¥åŒ…å«ä¸‰ç§å±æ€§ï¼Œåˆ†åˆ«æ˜¯scriptsã€pageå’Œpersistentã€‚å¦‚æœæŒ‡å®šäº†scriptså±æ€§ï¼Œåˆ™Chromeä¼šåœ¨æ‰©å±•å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æŒ‡å®šè„šæœ¬çš„é¡µé¢ï¼›å¦‚æœæŒ‡å®šäº†pageå±æ€§ï¼Œåˆ™Chromeä¼šå°†æŒ‡å®šçš„HTMLæ–‡ä»¶ä½œä¸ºåå°é¡µé¢è¿è¡Œã€‚é€šå¸¸æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨scriptså±æ€§å³å¯ï¼Œé™¤éåœ¨åå°é¡µé¢ä¸­éœ€è¦æ„å»ºç‰¹æ®Šçš„HTMLâ€”â€”ä½†ä¸€èˆ¬æƒ…å†µä¸‹åå°é¡µé¢çš„HTMLæˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°çš„ã€‚persistentå±æ€§å®šä¹‰äº†å¸¸é©»åå°çš„æ–¹å¼â€”â€”å½“å…¶å€¼ä¸ºtrueæ—¶ï¼Œè¡¨ç¤ºæ‰©å±•å°†ä¸€ç›´åœ¨åå°è¿è¡Œï¼Œæ— è®ºå…¶æ˜¯å¦æ­£åœ¨å·¥ä½œï¼›å½“å…¶å€¼ä¸ºfalseæ—¶ï¼Œè¡¨ç¤ºæ‰©å±•åœ¨åå°æŒ‰éœ€è¿è¡Œï¼Œè¿™å°±æ˜¯Chromeåæ¥æå‡ºçš„Event Pageã€‚Event Pageå¯ä»¥æœ‰æ•ˆå‡å°æ‰©å±•å¯¹å†…å­˜çš„æ¶ˆè€—ï¼Œå¦‚éå¿…è¦ï¼Œè¯·å°†persistentè®¾ç½®ä¸ºfalseã€‚persistentçš„é»˜è®¤å€¼ä¸ºtrueã€‚\n\nå¦‚æœæƒ³åœ¨ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ä¹‹å‰å°±è®©æ‰©å±•è¿è¡Œï¼Œå¯ä»¥åœ¨Manifestçš„permissionså±æ€§ä¸­åŠ å…¥\"background\"ï¼Œä½†é™¤éå¿…è¦ï¼Œå¦åˆ™å°½é‡ä¸è¦è¿™ä¹ˆåšï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç”¨æˆ·ä¸å–œæ¬¢è¿™æ ·ã€‚\n\n## å¸¦é€‰é¡¹é¡µé¢çš„æ‰©å±•\næœ‰ä¸€äº›æ‰©å±•å…è®¸ç”¨æˆ·è¿›è¡Œä¸ªæ€§åŒ–è®¾ç½®ï¼Œè¿™æ ·å°±éœ€è¦å‘ç”¨æˆ·æä¾›ä¸€ä¸ªé€‰é¡¹é¡µé¢ã€‚Chromeé€šè¿‡Manifestæ–‡ä»¶çš„options_pageå±æ€§ä¸ºå¼€å‘è€…æä¾›äº†è¿™æ ·çš„æ¥å£ï¼Œå¯ä»¥ä¸ºæ‰©å±•æŒ‡å®šä¸€ä¸ªé€‰é¡¹é¡µé¢ã€‚å½“ç”¨æˆ·åœ¨æ‰©å±•å›¾æ ‡ä¸Šç‚¹å‡»å³é”®ï¼Œé€‰æ‹©èœå•ä¸­çš„â€œé€‰é¡¹â€åï¼Œå°±ä¼šæ‰“å¼€è¿™ä¸ªé¡µé¢ã€‚\n\n## æ‰©å±•é¡µé¢é—´çš„é€šä¿¡\næœ‰æ—¶éœ€è¦è®©æ‰©å±•ä¸­çš„å¤šä¸ªé¡µé¢ä¹‹é—´ï¼Œæˆ–è€…ä¸åŒæ‰©å±•çš„å¤šä¸ªé¡µé¢ä¹‹é—´ç›¸äº’ä¼ è¾“æ•°æ®ï¼Œä»¥è·å¾—å½¼æ­¤çš„çŠ¶æ€ã€‚æ¯”å¦‚éŸ³ä¹æ’­æ”¾å™¨æ‰©å±•ï¼Œå½“ç”¨æˆ·é¼ æ ‡ç‚¹å‡»popupé¡µé¢ä¸­çš„éŸ³ä¹åˆ—è¡¨æ—¶ï¼Œpopupé¡µé¢åº”è¯¥å°†ç”¨æˆ·è¿™ä¸ªæŒ‡ä»¤å‘ŠçŸ¥åå°é¡µé¢ï¼Œä¹‹ååå°é¡µé¢å¼€å§‹æ’­æ”¾ç›¸åº”çš„éŸ³ä¹ã€‚\n\nChromeæä¾›äº†4ä¸ªæœ‰å…³æ‰©å±•é¡µé¢é—´ç›¸äº’é€šä¿¡çš„æ¥å£ï¼Œåˆ†åˆ«æ˜¯`runtime.sendMessage`ã€`runtime.onMessage`ã€`runtime.connect`å’Œ`runtime.onConnect`ã€‚\n\n> Chromeæä¾›çš„å¤§éƒ¨åˆ†APIæ˜¯ä¸æ”¯æŒåœ¨content_scriptsä¸­è¿è¡Œçš„ï¼Œä½†runtime.sendMessageå’Œruntime.onMessageå¯ä»¥åœ¨content_scriptsä¸­è¿è¡Œï¼Œæ‰€ä»¥æ‰©å±•çš„å…¶ä»–é¡µé¢ä¹Ÿå¯ä»¥åŒcontent_scriptsç›¸äº’é€šä¿¡ã€‚\n\n`chrome.runtime.sendMessage(extensionId, message, options, callback)` : extensionIdä¸ºæ‰€å‘é€æ¶ˆæ¯çš„ç›®æ ‡æ‰©å±•ï¼Œå¦‚æœä¸æŒ‡å®šè¿™ä¸ªå€¼ï¼Œåˆ™é»˜è®¤ä¸ºå‘èµ·æ­¤æ¶ˆæ¯çš„æ‰©å±•æœ¬èº«ï¼Œmessageä¸ºè¦å‘é€çš„å†…å®¹ï¼Œoptionsä¸ºå¯¹è±¡ç±»å‹ï¼Œcallbackæ˜¯å›è°ƒå‡½æ•°ã€‚\n`chrome.runtime.onMessage.addListener(callback)`ï¼šcallbackæ¥æ”¶åˆ°çš„å‚æ•°æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯messageã€senderå’ŒsendResponseï¼Œå³æ¶ˆæ¯å†…å®¹ã€æ¶ˆæ¯å‘é€è€…ç›¸å…³ä¿¡æ¯å’Œç›¸åº”å‡½æ•°ã€‚\n\n## å‚¨å­˜æ•°æ®\n### localStorage\n`localStorage`æ˜¯HTML5æ–°å¢çš„æ–¹æ³•ï¼Œå®ƒå…è®¸JavaScriptåœ¨ç”¨æˆ·è®¡ç®—æœºç¡¬ç›˜ä¸Šæ°¸ä¹…å‚¨å­˜æ•°æ®ï¼ˆé™¤éç”¨æˆ·ä¸»åŠ¨åˆ é™¤ï¼‰ã€‚ä½†localStorageä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼Œé¦–å…ˆæ˜¯localStorageå’ŒCookiesç±»ä¼¼ï¼Œéƒ½æœ‰åŸŸçš„é™åˆ¶ï¼Œè¿è¡Œåœ¨ä¸åŒåŸŸçš„JavaScriptæ— æ³•è°ƒç”¨å…¶ä»–åŸŸlocalStorageçš„æ•°æ®ï¼›å…¶æ¬¡æ˜¯å•ä¸ªåŸŸåœ¨localStorageä¸­å­˜å‚¨æ•°æ®çš„å¤§å°é€šå¸¸æœ‰é™åˆ¶ï¼ˆè™½ç„¶W3Cæ²¡æœ‰ç»™å‡ºé™åˆ¶ï¼‰ï¼Œå¯¹äºChromeè¿™ä¸ªé™åˆ¶æ˜¯5MB(é€šè¿‡å£°æ˜unlimitedStorageæƒé™ï¼ŒChromeæ‰©å±•å’Œåº”ç”¨å¯ä»¥çªç ´è¿™ä¸€é™åˆ¶)ï¼›æœ€ålocalStorageåªèƒ½å‚¨å­˜å­—ç¬¦ä¸²å‹çš„æ•°æ®ï¼Œæ— æ³•ä¿å­˜æ•°ç»„å’Œå¯¹è±¡ï¼Œä½†å¯ä»¥é€šè¿‡joinã€toStringå’ŒJSON.stringifyç­‰æ–¹æ³•å…ˆè½¬æ¢æˆå­—ç¬¦ä¸²å†å‚¨å­˜ã€‚\n### Chromeå­˜å‚¨API\nChromeä¸ºæ‰©å±•åº”ç”¨æä¾›äº†å­˜å‚¨APIï¼Œä»¥ä¾¿å°†æ‰©å±•ä¸­éœ€è¦ä¿å­˜çš„æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜ã€‚Chromeæä¾›çš„å­˜å‚¨APIå¯ä»¥è¯´æ˜¯å¯¹localStorageçš„æ”¹è¿›ï¼Œå®ƒä¸localStorageç›¸æ¯”æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š\n\n+ å¦‚æœå‚¨å­˜åŒºåŸŸæŒ‡å®šä¸ºsyncï¼Œæ•°æ®å¯ä»¥è‡ªåŠ¨åŒæ­¥ï¼›\n+ content_scriptså¯ä»¥ç›´æ¥è¯»å–æ•°æ®ï¼Œè€Œä¸å¿…é€šè¿‡backgroundé¡µé¢ï¼›\n+ åœ¨éšèº«æ¨¡å¼ä¸‹ä»ç„¶å¯ä»¥è¯»å‡ºä¹‹å‰å­˜å‚¨çš„æ•°æ®ï¼›\n+ è¯»å†™é€Ÿåº¦æ›´å¿«ï¼›\n+ ç”¨æˆ·æ•°æ®å¯ä»¥ä»¥å¯¹è±¡çš„ç±»å‹ä¿å­˜ã€‚\n\n> é¦–å…ˆlocalStorageæ˜¯åŸºäºåŸŸåçš„ï¼Œè¿™åœ¨å‰é¢çš„å°èŠ‚ä¸­å·²ç»æåˆ°è¿‡äº†ã€‚è€Œcontent_scriptsæ˜¯æ³¨å…¥åˆ°ç”¨æˆ·å½“å‰æµè§ˆé¡µé¢ä¸­çš„ï¼Œå¦‚æœcontent_scriptsç›´æ¥è¯»å–localStorageï¼Œæ‰€è¯»å–åˆ°çš„æ•°æ®æ˜¯ç”¨æˆ·å½“å‰æµè§ˆé¡µé¢æ‰€åœ¨åŸŸä¸­çš„ã€‚æ‰€ä»¥é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯content_scriptsé€šè¿‡runtime.sendMessageå’Œbackgroundé€šä¿¡ï¼Œç”±backgroundè¯»å†™æ‰©å±•æ‰€åœ¨åŸŸï¼ˆé€šå¸¸æ˜¯chrome-extension://extension-id/ï¼‰çš„localStorageï¼Œç„¶åå†ä¼ é€’ç»™content_scriptsã€‚\n\nä½¿ç”¨Chromeå­˜å‚¨APIå¿…é¡»è¦åœ¨Manifestçš„permissionsä¸­å£°æ˜\"storage\"ï¼Œä¹‹åæ‰æœ‰æƒé™è°ƒç”¨ã€‚Chromeå­˜å‚¨APIæä¾›äº†2ç§å‚¨å­˜åŒºåŸŸï¼Œåˆ†åˆ«æ˜¯syncå’Œlocalã€‚ä¸¤ç§å‚¨å­˜åŒºåŸŸçš„åŒºåˆ«åœ¨äºï¼Œsyncå‚¨å­˜çš„åŒºåŸŸä¼šæ ¹æ®ç”¨æˆ·å½“å‰åœ¨Chromeä¸Šç™»é™†çš„Googleè´¦æˆ·è‡ªåŠ¨åŒæ­¥æ•°æ®ï¼Œå½“æ— å¯ç”¨ç½‘ç»œè¿æ¥å¯ç”¨æ—¶ï¼ŒsyncåŒºåŸŸå¯¹æ•°æ®çš„è¯»å†™å’ŒlocalåŒºåŸŸå¯¹æ•°æ®çš„è¯»å†™è¡Œä¸ºä¸€è‡´ã€‚\n\n> StorageArea = sync / local\n\n1. `chrome.storage.StorageArea.get(keys, callback)`ï¼škeyså¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„æˆ–å¯¹è±¡ã€‚å¦‚æœkeysæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å’ŒlocalStorageçš„ç”¨æ³•ç±»ä¼¼ï¼›å¦‚æœæ˜¯æ•°ç»„ï¼Œåˆ™ç›¸å½“äºä¸€æ¬¡è¯»å–äº†å¤šä¸ªæ•°æ®ï¼›å¦‚æœkeysæ˜¯å¯¹è±¡ï¼Œåˆ™ä¼šå…ˆè¯»å–ä»¥è¿™ä¸ªå¯¹è±¡å±æ€§åä¸ºé”®å€¼çš„æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨åˆ™è¿”å›keyså¯¹è±¡çš„å±æ€§å€¼ï¼ˆæ¯”å¦‚keysä¸º{'name':'Billy'}ï¼Œå¦‚æœnameè¿™ä¸ªå€¼å­˜åœ¨ï¼Œå°±è¿”å›nameåŸæœ‰çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¿”å›Billyï¼‰ã€‚å¦‚æœkeysä¸ºä¸€ä¸ªç©ºæ•°ç»„ï¼ˆ[]ï¼‰æˆ–ç©ºå¯¹è±¡ï¼ˆ{}ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå¦‚æœkeysä¸ºnullï¼Œåˆ™è¿”å›æ‰€æœ‰å­˜å‚¨çš„æ•°æ®ã€‚\n2. `chrome.storage.StorageArea.getBytesInUse(keys, callback)`ï¼šæ­¤å¤„çš„keysåªèƒ½ä¸ºnullã€å­—ç¬¦ä¸²æˆ–åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚\n3. `chrome.storage.StorageArea.set(items, callback)`ï¼šitemsä¸ºå¯¹è±¡ç±»å‹ï¼Œå½¢å¼ä¸ºé”®/å€¼å¯¹ã€‚itemsçš„å±æ€§å€¼å¦‚æœæ˜¯å­—ç¬¦å‹ã€æ•°å­—å‹å’Œæ•°ç»„å‹ï¼Œåˆ™å‚¨å­˜çš„æ ¼å¼ä¸ä¼šæ”¹å˜ï¼Œä½†å¦‚æœæ˜¯å¯¹è±¡å‹å’Œå‡½æ•°å‹çš„ï¼Œä¼šè¢«å‚¨å­˜ä¸ºâ€œ{}â€ï¼Œå¦‚æœæ˜¯æ—¥æœŸå‹å’Œæ­£åˆ™å‹çš„ï¼Œä¼šè¢«å‚¨å­˜ä¸ºå®ƒä»¬çš„å­—ç¬¦ä¸²å½¢å¼ã€‚\n4. `chrome.storage.StorageArea.remove(keys, callback)`ï¼šå…¶ä¸­keyså¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚\n5. `chrome.storage.StorageArea.clear(callback)`ï¼šåˆ é™¤æ‰€æœ‰æ•°æ®ã€‚\n\nChromeåŒæ—¶è¿˜ä¸ºå­˜å‚¨APIæä¾›äº†ä¸€ä¸ªonChangedäº‹ä»¶ï¼Œå½“å­˜å‚¨åŒºçš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šè¢«æ¿€å‘ã€‚callbackä¼šæ¥æ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºchangesï¼Œç¬¬äºŒä¸ªæ˜¯StorageAreaã€‚changesæ˜¯è¯å…¸å¯¹è±¡ï¼Œé”®ä¸ºæ›´æ”¹çš„å±æ€§åç§°ï¼Œå€¼åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸ºoldValueå’ŒnewValueï¼›StorageAreaä¸ºlocalæˆ–syncã€‚\n\n> positionå±æ€§è¿˜æœ‰å¦å¤–çš„ä¸‰ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯absoluteã€relativeå’Œfixedã€‚å¦‚æœå…ƒç´ çš„ä½ç½®å±æ€§ä¸ºabsoluteï¼Œåˆ™å®ƒçš„ä½ç½®æ˜¯ç›¸å¯¹äºé™¤staticå®šä½ä»¥å¤–çš„çˆ¶ç³»å…ƒç´ çš„ï¼Œå¦‚æœæ²¡æœ‰è¿™æ ·çš„çˆ¶ç³»å…ƒç´ ï¼Œåˆ™ç›¸å¯¹äºbodyï¼›å¦‚æœå…ƒç´ çš„ä½ç½®å±æ€§ä¸ºrelativeï¼Œåˆ™å®ƒçš„ä½ç½®æ˜¯ç›¸å¯¹äºå®ƒé»˜è®¤åœ¨HTMLæµä¸­ä½ç½®çš„ï¼›å¦‚æœå…ƒç´ çš„ä½ç½®å±æ€§ä¸ºfixedï¼Œåˆ™å®ƒçš„ä½ç½®æ˜¯ç›¸å¯¹äºæµè§ˆå™¨çª—å£çš„ã€‚\n\n## Browser Actions\n### å›¾æ ‡\nBrowser Actionså¯ä»¥åœ¨Manifestä¸­è®¾å®šä¸€ä¸ªé»˜è®¤çš„å›¾æ ‡\n```javascript\n\"browser_action\": {\n    \"default_icon\": {\n        \"19\": \"images/icon19.png\",\n        \"38\": \"images/icon38.png\"\n    }\n}\n```\nä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒChromeä¼šé€‰æ‹©ä½¿ç”¨19åƒç´ çš„å›¾ç‰‡æ˜¾ç¤ºåœ¨å·¥å…·æ ä¸­ï¼Œä½†å¦‚æœç”¨æˆ·æ­£åœ¨ä½¿ç”¨è§†ç½‘è†œå±å¹•çš„è®¡ç®—æœºï¼Œåˆ™ä¼šé€‰æ‹©38åƒç´ çš„å›¾ç‰‡æ˜¾ç¤ºã€‚ä¸¤ç§å°ºå¯¸çš„å›¾ç‰‡å¹¶ä¸æ˜¯å¿…é¡»éƒ½æŒ‡å®šçš„ï¼Œå¦‚æœåªæŒ‡å®šä¸€ç§å°ºå¯¸çš„å›¾ç‰‡ï¼Œåœ¨å¦å¤–ä¸€ç§ç¯å¢ƒä¸‹ï¼ŒChromeä¼šè¯•å›¾æ‹‰ä¼¸å›¾ç‰‡å»é€‚åº”ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´å›¾æ ‡çœ‹ä¸Šå»å¾ˆéš¾çœ‹ã€‚å¦å¤–ï¼Œdefault_iconä¹Ÿä¸æ˜¯å¿…é¡»æŒ‡å®šçš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼ŒChromeå°†ä½¿ç”¨ä¸€ä¸ªé»˜è®¤å›¾æ ‡ã€‚\n\né€šè¿‡setIconæ–¹æ³•å¯ä»¥åŠ¨æ€æ›´æ”¹æ‰©å±•çš„å›¾æ ‡:`chrome.browserAction.setIcon(details, callback)`,å…¶ä¸­detailsçš„ç±»å‹ä¸ºå¯¹è±¡ï¼Œå¯ä»¥åŒ…å«ä¸‰ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯imageDataã€pathå’ŒtabIdã€‚\n\nimageDataæ˜¯å›¾ç‰‡çš„åƒç´ æ•°æ®ï¼Œå¯ä»¥é€šè¿‡HTMLçš„canvasæ ‡ç­¾è·å–åˆ°ã€‚\npathçš„å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œç»“æ„ä¸º{size: imagePath}ã€‚imagePathä¸ºå›¾ç‰‡åœ¨æ‰©å±•æ ¹ç›®å½•ä¸‹çš„ç›¸å¯¹ä½ç½®ã€‚\ntabIdçš„å€¼é™å®šäº†æµè§ˆå“ªä¸ªæ ‡ç­¾é¡µæ—¶ï¼Œå›¾æ ‡å°†è¢«æ›´æ”¹ã€‚\n### Popupé¡µé¢\npopupåœ¨å…³é—­åï¼Œå°±ç›¸å½“äºç”¨æˆ·å…³é—­äº†ç›¸åº”çš„æ ‡ç­¾é¡µï¼Œè¿™ä¸ªé¡µé¢ä¸ä¼šç»§ç»­è¿è¡Œã€‚å½“ç”¨æˆ·å†æ¬¡æ‰“å¼€è¿™ä¸ªé¡µé¢æ—¶ï¼Œæ‰€æœ‰çš„DOMå’Œjsç©ºé—´å˜é‡éƒ½å°†è¢«é‡æ–°åˆ›å»ºã€‚\n#### ä½¿ç”¨å¸¦æœ‰æ»šåŠ¨æ¡çš„DIVå®¹å™¨ã€‚\n\n#### [è®¾è®¡ä¸€ä¸ªæ›´å¥½çš„æ»šåŠ¨æ¡æ ·å¼ã€‚][1]\n\n#### è€ƒè™‘å±è”½å³é”®èœå•ã€‚\n\n#### ä½¿ç”¨å¤–éƒ¨å¼•ç”¨çš„è„šæœ¬ã€‚\n#### ä¸è¦åœ¨popupé¡µé¢çš„jsç©ºé—´å˜é‡ä¸­ä¿å­˜æ•°æ®ã€‚\n\n### æ ‡é¢˜å’Œbadge\nå°†é¼ æ ‡ç§»è‡³æ‰©å±•å›¾æ ‡ä¸Šï¼Œç‰‡åˆ»åæ‰€æ˜¾ç¤ºçš„æ–‡å­—å°±æ˜¯æ‰©å±•çš„æ ‡é¢˜ï¼Œåœ¨Manifestä¸­ï¼Œbrowser_actionçš„default_titleå±æ€§å¯ä»¥è®¾ç½®æ‰©å±•çš„é»˜è®¤æ ‡é¢˜ã€‚è¿˜å¯ä»¥ç”¨JavaScriptæ¥åŠ¨æ€æ›´æ”¹æ‰©å±•çš„æ ‡é¢˜ï¼š`chrome.browserAction.setTitle({title: 'This is a new title'});`ã€‚\n\nBadgeæ˜¯æ‰©å±•ä¸ºç”¨æˆ·æä¾›æœ‰é™ä¿¡æ¯çš„å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•è¾ƒæ ‡é¢˜ä¼˜è¶Šçš„åœ°æ–¹æ˜¯å®ƒå¯ä»¥ä¸€ç›´æ˜¾ç¤ºï¼Œå…¶ç¼ºç‚¹æ˜¯åªèƒ½æ˜¾ç¤ºå¤§çº¦4å­—èŠ‚é•¿åº¦çš„ä¿¡æ¯ã€‚Badgeç›®å‰åªèƒ½å¤Ÿé€šè¿‡JavaScriptè®¾å®šæ˜¾ç¤ºçš„å†…å®¹ï¼ŒåŒæ—¶Chromeè¿˜æä¾›äº†æ›´æ”¹badgeèƒŒæ™¯çš„æ–¹æ³•ã€‚å¦‚æœä¸å®šä¹‰badgeçš„èƒŒæ™¯é¢œè‰²ï¼Œé»˜è®¤å°†ä½¿ç”¨çº¢è‰²ï¼š\n```javascript\nchrome.browserAction.setBadgeBackgroundColor({color: '#0000FF'});\nchrome.browserAction.setBadgeText({text: 'Dog'});\n```\n\n## Content Scripts\n\n```json\n\"content_scripts\": [\n  {\n    //\"matches\": [\"http://*/*\", \"https://*/*\"],\n    // \"<all_urls>\" è¡¨ç¤ºåŒ¹é…æ‰€æœ‰åœ°å€\n    \"matches\": [\"<all_urls>\"],\n    // å¤šä¸ªJSæŒ‰é¡ºåºæ³¨å…¥\n    \"js\": [\"js/jquery-1.8.3.js\", \"js/content-script.js\"],\n    // JSçš„æ³¨å…¥å¯ä»¥éšä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯CSSçš„æ³¨æ„å°±è¦åƒä¸‡å°å¿ƒäº†ï¼Œå› ä¸ºä¸€ä¸å°å¿ƒå°±å¯èƒ½å½±å“å…¨å±€æ ·å¼\n    \"css\": [\"css/custom.css\"],\n    // ä»£ç æ³¨å…¥çš„æ—¶é—´ï¼Œå¯é€‰å€¼ï¼š \"document_start\", \"document_end\", or \"document_idle\"ï¼Œæœ€åä¸€ä¸ªè¡¨ç¤ºé¡µé¢ç©ºé—²æ—¶ï¼Œé»˜è®¤document_idle\n    \"run_at\": \"document_start\"\n  }\n]\n```\n\nå¦‚æœæ²¡æœ‰ä¸»åŠ¨æŒ‡å®š`run_at`ä¸º`document_start`ï¼ˆé»˜è®¤ä¸º`document_idle`ï¼‰ï¼Œä¸‹é¢è¿™ç§ä»£ç ä¸ä¼šç”Ÿæ•ˆï¼š\n\n``` javascript\ndocument.addEventListener('DOMContentLoaded', function(){\n\tconsole.log('æˆ‘è¢«æ‰§è¡Œäº†ï¼');\n});\n```\n\ncontent_scriptsåªèƒ½è®¿é—®ä¸‹é¢4ç§chrome api\n- chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)\n- chrome.i18n\n- chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)\n- chrome.storage\n\n## é€šä¿¡\n\nå‚è€ƒ [chromeæ’ä»¶å¼€å‘æ”»ç•¥](https://www.cnblogs.com/liuxianan/p/chrome-plugin-develop.html#blog-comments-placeholder)\n\n### popupå’Œbackground\n\n>  popupå¯ä»¥ç›´æ¥è°ƒç”¨backgroundä¸­çš„JSæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®backgroundçš„DOM\n\n``` javascript\nfunction test(){\n    alert('æˆ‘æ˜¯backgroundï¼');\n}\n\n// popup.js\nvar bg = chrome.extension.getBackgroundPage();\nbg.test();\n```\n\n> backgroundè®¿é—®popupï¼ˆpopupæ˜¯æ˜¾ç¤ºçŠ¶æ€ï¼‰\n\n``` javascript\nvar views = chrome.extension.getViews({type:'popup'});\nif(views.length > 0) {\n    console.log(views[0].location.href);\n}\n```\n\n### popupå’Œcontent\n\n> popupå’Œbackgroundå…¶å®å‡ ä¹å¯ä»¥è§†ä¸ºä¸€ç§ä¸œè¥¿ï¼Œå› ä¸ºå®ƒä»¬å¯è®¿é—®çš„APIéƒ½ä¸€æ ·ã€é€šä¿¡æœºåˆ¶ä¸€æ ·ã€éƒ½å¯ä»¥è·¨åŸŸã€‚\n\n### backgroundå’Œcontent\n\n``` javascript\n// backgroundæˆ–popup\nfunction sendMessageToContentScript(message, callback){\n    chrome.tabs.query({active: true, currentWindow: true}, function(tabs)\n    {\n        chrome.tabs.sendMessage(tabs[0].id, message, function(response)\n        {\n            if(callback) callback(response);\n        });\n    });\n}\nsendMessageToContentScript({cmd:'test', value:'ä½ å¥½ï¼Œæˆ‘æ˜¯popupï¼'}, function(response){\n    console.log('æ¥è‡ªcontentçš„å›å¤ï¼š'+response);\n});\n```\n\n``` javascript\n// content-script.js æ¥æ”¶\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse){\n    // console.log(sender.tab ?\"from a content script:\" + sender.tab.url :\"from the extension\");\n    if(request.cmd == 'test') alert(request.value);\n    sendResponse('æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼');\n});\n```\n\n### contentå’Œbackground\n\n``` javascript\n// content-script.js å‘é€\nchrome.runtime.sendMessage({greeting: 'ä½ å¥½ï¼Œæˆ‘æ˜¯content-scriptå‘€ï¼Œæˆ‘ä¸»åŠ¨å‘æ¶ˆæ¯ç»™åå°ï¼'}, function(response) {\n    console.log('æ”¶åˆ°æ¥è‡ªåå°çš„å›å¤ï¼š' + response);\n});\n```\n\n``` javascript\n// background.js æˆ–è€… popup.jsç›‘å¬æ¥è‡ªcontent-scriptçš„æ¶ˆæ¯\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse)\n{\n    console.log('æ”¶åˆ°æ¥è‡ªcontent-scriptçš„æ¶ˆæ¯ï¼š');\n    console.log(request, sender, sendResponse);\n    sendResponse('æˆ‘æ˜¯åå°ï¼Œæˆ‘å·²æ”¶åˆ°ä½ çš„æ¶ˆæ¯ï¼š' + JSON.stringify(request));\n});\n```\n\n> content_scriptså‘`popup`ä¸»åŠ¨å‘æ¶ˆæ¯çš„å‰ææ˜¯popupå¿…é¡»æ‰“å¼€ï¼å¦åˆ™éœ€è¦åˆ©ç”¨backgroundä½œä¸­è½¬ï¼›\n>\n> å¦‚æœbackgroundå’ŒpopupåŒæ—¶ç›‘å¬ï¼Œé‚£ä¹ˆå®ƒä»¬éƒ½å¯ä»¥åŒæ—¶æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªå¯ä»¥sendResponseï¼Œä¸€ä¸ªå…ˆå‘é€äº†ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ªå†å‘é€å°±æ— æ•ˆï¼›\n\n### contentå’Œpopup\n\n> åŒcontentå’Œbackground\n\n### injected scriptå’Œcontent-script\n\n> `content-script`å’Œé¡µé¢å†…çš„è„šæœ¬ï¼ˆ`injected-script`è‡ªç„¶ä¹Ÿå±äºé¡µé¢å†…çš„è„šæœ¬ï¼‰ä¹‹é—´å”¯ä¸€å…±äº«çš„ä¸œè¥¿å°±æ˜¯é¡µé¢çš„DOMå…ƒç´ ï¼Œæœ‰2ç§æ–¹æ³•å¯ä»¥å®ç°äºŒè€…é€šè®¯ï¼š\n>\n> 1. å¯ä»¥é€šè¿‡`window.postMessage`å’Œ`window.addEventListener`æ¥å®ç°äºŒè€…æ¶ˆæ¯é€šè®¯ï¼›\n> 2. é€šè¿‡è‡ªå®šä¹‰DOMäº‹ä»¶æ¥å®ç°ï¼›\n\n+ æ–¹æ³•ä¸€ï¼šï¼ˆæ¨èï¼‰\n\n``` javascript\n//injected-script\nwindow.postMessage({\"test\": 'ä½ å¥½ï¼'}, '*');\n\n//content script\nwindow.addEventListener(\"message\", function(e){\n    console.log(e.data);\n}, false);\n```\n\n+ æ–¹æ³•äºŒï¼š\n\n``` javascript\n//injected-script\nvar customEvent = document.createEvent('Event');\ncustomEvent.initEvent('myCustomEvent', true, true);\nfunction fireCustomEvent(data) {\n    hiddenDiv = document.getElementById('myCustomEventDiv');\n    hiddenDiv.innerText = data\n    hiddenDiv.dispatchEvent(customEvent);\n}\nfireCustomEvent('ä½ å¥½ï¼Œæˆ‘æ˜¯æ™®é€šJSï¼');\n\n//content script\nvar hiddenDiv = document.getElementById('myCustomEventDiv');\nif(!hiddenDiv) {\n    hiddenDiv = document.createElement('div');\n    hiddenDiv.style.display = 'none';\n    document.body.appendChild(hiddenDiv);\n}\nhiddenDiv.addEventListener('myCustomEvent', function() {\n    var eventData = document.getElementById('myCustomEventDiv').innerText;\n    console.log('æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶æ¶ˆæ¯ï¼š' + eventData);\n});\n```\n\n## é•¿è¿æ¥\n\nçŸ­è¿æ¥ï¼š`chrome.tabs.sendMessage`å’Œ`chrome.runtime.sendMessage`\n\né•¿è¿æ¥ï¼š`chrome.tabs.connect`å’Œ`chrome.runtime.connect`\n\n``` javascript\n// popup.js\ngetCurrentTabId((tabId) => {\n    var port = chrome.tabs.connect(tabId, {name: 'test-connect'});\n    port.postMessage({question: 'ä½ æ˜¯è°å•Šï¼Ÿ'});\n    port.onMessage.addListener(function(msg) {\n        alert('æ”¶åˆ°æ¶ˆæ¯ï¼š'+msg.answer);\n        if(msg.answer && msg.answer.startsWith('æˆ‘æ˜¯'))\n        {\n            port.postMessage({question: 'å“¦ï¼ŒåŸæ¥æ˜¯ä½ å•Šï¼'});\n        }\n    });\n});\n\n// content-script.js\n// ç›‘å¬é•¿è¿æ¥\nchrome.runtime.onConnect.addListener(function(port) {\n    console.log(port);\n    if(port.name == 'test-connect') {\n        port.onMessage.addListener(function(msg) {\n            console.log('æ”¶åˆ°é•¿è¿æ¥æ¶ˆæ¯ï¼š', msg);\n            if(msg.question == 'ä½ æ˜¯è°å•Šï¼Ÿ') port.postMessage({answer: 'æˆ‘æ˜¯ä½ çˆ¸ï¼'});\n        });\n    }\n});\n```\n\n## åŠ¨æ€æ³¨å…¥\n\n### script\n\nè™½ç„¶åœ¨`background`å’Œ`popup`ä¸­æ— æ³•ç›´æ¥è®¿é—®é¡µé¢DOMï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡`chrome.tabs.executeScript`æ¥æ‰§è¡Œè„šæœ¬ï¼Œä»è€Œå®ç°è®¿é—®webé¡µé¢çš„DOMï¼ˆæ³¨æ„ï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®é¡µé¢JSï¼‰\n\n``` json\n{\n    \"name\": \"åŠ¨æ€JSæ³¨å…¥æ¼”ç¤º\",\n    ...\n    \"permissions\": [\n        \"tabs\", \"http://*/*\", \"https://*/*\"\n    ],\n    ...\n}\n```\n\n``` javascript\n// åŠ¨æ€æ‰§è¡ŒJSä»£ç \nchrome.tabs.executeScript(tabId, {code: 'document.body.style.backgroundColor=\"red\"'});\n// åŠ¨æ€æ‰§è¡ŒJSæ–‡ä»¶\nchrome.tabs.executeScript(tabId, {file: 'some-script.js'});\n```\n\n### css\n\n``` json\n{\n    \"name\": \"åŠ¨æ€CSSæ³¨å…¥æ¼”ç¤º\",\n    ...\n    \"permissions\": [\n        \"tabs\", \"http://*/*\", \"https://*/*\"\n    ],\n    ...\n}\n```\n\n``` javascript\n// åŠ¨æ€æ‰§è¡ŒCSSä»£ç ï¼ŒTODOï¼Œè¿™é‡Œæœ‰å¾…éªŒè¯\nchrome.tabs.insertCSS(tabId, {code: 'xxx'});\n// åŠ¨æ€æ‰§è¡ŒCSSæ–‡ä»¶\nchrome.tabs.insertCSS(tabId, {file: 'some-style.css'});\n```\n\n## è·å–æ ‡ç­¾å’Œçª—å£\n\n``` javascript\n// è·å–å½“å‰çª—å£ID\nchrome.windows.getCurrent(function(currentWindow){\n    console.log('å½“å‰çª—å£IDï¼š' + currentWindow.id);\n});\n\n//è·å–å½“å‰æ ‡ç­¾é¡µID\n// 1\nfunction getCurrentTabId(callback){\n    chrome.tabs.query({active: true, currentWindow: true}, function(tabs){\n        if(callback) callback(tabs.length ? tabs[0].id: null);\n    });\n}\n\n//2\nfunction getCurrentTabId2(){\n    chrome.windows.getCurrent(function(currentWindow){\n        chrome.tabs.query({active: true, windowId: currentWindow.id}, function(tabs){\n            if(callback) callback(tabs.length ? tabs[0].id: null);\n        });\n    });\n}\n```\n\n\n\n##å³é”®èœå•\n\nè¦å°†æ‰©å±•åŠ å…¥åˆ°å³é”®èœå•ä¸­ï¼Œé¦–å…ˆè¦åœ¨Manifestçš„permissionsåŸŸä¸­å£°æ˜contextMenusæƒé™ã€‚\n```javascript\n\"permissions\": [\n    \"contextMenus\"\n]\n```\nåŒæ—¶è¿˜è¦åœ¨iconsåŸŸå£°æ˜16åƒç´ å°ºå¯¸çš„å›¾æ ‡ï¼Œè¿™æ ·åœ¨å³é”®èœå•ä¸­æ‰ä¼šæ˜¾ç¤ºå‡ºæ‰©å±•çš„å›¾æ ‡ã€‚\n```javascript\n\"icons\": {\n    \"16\": \"icon16.png\"\n}\n```\nChromeæä¾›äº†ä¸‰ç§æ–¹æ³•æ“ä½œå³é”®èœå•ï¼Œåˆ†åˆ«æ˜¯createã€updateå’Œremoveï¼Œå¯¹åº”äºåˆ›å»ºã€æ›´æ–°å’Œç§»é™¤æ“ä½œã€‚\n\né€šå¸¸createæ–¹æ³•ç”±åå°é¡µé¢æ¥è°ƒç”¨ï¼Œå³é€šè¿‡åå°é¡µé¢åˆ›å»ºè‡ªå®šä¹‰èœå•ã€‚å¦‚æœåå°é¡µé¢æ˜¯Event Pageï¼Œé€šå¸¸åœ¨onInstalledäº‹ä»¶ä¸­è°ƒç”¨createæ–¹æ³•ã€‚\n\nå³é”®èœå•æä¾›äº†4ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯æ™®é€šèœå•ã€å¤é€‰èœå•ã€å•é€‰èœå•å’Œåˆ†å‰²çº¿ï¼Œå…¶ä¸­æ™®é€šèœå•è¿˜å¯ä»¥æœ‰ä¸‹çº§èœå•ã€‚è¿ç»­ç›¸é‚»çš„å•é€‰èœå•ä¼šè¢«è‡ªåŠ¨è®¤ä¸ºæ˜¯å¯¹åŒä¸€è®¾ç½®çš„é€‰é¡¹ï¼ŒåŒæ—¶å•é€‰èœå•ä¼šè‡ªåŠ¨åœ¨ä¸¤ç«¯ç”Ÿæˆåˆ†å‰²çº¿ã€‚ä¸‹é¢çš„ä»£ç ç”Ÿæˆäº†ä¸€ç³»åˆ—çš„èœå•ï¼š\n\næˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„å³é”®èœå•åœ¨ä½•æ—¶æ˜¾ç¤ºï¼Œæ¯”å¦‚å½“ç”¨æˆ·é€‰æ‹©æ–‡æœ¬æ—¶ï¼Œæˆ–è€…åœ¨è¶…çº§é“¾æ¥ä¸Šå•å‡»å³é”®æ—¶ã€‚ä¸‹é¢çš„ä»£ç å®šä¹‰å½“ç”¨æˆ·åœ¨è¶…çº§é“¾æ¥ä¸Šç‚¹å‡»å³é”®æ—¶ï¼Œåœ¨èœå•ä¸­æ˜¾ç¤ºâ€œMy Menuâ€èœå•ï¼š\n```javascript\nchrome.contextMenus.create({\n    type: 'normal',\n    title: 'My Menu',\n    contexts: ['link']\n});\n```\ncontextsåŸŸçš„å€¼æ˜¯æ•°ç»„å‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç§æƒ…å†µä¸‹æ˜¾ç¤ºè‡ªå®šä¹‰èœå•ï¼Œå®Œæ•´çš„é€‰é¡¹åŒ…æ‹¬allã€pageã€frameã€selectionã€linkã€editableã€imageã€videoã€audioå’Œlauncherï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºpageï¼Œå³åœ¨æ‰€æœ‰çš„é¡µé¢å”¤å‡ºå³é”®èœå•æ—¶éƒ½æ˜¾ç¤ºè‡ªå®šä¹‰èœå•ã€‚å…¶ä¸­launcheråªå¯¹Chromeåº”ç”¨æœ‰æ•ˆï¼Œå¦‚æœåŒ…å«launcheré€‰é¡¹ï¼Œåˆ™å½“ç”¨æˆ·åœ¨chrome://apps/æˆ–è€…å…¶ä»–åœ°æ–¹çš„åº”ç”¨å›¾æ ‡ç‚¹å‡»å³é”®ï¼Œå°†æ˜¾ç¤ºç›¸åº”çš„è‡ªå®šä¹‰èœå•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œallé€‰é¡¹ä¸åŒ…æ‹¬launcherã€‚\n\nupdateæ–¹æ³•å¯ä»¥åŠ¨æ€æ›´æ”¹èœå•å±æ€§ï¼ŒæŒ‡å®šéœ€è¦æ›´æ”¹èœå•çš„idå’Œæ‰€éœ€è¦æ›´æ”¹çš„å±æ€§å³å¯ã€‚removeæ–¹æ³•å¯ä»¥åˆ é™¤æŒ‡å®šçš„èœå•ï¼ŒremoveAllæ–¹æ³•å¯ä»¥åˆ é™¤æ‰€æœ‰çš„èœå•ã€‚\n\n## æ¡Œé¢æé†’\nè¦ä½¿ç”¨æ¡Œé¢æé†’åŠŸèƒ½ï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜notificationsæƒé™ã€‚\n```javascript\n\"permissions\": [\n    \"notifications\"\n]\n```\nåˆ›å»ºæ¡Œé¢æé†’éå¸¸å®¹æ˜“ï¼Œåªéœ€æŒ‡å®šæ ‡é¢˜ã€å†…å®¹å’Œå›¾ç‰‡å³å¯ã€‚æ¡Œé¢ç³»ç»Ÿçª—å£åˆ›å»ºä¹‹åæ˜¯ä¸ä¼šç«‹åˆ»æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œä¸ºäº†è®©å…¶æ˜¾ç¤ºï¼Œè¿˜è¦è°ƒç”¨showæ–¹æ³•ï¼š`notification.show();`\n\n> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºè¦åœ¨æ¡Œé¢çª—å£ä¸­æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œå¿…é¡»åœ¨Manifestçš„web_accessible_resourcesåŸŸä¸­è¿›è¡Œå£°æ˜ï¼Œå¦åˆ™ä¼šå‡ºç°å›¾ç‰‡æ— æ³•æ‰“å¼€çš„æƒ…å†µ:\n```javascript\n\"web_accessible_resources\": [\n    \"icon48.png\"\n]\n```\n\n\n>å¦‚æœå¸Œæœ›imagesæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰pngå›¾ç‰‡éƒ½å¯è¢«æ˜¾ç¤ºï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å£°æ˜å®ç°ï¼š\n```javascript\n\"web_accessible_resources\": [\n    \"images/*.png\"\n]\n```\næ¡Œé¢æé†’çª—å£æä¾›äº†å››ç§äº‹ä»¶ï¼šondisplayã€onerrorã€oncloseå’Œonclickã€‚\n\n[æ¡Œé¢é€šçŸ¥](http://www.cnblogs.com/champagne/p/4831874.html)\n\n## Omnibox\nè¦ä½¿ç”¨omniboxéœ€è¦åœ¨Manifestçš„omniboxåŸŸæŒ‡å®škeywordï¼š`\"omnibox\": { \"keyword\" : \"hamster\" }`ã€‚åŒæ—¶æœ€å¥½æŒ‡å®šä¸€ä¸ª16åƒç´ çš„å›¾æ ‡ï¼Œå½“ç”¨æˆ·é”®å…¥å…³é”®å­—åï¼Œè¿™ä¸ªå›¾æ ‡ä¼šæ˜¾ç¤ºåœ¨åœ°å€æ çš„å‰ç«¯ã€‚`\"icons\": {\"16\": \"icon16.png\"}`ã€‚\n\nOmniboxæœ‰å››ç§äº‹ä»¶ï¼šonInputStartedã€onInputChangedã€onInputEnteredå’ŒonInputCancelledï¼Œåˆ†åˆ«ç”¨äºç›‘å¬ç”¨æˆ·å¼€å§‹è¾“å…¥ã€è¾“å…¥å˜åŒ–ã€æ‰§è¡ŒæŒ‡ä»¤å’Œå–æ¶ˆè¾“å…¥è¡Œä¸ºã€‚å…¶ä¸­æ‰§è¡ŒæŒ‡ä»¤æ˜¯æŒ‡ç”¨æˆ·æ•²å‡»å›è½¦é”®æˆ–ç”¨é¼ æ ‡ç‚¹å‡»å»ºè®®ç»“æœã€‚\n\n## ä¹¦ç­¾\nè¦åœ¨æ‰©å±•ä¸­æ“ä½œä¹¦ç­¾ï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜bookmarksæƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"bookmarks\"\n]\n```\nä¹¦ç­¾å¯¹è±¡æœ‰8ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯idã€parentIdã€indexã€urlã€titleã€dateAddedã€dateGroupModifiedå’Œchildrenã€‚è¿™8ä¸ªå±æ€§å¹¶ä¸æ˜¯æ¯ä¸ªä¹¦ç­¾å¯¹è±¡éƒ½å…·æœ‰çš„ï¼Œæ¯”å¦‚ä¹¦ç­¾åˆ†ç±»ï¼Œå³ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå®ƒå°±ä¸å…·æœ‰urlå±æ€§ã€‚indexå±æ€§æ˜¯è¿™ä¸ªä¹¦ç­¾åœ¨å…¶çˆ¶èŠ‚ç‚¹ä¸­çš„ä½ç½®ï¼Œå®ƒçš„å€¼æ˜¯ä»0å¼€å§‹çš„ã€‚childrenå±æ€§å€¼æ˜¯ä¸€ä¸ªåŒ…å«è‹¥å¹²ä¹¦ç­¾å¯¹è±¡çš„æ•°ç»„ã€‚dateAddedå’ŒdateGroupModifiedçš„å€¼æ˜¯è‡ª1970å¹´1æœˆ1æ—¥è‡³ä¿®æ”¹æ—¶é—´æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚åªæœ‰idå’Œtitleæ˜¯ä¹¦ç­¾å¯¹è±¡å¿…æœ‰çš„å±æ€§ï¼Œå…¶ä»–çš„å±æ€§éƒ½æ˜¯å¯é€‰çš„ã€‚idä¸éœ€è¦äººä¸ºå¹²é¢„ï¼Œå®ƒæ˜¯ç”±Chromeç®¡ç†çš„ã€‚æ ¹çš„idä¸º'0'ã€‚\n\n'0'ä¸ºæ ¹èŠ‚ç‚¹idï¼Œæ ¹èŠ‚ç‚¹ä¸‹æ˜¯ä¸å…è®¸åˆ›å»ºä¹¦ç­¾å’Œä¹¦ç­¾åˆ†ç»„çš„ï¼Œå®ƒçš„ä¸‹é¢é»˜è®¤åªæœ‰ä¸‰ä¸ªä¹¦ç­¾åˆ†ç»„ï¼šä¹¦ç­¾æ ã€å…¶ä»–ä¹¦ç­¾å’Œç§»åŠ¨è®¾å¤‡ä¹¦ç­¾ï¼Œå¦‚æœåˆ›å»ºæ—¶ä¸æŒ‡å®šparentIdï¼Œåˆ™æ‰€åˆ›å»ºçš„ä¹¦ç­¾ä¼šé»˜è®¤åŠ å…¥åˆ°å…¶ä»–ä¹¦ç­¾ä¸­ã€‚\n\nå¦‚æœåˆ›å»ºçš„ä¹¦ç­¾ä¸åŒ…å«urlå±æ€§ï¼Œåˆ™Chromeè‡ªåŠ¨å°†å…¶è§†ä½œä¸ºä¹¦ç­¾åˆ†ç±»ã€‚\n\né€šè¿‡moveæ–¹æ³•å¯ä»¥è°ƒæ•´ä¹¦ç­¾çš„ä½ç½®ï¼Œè¿™ç§è°ƒæ•´å¯ä»¥æ˜¯è·¨è¶Šçˆ¶èŠ‚ç‚¹çš„ã€‚\n\né€šè¿‡updateæ–¹æ³•å¯ä»¥æ›´æ”¹ä¹¦ç­¾å±æ€§ï¼ŒåŒ…æ‹¬æ ‡é¢˜å’ŒURLï¼Œæ›´æ–°æ—¶æœªæŒ‡å®šçš„å±æ€§å€¼å°†ä¸ä¼šæ›´æ”¹ã€‚\n\né€šè¿‡removeå’ŒremoveTreeå¯ä»¥åˆ é™¤ä¹¦ç­¾ï¼Œremoveæ–¹æ³•å¯ä»¥åˆ é™¤ä¹¦ç­¾å’Œç©ºçš„ä¹¦ç­¾åˆ†ç»„ï¼ŒremoveTreeå¯ä»¥åˆ é™¤åŒ…å«ä¹¦ç­¾çš„ä¹¦ç­¾åˆ†ç»„ã€‚\n\né€šè¿‡getTreeæ–¹æ³•å¯ä»¥è·å¾—ç”¨æˆ·å®Œæ•´çš„ä¹¦ç­¾æ ‘ã€‚\n\nsearchæ–¹æ³•å¯ä»¥è¿”å›åŒ¹é…æŒ‡å®šæ¡ä»¶çš„ä¹¦ç­¾å¯¹è±¡ï¼ŒåŒ¹é…çš„æ¡ä»¶åªèƒ½å­—ç¬¦ä¸²ã€‚\n\nä¹¦ç­¾çš„äº‹ä»¶ï¼šonCreatedã€onRemovedã€onChangedã€onChildrenReorderedã€onImportBeganã€onImportEndedã€‚\n```javascript\nchrome.bookmarks.onCreated.addListener(function(bookmark){\n    console.log(bookmark);\n});\n```\n\n## Cookies\nè¦ç®¡ç†Cookiesï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜cookiesæƒé™ï¼ŒåŒæ—¶ä¹Ÿè¦å£°æ˜æ‰€éœ€ç®¡ç†Cookiesæ‰€åœ¨çš„åŸŸï¼š\n```javascript\n\"permissions\": [\n    \"cookies\",\n    \"*://*.google.com\"\n]\n```\nå¦‚æœæƒ³è¦ç®¡ç†æ‰€æœ‰çš„Cookieså¯ä»¥å£°æ˜å¦‚ä¸‹æƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"cookies\",\n    \"<all_urls>\"\n]\n```\n\nChromeå®šä¹‰çš„Cookieå¯¹è±¡åŒ…å«å¦‚ä¸‹å±æ€§ï¼šnameï¼ˆåç§°ï¼‰ã€valueï¼ˆå€¼ï¼‰ã€domainï¼ˆåŸŸï¼‰ã€hostOnlyï¼ˆæ˜¯å¦åªå…è®¸å®Œå…¨åŒ¹é…domainçš„è¯·æ±‚è®¿é—®ï¼‰ã€pathï¼ˆè·¯å¾„ï¼‰ã€secureï¼ˆæ˜¯å¦åªå…è®¸å®‰å…¨è¿æ¥è°ƒç”¨ï¼‰ã€httpOnlyï¼ˆæ˜¯å¦ç¦æ­¢å®¢æˆ·ç«¯è°ƒç”¨ï¼‰ã€sessionï¼ˆæ˜¯å¦æ˜¯session cookieï¼‰ã€expirationDateï¼ˆè¿‡æœŸæ—¶é—´ï¼‰å’ŒstoreIdï¼ˆåŒ…å«æ­¤cookieçš„cookie storeçš„idï¼‰ã€‚\n\nChromeæä¾›äº†getå’ŒgetAllä¸¤ä¸ªæ–¹æ³•è¯»å–Cookiesï¼Œgetæ–¹æ³•å¯ä»¥è¯»å–æŒ‡å®šnameã€urlå’ŒstoreIdçš„Cookieï¼Œå…¶ä¸­storeIdå¯ä»¥ä¸æŒ‡å®šï¼Œä½†æ˜¯nameå’Œurlå¿…é¡»æŒ‡å®šã€‚å¦‚æœåœ¨åŒä¸€URLä¸­åŒ…å«å¤šä¸ªnameç›¸åŒçš„Cookiesï¼Œåˆ™ä¼šè¿”å›pathæœ€é•¿çš„é‚£ä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªCookiesçš„pathé•¿åº¦ç›¸åŒï¼Œåˆ™è¿”å›åˆ›å»ºæœ€æ—©çš„é‚£ä¸ªã€‚\n\n> å¦‚æœcookieçš„secureå±æ€§å€¼ä¸ºtrueï¼Œé‚£ä¹ˆé€šè¿‡getè·å–æ—¶urlåº”è¯¥æ˜¯httpsåè®®ã€‚\n\nsetæ–¹æ³•å¯ä»¥è®¾ç½®Cookieï¼š\n```javascript\nchrome.cookies.set({\n    'url':'http://github.com/test_cookie',\n    'name':'TEST',\n    'value':'foo',\n    'secure':false,\n    'httpOnly':false\n}, function(cookie){\n    console.log(cookie);\n});\n```\n\n## å†å²\nè¦ä½¿ç”¨historyæ¥å£ï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜historyæƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"history\"\n]\n```\nç®¡ç†å†å²çš„æ–¹æ³•åŒ…æ‹¬searchã€getVisitsã€addUrlã€deleteUrlã€deleteRangeå’ŒdeleteAllã€‚å…¶ä¸­searchå’ŒgetVisitsç”¨äºè¯»å–å†å²ï¼ŒaddUrlç”¨äºæ·»åŠ å†å²ï¼ŒdeleteUrlã€deleteRangeå’ŒdeleteAllç”¨äºåˆ é™¤å†å²ã€‚\n\n## ç®¡ç†æ‰©å±•ä¸åº”ç”¨\né™¤äº†é€šè¿‡chrome://extensions/ç®¡ç†Chromeæ‰©å±•å’Œåº”ç”¨å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Chromeçš„managementæ¥å£ç®¡ç†ã€‚managementæ¥å£å¯ä»¥è·å–ç”¨æˆ·å·²å®‰è£…çš„æ‰©å±•å’Œåº”ç”¨ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¸è½½å’Œç¦ç”¨å®ƒä»¬ã€‚é€šè¿‡managementæ¥å£å¯ä»¥ç¼–å†™å‡ºæ™ºèƒ½ç®¡ç†æ‰©å±•å’Œåº”ç”¨çš„ç¨‹åºã€‚\n\nè¦ä½¿ç”¨managementæ¥å£ï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜managementæƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"management\"\n]\n```\nè¯»å–ç”¨æˆ·å·²å®‰è£…æ‰©å±•å’Œåº”ç”¨çš„ä¿¡æ¯ã€‚Managementæä¾›äº†ä¸¤ä¸ªæ–¹æ³•è·å–ç”¨æˆ·å·²å®‰è£…æ‰©å±•åº”ç”¨çš„ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯getAllå’Œgetã€‚\nexInfoæ˜¯æ‰©å±•ä¿¡æ¯å¯¹è±¡ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š\n```javascript\n{\n    id: æ‰©å±•id,\n    name: æ‰©å±•åç§°,\n    shortName: æ‰©å±•çŸ­åç§°,\n    description: æ‰©å±•æè¿°,\n    version: æ‰©å±•ç‰ˆæœ¬,\n    mayDisable: æ˜¯å¦å¯è¢«ç”¨æˆ·å¸è½½æˆ–ç¦ç”¨,\n    enabled: æ˜¯å¦å·²å¯ç”¨,\n    disabledReason: æ‰©å±•è¢«ç¦ç”¨åŸå› ,\n    type: ç±»å‹,\n    appLaunchUrl: å¯åŠ¨url,\n    homepageUrl: ä¸»é¡µurl,\n    updateUrl: æ›´æ–°url,\n    offlineEnabled: ç¦»çº¿æ˜¯å¦å¯ç”¨,\n    optionsUrl: é€‰é¡¹é¡µé¢url,\n    icons: [{\n        size: å›¾ç‰‡å°ºå¯¸,\n        url: å›¾ç‰‡URL\n    }],\n    permissions: æ‰©å±•æƒé™,\n    hostPermissions: æ‰©å±•æœ‰æƒé™è®¿é—®çš„host,\n    installType: æ‰©å±•è¢«å®‰è£…çš„æ–¹å¼\n}\n```\n\n## æ ‡ç­¾\næ ‡ç­¾å¯¹è±¡çš„ç»“æ„ï¼š\n```javascript\n{\n    id: æ ‡ç­¾id,\n    index: æ ‡ç­¾åœ¨çª—å£ä¸­çš„ä½ç½®ï¼Œä»¥0å¼€å§‹,\n    windowId: æ ‡ç­¾æ‰€åœ¨çª—å£çš„id,\n    openerTabId: æ‰“å¼€æ­¤æ ‡ç­¾çš„æ ‡ç­¾id,\n    highlighted: æ˜¯å¦è¢«é«˜äº®æ˜¾ç¤º,\n    active: æ˜¯å¦æ˜¯æ´»åŠ¨çš„,\n    pinned: æ˜¯å¦è¢«å›ºå®š,\n    url: æ ‡ç­¾çš„URL,\n    title: æ ‡ç­¾çš„æ ‡é¢˜,\n    favIconUrl: æ ‡ç­¾faviconçš„URL,\n    status :æ ‡ç­¾çŠ¶æ€ï¼Œloadingæˆ–complete,\n    incognito: æ˜¯å¦åœ¨éšèº«çª—å£ä¸­,\n    width: å®½åº¦,\n    height: é«˜åº¦,\n    sessionId: ç”¨äºsessions APIçš„å”¯ä¸€id\n}\n```\nChromeé€šè¿‡tabsæ–¹æ³•æä¾›äº†ç®¡ç†æ ‡ç­¾çš„æ–¹æ³•ä¸ç›‘å¬æ ‡ç­¾è¡Œä¸ºçš„äº‹ä»¶ï¼Œå¤§å¤šæ•°æ–¹æ³•ä¸äº‹ä»¶æ˜¯æ— éœ€å£°æ˜ç‰¹æ®Šæƒé™çš„ï¼Œä½†æœ‰å…³æ ‡ç­¾çš„urlã€titleå’ŒfavIconUrlçš„æ“ä½œï¼ˆåŒ…æ‹¬è¯»å–ï¼‰ï¼Œéƒ½éœ€è¦å£°æ˜tabsæƒé™ã€‚\n```javascript\n\"permissions\": [\n    \"tabs\"\n]\n```\nè·å–æ ‡ç­¾ä¿¡æ¯ã€‚Chromeæä¾›äº†ä¸‰ç§è·å–æ ‡ç­¾ä¿¡æ¯çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯getã€getCurrentå’Œqueryã€‚getæ–¹æ³•å¯ä»¥è·å–åˆ°æŒ‡å®šidçš„æ ‡ç­¾ï¼ŒgetCurrentåˆ™è·å–è¿è¡Œçš„è„šæœ¬æœ¬èº«æ‰€åœ¨çš„æ ‡ç­¾ï¼Œqueryå¯ä»¥è·å–æ‰€æœ‰ç¬¦åˆæŒ‡å®šæ¡ä»¶çš„æ ‡ç­¾ã€‚\n```javascript\nchrome.tabs.get(tabId, function(tab){\n    console.log(tab);\n});\n\nchrome.tabs.getCurrent(function(tab){\n    console.log(tab);\n});\n```\nqueryæ–¹æ³•å¯ä»¥æŒ‡å®šçš„åŒ¹é…æ¡ä»¶å¦‚ä¸‹ï¼š\n```javascript\n{\n    active: æ˜¯å¦æ˜¯æ´»åŠ¨çš„,\n    pinned: æ˜¯å¦è¢«å›ºå®š,\n    highlighted: æ˜¯å¦æ­£è¢«é«˜äº®æ˜¾ç¤º,\n    currentWindow: æ˜¯å¦åœ¨å½“å‰çª—å£,\n    lastFocusedWindow: æ˜¯å¦æ˜¯ä¸Šä¸€æ¬¡é€‰ä¸­çš„çª—å£,\n    status: çŠ¶æ€ï¼Œloadingæˆ–complete,\n    title: æ ‡é¢˜,\n    url: æ‰€æ‰“å¼€çš„url,\n    windowId: æ‰€åœ¨çª—å£çš„id,\n    windowType: çª—å£ç±»å‹ï¼Œnormalã€popupã€panelæˆ–app,\n    index: çª—å£ä¸­çš„ä½ç½®\n}\n```\nåˆ›å»ºæ ‡ç­¾ã€‚åˆ›å»ºæ ‡ç­¾ä¸åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–°çš„æ ‡ç­¾è¡Œä¸ºç±»ä¼¼ï¼Œä½†å¯ä»¥æŒ‡å®šæ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯ï¼Œå¦‚URLã€çª—å£ä¸­çš„ä½ç½®å’Œæ´»åŠ¨çŠ¶æ€ç­‰ã€‚\n```javascript\nchrome.tabs.create({\n    windowId: wId,\n    index: 0,\n    url: 'http://www.google.com',\n    active: true,\n    pinned: false,\n    openerTabId: tId\n}, function(tab){\n    console.log(tab);\n});\n```\nè·å–æŒ‡å®šçª—å£æ´»åŠ¨æ ‡ç­¾å¯è§éƒ¨åˆ†çš„æˆªå›¾ã€‚\n```javascript\nchrome.tabs.captureVisibleTab(windowId, {\n    format: 'jpeg',\n    quality: 50\n}, function(dataUrl){\n    window.open(dataUrl, 'tabCapture');\n});\n```\nå…¶ä¸­formatè¿˜æ”¯æŒpngï¼Œå¦‚æœæŒ‡å®šä¸ºpngï¼Œåˆ™qualityå±æ€§ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœæŒ‡å®šjpegæ ¼å¼ï¼Œqualityçš„å–å€¼èŒƒå›´ä¸º0-100ï¼Œæ•°å€¼è¶Šé«˜ï¼Œå›¾ç‰‡è´¨é‡è¶Šå¥½ï¼Œä½“ç§¯ä¹Ÿè¶Šå¤§ã€‚æ‰©å±•åªæœ‰å£°æ˜activeTabæˆ–<all_url>æƒé™èƒ½è·å–åˆ°æ´»åŠ¨æ ‡ç­¾çš„æˆªå›¾ï¼š\n```javascript\n\"permissions\": [\n    \"activeTab\"\n]\n```\ncontent_scriptså¯ä»¥å‘åŒ¹é…æ¡ä»¶çš„é¡µé¢æ³¨å…¥JSå’ŒCSSï¼Œä½†æ˜¯å´æ— æ³•å‘ç”¨æˆ·æŒ‡å®šçš„æ ‡ç­¾æ³¨å…¥ã€‚é€šè¿‡executeScriptå’ŒinsertCSSå¯ä»¥åšåˆ°å‘æŒ‡å®šçš„æ ‡ç­¾æ³¨å…¥è„šæœ¬ã€‚\n```javascript\nchrome.tabs.executeScript(tabId, {\n    file: 'js/ex.js',\n    allFrames: true,\n    runAt: 'document_start'\n}, function(resultArray){\n    console.log(resultArray);\n});\n```\nä¹Ÿå¯ä»¥ç›´æ¥æ³¨å…¥ä»£ç ï¼š\n```javascript\nchrome.tabs.executeScript(tabId, {\n    code: 'document.body.style.backgroundColor=\"red\"',\n    allFrames: true,\n    runAt: 'document_start'\n}, function(resultArray){\n    console.log(resultArray);\n});\n```\nå‘æŒ‡å®šçš„æ ‡ç­¾æ³¨å…¥CSSï¼š\n```javascript\nchrome.tabs.insertCSS(tabId, {\n    file: 'css/insert.css',\n    allFrames: false,\n    runAt: 'document_start'\n}, function(){\n    console.log('The css has been inserted.');\n});\n```\nexecuteScriptå’ŒinsertCSSæ–¹æ³•ä¸­runAtçš„å€¼å¯ä»¥æ˜¯'document_start'ã€'document_end'æˆ–'document_idle'ã€‚\n\nä¸æŒ‡å®šæ ‡ç­¾ä¸­çš„å†…å®¹è„šæœ¬ï¼ˆcontent scriptï¼‰é€šä¿¡ã€‚å‰é¢ç« èŠ‚ä»‹ç»è¿‡æ‰©å±•é¡µé¢é—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šçš„æ ‡ç­¾é€šä¿¡ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\n```javascript\nchrome.tabs.sendMessage(tabId, message, function(response){\n    console.log(response);\n});\n```\n\n> åå°é¡µé¢ä¸»åŠ¨ä¸content_scriptsé€šä¿¡éœ€è¦ä½¿ç”¨chrome.tabs.sendMessageæ–¹æ³•\n\nç›‘æ§æ ‡ç­¾è¡Œä¸ºçš„äº‹ä»¶åŒ…å«onCreatedã€onUpdatedã€onMovedã€onActivatedã€onHighlightedã€onDetachedã€onAttachedã€onRemovedå’ŒonReplacedã€‚\n\n## Override Pages\nç›®å‰æ”¯æŒæ›¿æ¢çš„é¡µé¢åŒ…å«Chromeçš„ä¹¦ç­¾é¡µé¢ã€å†å²è®°å½•å’Œæ–°æ ‡ç­¾é¡µé¢ã€‚\nåªéœ€åœ¨Manifestä¸­è¿›è¡Œå£°æ˜å³å¯ï¼ˆä¸€ä¸ªæ‰©å±•åªèƒ½æ›¿æ¢ä¸€ä¸ªé¡µé¢ï¼‰ï¼š\n```javascript\n\"chrome_url_overrides\" : {\n    \"bookmarks\": \"bookmarks.html\"\n}\n\n\"chrome_url_overrides\" : {\n    \"history\": \"history.html\"\n}\n\n\"chrome_url_overrides\" : {\n    \"newtab\": \"newtab.html\"\n}\n```\n\n## ä¸‹è½½\nChromeæä¾›äº†downloads APIï¼Œæ‰©å±•å¯ä»¥é€šè¿‡æ­¤APIç®¡ç†æµè§ˆå™¨çš„ä¸‹è½½åŠŸèƒ½ï¼ŒåŒ…æ‹¬æš‚åœã€æœç´¢å’Œå–æ¶ˆç­‰ã€‚æ‰©å±•ä½¿ç”¨downloadsæ¥å£éœ€è¦åœ¨Manifestæ–‡ä»¶ä¸­å£°æ˜downloadsæƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"downloads\"\n]\n```\n`chrome.downloads.download(options, callback);`å…¶ä¸­optionsçš„å®Œæ•´ç»“æ„å¦‚ä¸‹ï¼š\n```javascript\n{\n    url: ä¸‹è½½æ–‡ä»¶çš„url,\n    filename: ä¿å­˜çš„æ–‡ä»¶å,\n    conflictAction: é‡åæ–‡ä»¶çš„å¤„ç†æ–¹å¼,\n    saveAs: æ˜¯å¦å¼¹å‡ºå¦å­˜ä¸ºçª—å£,\n    method: è¯·æ±‚æ–¹å¼ï¼ˆPOSTæˆ–GETï¼‰ï¼Œ\n    headers: è‡ªå®šä¹‰headeræ•°ç»„,\n    body: POSTçš„æ•°æ®\n}\n```\n## ç½‘ç»œè¯·æ±‚\n![ç½‘ç»œè¯·æ±‚çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæ‰€è§¦å‘äº‹ä»¶çš„æ—¶é—´é¡ºåº][2]\nè¦å¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œæ“ä½œï¼Œéœ€è¦åœ¨Manifestä¸­å£°æ˜webRequestæƒé™ä»¥åŠç›¸å…³è¢«æ“ä½œçš„URLã€‚å¦‚éœ€è¦é˜»æ­¢ç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦å£°æ˜webRequestBlockingæƒé™ã€‚\n```javascript\n\"permissions\": [\n    \"webRequest\",\n    \"webRequestBlocking\",\n    \"*://*.google.com/\"\n]\n```\n```javascript\nchrome.webRequest.onBeforeRequest.addListener(\n    function(details){\n        return {cancel: true};\n    },\n    {\n        urls: [\n            \"*://bad.example.com/*\"\n        ]\n    },\n    [\n        \"blocking\"\n    ]\n);\n```\n> headerä¸­çš„å¦‚ä¸‹å±æ€§æ˜¯ä¸æ”¯æŒæ›´æ”¹çš„ï¼šAuthorizationã€Cache-Controlã€Connectionã€Content-Lengthã€Hostã€If-Modified-Sinceã€If-None-Matchã€If-Rangeã€Partial-Dataã€Pragmaã€Proxy-Authorizationã€Proxy-Connectionå’ŒTransfer-Encodingã€‚\n\næ‰€æœ‰äº‹ä»¶ä¸­ï¼Œå›è°ƒå‡½æ•°æ‰€æ¥æ”¶åˆ°çš„ä¿¡æ¯å¯¹è±¡å‡åŒ…æ‹¬å¦‚ä¸‹å±æ€§ï¼šrequestIdã€urlã€methodã€frameIdã€parentFrameIdã€tabIdã€typeå’ŒtimeStampã€‚å…¶ä¸­typeå¯èƒ½çš„å€¼åŒ…æ‹¬\"main_frame\"ã€\"sub_frame\"ã€\"stylesheet\"ã€\"script\"ã€\"image\"ã€\"object\"ã€\"xmlhttprequest\"å’Œ\"other\"ã€‚\n\n## ä»£ç†\nChromeæµè§ˆå™¨æä¾›äº†ä»£ç†è®¾ç½®ç®¡ç†æ¥å£ï¼Œè¿™æ ·å¯ä»¥è®©æ‰©å±•æ¥åšåˆ°æ›´åŠ æ™ºèƒ½çš„ä»£ç†è®¾ç½®ã€‚è¦è®©æ‰©å±•ä½¿ç”¨ä»£ç†æ¥å£ï¼Œéœ€è¦å£°æ˜proxyæƒé™ï¼š\n```javascript\n\"permissions\": [\n    \"proxy\"\n]\n```\né€šè¿‡chrome.proxy.settings.setæ–¹æ³•å¯ä»¥è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä»£ç†è®¾ç½®å¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯å›è°ƒå‡½æ•°ã€‚\n\nä»£ç†è®¾ç½®å¯¹è±¡åŒ…æ‹¬modeå±æ€§ã€ruleså±æ€§å’ŒpacScriptå±æ€§ã€‚å…¶ä¸­modeå±æ€§ä¸ºä»£ç†æ¨¡å¼ï¼Œå¯é€‰çš„å€¼æœ‰'direct'ï¼ˆç›´æ¥è¿æ¥ï¼Œå³ä¸é€šè¿‡ä»£ç†ï¼‰ã€'auto_detect'ï¼ˆé€šè¿‡WPADåè®®è‡ªåŠ¨è·å–pacè„šæœ¬ï¼‰ã€'pac_script'ï¼ˆä½¿ç”¨æŒ‡å®šçš„pacè„šæœ¬ï¼‰ã€'fixed_servers'ï¼ˆå›ºå®šçš„ä»£ç†æœåŠ¡å™¨ï¼‰å’Œ'system'ï¼ˆä½¿ç”¨ç³»ç»Ÿçš„è®¾ç½®ï¼‰ã€‚ruleså±æ€§å’ŒpacScriptå±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼ŒrulesæŒ‡å®šäº†ä¸åŒçš„åè®®é€šè¿‡ä¸åŒçš„ä»£ç†ã€‚\n\n## API \n\n`chrome.alarms.*`\n\né€šè¿‡æ­¤åˆ¶å®šå‘¨æœŸæ€§ä»»åŠ¡ï¼Œéœ€åœ¨manifest.jsonæ–‡ä»¶ä¸­å£°æ˜æƒé™\n\n``` json\n\"permissions\": [\n\n\t\"alarms\"\n\n],\n```\n\n`chrome.alarms.create(string name, object alarmInfo)`\n\n| å±æ€§              | ç±»å‹     | æ³¨é‡Š             |\n| --------------- | ------ | -------------- |\n| when            | double | è§¦å‘alarmæ—¶é—´ï¼Œms   |\n| delayInMinutes  | double | å»¶è¿Ÿæ—¶é—´ï¼Œminute    |\n| periodInMinutes | double | å‘¨æœŸæ€§æ—¶é—´é—´éš”ï¼Œminute |\n\n- è·å–æŒ‡å®šåå­—çš„alarm\n  `chrome.alarms.get(string name, function(Alarm alarm) {...})`\n\n- è·å–æ‰€æœ‰alarm\n\n  `chrome.alarms.getAll(function(array of Alarm alarms) {...})`\n\n- é€šè¿‡åå­—åˆ é™¤alarm\n\n  `chrome.alarms.clear(string name, function(boolean wasCleared) {...})`\n\n- æ¸…é™¤æ‰€æœ‰alarm\n\n  `chrome.alarms.clearAll(function(boolean wasCleared) {...})`\n\n- ç›‘å¬alarmå‘ç”Ÿçš„äº‹ä»¶ï¼Œç”¨äºevent page\n\n  `chrome.alarms.onAlarm.addListener(function(Alarm alarm) {...})`\n\n[1]: http://css-tricks.com/custom-scrollbars-in-webkit/\n[2]: http://storage1.imgchr.com/CflJs.jpg",
      "data": {
        "title": "Chrome æ’ä»¶å¼€å‘",
        "date": "2024-12-08 11:16:11",
        "tags": [
          "chrome æ’ä»¶",
          "JavaScript"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/chrome-cha-jian-kai-fa.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## Manifest\nChromeæ‰©å±•çš„Manifestå¿…é¡»åŒ…å«`name`ã€`version`å’Œ`manifest_version`å±æ€§ï¼Œå¯¹äºåº”ç”¨æ¥è¯´ï¼Œè¿˜å¿…é¡»åŒ…å«`app`å±æ€§ã€‚",
      "fileName": "chrome-cha-jian-kai-fa"
    },
    {
      "content": "# ã€‡ã€ä»å…¥é—¨åˆ°å…¥ç‹±\n\n [ä¸­å›½çˆ¬è™«è¿æ³•è¿è§„æ¡ˆä¾‹æ±‡æ€»](https://github.com/HiddenStrawberry/Crawler_Illegal_Cases_In_China)\n\n![](https://xuhang.github.io/post-images/1733627425302.png)\n\n# ä¸€ã€ä»€ä¹ˆæ˜¯çˆ¬è™«\n![ä»€ä¹ˆæ˜¯çˆ¬è™«](https://xuhang.github.io/post-images/1733627403396.png)\n\n# äºŒã€çˆ¬è™«çš„åˆ†ç±»\n\n<!-- more -->\n\næœç´¢å¼•æ“ï¼šç™¾åº¦ã€è°·æ­Œ\n\næ•°æ®é‡‡é›†ï¼šå¤©çœ¼æŸ¥ã€ä¼æŸ¥æŸ¥\n\nè–…ç¾Šæ¯›ï¼šæŠ¢ç¥¨æœºå™¨äººã€ç§’æ€è½¯ä»¶ï¼Œæ¯”ä»·è½¯ä»¶ï¼Œå¾®åšåƒµå°¸ç²‰\n\nâ€¦â€¦\n\n# ä¸‰ã€çˆ¬è™«ä¸åçˆ¬è™«\n\n1. å›å­åè®®ï¼šrobots.txt\n\n   [www.baidu.com/robots.txt](http://www.baidu.com/robots.txt)\n\n![robotsåè®®](https://xuhang.github.io/post-images/1733627377901.png)\n   ![image-20220303093748092]\n\n1. æœ€ç®€å•çš„çˆ¬è™«\n\nPythonç‰ˆ\n\n```python\nimport requests\nrsp = requests.get('http://www.httpbin.org/user-agent')\n```\n\nJavaç‰ˆ\n\n```java\n@Test\npublic void testHttpclient() throws IOException {\n    CloseableHttpClient client = HttpClientBuilder.create().build();\n    HttpGet get = new HttpGet(\"http://www.httpbin.org/user-agent\");\n    CloseableHttpResponse response = client.execute(get);\n    HttpEntity entity = response.getEntity();\n    String string = EntityUtils.toString(entity);\n    System.out.println(string);\n}\n    \n@Test\npublic void testHtmlUnit() throws IOException {\n    WebClient edge = new WebClient(BrowserVersion.FIREFOX);\n    edge.getOptions().setCssEnabled(false);\n    edge.getOptions().setJavaScriptEnabled(true);\n    edge.getOptions().setThrowExceptionOnFailingStatusCode(false);\n    edge.getOptions().setThrowExceptionOnScriptError(false);\n    edge.waitForBackgroundJavaScript(600*1000);\n    UnexpectedPage page = edge.getPage(\"http://www.httpbin.org/user-agent\");\n    System.out.println(page.getWebResponse().getContentAsString());\n}\n```\n\nåŠ å…¥ä¾èµ–\n\n```xml\n<dependency>\n    <groupId>org.apache.httpcomponents</groupId>\n    <artifactId>httpclient</artifactId>\n    <version>4.5.3</version>\n</dependency>\n<dependency>\n    <groupId>net.sourceforge.htmlunit</groupId>\n    <artifactId>htmlunit</artifactId>\n    <version>2.45.0</version>\n</dependency>\n```\n\nä½†æ˜¯è¿™æ ·çš„çˆ¬è™«å¾ˆå®¹æ˜“é€šè¿‡æ£€æµ‹UAå¤´è¢«å‘ç°ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥å¯¹è¿™æ ·çš„çˆ¬è™«åšå‡ºåçˆ¬çš„æªæ–½ã€‚\n\n2. ä¿®æ”¹çˆ¬è™«çš„UA\n\nPythonç‰ˆ\n\n```python\nheader = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36'\n}\nrsp = requests.get('http://www.httpbin.org/user-agent', headers = header)\n```\n\nJavaç‰ˆ\n\n```java\n@Test\npublic void testHttpclient() throws IOException {\n    CloseableHttpClient client = HttpClientBuilder.create().build();\n    HttpGet get = new HttpGet(\"http://www.httpbin.org/user-agent\");\n    get.setHeader(\"User-Agent\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36\");\n    CloseableHttpResponse response = client.execute(get);\n    HttpEntity entity = response.getEntity();\n    String string = EntityUtils.toString(entity);\n    System.out.println(string);\n}\n```\n\n3. æ§åˆ¶çˆ¬è™«çš„é¢‘ç‡\n\nä¿®æ”¹UAåªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šé’ˆå¯¹æ¯ä¸ªipåœ°å€çš„è¯·æ±‚é¢‘ç‡æ¥è¯†åˆ«çˆ¬è™«ï¼Œæ¯”å¦‚ä¸€åˆ†é’Ÿå†…è¯·æ±‚å‡ ç™¾å‡ åƒæ¬¡ï¼Œä¸€å¤©24å°æ—¶ä¸é—´æ–­çš„è¯·æ±‚ï¼Œè¿™äº›ç‰¹å¾éƒ½å¯ä»¥è¢«è¯†åˆ«ä¸ºçˆ¬è™«ç¨‹åºã€‚æ‰€ä»¥åœ¨å¤§è§„æ¨¡æŠ“å–æ•°æ®æ—¶ï¼Œéœ€è¦å¯¹é™ä½æŠ“å–é¢‘ç‡ï¼Œæ¯”å¦‚æ¯æ¬¡è¯·æ±‚åsleep 3~5 ç§’ï¼›ä½†æ˜¯è¿™æ ·ä¼šå¤§å¤§é™ä½æŠ“å–çš„æ•ˆç‡ï¼Œæ‰€ä»¥è¿™é‡Œå°±éœ€è¦ç”¨åˆ°ä»£ç†IPæ± â€”â€”å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡éƒ¨ç½²é›†ç¾¤çš„æ–¹å¼æ¥æé«˜çˆ¬çš„é€Ÿåº¦\n\nä»£ç†æœåŠ¡å™¨ä¼šè½¬å‘çˆ¬è™«è¯·æ±‚ï¼Œè¿™æ ·æœåŠ¡å™¨é’ˆå¯¹IPçš„é™åˆ¶å°±ä¼šè¢«ç»•è¿‡ã€‚\n\n```python\nproxy = {\n    'http': '',\n    'https': ''\n}\nheader = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36'\n}\nrsp = requests.get('http://www.httpbin.org/user-agent', headers = header, proxies = proxy)\n```\n\n>ä»£ç†IPåˆ†é€æ˜ä»£ç†ï¼ŒåŒ¿åä»£ç†å’Œé«˜åŒ¿ä»£ç†ï¼Œé€æ˜ä»£ç†å…¶å®å¹¶ä¸ä¼šéšè—çˆ¬è™«çš„çœŸå®IPï¼ŒåŒ¿åä»£ç†ä¼šåœ¨è¯·æ±‚å¤´é‡Œå¸¦ä¸Šçˆ¬è™«çš„IPï¼Œæœ‰ä¸€å®šå‡ ç‡ä¼šè¢«è¯†åˆ«ï¼Œé«˜åŒ¿ä»£ç†åˆ™ä¼šå®Œå…¨éšè—çˆ¬è™«çš„IPï¼Œæ›´æ¨èä½¿ç”¨ã€‚\n\næ®è¯´ç°åœ¨äº’è”ç½‘ä¸Š50%ä»¥ä¸Šçš„æµé‡éƒ½æ˜¯ç”±çˆ¬è™«äº§ç”Ÿçš„ï¼Œé’ˆå¯¹ä¸€äº›çƒ­é—¨èµ„æºè¿™ä¸€æ¯”ä¾‹å¯ä»¥é«˜è¾¾98%ä»¥ä¸Šã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒæœåŠ¡å™¨ä¼šéœ€è¦ç”¨æˆ·ç™»å½•æ‰èƒ½è®¿é—®ï¼Œè€Œç®€å•çš„ç™»å½•éªŒè¯å°±æ˜¯å°†æµè§ˆå™¨ä¸Šçš„cookieå’ŒæœåŠ¡å™¨sessionç»‘å®šèµ·æ¥ã€‚\n\n4. éªŒè¯ç ï¼ˆ**C**ompletely **A**utomated **P**ublic **T**uring test to tell **C**omputers and **H**umans **A**partï¼Œç®€ç§°**CAPTCHA**ï¼‰\n![å›¾ç‰‡éªŒè¯ç å¼€å§‹æ˜¾â€œå¨åŠ›â€](https://xuhang.github.io/post-images/1733627453270.jpeg)\n\n![å›¾ç‰‡éªŒè¯ç å¼€å§‹æ˜¾â€œå¨åŠ›â€](https://xuhang.github.io/post-images/1733627479206.jpeg)\n\nå¯¹äºç®€å•çš„å­—æ¯å’Œæ•°å­—ç»„æˆçš„éªŒè¯ç ï¼Œå¯ä»¥é€šè¿‡è‡ªå·±è®­ç»ƒæ¨¡å‹æ¥è¯†åˆ«ï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ‰“ç å¹³å°æ¥éªŒè¯ã€‚\n![captcha](https://xuhang.github.io/post-images/1733627496743.jpeg)\n\n\n```python\ndef bypassWithDama():\n    rec_url = \"http://pred.fateadm.com\"\n    tm = str(int(time.time()))\n    sign = CalcSign(pd_id, pd_key, tm)\n    asign = CalcSign(app_id, app_key, tm)\n    param = {\n        \"user_id\": pd_id,\n        \"timestamp\": tm,\n        \"appid\": app_id,\n        \"sign\":sign,\n        \"asign\": asign,\n        \"predict_type\": \"30600\",\n        \"up_type\": \"mt\"\n    }\n    url = rec_url + \"/api/capreg\"\n    img_data = open('/Users/xuhang/Desktop/captcha.jpeg', 'rb')\n    files = {\n        \"img_data\": ('img_data', img_data)\n    }\n    header = {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.122 Safari/537.36'\n    }\n    rsp_data = requests.post(url, param, files=files, headers=header)\n    print('ã€æ–æ–æ‰“ç ã€‘' + rsp_data.text)\n    return rsp_data.json()\n\n// ã€æ–æ–æ‰“ç ã€‘{\"RetCode\":\"0\",\"ErrMsg\":\"\",\"RequestId\":\"20220303110050322d81ed0007a58386\",\"RspData\":\"{\\\"result\\\": \\\"yfx5\\\"}\"}\n```\n\nå¯¹äºåƒGoogleçš„CAPTCHAæˆ–è€… Intuitionçš„hCaptchaæˆ–è€…arkoselabsçš„FunCaptchaï¼Œè¿™ç±»å¤æ‚çš„éªŒè¯ç ï¼Œéœ€è¦è¯†åˆ«å›¾ç‰‡ä¸­çš„ç‰©å“å¹¶ç‚¹å‡»ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡ï¼Œæˆ–è€…å°†å›¾ç‰‡æ—‹è½¬åˆ°æ­£ç¡®çš„è§’åº¦ï¼Œå¯ä»¥ä½¿ç”¨æ‰“ç å¹³å°çš„äººå·¥æ‰“ç ï¼Œç”±äººå·¥å®Œæˆåå°†ç»“æœè¿”å›ã€‚\n\n1. å¸¦ä¸Šç™»å½•åçš„cookie\n\nå¯¹äºä¸€èˆ¬å®‰å…¨æ€§ä¸å¼ºçš„ç½‘ç«™ï¼Œå¹¶æ²¡æœ‰é’ˆå¯¹ç™»å½•éªŒè¯åšå¤ªå¤šçš„è®¾è®¡ï¼Œæ‰€ä»¥çˆ¬è™«å¾ˆå®¹æ˜“å°±èƒ½å®ç°å¸¦cookieè®¿é—®ã€‚\n\n```python\nheader = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36'\n}\nurl = 'https://store.steampowered.com/account/'\nrsp = requests.get(url, headers=header, verify=False)\n```\n\nå°†å“åº”çš„æ–‡æœ¬å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ä¿å­˜ä¸ºhtmlæ ¼å¼ï¼Œç„¶åç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œè™½ç„¶æ˜¯ä¹±ç ï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°Loginçš„æŒ‰é’®ï¼Œè¯´æ˜æ˜¯æœªç™»å½•çš„çŠ¶æ€ã€‚ç™»å½•steamä¹‹åå°†è¯·æ±‚ä¸­çš„cookieå¤åˆ¶å‡ºæ¥ï¼Œä¿®æ”¹headeråå†æ¬¡è¯·æ±‚\n\n```python\nheader = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.66 Safari/537.36',\n    'Cookie': '...'\n}\n```\n\nå¯ä»¥ä»é¡µé¢ä¸­æ‰¾åˆ°è¯¥è´¦å·ç»‘å®šçš„é‚®ç®±å’Œä½™é¢ç­‰ä¿¡æ¯ï¼Œè¯´æ˜ç™»å½•æˆåŠŸã€‚è™½ç„¶å¯ä»¥çˆ¬åˆ°æœ‰é™åˆ¶çš„ä¿¡æ¯ï¼Œä½†æ˜¯çˆ¬è™«å’Œè´¦å·ç»‘å®šäº†ï¼Œè¿™é‡Œä»£ç†å°±ä¸èµ·ä½œç”¨äº†ï¼Œé¢‘ç¹çˆ¬å–çš„è¯å¯èƒ½ä¼šå¯¼è‡´è¢«å°å·ï¼Œè¿™é‡Œå°±éœ€è¦å‡†å¤‡å¤šä¸ªè´¦å·äº†ï¼Œå¥½åœ¨çˆ¬è™«å¯ä»¥ä»£æ›¿äººå·¥ç”³è¯·è´¦å·ï¼Œåªæ˜¯æˆæœ¬ä¼šé«˜ä¸€äº›ã€‚\n\nè™½ç„¶ä¸Šé¢çš„æ“ä½œæˆ–å¤šæˆ–å°‘å¯ä»¥éª—è¿‡æœåŠ¡å™¨çš„æ£€æµ‹ï¼Œä½†æ˜¯ç›¸æ¯”ä¸çœŸå®çš„æµè§ˆå™¨ï¼Œçˆ¬è™«ç¨‹åºè¿˜æ˜¯ä¼šåœ¨å¾ˆå¤šæ–¹é¢å­˜åœ¨å·®å¼‚ã€‚æ¯”å¦‚çœŸæ˜¯æµè§ˆå™¨é€šå¸¸ä¼šæœ‰documentï¼ŒsetIntervalç­‰å¯¹è±¡ï¼Œçˆ¬è™«ç¨‹åºç¼ºå°‘è¿™äº›å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´æŸäº›å…³é”®æ€§æ­¥éª¤æ— æ³•æ‰§è¡Œï¼Œä»è€Œè¢«æœåŠ¡å™¨è¯†åˆ«å‡ºæ¥ã€‚å¦å¤–æœ‰äº›ç½‘ç«™éœ€è¦postæäº¤è¯·æ±‚æ•°æ®ï¼Œä½†æ˜¯æŸäº›å¿…éœ€çš„å‚æ•°åˆæ˜¯ç»è¿‡å„ç§å¤æ‚åŠ å¯†æ··æ·†ä¹‹åçš„ç»“æœï¼Œæœ‰æ—¶å€™å¯èƒ½è¿½è¸ªä¸€ä¸ªå‚æ•°å¿™ç¢Œäº†å¥½å‡ å¤©ï¼ŒæˆåŠŸçš„çˆ¬å–äº†ä¸€å¤©ï¼Œç¬¬äºŒå¤©ç½‘ç«™æ”¹å‚æ•°äº†ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çœŸå®çš„æµè§ˆå™¨çš„çˆ¬å–ã€‚\n\n> å¦‚æœæ˜¯ä¸ªäººç½‘ç«™çš„ç«™é•¿ï¼Œé€šå¸¸æ²¡æœ‰è¿‡å¤šçš„ç²¾åŠ›æ¥å¯¹æŠ—çˆ¬è™«ï¼Œç®€å•ç‚¹çš„æ–¹æ³•å°±æ˜¯ä¸Šé¢çš„éšæœºç”ŸæˆéªŒè¯ç ï¼Œç„¶ååŠ ç‚¹å¹²æ‰°çº¿ã€‚æˆ–è€…æ¥å…¥ç¬¬ä¸‰æ–¹çš„éªŒè¯ç å¹³å°ï¼Œæ¯”å¦‚æéªŒã€‚ä½†æ˜¯éªŒè¯ç é€šå¸¸åªç”¨åœ¨æœ‰æ•æ„Ÿæ“ä½œçš„åœ°æ–¹ï¼Œä¸å¯èƒ½æ¯ä¸ªè¯·æ±‚éƒ½è¦éªŒè¯ç ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ç½‘é¡µé˜²ç«å¢™ä¹‹ç±»çš„æœåŠ¡ï¼Œé€šè¿‡æ£€æŸ¥å®¢æˆ·ç«¯çš„å¼•æ“å’Œä¸€äº›ç‰¹å¾æ¥è¯†åˆ«æ˜¯ä¸æ˜¯çˆ¬è™«ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¦æˆªå¤§éƒ¨åˆ†çš„çˆ¬è™«äº†ã€‚\n> ![](https://xuhang.github.io/post-images/1733627531440.png)\n>\n> è¯¥é˜²ç«å¢™æœ€å¼€å§‹æ˜¯é€šè¿‡æµè§ˆå™¨çš„å¼•æ“è¿›è¡Œä¸€äº›è®¡ç®—ä»»åŠ¡ï¼Œåªæœ‰è®¡ç®—æ­£ç¡®æ‰èƒ½æˆåŠŸè·³è½¬ï¼Œä½†æ˜¯å·²ç»æœ‰äººæˆåŠŸç”¨pythonæ¨¡æ‹Ÿäº†è®¡ç®—è¿‡ç¨‹ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯hCaptchaçš„éªŒè¯ç ã€‚\n> ![](https://xuhang.github.io/post-images/1733627544953.png)\n>\n> \n\n1. headlessæµè§ˆå™¨\n\n   ![](https://xuhang.github.io/post-images/1733627713500.png)\n\n[PhantomJS](https://phantomjs.org/)æ˜¯ä¸€ä¸ªå¯ä»¥æ‰§è¡Œjavascriptè„šæœ¬çš„æ— å¤´ç½‘é¡µæµè§ˆå™¨ï¼Œç”±äºChromeæµè§ˆå™¨åœ¨17å¹´å¼€å§‹æ”¯æŒæ— å¤´æ¨¡å¼ï¼ŒPhantomJSçš„ä½œè€…å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¨èå¤§å®¶å»ä½¿ç”¨Chromeã€‚\n\nä¸‹é¢æ˜¯PhantomJSçš„ä¸€ä¸ªdemo\n\n```javascript\nvar page = require('webpage').create();\npage.open('http://www.google.com', function() {\n    setTimeout(function() {\n        page.render('google.png');\n        phantom.exit();\n    }, 200);\n});\n```\n\nè¿™é‡Œæ¨èä½¿ç”¨Seleniumï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥é©±åŠ¨Chromeã€Firefoxã€IEã€Safariã€Operaå’ŒPhantomJSï¼Œå¹¶ä¸”æä¾›å¤šç§è¯­è¨€çš„ç‰ˆæœ¬ï¼Œåªéœ€è¦å®‰è£…ç›¸åº”çš„æµè§ˆå™¨å¹¶æŒ‡å®šæµè§ˆå™¨çš„é©±åŠ¨è·¯å¾„å³å¯ã€‚\n\n```python\n# -*- coding: utf-8 -*-\nfrom selenium import webdriver\nimport time\nfrom selenium.webdriver.common.keys import Keys\nfrom selenium.webdriver import ActionChains\n\n\"\"\"\nå¦‚æœæ§åˆ¶å°å‡ºç°ä¹±ç ï¼Œå°è¯•ä¿®æ”¹ç¼–ç æ ¼å¼ï¼šchcp <ç¼–ç >\n65001\tUTF-8\n950\t\tç¹ä½“ä¸­æ–‡\n936\t\tGBK\n437\t\tMS-DOS\n\n\"\"\"\n\noptions = webdriver.ChromeOptions()\n# ä»¥Headlessæ¨¡å¼å¯åŠ¨\n# options.add_argument('headless')\n# çª—å£å¤§å°ï¼ˆé€šè¿‡æˆªå›¾å¯ä»¥åæ˜ çª—å£å¤§å°ï¼‰\noptions.add_argument('window-size=1200x600')\n# è®¾ç½®User-Agent\noptions.add_argument('user-agent=Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36')\n\n# åˆ›å»ºå®ä¾‹\nbrowser = webdriver.Chrome(chrome_options = options, executable_path='/Users/xuhang/Downloads/chromedriver')\n\n# çª—å£æœ€å¤§åŒ–\nbrowser.maximize_window()\n\n# Part â… \n\n# è¯·æ±‚ç½‘å€\nbrowser.get(url = \"https://www.smzdm.com\")\ntime.sleep(2)\n\n# æˆªå›¾\nbrowser.save_screenshot('smzdm_1.png')\n\n# ä¸‹æ‹‰æ»‘åŠ¨é¡µé¢ - é€šè¿‡JSè„šæœ¬\nbrowser.execute_script(\"window.scrollTo(10000, document.body.scrollHeight)\")\n\n# ä¸‹æ‹‰æ»‘åŠ¨é¡µé¢ - é€šè¿‡æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨\n# from selenium.webdriver.support.wait import WebDriverWait\n# WebDriverWait(browser, 20, 0.5).until(lambda x: x.find_element_by_id('feed-main-list'))\n# actionChain = browser.find_element_by_css_selector(\"#feed-main-list li:last-child\")\n# ActionChains(browser).move_to_element(actionChain).perform()\nbrowser.save_screenshot('smzdm_2.png')\n\n# æ–°å¼€çª—å£æ‰“å¼€ç™¾åº¦é¦–é¡µ\nbrowser.execute_script(\"window.open('https://www.baidu.com')\")\nhandlers = browser.window_handles\n# print(handlers)\n\n# åˆ‡æ¢åˆ°ç¬¬2ä¸ªçª—å£\nbrowser.switch_to_window(handlers[1])\n\n# åœ¨ç¬¬2ä¸ªçª—å£æ“ä½œ\nbrowser.find_element_by_id('kw').send_keys('selenium')\nbrowser.find_element_by_id('su').click()\n\n# è·å–cookies\ncookies = browser.get_cookies()\ncookie = browser.get_cookie('BAIDUID')\ntime.sleep(2)\nbrowser.save_screenshot('baidu_1.png')\nbrowser.switch_to_window(handlers[0])\ntime.sleep(2)\nprint(cookie)\n\nbrowser.quit()\n```\n\nåˆ°è¿™é‡Œï¼Œé…åˆä¸Šä»£ç†IPå’Œè´¦å·ç™»é™†å·²ç»å¯ä»¥ç»•å¼€å¤§éƒ¨åˆ†çš„ç½‘ç«™éªŒè¯äº†ï¼Œä½†æ˜¯å³ä½¿ç”¨ä¸Šäº†çœŸå®çš„æµè§ˆå™¨ï¼ŒSeleniumæ“æ§çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šæš´éœ²å‡ºä¸€éƒ¨åˆ†ç‰¹å¾ã€‚æ¯”å¦‚`window.navigator.webdriver`å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯æ­£å¸¸æµè§ˆå™¨æ²¡æœ‰çš„ï¼Œä½†æ˜¯Chrome Headlessé‡Œæœ‰ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡å‚æ•°å…³é—­è¯¥å±æ€§ï¼Œä½†æ˜¯ä»æœ‰å…¶ä»–å±æ€§ä¼šæš´éœ²å‡ºæ¥ã€‚\n\né™¤äº†ä»¥ä¸Šç”¨åˆ°çš„Seleniumï¼Œè¿˜æœ‰Pupperteerå’ŒPythonç‰ˆæœ¬çš„Pypperteerï¼Œå™¨ä¸­Pupperteeræ˜¯Googleå®˜æ–¹æ¨å‡ºçš„åŸºäºChrome DevTool protocol åè®®çš„NodejsåŒ…ï¼Œé€šå¸¸åœ¨Seleniumå¤±è´¥ä¹‹åå°è¯•ä½¿ç”¨Pupperteerï¼Œè¿˜æ˜¯ä¸è¡Œå¯ä»¥è€ƒè™‘å¼€å‘Chromeçš„æ’ä»¶æ¥çˆ¬ï¼Œå› ä¸ºChromeæ’ä»¶æ˜¯è¿è¡Œåœ¨çœŸæ­£çš„æµè§ˆå™¨ä¸Šé¢ï¼Œå’Œå¹³æ—¶ä½¿ç”¨çš„ä¸€æ ·ï¼Œå®ƒè¿˜èƒ½ä½¿ç”¨æµè§ˆå™¨ä»¥å¾€çš„ç¼“å­˜ï¼Œä¸å®¹æ˜“è¢«è¯†åˆ«å‡ºæ¥ã€‚\n\n![seleniumå’Œpuppeteer](%E5%9B%BE%E7%89%87%E7%B4%A0%E6%9D%90%E6%96%87%E4%BB%B6%E5%A4%B9/selenium%E5%92%8Cpuppeteer.png)\n\n# å››ã€æ‰©å±•\n\n åçˆ¬è™«é™¤äº†åœ¨æœåŠ¡ç«¯å¯¹å¯ç–‘è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œè¿˜å¯ä»¥åœ¨å®¢æˆ·ç«¯å¢åŠ çˆ¬è™«çš„å¼€å‘éš¾åº¦ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ä»£ç æ··æ·†ã€å¹²æ‰°è°ƒè¯•ã€æ•°æ®æŠ•æ¯’ã€å›¾ç‰‡æ›¿æ¢æ•°æ®ã€å­—ä½“ä¹±åºã€‚\n\n1. ä»£ç æ··æ·†\n\n   ![base62åŠ å¯†](https://xuhang.github.io/post-images/1733627635187.png)\n\nbase62åŠ å¯†æœ€æ˜æ˜¾çš„ç‰¹å¾æ˜¯ä»¥`eval(function(p,a,c,k,e,r))`å¼€å¤´ï¼Œè¿™æ ·åŠ å¯†åçš„ä»£ç æ²¡æœ‰å¯è¯»æ€§ï¼Œå¯¹äºä¸ç†Ÿæ‚‰æ­¤åŠ å¯†çš„äººæœ‰ä¸€å®šéš¾åº¦ï¼Œä½†æ˜¯ç”±äºæ­¤æ–¹æ³•æœ€ç»ˆè¦æ‰§è¡Œevalæ–¹æ³•ï¼Œæ‰€ä»¥åªéœ€è¦é€šè¿‡console.logå°†å†…å®¹æ‰“å°å‡ºæ¥å°±æ˜¯åŠ å¯†å‰çš„ä»£ç ã€‚\n\n1. å¹²æ‰°è°ƒè¯•\n\n![image-20220308103521169](https://xuhang.github.io/post-images/1733627650683.png)\n\nç”±äºçˆ¬è™«å¿…é¡»é€šè¿‡æ‰¾å‡ºæ•°æ®æ¥å£æ‰èƒ½è¿›è¡Œæ•°æ®æŠ“å–ï¼Œå¯¹äºæµè§ˆå™¨æœ€åŸºç¡€çš„æ“ä½œå°±æ˜¯æ‰“å¼€DevToolsæ¥åˆ†æè¯·æ±‚å’Œæ•°æ®ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç°ç”¨æˆ·æ‰“å¼€DevToolså°±å¯ä»¥åšä¸€äº›å¹²æ‰°æ¥å¢åŠ éš¾åº¦ã€‚æ¯”å¦‚`debugger;`æœ¬æ¥æ˜¯å¼€å‘äººå‘˜ç”¨æ¥åœ¨è°ƒè¯•ä»£ç æ—¶ä½¿ç”¨çš„å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šå¼ºåˆ¶åœ¨æ­¤å¤„æ‰“æ–­ç‚¹ï¼Œæ‰€ä»¥å¯ä»¥å¯¹çˆ¬è™«çš„å¼€å‘äººå‘˜è¿›è¡Œä¸€å®šçš„å¹²æ‰°ã€‚ä½†æ˜¯æ­¤æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„åœç”¨æ–­ç‚¹ä½¿å…¶å¤±æ•ˆã€‚ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰æ£€æµ‹åˆ°DevToolsåç«‹å³åˆ é™¤æ‰€æœ‰å…³é”®çš„ä¿¡æ¯ï¼Œè¿™æ ·ä¹Ÿå°±ä¸ä¼šæš´éœ²æ•°æ®æ¥å£äº†ã€‚ï¼ˆå¾®ä¿¡è¯»ä¹¦ç”¨åˆ°äº†æ­¤æ–¹æ³•ï¼‰\n\n1. æ•°æ®æŠ•æ¯’\n\næ­¤æ–¹æ³•ä¼šæœ‰ä¸€å®šå‡ ç‡è¯¯ä¼¤åˆ°æ­£å¸¸ç”¨æˆ·ï¼Œæ‰€ä»¥ä½¿ç”¨å¾—å¾ˆå°‘ï¼Œè€Œä¸”ä½¿ç”¨ä¹Ÿå¿…é¡»å¾ˆè°¨æ…ã€‚å¦‚æœåå°åœ¨æ£€æµ‹åˆ°æ˜¯çˆ¬è™«ä¹‹åï¼Œå°†åŸæœ¬æ­£ç¡®çš„æ•°æ®æ›¿æ¢æ‰ï¼Œè®©çˆ¬è™«æ‹¿åˆ°çš„æ˜¯æ¯«æ— æ„ä¹‰çš„æ•°æ®ï¼Œè¿™æ ·çˆ¬è™«æ–¹å°±ä¼šå› ä¸ºè¿™äº›å¼‚å¸¸æ•°æ®åšå‡ºé”™è¯¯çš„ç­–ç•¥ã€‚\n\n4. å›¾ç‰‡æ›¿æ¢\n\nå› ä¸ºçˆ¬è™«ä¸»è¦æŠ“å–çš„æ˜¯æ–‡æœ¬ç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚ä»·æ ¼ã€é‚®ç®±ç­‰ï¼Œè€Œçˆ¬è™«å¤„ç†æ–‡æœ¬æ•°æ®çš„æˆæœ¬æ˜¯å¾ˆä½çš„ã€‚å¦‚æœå°†å…³é”®çš„æ•°æ®ç”¨å›¾ç‰‡è¿›è¡Œæ›¿æ¢ï¼Œå›¾ç‰‡ä¸Šå±•ç¤ºçš„æ˜¯æ­£å¸¸çš„æ•°æ®ï¼Œè¿™æ ·ä¸ä¼šå¯¹æ­£å¸¸è®¿é—®çš„ç”¨æˆ·é€ æˆå½±å“ï¼Œåªä¼šå¢åŠ çˆ¬è™«è·å–æ•°æ®çš„éš¾åº¦ã€‚\n\n5. å­—ä½“ä¹±åº\n\nè¿™ç§æ–¹æ³•å’Œæ•°æ®æŠ•æ¯’çš„æ•ˆæœç±»ä¼¼ï¼Œä½†æ˜¯ä¸ä¼šè¯¯ä¼¤æ­£å¸¸è®¿é—®çš„ç”¨æˆ·ã€‚å…·ä½“æ“ä½œæ˜¯åœ¨é¡µé¢ä¸ŠåŠ è½½ä¹±åºè¿‡çš„å­—ä½“æ–‡ä»¶ï¼Œä½†æ˜¯ä¹±åºçš„è§„åˆ™åå°æ˜¯çŸ¥é“çš„ï¼Œåå°åœ¨è¿”å›æ•°æ®çš„æ—¶å€™åªè¦æ ¹æ®ä¹±åºçš„è§„åˆ™åšä¸€æ¬¡åå‘çš„æ›¿æ¢ï¼Œå°±èƒ½è®©htmlçš„æºæ•°æ®å’Œé¡µé¢ä¸Šå±•ç¤ºçš„ä¸ä¸€è‡´ï¼Œè€Œçˆ¬è™«æ˜¯æ ¹æ®htmlæºé‡Œçš„æ•°æ®æ¥è¿›è¡Œå¤„ç†çš„ã€‚\n\n[åœ¨çº¿å­—ä½“ç¼–è¾‘å™¨-JSONåœ¨çº¿ç¼–è¾‘å™¨ (qqe2.com)](https://font.qqe2.com/)\n\n![](https://xuhang.github.io/post-images/1733627666181.png)\n\nè¿™ä¸ªå­—ä½“æ–‡ä»¶é‡Œï¼Œæ•°å­—7å’Œ1äº¤æ¢äº†é¡ºåºï¼ˆä¸ºæ¼”ç¤ºæ–¹ä¾¿ï¼Œåªä¹±åºäº†2ä¸ªæ•°å­—ï¼Œé€šå¸¸æ˜¯è¶Šä¹±è¶Šå¥½ï¼‰ï¼Œåœ¨é¡µé¢ä¸Šå®šä¹‰è¿™ä¸ªå­—ä½“å¹¶æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨å®šä¹‰çš„å­—ä½“ã€‚\n\n![](https://xuhang.github.io/post-images/1733627679511.png)\n\næºæ–‡ä»¶é‡Œçš„æ•°å­—æ˜¯`1234567890`ï¼Œé¡µé¢ä¸Šå±•ç¤ºçš„æ˜¯`7234561890`ã€‚\n\n![](https://xuhang.github.io/post-images/1733627688770.png)\n\n![](https://xuhang.github.io/post-images/1733627698376.png)\n\nå¯¹äºä¸­æ–‡ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ä¸­æ–‡å­—ç¬¦è¿‡å¤šï¼Œä¹±åºä¹‹åæ˜ å°„å…³ç³»å¤æ‚ï¼Œä¼šè®©ç»´æŠ¤å˜å¾—å›°éš¾ã€‚\n\n---",
      "data": {
        "title": "çˆ¬è™«",
        "date": "2024-12-08 11:06:46",
        "tags": [
          "çˆ¬è™«",
          "chrome æ’ä»¶",
          "python"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/pa-chong.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "# ã€‡ã€ä»å…¥é—¨åˆ°å…¥ç‹±\n\n [ä¸­å›½çˆ¬è™«è¿æ³•è¿è§„æ¡ˆä¾‹æ±‡æ€»](https://github.com/HiddenStrawberry/Crawler_Illegal_Cases_In_China)\n\n![](https://xuhang.github.io/post-images/1733627425302.png)\n\n# ä¸€ã€ä»€ä¹ˆæ˜¯çˆ¬è™«\n![ä»€ä¹ˆæ˜¯çˆ¬è™«](https://xuhang.github.io/post-images/1733627403396.png)\n\n# äºŒã€çˆ¬è™«çš„åˆ†ç±»",
      "fileName": "pa-chong"
    },
    {
      "content": "## è½¯ä»¶å¼€å‘çš„7æ¡åŸåˆ™\n\n###### å¼€é—­åŸåˆ™\n\nå¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼ŒOCPï¼‰ç”±å‹ƒå…°ç‰¹Â·æ¢…è€¶ï¼ˆBertrand Meyerï¼‰æå‡ºï¼Œä»–åœ¨ 1988 å¹´çš„è‘—ä½œã€Šé¢å‘å¯¹è±¡è½¯ä»¶æ„é€ ã€‹ï¼ˆObject Oriented Software Constructionï¼‰ä¸­æå‡ºï¼šè½¯ä»¶å®ä½“åº”å½“==å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­==ï¼ˆSoftware entities should be open for extensionï¼Œbut closed for modificationï¼‰ï¼Œè¿™å°±æ˜¯å¼€é—­åŸåˆ™çš„ç»å…¸å®šä¹‰ã€‚\n\n<!-- more -->\n\n> å½“åº”ç”¨çš„éœ€æ±‚æ”¹å˜æ—¶ï¼Œåœ¨ä¸ä¿®æ”¹è½¯ä»¶å®ä½“çš„æºä»£ç æˆ–è€…äºŒè¿›åˆ¶ä»£ç çš„å‰æä¸‹ï¼Œå¯ä»¥æ‰©å±•æ¨¡å—çš„åŠŸèƒ½ï¼Œä½¿å…¶æ»¡è¶³æ–°çš„éœ€æ±‚ã€‚\n\nè½¯ä»¶å®ä½“åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š==é¡¹ç›®ä¸­åˆ’åˆ†å‡ºçš„æ¨¡å—==ã€==ç±»ä¸æ¥å£==ã€==æ–¹æ³•==ã€‚\n\né—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡çš„==ç»ˆæç›®æ ‡==ï¼Œå®ƒä½¿è½¯ä»¶å®ä½“æ‹¥æœ‰ä¸€å®šçš„==é€‚åº”æ€§==å’Œ==çµæ´»æ€§==çš„åŒæ—¶å…·å¤‡==ç¨³å®šæ€§==å’Œ==å»¶ç»­æ€§==ã€‚å…·ä½“æ¥è¯´ï¼Œå…¶ä½œç”¨å¦‚ä¸‹ï¼š\n\n1. å¯¹è½¯ä»¶==æµ‹è¯•==çš„å½±å“\n\n   è½¯ä»¶éµå®ˆå¼€é—­åŸåˆ™çš„è¯ï¼Œè½¯ä»¶æµ‹è¯•æ—¶åªéœ€è¦==å¯¹æ‰©å±•çš„ä»£ç è¿›è¡Œæµ‹è¯•==å°±å¯ä»¥äº†ï¼Œå› ä¸ºåŸæœ‰çš„æµ‹è¯•ä»£ç ä»ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚\n\n2. å¯ä»¥æé«˜ä»£ç çš„==å¯å¤ç”¨æ€§==\n\n   ç²’åº¦è¶Šå°ï¼Œè¢«å¤ç”¨çš„å¯èƒ½æ€§å°±è¶Šå¤§ï¼›åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œæ ¹æ®åŸå­å’ŒæŠ½è±¡ç¼–ç¨‹å¯ä»¥æé«˜ä»£ç çš„å¯å¤ç”¨æ€§ã€‚\n\n3. å¯ä»¥æé«˜è½¯ä»¶çš„==å¯ç»´æŠ¤æ€§==\n\n   éµå®ˆå¼€é—­åŸåˆ™çš„è½¯ä»¶ï¼Œå…¶ç¨³å®šæ€§é«˜å’Œå»¶ç»­æ€§å¼ºï¼Œä»è€Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚\n\n###### é‡Œæ°æ›¿æ¢åŸåˆ™\n\né‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰ç”±éº»çœç†å·¥å­¦é™¢è®¡ç®—æœºç§‘å­¦å®éªŒå®¤çš„é‡Œæ–¯ç§‘å¤«ï¼ˆLiskovï¼‰å¥³å£«åœ¨ 1987 å¹´çš„â€œé¢å‘å¯¹è±¡æŠ€æœ¯çš„é«˜å³°ä¼šè®®â€ï¼ˆOOPSLAï¼‰ä¸Šå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« ã€Šæ•°æ®æŠ½è±¡å’Œå±‚æ¬¡ã€‹ï¼ˆData Abstraction and Hierarchyï¼‰é‡Œæå‡ºæ¥çš„ï¼Œå¥¹æå‡ºï¼š==ç»§æ‰¿å¿…é¡»ç¡®ä¿è¶…ç±»æ‰€æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¸­ä»ç„¶æˆç«‹==ï¼ˆInheritance should ensure that any property proved about supertype objects also holds for subtype objectsï¼‰ã€‚\n\né‡Œæ°æ›¿æ¢åŸæ˜¯==ç»§æ‰¿==å¤ç”¨çš„åŸºç¡€ï¼Œå®ƒåæ˜ äº†åŸºç±»ä¸å­ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯å¯¹å¼€é—­åŸåˆ™çš„è¡¥å……ï¼Œæ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚\n\n> å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚\n\nå…·ä½“ä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•\n- å­ç±»ä¸­å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•\n- å½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼‰è¦æ¯”çˆ¶ç±»çš„æ–¹æ³•æ›´å®½æ¾\n- å½“å­ç±»çš„æ–¹æ³•å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼ˆé‡å†™/é‡è½½æˆ–å®ç°æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„çš„è¾“å‡º/è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»çš„æ–¹æ³•æ›´ä¸¥æ ¼æˆ–ç›¸ç­‰\n\né‡Œæ°æ›¿æ¢åŸåˆ™çš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š\n\n1. é‡Œæ°æ›¿æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€ã€‚\n2. å®ƒå…‹æœäº†ç»§æ‰¿ä¸­é‡å†™çˆ¶ç±»é€ æˆçš„å¯å¤ç”¨æ€§å˜å·®çš„ç¼ºç‚¹ã€‚\n3. å®ƒæ˜¯åŠ¨ä½œæ­£ç¡®æ€§çš„ä¿è¯ã€‚å³ç±»çš„æ‰©å±•ä¸ä¼šç»™å·²æœ‰çš„ç³»ç»Ÿå¼•å…¥æ–°çš„é”™è¯¯ï¼Œé™ä½äº†ä»£ç å‡ºé”™çš„å¯èƒ½æ€§ã€‚\n4. åŠ å¼ºç¨‹åºçš„å¥å£®æ€§ï¼ŒåŒæ—¶å˜æ›´æ—¶å¯ä»¥åšåˆ°éå¸¸å¥½çš„å…¼å®¹æ€§ï¼Œæé«˜ç¨‹åºçš„ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ï¼Œé™ä½éœ€æ±‚å˜æ›´æ—¶å¼•å…¥çš„é£é™©ã€‚\n\n###### ä¾èµ–å€’ç½®åŸåˆ™\n\nä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼ŒDIPï¼‰æ˜¯ Object Mentor å…¬å¸æ€»è£ç½—ä¼¯ç‰¹Â·é©¬ä¸ï¼ˆRobert C.Martinï¼‰äº 1996 å¹´åœ¨ [C++](http://c.biancheng.net/cplus/) Report ä¸Šå‘è¡¨çš„æ–‡ç« ã€‚ä¾èµ–å€’ç½®åŸåˆ™çš„åŸå§‹å®šä¹‰ä¸ºï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ï¼ˆHigh level modules shouldnot depend upon low level modules.Both should depend upon abstractions.Abstractions should not depend upon details. Details should depend upon abstractionsï¼‰ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šè¦==é¢å‘æ¥å£ç¼–ç¨‹==ï¼Œä¸è¦é¢å‘å®ç°ç¼–ç¨‹ã€‚\n\nä¾èµ–å€’ç½®åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦é€”å¾„ä¹‹ä¸€ï¼Œå®ƒé™ä½äº†å®¢æˆ·ä¸å®ç°æ¨¡å—ä¹‹é—´çš„è€¦åˆã€‚\n\nå¼€å‘ä¸­éœ€è¦éµå¾ªä»¥ä¸‹å‡ ç‚¹ï¼š\n\n1. æ¯ä¸ªç±»å°½é‡æä¾›æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚\n2. å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æ¥å£æˆ–è€…æ˜¯æŠ½è±¡ç±»ã€‚\n3. ä»»ä½•ç±»éƒ½ä¸åº”è¯¥ä»å…·ä½“ç±»æ´¾ç”Ÿã€‚\n4. ä½¿ç”¨ç»§æ‰¿æ—¶å°½é‡éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚\n\nä¾èµ–å€’ç½®åŸåˆ™çš„ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š\n\n+ ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥é™ä½ç±»é—´çš„è€¦åˆæ€§ã€‚\n\n- ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚\n- ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥å‡å°‘å¹¶è¡Œå¼€å‘å¼•èµ·çš„é£é™©ã€‚\n- ä¾èµ–å€’ç½®åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n\n###### å•ä¸€æŒ‡è´£åŸåˆ™\n\nå•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼ŒSRPï¼‰åˆç§°å•ä¸€åŠŸèƒ½åŸåˆ™ï¼Œç”±ç½—ä¼¯ç‰¹Â·C.é©¬ä¸ï¼ˆRobert C. Martinï¼‰äºã€Šæ•æ·è½¯ä»¶å¼€å‘ï¼šåŸåˆ™ã€æ¨¡å¼å’Œå®è·µã€‹ä¸€ä¹¦ä¸­æå‡ºçš„ã€‚è¿™é‡Œçš„èŒè´£æ˜¯æŒ‡ç±»å˜åŒ–çš„åŸå› ï¼Œå•ä¸€èŒè´£åŸåˆ™==è§„å®šä¸€ä¸ªç±»åº”è¯¥æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ==ï¼Œå¦åˆ™ç±»åº”è¯¥è¢«æ‹†åˆ†ï¼ˆThere should never be more than one reason for a class to changeï¼‰ã€‚\n\nå•ä¸€èŒè´£åŸåˆ™å°†æœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚\n\n- é™ä½ç±»çš„å¤æ‚åº¦ã€‚ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ï¼Œå…¶é€»è¾‘è‚¯å®šè¦æ¯”è´Ÿè´£å¤šé¡¹èŒè´£ç®€å•å¾—å¤šã€‚\n- æé«˜ç±»çš„å¯è¯»æ€§ã€‚å¤æ‚æ€§é™ä½ï¼Œè‡ªç„¶å…¶å¯è¯»æ€§ä¼šæé«˜ã€‚\n- æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚å¯è¯»æ€§æé«˜ï¼Œé‚£è‡ªç„¶æ›´å®¹æ˜“ç»´æŠ¤äº†ã€‚\n- å˜æ›´å¼•èµ·çš„é£é™©é™ä½ã€‚å˜æ›´æ˜¯å¿…ç„¶çš„ï¼Œå¦‚æœå•ä¸€èŒè´£åŸåˆ™éµå®ˆå¾—å¥½ï¼Œå½“ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œå¯ä»¥æ˜¾è‘—é™ä½å¯¹å…¶ä»–åŠŸèƒ½çš„å½±å“ã€‚\n\n###### æ¥å£éš”ç¦»åŸåˆ™\n\næ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼ŒISPï¼‰è¦æ±‚ç¨‹åºå‘˜å°½é‡å°†è‡ƒè‚¿åºå¤§çš„æ¥å£æ‹†åˆ†æˆæ›´å°çš„å’Œæ›´å…·ä½“çš„æ¥å£ï¼Œè®©æ¥å£ä¸­åªåŒ…å«å®¢æˆ·æ„Ÿå…´è¶£çš„æ–¹æ³•ã€‚\n\næ¥å£éš”ç¦»åŸåˆ™åº”åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- æ¥å£å°½é‡å°ï¼Œä½†æ˜¯è¦æœ‰é™åº¦ã€‚ä¸€ä¸ªæ¥å£åªæœåŠ¡äºä¸€ä¸ªå­æ¨¡å—æˆ–ä¸šåŠ¡é€»è¾‘ã€‚\n- ä¸ºä¾èµ–æ¥å£çš„ç±»å®šåˆ¶æœåŠ¡ã€‚åªæä¾›è°ƒç”¨è€…éœ€è¦çš„æ–¹æ³•ï¼Œå±è”½ä¸éœ€è¦çš„æ–¹æ³•ã€‚\n- äº†è§£ç¯å¢ƒï¼Œæ‹’ç»ç›²ä»ã€‚æ¯ä¸ªé¡¹ç›®æˆ–äº§å“éƒ½æœ‰é€‰å®šçš„ç¯å¢ƒå› ç´ ï¼Œç¯å¢ƒä¸åŒï¼Œæ¥å£æ‹†åˆ†çš„æ ‡å‡†å°±ä¸åŒæ·±å…¥äº†è§£ä¸šåŠ¡é€»è¾‘ã€‚\n- æé«˜å†…èšï¼Œå‡å°‘å¯¹å¤–äº¤äº’ã€‚ä½¿æ¥å£ç”¨æœ€å°‘çš„æ–¹æ³•å»å®Œæˆæœ€å¤šçš„äº‹æƒ…ã€‚\n\néµå¾ªæ¥å£éš”ç¦»åŸåˆ™æœ‰ä»¥ä¸‹ 5 ä¸ªä¼˜ç‚¹ã€‚\n\n1. å°†è‡ƒè‚¿åºå¤§çš„æ¥å£åˆ†è§£ä¸ºå¤šä¸ªç²’åº¦å°çš„æ¥å£ï¼Œå¯ä»¥é¢„é˜²å¤–æ¥å˜æ›´çš„æ‰©æ•£ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n2. æ¥å£éš”ç¦»æé«˜äº†ç³»ç»Ÿçš„å†…èšæ€§ï¼Œå‡å°‘äº†å¯¹å¤–äº¤äº’ï¼Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆæ€§ã€‚\n3. å¦‚æœæ¥å£çš„ç²’åº¦å¤§å°å®šä¹‰åˆç†ï¼Œèƒ½å¤Ÿä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼›ä½†æ˜¯ï¼Œå¦‚æœå®šä¹‰è¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ï¼›å¦‚æœå®šä¹‰å¤ªå¤§ï¼Œçµæ´»æ€§é™ä½ï¼Œæ— æ³•æä¾›å®šåˆ¶æœåŠ¡ï¼Œç»™æ•´ä½“é¡¹ç›®å¸¦æ¥æ— æ³•é¢„æ–™çš„é£é™©ã€‚\n4. ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£è¿˜èƒ½å¤Ÿä½“ç°å¯¹è±¡çš„å±‚æ¬¡ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ¥å£çš„ç»§æ‰¿ï¼Œå®ç°å¯¹æ€»æ¥å£çš„å®šä¹‰ã€‚\n5. èƒ½å‡å°‘é¡¹ç›®å·¥ç¨‹ä¸­çš„ä»£ç å†—ä½™ã€‚è¿‡å¤§çš„å¤§æ¥å£é‡Œé¢é€šå¸¸æ”¾ç½®è®¸å¤šä¸ç”¨çš„æ–¹æ³•ï¼Œå½“å®ç°è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œè¢«è¿«è®¾è®¡å†—ä½™çš„ä»£ç ã€‚\n\n###### è¿ªç±³ç‰¹æ³•åˆ™\n\nè¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼ŒLoDï¼‰åˆå«ä½œæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLeast Knowledge Principleï¼ŒLKP)ï¼Œäº§ç”Ÿäº 1987 å¹´ç¾å›½ä¸œåŒ—å¤§å­¦ï¼ˆNortheastern Universityï¼‰çš„ä¸€ä¸ªåä¸ºè¿ªç±³ç‰¹ï¼ˆDemeterï¼‰çš„ç ”ç©¶é¡¹ç›®ï¼Œç”±ä¼Šæ©Â·è·å…°ï¼ˆIan Hollandï¼‰æå‡ºï¼Œè¢« UML åˆ›å§‹è€…ä¹‹ä¸€çš„å¸ƒå¥‡ï¼ˆBoochï¼‰æ™®åŠï¼Œåæ¥åˆå› ä¸ºåœ¨ç»å…¸è‘—ä½œã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹ï¼ˆThe Pragmatic Programmerï¼‰æåŠè€Œå¹¿ä¸ºäººçŸ¥ã€‚è¿ªç±³ç‰¹æ³•åˆ™çš„å®šä¹‰æ˜¯ï¼šåªä¸ä½ çš„ç›´æ¥æœ‹å‹äº¤è°ˆï¼Œä¸è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯ï¼ˆTalk only to your immediate friends and not to strangersï¼‰ã€‚å…¶å«ä¹‰æ˜¯ï¼šå¦‚æœä¸¤ä¸ªè½¯ä»¶å®ä½“æ— é¡»ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆå°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹è½¬å‘è¯¥è°ƒç”¨ã€‚å…¶ç›®çš„æ˜¯==é™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§==ã€‚\n\nè¿ªç±³ç‰¹æ³•åˆ™æ—¶è¦æ³¨æ„ä»¥ä¸‹ 6 ç‚¹ã€‚\n\n1. åœ¨ç±»çš„åˆ’åˆ†ä¸Šï¼Œåº”è¯¥åˆ›å»ºå¼±è€¦åˆçš„ç±»ã€‚ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆè¶Šå¼±ï¼Œå°±è¶Šæœ‰åˆ©äºå®ç°å¯å¤ç”¨çš„ç›®æ ‡ã€‚\n2. åœ¨ç±»çš„ç»“æ„è®¾è®¡ä¸Šï¼Œå°½é‡é™ä½ç±»æˆå‘˜çš„è®¿é—®æƒé™ã€‚\n3. åœ¨ç±»çš„è®¾è®¡ä¸Šï¼Œä¼˜å…ˆè€ƒè™‘å°†ä¸€ä¸ªç±»è®¾ç½®æˆä¸å˜ç±»ã€‚\n4. åœ¨å¯¹å…¶ä»–ç±»çš„å¼•ç”¨ä¸Šï¼Œå°†å¼•ç”¨å…¶ä»–å¯¹è±¡çš„æ¬¡æ•°é™åˆ°æœ€ä½ã€‚\n5. ä¸æš´éœ²ç±»çš„å±æ€§æˆå‘˜ï¼Œè€Œåº”è¯¥æä¾›ç›¸åº”çš„è®¿é—®å™¨ï¼ˆset å’Œ get æ–¹æ³•ï¼‰ã€‚\n6. è°¨æ…ä½¿ç”¨åºåˆ—åŒ–ï¼ˆSerializableï¼‰åŠŸèƒ½ã€‚\n\nè¿ªç±³ç‰¹æ³•åˆ™æœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜ç‚¹ã€‚\n\n1. é™ä½äº†ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜äº†æ¨¡å—çš„ç›¸å¯¹ç‹¬ç«‹æ€§ã€‚\n2. ç”±äºäº²åˆåº¦é™ä½ï¼Œä»è€Œæé«˜äº†ç±»çš„å¯å¤ç”¨ç‡å’Œç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚\n\n###### åˆæˆå¤ç”¨åŸåˆ™\n\nåˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼ŒCRPï¼‰åˆå«ç»„åˆ/èšåˆå¤ç”¨åŸåˆ™ï¼ˆComposition/Aggregate Reuse Principleï¼ŒCARPï¼‰ã€‚å®ƒè¦æ±‚åœ¨è½¯ä»¶å¤ç”¨æ—¶ï¼Œè¦å°½é‡å…ˆä½¿ç”¨==ç»„åˆ==æˆ–è€…==èšåˆ==ç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨==ç»§æ‰¿==å…³ç³»æ¥å®ç°ã€‚å¦‚æœè¦ä½¿ç”¨ç»§æ‰¿å…³ç³»ï¼Œåˆ™å¿…é¡»ä¸¥æ ¼éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚\n\né€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸ºç»§æ‰¿å¤ç”¨å’Œåˆæˆå¤ç”¨ä¸¤ç§ï¼Œç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ã€‚\n\n1. ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚\n2. å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚\n3. å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚\n\né‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚\n\n1. å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚\n2. æ–°æ—§ç±»ä¹‹é—´çš„è€¦åˆåº¦ä½ã€‚è¿™ç§å¤ç”¨æ‰€éœ€çš„ä¾èµ–è¾ƒå°‘ï¼Œæ–°å¯¹è±¡å­˜å–æˆåˆ†å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡æˆåˆ†å¯¹è±¡çš„æ¥å£ã€‚\n3. å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚\n\n###### ä¸ƒå¤§åŸåˆ™æ€»ç»“\n\n| è®¾è®¡åŸåˆ™     | ä¸€å¥è¯å½’çº³                                                   | ç›®çš„                                       |\n| ------------ | ------------------------------------------------------------ | ------------------------------------------ |\n| å¼€é—­åŸåˆ™     | å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­                                       | é™ä½ç»´æŠ¤å¸¦æ¥çš„æ–°é£é™©                       |\n| ä¾èµ–å€’ç½®åŸåˆ™ | é«˜å±‚ä¸åº”è¯¥ä¾èµ–ä½å±‚ï¼Œè¦é¢å‘æ¥å£ç¼–ç¨‹                           | æ›´åˆ©äºä»£ç ç»“æ„çš„å‡çº§æ‰©å±•                   |\n| å•ä¸€èŒè´£åŸåˆ™ | ä¸€ä¸ªç±»åªå¹²ä¸€ä»¶äº‹ï¼Œå®ç°ç±»è¦å•ä¸€                               | ä¾¿äºç†è§£ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§                 |\n| æ¥å£éš”ç¦»åŸåˆ™ | ä¸€ä¸ªæ¥å£åªå¹²ä¸€ä»¶äº‹ï¼Œæ¥å£è¦ç²¾ç®€å•ä¸€                           | åŠŸèƒ½è§£è€¦ï¼Œé«˜èšåˆã€ä½è€¦åˆ                   |\n| è¿ªç±³ç‰¹æ³•åˆ™   | ä¸è¯¥çŸ¥é“çš„ä¸è¦çŸ¥é“ï¼Œä¸€ä¸ªç±»åº”è¯¥ä¿æŒå¯¹å…¶å®ƒå¯¹è±¡æœ€å°‘çš„äº†è§£ï¼Œé™ä½è€¦åˆåº¦ | åªå’Œæœ‹å‹äº¤æµï¼Œä¸å’Œé™Œç”Ÿäººè¯´è¯ï¼Œå‡å°‘ä»£ç è‡ƒè‚¿ |\n| é‡Œæ°æ›¿æ¢åŸåˆ™ | ä¸è¦ç ´åç»§æ‰¿ä½“ç³»ï¼Œå­ç±»é‡å†™æ–¹æ³•åŠŸèƒ½å‘ç”Ÿæ”¹å˜ï¼Œä¸åº”è¯¥å½±å“çˆ¶ç±»æ–¹æ³•çš„å«ä¹‰ | é˜²æ­¢ç»§æ‰¿æ³›æ»¥                               |\n| åˆæˆå¤ç”¨åŸåˆ™ | å°½é‡ä½¿ç”¨ç»„åˆæˆ–è€…èšåˆå…³ç³»å®ç°ä»£ç å¤ç”¨ï¼Œå°‘ä½¿ç”¨ç»§æ‰¿             | é™ä½ä»£ç è€¦åˆ                               |\n\n## è®¾è®¡æ¨¡å¼åˆ†ç±»æ¦‚è¿°\n\nè®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ˜¯é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™çš„å®é™…è¿ç”¨ï¼Œæ˜¯å¯¹ç±»çš„å°è£…æ€§ã€ç»§æ‰¿æ€§å’Œå¤šæ€æ€§ä»¥åŠç±»çš„å…³è”å…³ç³»å’Œç»„åˆå…³ç³»çš„å……åˆ†ç†è§£ã€‚\n\n- å¯ä»¥æé«˜ç¨‹åºå‘˜çš„æ€ç»´èƒ½åŠ›ã€ç¼–ç¨‹èƒ½åŠ›å’Œè®¾è®¡èƒ½åŠ›ã€‚\n- ä½¿ç¨‹åºè®¾è®¡æ›´åŠ æ ‡å‡†åŒ–ã€ä»£ç ç¼–åˆ¶æ›´åŠ å·¥ç¨‹åŒ–ï¼Œä½¿è½¯ä»¶å¼€å‘æ•ˆç‡å¤§å¤§æé«˜ï¼Œä»è€Œç¼©çŸ­è½¯ä»¶çš„å¼€å‘å‘¨æœŸã€‚\n- ä½¿è®¾è®¡çš„ä»£ç å¯é‡ç”¨æ€§é«˜ã€å¯è¯»æ€§å¼ºã€å¯é æ€§é«˜ã€çµæ´»æ€§å¥½ã€å¯ç»´æŠ¤æ€§å¼ºã€‚\n\n\n\n**åˆ›å»ºå‹æ¨¡å¼**ï¼šç”¨äºæè¿°â€œæ€æ ·åˆ›å»ºå¯¹è±¡â€ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯â€œå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»â€ã€‚\n\n**ç»“æ„å‹æ¨¡å¼**ï¼šç”¨äºæè¿°å¦‚ä½•å°†ç±»æˆ–å¯¹è±¡æŒ‰æŸç§å¸ƒå±€ç»„æˆæ›´å¤§çš„ç»“æ„ã€‚\n\n**è¡Œä¸ºå‹æ¨¡å¼**ï¼šç”¨äºæè¿°ç±»æˆ–å¯¹è±¡ä¹‹é—´æ€æ ·ç›¸äº’åä½œå…±åŒå®Œæˆå•ä¸ªå¯¹è±¡éƒ½æ— æ³•å•ç‹¬å®Œæˆçš„ä»»åŠ¡ï¼Œä»¥åŠæ€æ ·åˆ†é…èŒè´£ã€‚\n\n###### è®¾è®¡æ¨¡å¼æ€»ç»“\n\n| æ¨¡å¼åˆ†ç±» | æ¨¡å¼åç§° | ä¸€å¥è¯æ€»ç»“ |\n| -------- | -------- | -------- |\n|   åˆ›å»ºå‹æ¨¡å¼   |    å·¥å‚æ–¹æ³•      | ç®€å•å·¥å‚ï¼ˆé™æ€å·¥å‚ï¼‰æ¨¡å¼æœ‰==ä¸€ä¸ª==å…·ä½“çš„å·¥å‚ç±»ï¼Œå¯ä»¥ç”Ÿæˆ==å¤šä¸ª==ä¸åŒçš„äº§å“ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æœ‰==å¤šä¸ª==å·¥å‚==å®ç°ç±»==ï¼Œæ¯ä¸ªå®ç°ç±»ç”Ÿæˆå…·ä½“çš„äº§å“ã€‚ |\n| : |   æŠ½è±¡å·¥å‚      |ä¸ºè®¿é—®ç±»æä¾›ä¸€ä¸ªåˆ›å»º==ä¸€ç»„ç›¸==å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œä¸”è®¿é—®ç±»æ— é¡»æŒ‡å®šæ‰€è¦äº§å“çš„å…·ä½“ç±»å°±èƒ½å¾—åˆ°åŒæ—çš„ä¸åŒç­‰çº§çš„äº§å“çš„æ¨¡å¼ç»“æ„ã€‚|\n| : |     å»ºé€ è€…     | å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„==æ„é€ ==ä¸å®ƒçš„==è¡¨ç¤º==åˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ |\n| : | åŸå‹ | ç”¨ä¸€ä¸ªå·²ç»åˆ›å»ºçš„å®ä¾‹ä½œä¸ºåŸå‹ï¼Œé€šè¿‡å¤åˆ¶è¯¥åŸå‹å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå’ŒåŸå‹ç›¸åŒæˆ–ç›¸ä¼¼çš„æ–°å¯¹è±¡ã€‚ï¼ˆ==clone==ï¼‰ |\n| : | å•ä¾‹ | æŒ‡ä¸€ä¸ªç±»==åªæœ‰ä¸€ä¸ªå®ä¾‹==ï¼Œä¸”è¯¥ç±»èƒ½è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹çš„ä¸€ç§æ¨¡å¼ã€‚ |\n| ç»“æ„å‹æ¨¡å¼ | é€‚é…å™¨ | å°†ä¸€ä¸ªç±»çš„æ¥å£==è½¬æ¢==æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£==ä¸å…¼å®¹==è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»èƒ½ä¸€èµ·å·¥ä½œã€‚ |\n| : | æ¡¥æ¥ | å°†==æŠ½è±¡==ä¸==å®ç°==åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥==ç‹¬ç«‹å˜åŒ–==ã€‚å®ƒæ˜¯ç”¨==ç»„åˆå…³ç³»==ä»£æ›¿ç»§æ‰¿å…³ç³»æ¥å®ç°çš„ï¼Œä»è€Œé™ä½äº†æŠ½è±¡å’Œå®ç°è¿™ä¸¤ä¸ªå¯å˜ç»´åº¦çš„è€¦åˆåº¦ã€‚ |\n| : | ç»„åˆ | å°†å¯¹è±¡ç»„åˆæˆ==æ ‘çŠ¶==å±‚æ¬¡ç»“æ„ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰==ä¸€è‡´çš„è®¿é—®æ€§==ã€‚ |\n| : | è£…é¥° | ==åŠ¨æ€==åœ°ç»™å¯¹è±¡å¢åŠ ä¸€äº›==èŒè´£==ï¼Œå³å¢åŠ å…¶é¢å¤–çš„åŠŸèƒ½ã€‚ |\n| : | å¤–è§‚ | ä¸º==å¤šä¸ª==å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ä¸ª==ä¸€è‡´çš„æ¥å£==ï¼Œä½¿è¿™äº›å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“è¢«è®¿é—®ã€‚ |\n| : | äº«å…ƒ | è¿ç”¨==å…±äº«æŠ€æœ¯==æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡==ç»†ç²’åº¦==å¯¹è±¡çš„å¤ç”¨ã€‚ |\n| : | ä»£ç† | ä¸ºæŸå¯¹è±¡æä¾›ä¸€ç§==ä»£ç†==ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚å³å®¢æˆ·ç«¯é€šè¿‡ä»£ç†==é—´æ¥==åœ°è®¿é—®è¯¥å¯¹è±¡ï¼Œä»è€Œé™åˆ¶ã€å¢å¼ºæˆ–ä¿®æ”¹è¯¥å¯¹è±¡çš„ä¸€äº›ç‰¹æ€§ã€‚ |\n| è¡Œä¸ºæ¨¡å¼ | è´£ä»»é“¾ | æŠŠè¯·æ±‚ä»é“¾ä¸­çš„ä¸€ä¸ªå¯¹è±¡ä¼ åˆ°ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œç›´åˆ°è¯·æ±‚è¢«å“åº”ä¸ºæ­¢ã€‚é€šè¿‡è¿™ç§æ–¹å¼å»é™¤å¯¹è±¡ä¹‹é—´çš„è€¦åˆã€‚ |\n| : | å‘½ä»¤ | å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚ |\n| : | è¿­ä»£å™¨ | æä¾›ä¸€ç§æ–¹æ³•æ¥é¡ºåºè®¿é—®èšåˆå¯¹è±¡ä¸­çš„ä¸€ç³»åˆ—æ•°æ®ï¼Œè€Œä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ |\n| : | ä¸­ä»‹è€… | å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥ç®€åŒ–åŸæœ‰å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œé™ä½ç³»ç»Ÿä¸­å¯¹è±¡é—´çš„è€¦åˆåº¦ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´ä¸å¿…ç›¸äº’äº†è§£ã€‚ |\n| : | å¤‡å¿˜å½• | åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œè·å–å¹¶ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åæ¢å¤å®ƒã€‚ |\n| : | è§‚å¯Ÿè€… | å¤šä¸ªå¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒæŠŠè¿™ç§æ”¹å˜é€šçŸ¥ç»™å…¶ä»–å¤šä¸ªå¯¹è±¡ï¼Œä»è€Œå½±å“å…¶ä»–å¯¹è±¡çš„è¡Œä¸ºã€‚ |\n| : | çŠ¶æ€ | å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å…¶è¡Œä¸ºèƒ½åŠ›ã€‚ |\n| : | ç­–ç•¥ | å®šä¹‰äº†==ä¸€ç³»åˆ—==ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„æ”¹å˜ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ |\n| : | æ¨¡ç‰ˆæ–¹æ³• | å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•==éª¨æ¶==ï¼Œå°†ç®—æ³•çš„ä¸€äº›æ­¥éª¤==å»¶è¿Ÿåˆ°å­ç±»==ä¸­ï¼Œä½¿å¾—å­ç±»åœ¨å¯ä»¥ä¸æ”¹å˜è¯¥ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ |\n| : | è®¿é—®è€… | åœ¨ä¸æ”¹å˜é›†åˆå…ƒç´ çš„å‰æä¸‹ï¼Œä¸ºä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ï¼Œå³æ¯ä¸ªå…ƒç´ æœ‰å¤šä¸ªè®¿é—®è€…å¯¹è±¡è®¿é—®ã€‚ |\n| : | è§£é‡Šå™¨ | æä¾›å¦‚ä½•å®šä¹‰è¯­è¨€çš„æ–‡æ³•ï¼Œä»¥åŠå¯¹è¯­è¨€å¥å­çš„è§£é‡Šæ–¹æ³•ï¼Œå³è§£é‡Šå™¨ã€‚ |",
      "data": {
        "title": "è®¾è®¡æ¨¡å¼å’Œå¼€å‘åŸåˆ™",
        "date": "2024-12-08 11:05:28",
        "tags": [
          "è®¾è®¡æ¨¡å¼",
          "note"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/she-ji-mo-shi-he-kai-fa-yuan-ze.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## è½¯ä»¶å¼€å‘çš„7æ¡åŸåˆ™\n\n###### å¼€é—­åŸåˆ™\n\nå¼€é—­åŸåˆ™ï¼ˆOpen Closed Principleï¼ŒOCPï¼‰ç”±å‹ƒå…°ç‰¹Â·æ¢…è€¶ï¼ˆBertrand Meyerï¼‰æå‡ºï¼Œä»–åœ¨ 1988 å¹´çš„è‘—ä½œã€Šé¢å‘å¯¹è±¡è½¯ä»¶æ„é€ ã€‹ï¼ˆObject Oriented Software Constructionï¼‰ä¸­æå‡ºï¼šè½¯ä»¶å®ä½“åº”å½“==å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­==ï¼ˆSoftware entities should be open for extensionï¼Œbut closed for modificationï¼‰ï¼Œè¿™å°±æ˜¯å¼€é—­åŸåˆ™çš„ç»å…¸å®šä¹‰ã€‚",
      "fileName": "she-ji-mo-shi-he-kai-fa-yuan-ze"
    },
    {
      "content": "## æœ¯è¯­\n\nå‘å¸ƒè®¢é˜…çš„å¯¹è±¡æ˜¯==ä¸»é¢˜ï¼ˆTopicï¼‰==ï¼Œå‘ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç§°ä¸º==ç”Ÿäº§è€…ï¼ˆProducerï¼‰==ï¼Œè®¢é˜…ä¸»é¢˜æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç§°ä¸º==æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰==ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ç»Ÿç§°ä¸º==å®¢æˆ·ç«¯ï¼ˆClientsï¼‰==ã€‚\n\nKafka çš„æœåŠ¡å™¨ç«¯ç”±è¢«ç§°ä¸º ==Broker== çš„==æœåŠ¡è¿›ç¨‹==æ„æˆï¼Œå³ä¸€ä¸ª Kafka é›†ç¾¤ç”±å¤šä¸ª Broker ç»„æˆï¼ŒBroker è´Ÿè´£æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œä»¥åŠå¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ã€‚è™½ç„¶å¤šä¸ªBrokerå¯ä»¥åŒæ—¶è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯é€šå¸¸å°†ä¸åŒçš„Brokeråˆ†æ•£åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œä»¥ä¿è¯é«˜å¯ç”¨ã€‚\n\nå®ç°é«˜å¯ç”¨çš„å¦ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯==å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰==ã€‚å¤‡ä»½çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç›¸åŒçš„æ•°æ®æ‹·è´åˆ°å¤šå°æœºå™¨ä¸Šï¼Œè€Œè¿™äº›ç›¸åŒçš„æ•°æ®æ‹·è´åœ¨ Kafka ä¸­è¢«ç§°ä¸º==å‰¯æœ¬ï¼ˆReplicaï¼‰==ã€‚å‰¯æœ¬çš„æ•°é‡æ˜¯å¯ä»¥é…ç½®çš„ï¼Œè¿™äº›å‰¯æœ¬ä¿å­˜ç€ç›¸åŒçš„æ•°æ®ï¼Œä½†å´æœ‰ä¸åŒçš„è§’è‰²å’Œä½œç”¨ã€‚Kafka å®šä¹‰äº†ä¸¤ç±»å‰¯æœ¬ï¼š==é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰==å’Œ==è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰==ã€‚å‰è€…å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™é‡Œçš„å¯¹å¤–æŒ‡çš„æ˜¯ä¸å®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œäº¤äº’ï¼›è€Œåè€…åªæ˜¯è¢«åŠ¨åœ°è¿½éšé¢†å¯¼è€…å‰¯æœ¬è€Œå·²ï¼Œä¸èƒ½ä¸å¤–ç•Œè¿›è¡Œäº¤äº’ã€‚\n\n<!-- more -->\n\n\nå‰¯æœ¬æœºåˆ¶å¯ä»¥ä¿è¯æ•°æ®çš„æŒä¹…åŒ–æˆ–æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ²¡æœ‰è§£å†³ä¼¸ç¼©æ€§çš„é—®é¢˜ï¼ˆScalabilityï¼‰ï¼Œå¦‚æœé¢†å¯¼è€…å‰¯æœ¬ç§¯ç´¯äº†å¤ªå¤šçš„æ•°æ®ä»¥è‡³äºå•å° Broker æœºå™¨éƒ½æ— æ³•å®¹çº³äº†ï¼Œæ­¤æ—¶å°±éœ€è¦æŠŠæ•°æ®åˆ†å‰²æˆå¤šä»½ä¿å­˜åœ¨ä¸åŒçš„ Broker ä¸Šã€‚è¿™ç§æœºåˆ¶å°±æ˜¯æ‰€è°“çš„==åˆ†åŒºï¼ˆPartitioningï¼‰==ã€‚\n\nKafka ä¸­çš„åˆ†åŒºæœºåˆ¶æŒ‡çš„æ˜¯å°†æ¯ä¸ªä¸»é¢˜åˆ’åˆ†æˆå¤šä¸ª==åˆ†åŒºï¼ˆPartitionï¼‰==ï¼Œæ¯ä¸ªåˆ†åŒºæ˜¯ä¸€ç»„==æœ‰åº==çš„æ¶ˆæ¯æ—¥å¿—ï¼Œç”Ÿäº§è€…ç”Ÿäº§çš„æ¯æ¡æ¶ˆæ¯åªä¼šè¢«å‘é€åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ã€‚\n\n**å‰¯æœ¬æ˜¯åœ¨åˆ†åŒºè¿™ä¸ªå±‚çº§å®šä¹‰çš„ã€‚**æ¯ä¸ªåˆ†åŒºä¸‹å¯ä»¥é…ç½®è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­åªèƒ½æœ‰ 1 ä¸ªé¢†å¯¼è€…å‰¯æœ¬å’Œ N-1 ä¸ªè¿½éšè€…å‰¯æœ¬ã€‚ç”Ÿäº§è€…å‘åˆ†åŒºå†™å…¥æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„ä½ç½®ä¿¡æ¯ç”±ä¸€ä¸ªå«==ä½ç§»ï¼ˆOffsetï¼‰==çš„æ•°æ®æ¥è¡¨å¾ã€‚åˆ†åŒºä½ç§»æ€»æ˜¯ä» 0 å¼€å§‹ï¼Œå•è°ƒé€’å¢ä¸”ä¸ä¼šæ”¹å˜ã€‚\n\nKafka ä½¿ç”¨==æ¶ˆæ¯æ—¥å¿—ï¼ˆLogï¼‰==æ¥ä¿å­˜æ•°æ®ï¼Œä¸€ä¸ªæ—¥å¿—å°±æ˜¯ç£ç›˜ä¸Šä¸€ä¸ª==**åªèƒ½è¿½åŠ å†™**ï¼ˆAppend-onlyï¼‰==æ¶ˆæ¯çš„ç‰©ç†æ–‡ä»¶ã€‚å› ä¸ºåªèƒ½è¿½åŠ å†™å…¥ï¼Œæ•…é¿å…äº†ç¼“æ…¢çš„éšæœº I/O æ“ä½œï¼Œæ”¹ä¸ºæ€§èƒ½è¾ƒå¥½çš„é¡ºåºI/O å†™æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å®ç° Kafka é«˜ååé‡ç‰¹æ€§çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µã€‚ä¸è¿‡å¦‚æœä½ ä¸åœåœ°å‘ä¸€ä¸ªæ—¥å¿—å†™å…¥æ¶ˆæ¯ï¼Œæœ€ç»ˆä¹Ÿä¼šè€—å°½æ‰€æœ‰çš„ç£ç›˜ç©ºé—´ï¼Œå› æ­¤ Kafka å¿…ç„¶è¦å®šæœŸåœ°åˆ é™¤æ¶ˆæ¯ä»¥å›æ”¶ç£ç›˜ã€‚æ€ä¹ˆåˆ é™¤å‘¢ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡==æ—¥å¿—æ®µï¼ˆLog Segmentï¼‰==æœºåˆ¶ã€‚åœ¨ Kafka åº•å±‚ï¼Œä¸€ä¸ªæ—¥å¿—åˆè¿‘ä¸€æ­¥ç»†åˆ†æˆå¤šä¸ªæ—¥å¿—æ®µï¼Œæ¶ˆæ¯è¢«è¿½åŠ å†™åˆ°å½“å‰æœ€æ–°çš„æ—¥å¿—æ®µä¸­ï¼Œå½“å†™æ»¡äº†ä¸€ä¸ªæ—¥å¿—æ®µåï¼ŒKafka ä¼šè‡ªåŠ¨åˆ‡åˆ†å‡ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µï¼Œå¹¶å°†è€çš„æ—¥å¿—æ®µå°å­˜èµ·æ¥ã€‚Kafka åœ¨åå°è¿˜æœ‰å®šæ—¶ä»»åŠ¡ä¼šå®šæœŸåœ°æ£€æŸ¥è€çš„æ—¥å¿—æ®µæ˜¯å¦èƒ½å¤Ÿè¢«åˆ é™¤ï¼Œä»è€Œå®ç°å›æ”¶ç£ç›˜ç©ºé—´çš„ç›®çš„ã€‚\n\n==æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰==æŒ‡çš„æ˜¯å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å…±åŒç»„æˆä¸€ä¸ªç»„æ¥æ¶ˆè´¹ä¸€ä¸ªä¸»é¢˜ï¼Œä¸»é¢˜ä¸­çš„æ¯ä¸ªåˆ†åŒºåªä¼šè¢«ç»„å†…çš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¶ˆè´¹ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆæå‡æ¶ˆè´¹ç«¯çš„ååé‡ã€‚æ­¤å¤–ï¼ŒKafkaå¦‚æœæ£€æµ‹åˆ°æ¶ˆè´¹è€…ç»„å†…æŸä¸ªå®ä¾‹æŒ‚äº†ï¼Œä¼šæŠŠè¿™ä¸ªå®ä¾‹ä¹‹å‰è´Ÿè´£çš„åˆ†åŒºè½¬ç§»ç»™å…¶ä»–æ¶ˆè´¹è€…ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯==é‡å¹³è¡¡ï¼ˆRebalanceï¼‰==ã€‚\n\n![](https://xuhang.github.io/post-images/1733626924845.png)\n\nå½“æ•°æ®åœ¨ç½‘ç»œå’Œç£ç›˜è¿›è¡Œä¼ è¾“æ—¶ï¼Œé¿å…æ˜‚è´µçš„å†…æ ¸æ€æ•°æ®æ‹·è´ï¼ŒKafkaä½¿ç”¨äº†Linuxå¹³å°å®ç°çš„==é›¶æ‹·è´ï¼ˆZero Copyï¼‰==æŠ€æœ¯ã€‚\n\nKafkaç‰ˆæœ¬æ¼”è¿›\n\n+ 0.8 å¼•å…¥å‰¯æœ¬æœºåˆ¶ï¼Œè‡³æ­¤æˆä¸ºä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šå®Œå¤‡çš„åˆ†å¸ƒå¼é«˜å¯é æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆï¼Œæ­¤ç‰ˆæœ¬APIéœ€è¦æŒ‡å®šZooKeeperåœ°å€ï¼›\n+ 0.8.2.0 ç¤¾åŒºç‰ˆå¼•å…¥æ–°ç‰ˆæœ¬Producer APIï¼Œæ­¤ç‰ˆæœ¬éœ€è¦æŒ‡å®šBrokeråœ°å€ï¼›\n+ 0.9.0.0 å¢åŠ åŸºç¡€çš„å®‰å…¨è®¤è¯/æƒé™ï¼Œä½¿ç”¨Javaé‡å†™æ¶ˆè´¹è€…APIï¼Œå¼•å…¥Kafka Connectç»„ä»¶ï¼Œæ­¤ç‰ˆæœ¬Producer APIæ¯”è¾ƒç¨³å®šï¼›\n+ 0.10.0.0 é‡Œç¨‹ç¢‘ï¼Œå¼•å…¥Kafka Streamï¼›\n+ 0.10.2.2 æ–°ç‰ˆæœ¬Consumer APIï¼Œä¿®å¤äº†å¯èƒ½å¯¼è‡´Producer APIæ€§èƒ½é™ä½çš„bugï¼›\n+ 0.11.0.0 æä¾›å¹‚ç­‰æ€§Producer APIå’Œäº‹åŠ¡ APIï¼Œå¯¹æ¶ˆæ¯æ ¼å¼åšäº†é‡æ„ã€‚\n\n## é›†ç¾¤å‚æ•°é…ç½®\n\n**Brokerç«¯å‚æ•°**\n\n```properties\nlog.dirs: Brokeréœ€è¦ä½¿ç”¨çš„æ–‡ä»¶ç›®å½•è·¯å¾„ï¼Œé€—å·åˆ†å‰²ï¼Œæœ€å¥½æ˜¯ä¸åŒç‰©ç†ç£ç›˜ä¸Šçš„ç›®å½•ï¼Œèƒ½æé«˜ååé‡\nlog.dir: Brokeréœ€è¦ä½¿ç”¨çš„å•ä¸ªæ–‡ä»¶è·¯å¾„\nzookeeper.connect: zkåœ°å€\n# chroot zkåˆ«åï¼ŒåŠ åœ¨zookeeper.connectå‚æ•°æœ€åï¼Œä¸ç”¨æ¯ä¸ªzkåœ°å€éƒ½åŠ \n# zookeeper.connect=zk1:2181,zk2:2181,zk3:2181/kafka1\nlisteners: åè®®åç§°://ä¸»æœº:ç«¯å£, åè®®åç§°://ä¸»æœº:ç«¯å£... å‘Šè¯‰å¤–éƒ¨è¿æ¥ç€é€šè¿‡ä»€ä¹ˆåè®®è®¿é—®ä¸»æœºåå’Œç«¯å£å¼€æ”¾çš„kafka\nadvertised.listeners: è¿™ç»„ç›‘å¬å™¨æ˜¯Brokerç”¨äºå¯¹å¤–å‘å¸ƒçš„ï¼ˆé€šå¸¸æ˜¯åŒç½‘å¡çš„å¤–ç½‘IPï¼‰\n# åè®®å¯ä»¥è‡ªå®šä¹‰ï¼Œå¦‚æœè‡ªå®šä¹‰åè®®åç§°ï¼Œå¿…é¡»ç”¨listener.security.protocol.mapå‚æ•°æŒ‡å®šå…·ä½“åº•å±‚å®‰å…¨åè®®\nlistener.security.protocol.map=CONTROLLER:PLAINTEXT :è¡¨ç¤ºCONTROLLERè‡ªå®šä¹‰åè®®åº•å±‚ä½¿ç”¨æ˜æ–‡ä¸åŠ å¯†ä¼ è¾“\nauto.create.topics.enable: æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»ºTopic\nunclean.leader.election.enable: æ˜¯å¦å…è®¸Unclean Leaderï¼ˆè½åå¾ˆå¤šçš„åˆ†åŒºå‰¯æœ¬ï¼‰é€‰ä¸¾\nauto.leader.rebalance.enable: æ˜¯å¦å…è®¸å®šæœŸè¿›è¡ŒLeaderé€‰ä¸¾\nlog.retention.{hour|minutes|ms}: æ§åˆ¶ä¸€æ¡æ¶ˆæ¯æ•°æ®è¢«ä¿å­˜çš„æ—¶é—´\nlog.retention.bytes: Brokerä¸ºæ¶ˆæ¯ä¿å­˜çš„æ€»ç£ç›˜å®¹é‡å¤§å°\nmessage.max.bytes: æ§åˆ¶Brokerèƒ½å¤Ÿæ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯å¤§å°\n```\n\n**Topicçº§åˆ«å‚æ•°**\n\n> Topic çº§åˆ«å‚æ•°ä¼šè¦†ç›–å…¨å±€Broker å‚æ•°çš„å€¼\n\n```properties\nretention.ms: è¯¥Topicæ¶ˆæ¯è¢«ä¿å­˜çš„æ—¶é•¿ï¼Œé»˜è®¤7days\nretention.bytes: ä¸ºè¯¥Topicé¢„ç•™çš„ç£ç›˜ç©ºé—´ï¼Œé»˜è®¤-1ï¼Œæ— é™åˆ¶\nmax.message.bytes: Brokerèƒ½å¤Ÿæ­£å¸¸æ¥æ”¶è¯¥Topicçš„æœ€å¤§æ¶ˆæ¯å¤§å°\n```\n\n**JVMå‚æ•°**\n\n```properties\nKAFKA_HEAP_OPTS: å †å¤§å°\nKAFKA_JVM_PERFORMANCE_OPTS: GCå‚æ•°\n```\n\n**æ“ä½œç³»ç»Ÿå‚æ•°**\n\n```shell\nulimit -n 1000000: Linuxæ“ä½œç³»ç»Ÿèƒ½æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œå°½å¯èƒ½å¤§\n```\n\næ“ä½œç³»ç»Ÿå…¶ä»–å‚æ•°åŒ…æ‹¬swapè°ƒä¼˜å’ŒFlushè½ç›˜æ—¶é—´ï¼Œswapå¦‚æœè®¾ç½®ä¸º0ï¼Œå½“ç‰©ç†å†…å­˜è€—å°½ï¼Œæ“ä½œç³»ç»Ÿä¼šéšæœºé€‰æ‹©ä¸€ä¸ªè¿›ç¨‹ kill æ‰ï¼Œæ— æ³•è§‚æµ‹åˆ° Broker æ€§èƒ½çš„ä¸‹é™å’Œé¢„è­¦ã€‚Kafkaåªè¦å°†æ•°æ®å†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜å°±å¯ä»¥ä»»åŠ¡æ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œä¹‹åç”±æ“ä½œç³»ç»Ÿå®šæœŸå°†è„æ•°æ®è½ç›˜åˆ°ç£ç›˜ä¸Šã€‚é‰´äºKafkaæä¾›çš„å¤šå‰¯æœ¬å†—ä½™æœºåˆ¶ï¼Œå¯ä»¥ç¨å¾®å°†å®šæœŸåˆ·ç›˜çš„é—´éš”å¢å¤§ã€‚\n\n## åˆ†åŒºæœºåˆ¶\n\n**åˆ†åŒºç­–ç•¥**ï¼ˆç”±ç”Ÿäº§è€…å†³å®šæ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜çš„å“ªä¸ªåˆ†åŒºï¼‰\n\n+ è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ï¼šé€šè¿‡ç”Ÿäº§è€…ç«¯`partitioner.class`å‚æ•°æŒ‡å®šåˆ†åŒºç­–ç•¥ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå®ç°`org.apache.kafka.clients.producer.Partitioner`æ¥å£çš„ç±»å¹¶å®ç°å…¶ä¸­çš„`partition()`æ–¹æ³•ã€‚\n+ è½®è¯¢ç­–ç•¥ï¼ˆRound-robinï¼‰ï¼šé¡ºåºåˆ†é…ï¼Œé»˜è®¤åˆ†åŒºç­–ç•¥ï¼›\n+ éšæœºç­–ç•¥ï¼ˆRandomnessï¼‰ï¼šéšæœºåœ°å°†æ¶ˆæ¯æ”¾åˆ°æŸä¸ªåˆ†åŒºä¸­ï¼›\n+ æŒ‰æ¶ˆæ¯é”®ä¿åºç­–ç•¥ï¼ˆKey-orderingï¼‰ï¼šåŒä¸€ä¸ªkeyçš„æ‰€æœ‰æ¶ˆæ¯è¿›å…¥ç›¸åŒçš„åˆ†åŒº\n\n## å‹ç¼©\n\nå‹ç¼©å¯èƒ½å‘ç”Ÿåœ¨ä¸¤ä¸ªåœ°æ–¹ï¼šç”Ÿäº§è€…å’ŒBrokerç«¯\n\nç”Ÿäº§è€…ç¨‹åºä¸­é…ç½®`compression.type`å¯ç”¨æŒ‡å®šçš„å‹ç¼©ç®—æ³•ç±»å‹ï¼Œæ¯”å¦‚\n\n```java\nProperties props = new Properties();\nprops.put(\"bootstrap.servers\", \"localhost:9092\");\nprops.put(\"acks\", \"all\");\nprops.put(\"key.serializer\", \"org.apache.kafka.common.seriailization.StringSerializer\");\nprops.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\");\nprosp.put(\"comression.type\", \"gzip\"); // å¯ç”¨GZIPå‹ç¼©\nProducer<String, String> producer = new KafkaProducer<>(props);\n```\n\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒBrokerç«¯æ¥æ”¶åˆ°Producerçš„æ¶ˆæ¯ååŸå°ä¸åŠ¨åœ°ä¿å­˜ï¼Œä½†æ˜¯æœ‰ä¸¤ç§ä¾‹å¤–æƒ…å†µå¯èƒ½è®©Brokeré‡æ–°å‹ç¼©æ¶ˆæ¯ï¼š\n\n1. Brokerç«¯æŒ‡å®šäº†å’ŒProducerç«¯ä¸åŒçš„å‹ç¼©ç®—æ³•ã€‚Brokerç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åå…ˆç”¨Producerç«¯çš„å‹ç¼©ç®—æ³•è§£å‹ï¼Œç„¶åç”¨Brokerç«¯çš„å‹ç¼©ç®—æ³•é‡æ–°å‹ç¼©ã€‚\n2. Brokerç«¯å‘ç”Ÿäº†æ¶ˆæ¯æ ¼å¼è½¬æ¢ã€‚ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹è€ç‰ˆæœ¬çš„æ¶ˆè´¹è€…ç¨‹åºã€‚\n\nKafkaä¼šå°†æ¶ˆæ¯ä½¿ç”¨çš„å‹ç¼©ç®—æ³•å°è£…è¿›æ¶ˆæ¯é›†åˆä¸­ï¼Œå½“Consumerè¯»å–æ¶ˆæ¯é›†åˆæ—¶ï¼Œå°±çŸ¥é“ä½¿ç”¨å“ªç§å‹ç¼©ç®—æ³•è§£å‹äº†ã€‚Brokerç«¯ä¹Ÿä¼šè¿›è¡Œè§£å‹ç¼©ï¼Œç›®çš„æ—¶ä¸ºäº†å¯¹æ¶ˆæ¯æ‰§è¡ŒéªŒè¯ï¼Œä½†æ˜¯ä¼šå¯¹Brokerç«¯æ€§èƒ½é€ æˆä¸€å®šå½±å“ã€‚\n\nFacebook Zstandardæä¾›çš„å„å‹ç¼©ç®—æ³•benckmarkç»“æœ\n\n| ç®—æ³•            | å‹ç¼©æ¯” | å‹ç¼©ååé‡ MB/s | è§£å‹ååé‡ MB/s |\n| --------------- | ------ | --------------- | --------------- |\n| zstd 1.3.4-1    | 2.877  | 470             | 1380            |\n| zlib 1.2.11-1   | 2.743  | 110             | 400             |\n| brotli 1.0.2-0  | 2.701  | 410             | 430             |\n| quicklz 1.5.0-1 | 2.238  | 550             | 710             |\n| lzo1x2.09-1     | 2.108  | 650             | 830             |\n| lz4 1.8.1       | 2.101  | 750             | 3700            |\n| snappy 1.1.4    | 2.091  | 530             | 1800            |\n| lzf 3.6-1       | 2.077  | 400             | 860             |\n\n## æ— æ¶ˆæ¯ä¸¢å¤±é…ç½®\n\nå½“Kafkaçš„è‹¥å¹²ä¸ªï¼ˆå¯ä»¥é€‰æ‹©ä¸€ä¸ªæˆ–è€…æ‰€æœ‰ï¼‰BrokeræˆåŠŸæ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯å¹¶æˆåŠŸå†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶åï¼Œä¼šå‘Šè¯‰ç”Ÿäº§è€…è¿™æ¡æ¶ˆæ¯å·²æˆåŠŸæäº¤ã€‚å¯¹äºâ€œå·²æäº¤â€çš„æ¶ˆæ¯ï¼ŒKafkaä¼šä¿è¯æ¶ˆæ¯æœ‰é™åº¦çš„æŒä¹…åŒ–ã€‚\n\nå¦‚æœç”Ÿäº§è€…ä½¿ç”¨çš„æ˜¯`producer.send(msg)`å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªAPIæ˜¯å¼‚æ­¥çš„ï¼Œè°ƒç”¨åç«‹å³è¿”å›ï¼Œæ— æ³•çŸ¥é“æ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸã€‚åº”è¯¥ä½¿ç”¨`producer.send(msg, callback)`ï¼Œè¿™ä¸ªAPIèƒ½å‡†ç¡®çš„å‘Šè¯‰å®¢æˆ·ç«¯æ¶ˆæ¯æ˜¯å¦æäº¤æˆåŠŸã€‚\n\n`acks=all`è¡¨ç¤ºProducerå¯¹â€œå·²æäº¤â€æ¶ˆæ¯çš„å®šä¹‰ï¼Œallè¡¨æ˜éœ€è¦æ‰€æœ‰å‰¯æœ¬Brokeréƒ½æ¥æ”¶åˆ°æ¶ˆæ¯æ‰ç®—â€œå·²æäº¤â€ã€‚\n\n`retries=3`è¡¨ç¤ºProducerçš„è‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€æ¬¡æ•°ã€‚\n\n## æ‹¦æˆªå™¨\n\nç”Ÿäº§è€…æ‹¦æˆªå™¨ï¼Œåœ¨æ¶ˆæ¯å‘é€å‰å’Œæ¶ˆæ¯æˆåŠŸæäº¤åæ’å…¥é€»è¾‘ï¼›æ¶ˆè´¹è€…æ‹¦æˆªå™¨ï¼Œåœ¨æ¶ˆæ¯æ¶ˆè´¹å‰å’Œæäº¤ä½ç§»ï¼ˆoffsetï¼‰åæ’å…¥é€»è¾‘ã€‚\n\nè‡ªå®šä¹‰ç”Ÿäº§è€…æ‹¦æˆªå™¨éœ€è¦å®ç°`org.apache.kafka.clients.producer.ProducerInterceptor`æ¥å£ï¼Œæ ¸å¿ƒæ–¹æ³•ï¼š\n\n1. `onSend`ï¼šåœ¨æ¶ˆæ¯å‘é€ä¹‹å‰è¢«è°ƒç”¨\n2. `onAcknowledgement`ï¼šåœ¨æ¶ˆæ¯æˆåŠŸæäº¤æˆ–å‘é€å¤±è´¥åè¢«è°ƒç”¨ï¼Œ`onAcknowledgement`çš„è°ƒç”¨è¦æ—©äºç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„å›è°ƒcallbackçš„è°ƒç”¨\n\nè‡ªå®šä¹‰æ¶ˆè´¹è€…æ‹¦æˆªå™¨éœ€è¦å®ç°`org.apache.kafka.clients.consumer.ConsumerInterceptor`æ¥å£ï¼Œæ ¸å¿ƒæ–¹æ³•ï¼š\n\n1. `onConsume`ï¼šåœ¨æ¶ˆæ¯è¢«Consumerå¤„ç†ä¹‹å‰è°ƒç”¨\n2. `onCommit`ï¼šConsumeråœ¨æäº¤offsetä¹‹åè°ƒç”¨\n\n## è¿æ¥\n\nåœ¨==**åˆ›å»º**== KafkaProducer å®ä¾‹æ—¶ï¼Œç”Ÿäº§è€…åº”ç”¨ä¼šåœ¨åå°åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªåä¸º Sender çš„çº¿ç¨‹ï¼Œè¯¥ Sender çº¿ç¨‹å¼€å§‹è¿è¡Œæ—¶é¦–å…ˆä¼šåˆ›å»ºä¸ Broker çš„è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒç”¨sendæ–¹æ³•å‰ï¼ŒProducerå°±å·²ç»è¿æ¥åˆ°Brokeräº†ï¼Œè¿æ¥çš„æ˜¯`bootstrap.servers`æŒ‡å®šçš„Brokeråœ°å€ã€‚å®é™…ä½¿ç”¨ä¸­ï¼Œå¹¶ä¸éœ€è¦æŠŠæ‰€æœ‰Brokeråœ°å€éƒ½é…ç½®åœ¨`bootstrap.servers`å‚æ•°ä¸­ï¼Œå› ä¸ºä¸º Producer ä¸€æ—¦è¿æ¥åˆ°é›†ç¾¤ä¸­çš„ä»»ä¸€å°Brokerï¼Œä¼šå‘æŸä¸€å°Brokerå‘é€METADATAè¯·æ±‚ï¼Œå°±èƒ½æ‹¿åˆ°æ•´ä¸ªé›†ç¾¤çš„ Broker ä¿¡æ¯ã€‚\n\nå½“ Producer æ›´æ–°äº†é›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ä¹‹åï¼Œå¦‚æœå‘ç°ä¸æŸäº› Broker å½“å‰æ²¡æœ‰è¿æ¥ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåˆ›å»ºä¸€ä¸ª TCP è¿æ¥ã€‚åŒæ ·åœ°ï¼Œå½“è¦å‘é€æ¶ˆæ¯æ—¶ï¼ŒProducer å‘ç°å°šä¸å­˜åœ¨ä¸ç›®æ ‡ Broker çš„è¿æ¥ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªã€‚\n\nProducerç«¯å‚æ•°`connections.max.idle.ms`é…ç½®äº†Kafkaå…³é—­TCPè¿æ¥çš„ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤9åˆ†é’Ÿã€‚å¦‚æœè®¾ç½®ä¸º `-1`åˆ™è¡¨ç¤ºä¸å…³é—­ç©ºé—²çš„TCPè¿æ¥ã€‚\n\nå’Œç”Ÿäº§è€…ä¸åŒçš„æ˜¯ï¼Œæ¶ˆè´¹è€…ç«¯æ„å»º`KafkaConsumer`å®ä¾‹æ—¶æ˜¯ä¸ä¼šåˆ›å»ºä»»ä½•TCPè¿æ¥çš„ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨`KafkaConsumer.poll`æ–¹æ³•æ—¶åˆ›å»ºã€‚å†å…·ä½“ä¸€ç‚¹ï¼Œpollæ–¹æ³•å†…éƒ¨æœ‰3ä¸ªåˆ›å»ºTCPè¿æ¥çš„æ—¶æœºï¼š\n\n1. å‘èµ·`FindCoordinator`è¯·æ±‚æ—¶ã€‚æ¶ˆè´¹è€…å‘é›†ç¾¤ä¸­è´Ÿè½½æœ€å°ï¼ˆå¾…å‘é€è¯·æ±‚æœ€å°‘ï¼‰çš„Brokerå‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢Coordinatorå¯¹äºçš„Brokerï¼Œè¿™ä¸€æ­¥ä¼šåˆ›å»ºSocketè¿æ¥ã€‚è¿™ä¸ªTCPä¹‹åä¼šè¢«å…³é—­ã€‚\n2. å®Œæˆä¸Šä¸€æ­¥çš„`FindCoordinator`è¯·æ±‚åï¼Œè¿æ¥æ­£çœŸçš„Coordinatorï¼Œæ­¤æ—¶ä¼šåˆ›å»ºSocketè¿æ¥ã€‚\n3. æ¶ˆè´¹æ•°æ®æ—¶ã€‚æ¶ˆè´¹è€…ä¼šä¸ºæ¯ä¸ªè¦æ¶ˆè´¹çš„åˆ†åŒºåˆ›å»ºä¸è¯¥åˆ†åŒºLeaderå‰¯æœ¬æ‰€åœ¨çš„Brokerè¿æ¥çš„TCPã€‚\n\næ¶ˆè´¹è€…å…³é—­Socketä¹Ÿåˆ†ä¸ºä¸»åŠ¨å…³é—­å’ŒKafkaè‡ªåŠ¨å…³é—­ã€‚ä¸»åŠ¨å…³é—­æ˜¯è°ƒç”¨APIå…³é—­ï¼Œå¦‚`KafkaCosnumer.close()`ï¼Œè‡ªåŠ¨å…³é—­ç”±æ¶ˆè´¹è€…ç«¯å‚æ•°`connection.max.idle.ms`æ§åˆ¶ï¼Œé»˜è®¤9åˆ†é’Ÿã€‚\n\n## æ¶ˆæ¯å¯é æ€§ä¿éšœ\n\nKafkaæ¶ˆæ¯äº¤ä»˜å¯é æ€§ä¿éšœï¼š\n\n1. ==æœ€å¤šä¸€æ¬¡==ï¼šæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šé‡å¤å‘é€ï¼ˆç¦æ­¢Produceré‡è¯•ï¼‰\n2. ==è‡³å°‘ä¸€æ¬¡==ï¼šæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä½†å¯èƒ½é‡å¤å‘é€ï¼ˆKafkaé»˜è®¤ï¼‰\n3. ==ç²¾ç¡®ä¸€æ¬¡==ï¼šæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šé‡å¤å‘é€ï¼ˆå¹‚ç­‰å’Œäº‹åŠ¡ï¼‰\n\n**å¹‚ç­‰æ€§ï¼ˆIdempotenceï¼‰**\n\næŒ‡çš„æ˜¯æŸäº›æ“ä½œæˆ–å‡½æ•°èƒ½å¤Ÿè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œä½†æ¯æ¬¡å¾—åˆ°çš„ç»“æœéƒ½æ˜¯ä¸å˜çš„ã€‚\n\n0.11.0.0ä¹‹åå¼•å…¥äº†å¹‚ç­‰æ€§Producerï¼Œå¼€å¯æ–¹æ³•ï¼š\n\n```java\nprops.put(\"enable.idempotence\", true);\n// or\nprops.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);\n```\n\nä¸ºå®ç°å¹‚ç­‰æ€§ï¼ŒKafkaåº•å±‚è®¾è®¡æ¶æ„ä¸­å¼•å…¥äº†ProducerIDå’ŒSequenceNumber\n\n- ProducerIDï¼šåœ¨æ¯ä¸ªæ–°çš„Produceråˆå§‹åŒ–æ—¶ï¼Œä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ProducerIDï¼Œè¿™ä¸ªProducerIDå¯¹å®¢æˆ·ç«¯ä½¿ç”¨è€…æ˜¯ä¸å¯è§çš„ã€‚\n- SequenceNumberï¼šå¯¹äºæ¯ä¸ªProducerIDï¼ŒProducerå‘é€æ•°æ®çš„æ¯ä¸ªTopicå’ŒPartitionéƒ½å¯¹åº”ä¸€ä¸ªä»0å¼€å§‹å•è°ƒé€’å¢çš„SequenceNumberå€¼ã€‚\n\nProduceråœ¨æ¯æ¡æ¶ˆæ¯ä¸­é™„å¸¦äº†PIDï¼ˆProducerIDï¼‰å’ŒSequenceNumberã€‚Broker ä¸ºæ¯ä¸ª Topic çš„æ¯ä¸ª Partition éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå½“å‰å†™æˆåŠŸçš„æ¶ˆæ¯çš„æœ€å¤§ PID-SequenceNumber å…ƒç»„ï¼Œå½“ Broker æ”¶åˆ°ä¸€ä¸ªæ¯”å½“å‰æœ€å¤§ PID-Sequence Number å…ƒç»„å°ï¼ˆæˆ–ç­‰äºï¼‰çš„ SequenceNumber æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šä¸¢å¼ƒè¯¥æ¶ˆæ¯ï¼Œä»¥é¿å…é€ æˆæ•°æ®é‡å¤å­˜å‚¨ã€‚\n\n**å¹‚ç­‰æ€§Producer** \n\nèƒ½å¤Ÿä¿è¯æŸä¸ªä¸»é¢˜çš„**ä¸€ä¸ªåˆ†åŒºä¸Š**ä¸å‡ºç°é‡å¤æ¶ˆæ¯ï¼Œå®ƒæ— æ³•å®ç°å¤šä¸ªåˆ†åŒºçš„å¹‚ç­‰æ€§ã€‚æˆ–è€…å½“Producerè¿›ç¨‹é‡å¯åï¼Œè¿™ç§å¹‚ç­‰æ€§ä¹Ÿä¼šä¸¢å¤±ã€‚\n\nè¦å®ç°å¤šåˆ†åŒºåŠå¤šä¼šè¯ä¸Šçš„æ¶ˆæ¯ä¸é‡å¤ï¼Œéœ€è¦äº‹åŠ¡ï¼ˆTransactionï¼‰æˆ–ä¾èµ–äº‹åŠ¡å‹Producerã€‚\n\n**äº‹åŠ¡ï¼ˆTransactionï¼‰**\n\nä¸»è¦æ˜¯åœ¨ read committed éš”ç¦»çº§åˆ«ä¸Šåšäº‹æƒ…ã€‚å®ƒèƒ½ä¿è¯å¤šæ¡æ¶ˆæ¯åŸå­æ€§åœ°å†™å…¥åˆ°ç›®æ ‡åˆ†åŒºï¼ŒåŒæ—¶ä¹Ÿèƒ½ä¿è¯ Consumer åªèƒ½çœ‹åˆ°äº‹åŠ¡æˆåŠŸæäº¤çš„æ¶ˆæ¯ã€‚\n\n**äº‹åŠ¡å‹ Producer**\n\näº‹åŠ¡å‹ Producer èƒ½å¤Ÿä¿è¯å°†æ¶ˆæ¯==åŸå­æ€§==åœ°å†™å…¥åˆ°å¤šä¸ªåˆ†åŒºä¸­ã€‚è¿™æ‰¹æ¶ˆæ¯è¦ä¹ˆå…¨éƒ¨å†™å…¥æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚å¦å¤–ï¼Œäº‹åŠ¡å‹ Producer ä¹Ÿä¸æƒ§è¿›ç¨‹çš„é‡å¯ã€‚Producer é‡å¯å›æ¥åï¼ŒKafka ä¾ç„¶ä¿è¯å®ƒä»¬å‘é€æ¶ˆæ¯çš„ç²¾ç¡®ä¸€æ¬¡å¤„ç†ã€‚\n\n```properties\n// å¼€å¯äº‹åŠ¡å‹Producer\nenable.idempotence=true\n```\n\nåœ¨Consumerç«¯è¯»å–äº‹åŠ¡å‹Producerå‘é€çš„æ¶ˆæ¯ï¼Œè®¾ç½® `isolation.level`å‚æ•°ï¼š\n\n1. `read_uncommitted`ï¼šé»˜è®¤å€¼ï¼ŒConsumerèƒ½è¯»å–Kafkaå†™å…¥çš„ä»»ä½•æ¶ˆæ¯\n2. `read_committed`ï¼šConsumeråªä¼šè¯»å–äº‹åŠ¡å‹ProduceræˆåŠŸæäº¤çš„äº‹åŠ¡å†™å…¥çš„æ¶ˆæ¯ï¼Œä¹Ÿèƒ½çœ‹åˆ°éäº‹åŠ¡å‹Producerå†™å…¥çš„æ‰€æœ‰æ¶ˆæ¯ã€‚\n\n## æ¶ˆè´¹è€…ç»„\n\nConsumer Group æ˜¯ Kafka æä¾›çš„å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹è€…æœºåˆ¶ï¼Œç»„å†…çš„å¤šä¸ªæ¶ˆè´¹è€…æˆ–æ¶ˆè´¹è€…å®ä¾‹å…±äº«ä¸€ä¸ªå…¬å…±çš„IDï¼ˆGroup IDï¼‰ï¼Œç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåœ¨ä¸€èµ·æ¶ˆè´¹è®¢é˜…ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºã€‚\n\nå¦‚æœæ‰€æœ‰å®ä¾‹éƒ½å±äºåŒä¸€ä¸ª Groupï¼Œé‚£ä¹ˆå®ƒå®ç°çš„å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ï¼›å¦‚æœæ‰€æœ‰å®ä¾‹åˆ†åˆ«å±äºä¸åŒçš„ Groupï¼Œé‚£ä¹ˆå®ƒå®ç°çš„å°±æ˜¯å‘å¸ƒ / è®¢é˜…æ¨¡å‹ã€‚Â·\n\nç†æƒ³æƒ…å†µä¸‹ï¼ŒConsumer å®ä¾‹çš„æ•°é‡åº”è¯¥ç­‰äºè¯¥ Group è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ€»æ•°ã€‚\n\nåœ¨æ–°ç‰ˆæœ¬çš„ Consumer Group ä¸­ï¼ŒKafka ç¤¾åŒºé‡æ–°è®¾è®¡äº† Consumer Group çš„ä½ç§»ç®¡ç†æ–¹å¼ï¼Œé‡‡ç”¨äº†å°†ä½ç§»ä¿å­˜åœ¨ Kafka å†…éƒ¨ä¸»é¢˜ï¼ˆ __consumer_offsetsï¼‰çš„æ–¹æ³•ã€‚\n\nRebalance æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ª Consumer Group ä¸‹çš„æ‰€æœ‰ Consumer å¦‚ä½•è¾¾æˆä¸€è‡´ï¼Œæ¥åˆ†é…è®¢é˜…Topic çš„æ¯ä¸ªåˆ†åŒºã€‚\n\nè§¦å‘Rebalanceçš„3ä¸ªæ¡ä»¶ï¼š\n\n1. ç»„æˆå‘˜æ•°å‘ç”Ÿå˜æ›´ã€‚æœ‰æ–°çš„ConsumeråŠ å…¥æˆ–æœ‰Consumerå´©æºƒä¸‹çº¿\n2. è®¢é˜…ä¸»é¢˜æ•°å‘ç”Ÿå˜æ›´ã€‚Consumer Group å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼è®¢é˜…ä¸»é¢˜ï¼Œæ¯”å¦‚`consumer.subscribe(Pattern.compile(â€œt.*câ€)) `ï¼Œå½“æœ‰æ–°çš„ä¸»é¢˜åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼åˆ™ä¼šè§¦å‘\n3. è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜æ›´ã€‚\n\næ¯ä¸ªConsumerä¼šå®šæœŸåœ°å‘Coordinatorå‘é€å¿ƒè·³ï¼Œå¦‚æœConsumerä¸èƒ½åŠæ—¶åœ°å‘é€å¿ƒè·³è¯·æ±‚ï¼ŒCoordinatorå°±ä¼šå°†å…¶ä»Groupä¸­ç§»é™¤ï¼Œå¼€å¯æ–°ä¸€è½®çš„Rebalanceã€‚è¿™ä¸ªæ—¶é—´ç”±å‚æ•°`session.timeout.ms`æ§åˆ¶ï¼Œé»˜è®¤10sã€‚å‚æ•°`heartbeat.interval.ms`æ§åˆ¶å¿ƒè·³è¯·æ±‚çš„é¢‘ç‡ï¼ŒCoordinatoré€šè¿‡å¿ƒè·³è¯·æ±‚çš„å“åº”é€šçŸ¥Consumerå¼€å¯Rebalanceã€‚å‚æ•°`max.poll.interval.ms`å‚æ•°é™å®šConsumerç«¯ä¸¤æ¬¡pollè°ƒç”¨çš„æœ€å¤§é—´éš”ï¼Œé»˜è®¤5minï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè¡¨æ˜Consumeræ— æ³•é¡ºåˆ©åœ°æ¶ˆè´¹å®Œpollçš„æ¶ˆæ¯ï¼ŒConsumerä¼šä¸»åŠ¨ç¦»å¼€Groupï¼ŒCoordinatorä¼šå¼€å¯æ–°ä¸€è½®çš„Rebalanceã€‚\n\nä½†æ˜¯ï¼ŒRebalanceå‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰Consumerå®ä¾‹éƒ½ä¼šåœæ­¢æ¶ˆè´¹ï¼Œç›´åˆ°Rebalanceå®Œæˆã€‚Rebalanceè¿‡ç¨‹ä¸­ï¼Œç”±åè°ƒè€…Coordinatorç»„ä»¶å¸®åŠ©å®Œæˆè®¢é˜…ä¸»é¢˜åˆ†åŒºçš„åˆ†é…ï¼ŒCoordinatorä¸“é—¨ä¸ºConsumer Group æœåŠ¡ï¼Œè´Ÿè´£ä¸ºGroupæ‰§è¡ŒRebalanceä»¥åŠæä¾›ä½ç§»ç®¡ç†å’Œç»„æˆå‘˜ç®¡ç†ç­‰ã€‚æ‰€æœ‰Brokeråœ¨å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºå’Œå¼€å¯ç›¸åº”çš„Coordinatorç»„ä»¶ã€‚\n\n**åè°ƒè€…Coordinator**\n\nåè°ƒè€…ä¸“é—¨ä¸ºConsumer Group æœåŠ¡ï¼Œè´Ÿè´£ä¸ºGroupæ‰§è¡ŒRebalanceä»¥åŠæä¾›ä½ç§»ç®¡ç†å’Œç»„æˆå‘˜ç®¡ç†ã€‚Consumeråœ¨æäº¤ä½ç§»æ—¶ï¼Œå…¶å®æ˜¯å‘Coordinatoræ‰€åœ¨çš„Brokeræäº¤ä½ç§»ï¼›å½“Consumerå¯åŠ¨æ—¶ï¼Œä¹Ÿæ˜¯å‘Coordinatoræ‰€åœ¨çš„Brokerå‘é€å„ç§è¯·æ±‚ï¼Œç„¶åç”±Coordinatoræ‰§è¡Œæ¶ˆè´¹è€…ç»„çš„æ³¨å†Œã€æˆå‘˜ç®¡ç†ç­‰å…ƒæ•°æ®ç®¡ç†ã€‚\n\næ‰€æœ‰çš„Brokeréƒ½æœ‰å„è‡ªçš„Coordinatorç»„ä»¶ã€‚\n\n1. é€šè¿‡è®¡ç®—`partitionId = Math.abs(groupId.hashCode() % offsetTopicPartitionCount)`ç¡®å®šç”±ä½ç§»ä¸»é¢˜çš„å“ªä¸ªåˆ†åŒºæ¥ä¿å­˜Groupçš„æ•°æ®ã€‚\n2. æ‰¾åˆ°è¯¥åˆ†åŒºçš„Leaderå‰¯æœ¬ï¼Œè¯¥Brokerå°±æ˜¯å¯¹äºçš„Coordinatorã€‚\n\n**ä½ç§»ä¸»é¢˜ Offset Topic**\n\n`__consumer_offsets`ä½¿ç”¨Kafkaè‡ªå®šä¹‰çš„æ¶ˆæ¯æ ¼å¼ï¼Œä¸»é¢˜ä¸­çš„keyåŒ…å«3éƒ¨åˆ†å†…å®¹ï¼šGroupIDï¼Œä¸»é¢˜åï¼Œåˆ†åŒºå·ã€‚\n\nä¸»é¢˜æ¶ˆæ¯ä½“çš„æ ¼å¼ï¼š\n\n1. åŒ…å«ä½ç§»æ•°æ®ã€æ—¶é—´æˆ³å’Œè‡ªå®šä¹‰çš„æ•°æ®\n2. ç”¨äºä¿å­˜Consumer Groupä¿¡æ¯çš„æ¶ˆæ¯\n3. ç”¨äºåˆ é™¤Groupè¿‡æœŸä½ç§»ç”šè‡³æ˜¯åˆ é™¤Groupçš„æ¶ˆæ¯ï¼ˆæ¶ˆæ¯ä½“ä¸ºnullï¼Œå½“æŸä¸ªConsumer Groupä¸‹æ‰€æœ‰Consumeréƒ½åœæ­¢ä¸”ä½ç§»æ•°æ®éƒ½å·²è¢«åˆ é™¤ï¼ŒKafkaä¼šå‘ä½ç§»ä¸»é¢˜çš„å¯¹åº”åˆ†åŒºå†™å…¥ï¼‰\n\nå½“Kafkaé›†ç¾¤ä¸­ç¬¬ä¸€ä¸ªConsumerå¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä½ç§»ä¸»é¢˜ã€‚`__consumer_offsets`ä¸»é¢˜çš„åˆ†åŒºæ•°é€šè¿‡Brokerç«¯å‚æ•°`offset.topic.num.partitions`è®¾ç½®ï¼Œé»˜è®¤50ï¼Œå‰¯æœ¬æ•°é»˜è®¤3ã€‚\n\nå¦‚æœConsumeré‡‡ç”¨çš„æ˜¯è‡ªåŠ¨æäº¤ä½ç§»çš„æ–¹å¼ï¼Œå°±ä¼šæ— é™æœŸåœ°å‘`__consumer_offsets`ä¸­å†™å…¥ä¸»é¢˜æ¶ˆæ¯ã€‚æ­¤æ—¶éœ€è¦Kafkaå®šæœŸåˆ é™¤è¿‡æœŸæ¶ˆæ¯ã€‚Kafkaä½¿ç”¨çš„æ˜¯`Compact`ç­–ç•¥ï¼Œå³å¯¹äºä¸»é¢˜ä¸­åŒä¸€ä¸ªKeyçš„å¤šæ¡æ¶ˆæ¯ï¼Œåªä¿ç•™æœ€æ–°çš„æ¶ˆæ¯ã€‚Kafkaæä¾›äº†ä¸“é—¨çš„åå°çº¿ç¨‹ï¼ˆ`Log Cleaner`ï¼‰å®šæœŸå·¡æ£€å¾…Compactçš„ä¸»é¢˜ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å¯åˆ é™¤æ•°æ®ã€‚\n\n## å¤šçº¿ç¨‹æ¶ˆè´¹è€…å®ä¾‹\n\n`KafkaConsumer`æ˜¯å•çº¿ç¨‹è®¾è®¡çš„ï¼ˆå¿ƒè·³çº¿ç¨‹æ˜¯å•ç‹¬çš„çº¿ç¨‹ï¼‰ï¼Œèƒ½ç®€åŒ–Consumerç«¯çš„è®¾è®¡ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨Consumerè·å–åˆ°æ¶ˆæ¯åï¼Œå¤šçº¿ç¨‹å¤„ç†æ¶ˆæ¯ã€‚\n\n`KafkaConsumer`ç±»ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­å…±äº«ä¸€ä¸ª`KafkaConsumer`å®ä¾‹ï¼Œç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å¯ä»¥å¤šçº¿ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªä¸“å±çš„`KafkaConsumer`å®ä¾‹ï¼Œè´Ÿè´£å®Œæ•´çš„æ¶ˆæ¯è·å–ã€å¤„ç†æµç¨‹ã€‚\n\n## æ¶ˆè´¹è¿›åº¦\n\nKafkaç›‘æ§çš„æ˜¯åˆ†åŒºçš„Lagï¼Œå¦‚æœè¦è®¡ç®—ä¸»é¢˜çš„Lagï¼Œéœ€è¦æ‰‹åŠ¨æ±‡æ€»ç´ æœ‰åˆ†åŒºçš„Lagã€‚å¦‚æœæ¶ˆè´¹è€…é€Ÿåº¦èµ¶ä¸ä¸Šç”Ÿäº§è€…çš„é€Ÿåº¦ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸åœ¨æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ä¸­ï¼Œè€Œæ˜¯ç£ç›˜ä¸­ï¼Œè¿™æ ·è¿™äº›æ•°æ®å°±ä¸èƒ½é€šè¿‡é›¶æ‹·è´ä¼ è¾“ï¼Œè¿›ä¸€æ­¥æ‹‰å¤§æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„å·®è·ï¼ŒLagè¶Šæ¥è¶Šå¤§ã€‚\n\næœ‰3ç§æ–¹æ³•ç›‘æ§æ¶ˆè´¹è¿›åº¦ï¼š\n\n1. Kafkaè‡ªå¸¦çš„å‘½ä»¤è¡Œå·¥å…·`kafka-consumer-groups`è„šæœ¬\n2. Kafka Java Consumer APIç¼–ç¨‹\n3. Kafkaè‡ªå¸¦çš„JMXç›‘æ§æŒ‡æ ‡\n\n## å‰¯æœ¬\n\nå‰¯æœ¬æœºåˆ¶ï¼Œä¹Ÿç§°å¤‡ä»½æœºåˆ¶ï¼Œé€šå¸¸æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šå°æœºå™¨ä¸Šæœ‰ç›¸åŒçš„æ•°æ®æ‹·è´ã€‚\n\n1. æä¾›æ•°æ®å†—ä½™ã€‚å³ä½¿éƒ¨åˆ†ç»„ä»¶å¤±æ•ˆï¼Œç³»ç»Ÿä¾ç„¶èƒ½ç»§ç»­è¿è½¬ï¼Œæé«˜æ•´ä½“å¯ç”¨æ€§å’Œæ•°æ®æŒä¹…æ€§ã€‚\n2. æé«˜é«˜ä¼¸ç¼©æ€§ã€‚æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œèƒ½é€šè¿‡å¢åŠ æœºå™¨çš„æ–¹å¼æé«˜è¯»å†™æ€§èƒ½ï¼Œè¿›è€Œæé«˜ååé‡ã€‚\n3. æ”¹å–„æ•°æ®å±€éƒ¨æ€§ã€‚è¿è¡Œæ•°æ®æ”¾å…¥ä¸ç”¨æˆ·åœ°ç†ä½ç½®ç›¸è¿‘çš„åœ°æ–¹ã€‚\n\nKafkaçš„å‰¯æœ¬æœºåˆ¶ä¸å…¶ä»–åˆ†å¸ƒå¼ç³»ç»Ÿä¸åŒï¼ŒKafkaçš„è¿½éšè€…å‰¯æœ¬ä¸å¯¹å¤–æé«˜æœåŠ¡ï¼Œæ‰€æœ‰çš„è¯·æ±‚å¿…é¡»ç”±Leaderå‰¯æœ¬å¤„ç†ï¼Œè¿½éšè€…å‰¯æœ¬çš„å”¯ä¸€ä»»åŠ¡å°±æ˜¯ä»Leaderå‰¯æœ¬==å¼‚æ­¥æ‹‰å–==æ¶ˆæ¯ï¼Œå†™å…¥åˆ°è‡ªå·±çš„æäº¤æ—¥å¿—ç§ï¼Œä»è€Œå®ç°ä¸Leaderå‰¯æœ¬çš„åŒæ­¥ã€‚å½“Leaderå‰¯æœ¬æŒ‚äº†ï¼ŒKafkaä¾æ‰˜äºZookeeperæä¾›çš„ç›‘æ§åŠŸèƒ½å¯ä»¥å®æ—¶æ„ŸçŸ¥ï¼Œå¹¶ç«‹å³å¼€å¯æ–°ä¸€è½®çš„Leaderé€‰ä¸¾ã€‚\n\nè¿™ç§æœºåˆ¶æœ‰ä¸¤ä¸ªå¥½å¤„ï¼š\n\n1. å®ç°â€œRead-your-writesâ€ï¼Œç”Ÿäº§è€…å†™å…¥æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…é©¬ä¸Šå¯ä»¥è¯»å–åˆ°ï¼Œè€Œä¸ç”¨ç­‰å¾…å¼‚æ­¥åŒæ­¥å®Œæˆã€‚\n2. å®ç°å•è°ƒè¯»ï¼ˆMonotonic Readsï¼‰ï¼Œç”±äºå‰¯æœ¬çš„åŒæ­¥è¿›åº¦ä¸ä¸€æ ·ï¼Œé¿å…ä»ä¸åŒçš„å‰¯æœ¬ä¸Šè¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚\n\n**ISR ï¼ˆIn-Sync Replicasï¼‰**\n\nISRå‰¯æœ¬é›†åˆæ˜¯ä¸€ä¸ªåŠ¨æ€è°ƒæ•´çš„é›†åˆï¼Œé›†åˆä¸­çš„å‰¯æœ¬éƒ½è¢«è®¤ä¸ºæ˜¯å’ŒLeaderå‰¯æœ¬åŒæ­¥çš„ï¼ŒLeaderå‰¯æœ¬æ˜¯å¤©ç„¶å°±åœ¨ISRä¸­çš„ï¼ˆå¦‚æœLeaderå‰¯æœ¬æŒ‚äº†ï¼Œé›†åˆå°±æ˜¯ç©ºçš„ï¼‰ã€‚Brokerç«¯å‚æ•°`replica.lag.time.max.ms`å«ä¹‰æ˜¯è¿½éšè€…å‰¯æœ¬èƒ½å¤Ÿè½åLeaderå‰¯æœ¬çš„æœ€å¤§æ—¶é—´é—´éš”ï¼ˆé»˜è®¤10sï¼‰ï¼Œå¦‚æœè¿½éšè€…å‰¯æœ¬è½åè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œå°±ä¼šè¢«è¸¢å‡ºISRé›†åˆï¼Œç­‰é‡æ–°è¿½ä¸Šäº†ä¼šè¢«é‡æ–°åŠ å›ISRã€‚\n\næ‰€æœ‰ä¸åœ¨ISRé›†åˆä¸­çš„å­˜æ´»å‰¯æœ¬ç§°ä¸º==éåŒæ­¥å‰¯æœ¬==ï¼Œå¦‚æœå…è®¸é€‰ä¸¾è¿™ç§å‰¯æœ¬çš„è¿‡ç¨‹ç§°ä¸º==Unclean é¢†å¯¼è€…é€‰ä¸¾==ï¼ŒBrokerç«¯å‚æ•°`unclean.leader.election.enable`å¯ä»¥æ§åˆ¶æ˜¯å¦å…è®¸éåŒæ­¥å‰¯æœ¬å‚ä¸Leaderé€‰ä¸¾ã€‚å¦‚æœå¼€å¯ï¼Œå¯èƒ½å›é€ æˆæ•°æ®ä¸¢å¤±ï¼Œåä¹‹ï¼Œåˆ™èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼ŒKafkaèµ‹äºˆä½ é€‰æ‹©CPè¿˜æ˜¯APçš„æƒåˆ©ã€‚",
      "data": {
        "title": "Kafka æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ç¬”è®°",
        "date": "2024-12-08 11:01:07",
        "tags": [
          "kafka",
          "geektime",
          "note"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/kafka-he-xin-ji-zhu-yu-shi-zhan-bi-ji.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## æœ¯è¯­\n\nå‘å¸ƒè®¢é˜…çš„å¯¹è±¡æ˜¯==ä¸»é¢˜ï¼ˆTopicï¼‰==ï¼Œå‘ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç§°ä¸º==ç”Ÿäº§è€…ï¼ˆProducerï¼‰==ï¼Œè®¢é˜…ä¸»é¢˜æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç§°ä¸º==æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰==ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ç»Ÿç§°ä¸º==å®¢æˆ·ç«¯ï¼ˆClientsï¼‰==ã€‚\n\nKafka çš„æœåŠ¡å™¨ç«¯ç”±è¢«ç§°ä¸º ==Broker== çš„==æœåŠ¡è¿›ç¨‹==æ„æˆï¼Œå³ä¸€ä¸ª Kafka é›†ç¾¤ç”±å¤šä¸ª Broker ç»„æˆï¼ŒBroker è´Ÿè´£æ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œä»¥åŠå¯¹æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–ã€‚è™½ç„¶å¤šä¸ªBrokerå¯ä»¥åŒæ—¶è¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼Œä½†æ˜¯é€šå¸¸å°†ä¸åŒçš„Brokeråˆ†æ•£åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œä»¥ä¿è¯é«˜å¯ç”¨ã€‚\n\nå®ç°é«˜å¯ç”¨çš„å¦ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯==å¤‡ä»½æœºåˆ¶ï¼ˆReplicationï¼‰==ã€‚å¤‡ä»½çš„æ€æƒ³å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç›¸åŒçš„æ•°æ®æ‹·è´åˆ°å¤šå°æœºå™¨ä¸Šï¼Œè€Œè¿™äº›ç›¸åŒçš„æ•°æ®æ‹·è´åœ¨ Kafka ä¸­è¢«ç§°ä¸º==å‰¯æœ¬ï¼ˆReplicaï¼‰==ã€‚å‰¯æœ¬çš„æ•°é‡æ˜¯å¯ä»¥é…ç½®çš„ï¼Œè¿™äº›å‰¯æœ¬ä¿å­˜ç€ç›¸åŒçš„æ•°æ®ï¼Œä½†å´æœ‰ä¸åŒçš„è§’è‰²å’Œä½œç”¨ã€‚Kafka å®šä¹‰äº†ä¸¤ç±»å‰¯æœ¬ï¼š==é¢†å¯¼è€…å‰¯æœ¬ï¼ˆLeader Replicaï¼‰==å’Œ==è¿½éšè€…å‰¯æœ¬ï¼ˆFollower Replicaï¼‰==ã€‚å‰è€…å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™é‡Œçš„å¯¹å¤–æŒ‡çš„æ˜¯ä¸å®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œäº¤äº’ï¼›è€Œåè€…åªæ˜¯è¢«åŠ¨åœ°è¿½éšé¢†å¯¼è€…å‰¯æœ¬è€Œå·²ï¼Œä¸èƒ½ä¸å¤–ç•Œè¿›è¡Œäº¤äº’ã€‚",
      "fileName": "kafka-he-xin-ji-zhu-yu-shi-zhan-bi-ji"
    },
    {
      "content": "## ä¸€ã€äº†è§£Electron\n\nElectron æ˜¯ç”± Github å¼€å‘ï¼Œç”¨ HTMLï¼ŒCSS å’Œ JavaScript æ¥æ„å»ºè·¨å¹³å°æ¡Œé¢åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå¼€æºåº“ã€‚æœ€åˆçš„æ—¶å€™æ˜¯å±äº Github å¼€æºä»£ç ç¼–è¾‘å™¨ Atom çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ 2014 æ˜¥å­£è¿™ä¸¤ä¸ªé¡¹ç›®ç›¸ç»§å¼€æºã€‚\n\n<!-- more -->\n\n**é‡Œç¨‹ç¢‘äº‹ä»¶**\n\n| æ—¶é—´         | é‡Œç¨‹ç¢‘                                         |\n| ------------ | ---------------------------------------------- |\n| 2013 å¹´ 4 æœˆ | Atom Shell é¡¹ç›®å¯åŠ¨ ã€‚                         |\n| 2014 å¹´ 5 æœˆ | Atom Shell è¢«å¼€æº ã€‚                           |\n| 2015 å¹´ 4 æœˆ | Atom Shell è¢«é‡å‘½åä¸º Electron ã€‚              |\n| 2016 å¹´ 5 æœˆ | Electron å‘å¸ƒäº† v1.0.0 ç‰ˆæœ¬ ã€‚                 |\n| 2016 å¹´ 5 æœˆ | Electron æ„å»ºçš„åº”ç”¨ç¨‹åºå¯ä¸Šæ¶ Mac App Store ã€‚ |\n| 2016 å¹´ 8 æœˆ | Windows Store æ”¯æŒ Electron æ„å»ºçš„åº”ç”¨ç¨‹åº ã€‚  |\n\n**Electronä¼˜ç‚¹**ï¼š\n\n+ è·¨å¹³å°ï¼Œé™ä½å¼€å‘æˆæœ¬ã€‚\n+ å¼ºå¤§çš„ npm ç”Ÿæ€ï¼Œæå‡å¼€å‘æ•ˆç‡\n+ ç®€å•æ˜“å­¦çš„ JavaScript è¯­è¨€ï¼ŒåŸºäº Web çš„æ¡Œé¢å¼€å‘ï¼Œä¸ç”¨å†å»å­¦ä¹  C# æˆ–è€… Swiftï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚\n+ è‹¹æœå•†åº—å’Œå¾®è½¯å•†åº—éƒ½æ”¯æŒæäº¤ Electron åº”ç”¨ç¨‹åºã€‚\n+ å¼€å‘é€Ÿåº¦å¿«ï¼Œé€‚åˆéœ€è¦æ®µæ—¶é—´å†…çœ‹åˆ°æ•ˆæœçš„åº”ç”¨å¼€å‘\n\n**ç¼ºç‚¹**ï¼š\n\n+ æ‰“åŒ…ä½“ç§¯å¤§\n+ Chromiumæ¯”è¾ƒåƒå†…å­˜\n+ è·¨å¹³å°å¹¶ä¸ä»£è¡¨ä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œï¼Œéœ€è¦åœ¨å„ä¸ªç³»ç»Ÿä¸Šæµ‹è¯•ã€æ‰“åŒ…\n+ ç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œå¤šä¸ªç‰ˆæœ¬é—´æœ‰å…¼å®¹æ€§çš„é—®é¢˜\n\n**è·¨å¹³å°å¼€å‘æ¡†æ¶æ¯”è¾ƒ**\n| æ¡†æ¶                  | æ”¯æŒè¯­è¨€             | ä¼˜ç¼ºç‚¹                                                       |\n| --------------------- | -------------------- | ------------------------------------------------------------ |\n| Qt                    | C++/Python           | ä¼˜ç‚¹ï¼šæµè¡Œã€ç¨³å®šï¼Œå†…ç½®è‡ªç»˜å¼•æ“ï¼Œä¿è¯ä¸åŒç³»ç»Ÿä¸Šç•Œé¢ä¸€è‡´ï¼ŒPyQtå¯ä»¥ä½¿ç”¨Pythonå¼€å‘<br/>ç¼ºç‚¹ï¼šé«˜åˆ†å±ç¼©æ”¾æ˜¾ç¤ºé—®é¢˜ï¼Œå•†ä¸šéœ€æˆæƒï¼Œå…è´¹ç‰ˆæœ¬ç‰ˆæƒé—®é¢˜ |\n| GTK                   | C/C++/JS/Rustç­‰      | ä¼˜ç‚¹ï¼šè‡ªç»˜å¼•æ“ï¼Œæä¾›å¤§é‡ç³»ç»Ÿç›¸å…³APIï¼Œå•†ä¸šæˆæƒå‹å¥½<br/>ç¼ºç‚¹ï¼šåªåœ¨Linuxç¯å¢ƒä¸‹æµè¡Œï¼Œå…¶ä»–ç¯å¢ƒä¸‹å¼€å‘å›°éš¾ |\n| wxWidgets             | C++                  | ä¼˜ç‚¹ï¼šç¨³å®šã€æˆç†Ÿ<br/>ç¼ºç‚¹ï¼šæ²¡æœ‰è‡ªç»˜å¼•æ“ï¼Œç•Œé¢é£æ ¼ä¸ç»Ÿä¸€      |\n| FLTK                  | C++                  | ä¼˜ç‚¹ï¼šè½»é‡ï¼ŒOpenGLå¼•æ“ï¼Œæœ‰Rustç»‘å®šfltk-rs<br/>ç¼ºç‚¹ï¼šç»˜å›¾APIå°‘ |\n| Duilib                | C++                  | ä¼˜ç‚¹ï¼šå¼€æºã€æœ‰ä¸å°‘å¤§å‚ä½¿ç”¨<br/>ç¼ºç‚¹ï¼šåªæ”¯æŒWindowsã€ä¸æ”¯æŒé«˜åˆ†å±ã€å‡ ä¹æ²¡æœ‰ç³»ç»Ÿçº§APIï¼Œæ›´æ–°ä¸åŠæ—¶ï¼Œå¼€å‘ç¯å¢ƒæ­å»ºéº»çƒ¦ |\n| Sciter                | C++/Rust/Go/Pythonç­‰ | ä¼˜ç‚¹ï¼šç²¾ç®€ï¼Œä¸ªäººä½¿ç”¨å…è´¹ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªæµè§ˆå™¨æ ¸å¿ƒï¼Œè‡ªç ”è„šæœ¬ç±»ä¼¼JS<br/>ç¼ºç‚¹ï¼šé—­æºï¼Œå•†ä¸šæ”¶è´¹ï¼Œä¸æ”¯æŒFlexå¸ƒå±€ï¼Œéå®˜æ–¹ç»‘å®šè´¨é‡å·®ï¼Œç¤¾åŒºä¸æˆç†Ÿ |\n| CEF                   | C/C++/Go/Python/Java | ä¼˜ç‚¹ï¼šåŸºäºChromiumï¼Œè£…æœºé‡å¤§ï¼Œæ”¯æŒHTML/CSS/JSç‰¹æ€§<br/>ç¼ºç‚¹ï¼šä½“ç§¯å¤§ã€å‡ ä¹ä¸æä¾›ç³»ç»ŸåŠAPIï¼Œç‰ˆæœ¬å‘å¸ƒé¢‘ç¹ |\n| MAUI                  | C#                   | ä¼˜ç‚¹ï¼šå¾®è½¯å¼€å‘ï¼Œæœ‰è‡ªç»˜å¼•æ“ï¼Œæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯<br/>ç¼ºç‚¹ï¼šæš‚æ— ç¨³å®šç‰ˆï¼Œç•Œé¢æœ‰XAMLæè¿° |\n| Compose Multiplatform | Kotlin               | ä¼˜ç‚¹ï¼šæ–°ï¼Œè‡ªç»˜å¼•æ“Skiaï¼ˆGooleï¼‰<br/>ç¼ºç‚¹ï¼šç¨³å®šæ¬ ç¼ºï¼Œæ‰“åŒ…éœ€è¦å°è£…JRE |\n| flutter-desktop       | Dart                 | ä¼˜ç‚¹ï¼šæ–°ï¼Œè‡ªç»˜å¼•æ“Skiaï¼Œæ”¯æŒFFI<br/>ç¼ºç‚¹ï¼šä¸ç¨³å®šï¼ŒDartå¤§æ‹¬å·åµŒå¥—ä¸å‹å¥½ï¼Œæ‰“åŒ…ä½“ç§¯å¤§ |\n| webview2              | C#/C++               | ä¼˜ç‚¹ï¼šå¯ä»¥å¤ç”¨ç³»ç»Ÿå½“ä¸­å·²å­˜åœ¨çš„webview2äºŒè¿›åˆ¶èµ„æºï¼Œæ‰“åŒ…ä½“ç§¯å°<br/>ç¼ºç‚¹ï¼šåªæ”¯æŒWindowsï¼Œé—­æº |\n| TAURI                 | Rust                 | ä¼˜ç‚¹ï¼šå®‰è£…åŒ…å°ï¼Œæ–°ï¼Œå¼€æºï¼Œæœ€è¿‘æ¯”è¾ƒç«<br/>ç¼ºç‚¹ï¼šæ–°ï¼Œä¸ç¨³å®šï¼Œwebviewæœ‰çš„é—®é¢˜TARIéƒ½æœ‰ |\n| NW.jsï¼ˆnode-webkitï¼‰  | JS                   | ä¼˜ç‚¹ï¼šå¼€æºï¼Œå¼€å‘æ–¹ä¾¿<br/>ç¼ºç‚¹ï¼šå°è£…çš„ç³»ç»Ÿçº§APIä¸å¦‚Electronï¼Œç”Ÿæ€ä¸å®Œå–„ï¼ŒAPIä¸ç¨³å®š |\n| Electron              | JS                   | ä¼˜ç‚¹ï¼šä½œè€…æ˜¯NW.jsåŸæˆå‘˜ï¼ŒGithubï¼Œå¾®è½¯ç­‰å¤§å‚åœ¨ç”¨ï¼ˆgithubå®¢æˆ·ç«¯ï¼ŒVSCodeï¼‰ï¼Œç”Ÿæ€å®Œå–„ï¼Œç³»ç»Ÿçº§APIå¤š<br/>ç¼ºç‚¹ï¼šæ‰“åŒ…ä½“ç§¯å¤§ |\n| ImGui                 | C++                  | ä¼˜ç‚¹ï¼šå¯¹æ¸¸æˆå¼€å‘è€…å‹å¥½ï¼Œæ”¯æŒå¤šç§å¼•æ“æ¯”å¦‚OpenGLï¼ŒDirectxï¼ŒVulkanç­‰ï¼Œæ‰“åŒ…ä½“ç§¯å°<br/>ç¼ºç‚¹ï¼šå¾ªç¯ç»˜åˆ¶æ•´ä¸ªç•Œé¢ï¼Œæ¶ˆè€—CPUï¼Œæœ‰ä¸€äº›å°é—®é¢˜ |\n\nå¦‚æœæ˜¯ä¼šC/C++ï¼Œå¯é€‰çš„æ¡†æ¶å°±å¾ˆå¤šï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„æ¡†æ¶ï¼Œä½†æ˜¯å¦‚æœä¼šä¸€ç‚¹JSï¼Œè¿™é‡Œçš„Electronå¯èƒ½æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚é¦–å…ˆæ˜¯å¼€æºï¼Œå¼€å‘è¯­è¨€JSç›¸å¯¹å¤§ä¼—ï¼Œé‡åˆ°é—®é¢˜ä¹Ÿæ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼›å…¶æ¬¡æ˜¯Electronçš„ç”Ÿæ€å®Œå–„ï¼Œæœ‰æ¯”è¾ƒå¤šçš„å¤§å‚åœ¨ä½¿ç”¨ï¼Œæ¯”å¦‚å¾®è½¯çš„VS Codeï¼ŒGithubå®˜æ–¹çš„å®¢æˆ·ç«¯GUIï¼ŒSlackï¼ŒPostmanç­‰ï¼Œå›½å†…ä¹Ÿæœ‰å¾ˆå¤šä½¿ç”¨æ¡ˆä¾‹ï¼Œæ¯”å¦‚è¿…é›·Xï¼Œutoolsç­‰ï¼Œæ›´å¤šçš„Electron åº”ç”¨å¯ä»¥åœ¨ [ğŸ”—è¿™é‡Œ](https://www.electronjs.org/apps) å‘ç°ã€‚\n\n![Electron - www.electronjs.org](https://xuhang.github.io/post-images/1733619671523.png)\n\n## äºŒã€ä½¿ç”¨Electronå¼€å‘åº”ç”¨\n### é—®é¢˜\nåœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤§éƒ¨åˆ†æ—¶é—´æ˜¯ä½¿ç”¨QQä½œä¸ºæ²Ÿé€šå·¥å…·ï¼Œé‚£é¡¹ç›®ç›¸å…³çš„éœ€æ±‚æ–‡æ¡£ã€æ¥å£æ–‡æ¡£ä¹ŸåŸºæœ¬ä¸Šæ˜¯é€šè¿‡QQåˆ†äº«ï¼Œæ—¶é—´ä¹…äº†åœ¨QQçš„æœ¬åœ°ç›®å½•é‡Œå°±ä¼šæœ‰å¾ˆå¤šä¸åŒé¡¹ç›®çš„ç›¸å…³æ–‡æ¡£ï¼Œè¦æ‰¾åˆ°å°±ä¼šå¾ˆå›°éš¾ï¼Œè€Œä¸”å¾ˆå¤šæ–‡æ¡£åä»…å·®å‡ ä¸ªå­—ï¼Œå¾ˆéš¾åŒºåˆ†æ¯ä¸ªæ–‡æ¡£å±äºå“ªä¸ªé¡¹ç›®ä¸‹çš„ã€‚\n\n### æ–¹æ¡ˆ1\næ¯æ¬¡æ¶‰åŠæ–°çš„éœ€æ±‚ï¼Œåœ¨ç”¨æˆ·ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªè¯¥é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œæ¯æ¬¡æœ‰æ”¶åˆ°é¡¹ç›®ç›¸å…³çš„æ–‡ä»¶å°±å°†æ–‡æ¡£å­˜æ”¾åˆ°è¯¥è·¯å¾„ä¸‹ï¼Œå†æ¬¡ä½¿ç”¨æ—¶å°±åœ¨è¯¥ç›®å½•ä¸‹æŸ¥æ‰¾ã€‚\n\n![](https://xuhang.github.io/post-images/1733619772394.png)\n\n### æ–¹æ¡ˆ2\næ–¹æ¡ˆ1è™½ç„¶èƒ½å°†æ–‡ä»¶åˆ†é¡¹ç›®å­˜å‚¨ï¼Œä½†æ˜¯æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹å¾ˆéš¾é€šè¿‡æ–‡ä»¶è·å–ï¼›æ¯æ¬¡è¿›å…¥é¡¹ç›®ç›®å½•éœ€è¦æ‰“å¼€èµ„æºç®¡ç†å™¨ï¼Œè¿›å…¥ç”¨æˆ·ç›®å½•ï¼Œé€‰æ‹©ç›¸å…³é¡¹ç›®ï¼Œæ­¥éª¤ç¹çï¼›â€¦â€¦è¿™é‡Œæˆ‘ä»¬å¼€å‘ä¸€ä¸ªä¸“é—¨è§£å†³è¿™ä¸ªç—›ç‚¹çš„è½¯ä»¶ï¼Œç”¨æ¥ç®¡ç†é¡¹ç›®ç›¸å…³çš„æ–‡ä»¶ï¼Œè¯¥è½¯ä»¶æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n+ [x] åˆ†é¡¹ç›®ç®¡ç†æ‰€å±æ–‡ä»¶\n+ [x] ä»¥æ˜“è¯»çš„æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶çš„åŠ å…¥æ—¶é—´\n+ [x] æ”¯æŒç›´æ¥ä»èŠå¤©è½¯ä»¶å¯¹è¯æ¡†ä¸­æ‹–æ‹½æ–‡ä»¶åˆ°é¡¹ç›®ä¸­\n+ [ ] å¦‚æœå…¶ä»–äººéœ€è¦ï¼Œå¯ä»¥å°†é¡¹ç›®æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…åˆ†äº«\n+ [x] å¯ä»¥å¯¹æ¯ä¸ªæ–‡ä»¶æ³¨é‡Šï¼Œæ ‡æ³¨è¯¥æ–‡ä»¶çš„ä½œç”¨ã€å†…å®¹ç­‰\n+ [x] å¿«é€Ÿå®šä½åˆ°æ–‡ä»¶å’Œæ‰“å¼€æ–‡ä»¶\n+ [ ] é’ˆå¯¹æ¯ä¸ªé¡¹ç›®å†…åµŒä¸€ä¸ªKanbanæ¥è®°å½•å…·ä½“ä»»åŠ¡çš„å®Œæˆæƒ…å†µ\n+ [ ]  æ ¹æ®ä¸åŒçš„å‘½åè§„åˆ™è‡ªåŠ¨å…³è”åˆ°æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬\n+ [x] åŠ å…¥æ²Ÿé€šåŠŸèƒ½ï¼Œå¯ä»¥å¿«é€Ÿä¸å°ç»„æˆå‘˜åˆ†äº«æ–‡ä»¶\n\n\n| Windows UI                                                   | MacOS UI                                                     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| ![](https://xuhang.github.io/post-images/1733619845296.png)  |\n\n### å¼€å‘\n\nç”±äºElectronç‰ˆæœ¬æ›´æ–°è¾ƒå¿«ï¼Œæ¥å£å’ŒåŠŸèƒ½å¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„å˜åŠ¨ï¼Œå»ºè®®å‚è€ƒå®˜æ–¹æ–‡æ¡£[ğŸ”—å®˜æ–¹æ–‡æ¡£](https://www.electronjs.org/zh/docs/latest/)ï¼ˆæœ‰ä¸­æ–‡ï¼‰ã€‚\n\n#### **0. Electronä¸­å¸¸ç”¨çš„æ¨¡å—**\n\nå¯ä»¥ä»å‘½åè§„åˆ™ä¸­å¾—çŸ¥ï¼Œå¦‚æœå¼•å…¥çš„æ˜¯ç±»ï¼Œç”¨æˆ·æ˜¯å¯ä»¥åˆ›å»ºå¤šä¸ªå®ä¾‹å¯¹è±¡çš„ï¼Œå¦‚æœå¼•å…¥çš„æ˜¯å¯¹è±¡ï¼Œåˆ™æ˜¯Electronå·²ç»åˆ›å»ºå¥½çš„ï¼Œä¸”ä¸€ä¸ªåº”ç”¨é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚\n\n```javascript\nconst { \n    app, // å¯¹è¯¥åº”ç”¨ç¨‹åºçš„å¼•ç”¨ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥åŒ…å«0-å¤šä¸ªçª—å£\n    BrowserWindow, // çª—å£ç±»\n    Menu, // èœå•ç±»\n    Tray, // ä»»åŠ¡æ å›¾æ ‡\n    Notification, // é€šçŸ¥\n    shell, // Shellå¯¹è±¡ï¼Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤\n    ipcMain, // IpcMainå¯¹è±¡ï¼Œç”¨æ¥è§¦å‘å’Œç›‘å¬æ¶ˆæ¯äº‹ä»¶\n    globalShortcut, // GlobalShortcutå¯¹è±¡ï¼Œç”¨æ¥å¤„ç†å…¨å±€å¿«æ·é”®çš„ç»‘å®šå’Œè§£ç»‘\n    screen, // Screenå¯¹è±¡ï¼Œç”¨æ¥è·å–æ˜¾ç¤ºå™¨ç›¸å…³æ•°æ®\n    nativeImage // NativeImageå¯¹è±¡ï¼Œç”¨æ¥ç”Ÿæˆå’Œè·å–å›¾ç‰‡\n} = require('electron');\n```\n\n#### **1. å•å®ä¾‹**\n\nå•å®ä¾‹æ˜¯ä¸ºäº†ä¿è¯åªæœ‰ä¸€ä¸ªåœ¨å·¥ä½œï¼Œé˜²æ­¢è¯¯æ“ä½œå¤šæ¬¡åŒå‡»åå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚è¿™é‡Œå¤šä¸ªå®ä¾‹æ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥é™åˆ¶å¤šå®ä¾‹çš„ç”Ÿæˆï¼Œå¦‚æœé‡å¤åˆ›å»ºappå¯¹è±¡åˆ™ç›´æ¥é€€å‡ºã€‚\n\n```javascript\nconst gotTheLock = app.requestSingleInstanceLock()\nif (!gotTheLock) {\n    app.quit()\n} else {\n    app.on('second-instance', (event, commandLine, workingDirectory) => {\n            // å½“è¿è¡Œç¬¬äºŒä¸ªå®ä¾‹æ—¶,å°†ä¼šèšç„¦åˆ°myWindowè¿™ä¸ªçª—å£\n            if (win) {\n                if (win.isMinimized()) win.restore()\n                win.focus()\n            }\n        })\n        // app å¯åŠ¨åˆ›å»ºçª—å£\n    app.on('ready', createWindow);\n}\n```\n#### **2. è‡ªå®šä¹‰åè®®**\n\nåœ¨æµè§ˆå™¨ä¸­å¸¸ç”¨çš„åè®®æœ‰`http`ã€`https`ã€`file`ç­‰ï¼Œè‡ªå®šä¹‰åè®®å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡åœ¨æµè§ˆå™¨è®¿é—®è‡ªå®šä¹‰schemaæ‰“å¼€æˆ‘ä»¬çš„åº”ç”¨ï¼Œå¹¶æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬ä»¥è½¯ä»¶åç§°`fily`ä½œä¸ºåè®®åç§°ï¼Œåé¢çš„uriè·¯å¾„ä¸ºè¦è®¿é—®çš„é¡¹ç›®åç§°(ç›®å‰æ”¯æŒè‹±æ–‡å­—æ¯å’Œæ•°å­—çš„åç§°ï¼Œä¸­æ–‡éœ€è¦é¢å¤–çš„ç¼–è§£ç )ã€‚\n\n```http\nfily://project-name\n```\nå®ç°æ–¹å¼MacOSå’ŒWindowsæœ‰åŒºåˆ«ï¼ŒMacOSé€šè¿‡`app.setAsDefaultProtocolClient`è®¾ç½®é»˜è®¤åè®®ï¼ŒWindowsé€šè¿‡ç¬¬äºŒå®ä¾‹æ‰“å¼€ã€‚\n```javascript\n// MacOS\nif (process.defaultApp) {\n    if (process.argv.length >= 2) {\n        app.setAsDefaultProtocolClient('fily', process.execPath, [path.resolve(process.argv[1])])\n    }\n} else {\n    app.setAsDefaultProtocolClient('fily')\n}\n\napp.on('open-url', (event, url) => {\n    openUrl(url);\n})\n\n//Windows\nconst gotTheLock = app.requestSingleInstanceLock()\nif (!gotTheLock) {\n    app.quit()\n} else {\n    app.on('second-instance', (event, commandLine, workingDirectory) => {\n            // å½“è¿è¡Œç¬¬äºŒä¸ªå®ä¾‹æ—¶,å°†ä¼šèšç„¦åˆ°myWindowè¿™ä¸ªçª—å£\n            if (win) {\n                if (win.isMinimized()) win.restore()\n                win.focus()\n                let lastCommand = commandLine[commandLine.length - 1];  // â‘ \n                if (lastCommand.indexOf('fily://') === 0) {             // â‘¡\n                    openUrl(lastCommand)                                // â‘¢\n                }\n            }\n        })\n        // app å¯åŠ¨åˆ›å»ºçª—å£\n    app.on('ready', createWindow);\n}\n```\n\n#### **3. è¿›ç¨‹é—´é€šä¿¡**\n\nElectronåˆ†ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼Œä¸»ç¨‹åº (main process)ï¼Œå®ƒè¿è¡Œåœ¨ Node.jsç¯å¢ƒé‡Œï¼Œè´Ÿè´£æ§åˆ¶åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€æ˜¾ç¤ºåŸç”Ÿç•Œé¢ã€æ‰§è¡Œç‰¹æ®Šæ“ä½œå¹¶ç®¡ç†æ¸²æŸ“å™¨è¿›ç¨‹ (renderer processes)ã€‚åº”ç”¨ä¸­çš„æ¯ä¸ªé¡µé¢éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œæˆ‘ä»¬ç§°è¿™äº›è¿›ç¨‹ä¸º æ¸²æŸ“å™¨(renderer) ã€‚ æ¸²æŸ“å™¨ä¹Ÿèƒ½è®¿é—®å‰ç«¯å¼€å‘å¸¸ä¼šç”¨åˆ°çš„ APIå’Œå·¥å…·ï¼Œä¾‹å¦‚ç”¨äºæ‰“åŒ…å¹¶å‹ç¼©ä»£ç çš„webpackï¼Œè¿˜æœ‰ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ React ã€‚\n\n| é€šä¿¡æ–¹å‘                 | ä»£ç                                               |\n| ------------------------ | ------------------------------------------------- |\n| ä¸»è¿›ç¨‹ç›‘å¬äº‹ä»¶           | `ipcMain.on(EVENT-NAME, (event, data) => {})`     |\n| ä¸»è¿›ç¨‹å‘æ¸²æŸ“è¿›ç¨‹å‘é€é€šçŸ¥ | `win.webContents.send(EVENT-NAME, {})`            |\n| æ¸²æŸ“è¿›ç¨‹ç›‘å¬äº‹ä»¶         | `ipcRenderer.on(EVENT-NAME, (event, data) => {})` |\n| æ¸²æŸ“è¿›ç¨‹å‘ä¸»è¿›ç¨‹å‘é€é€šçŸ¥ | `ipcRenderer.send(EVENT-NAME, {})`                |\n\nä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¸»è¦è´Ÿè´£çš„åŠŸèƒ½èŒƒå›´ä¸åŒï¼Œè¿›ç¨‹é—´çš„é€šä¿¡é€šè¿‡äº‹ä»¶ç›‘å¬å’Œæ¶ˆæ¯é€šçŸ¥æ¥äº¤äº’å®Œæˆã€‚\n\n> Electron çš„ä¸»è¿›ç¨‹æ˜¯ä¸€ä¸ªæ‹¥æœ‰ç€å®Œå…¨æ“ä½œç³»ç»Ÿè®¿é—®æƒé™çš„ Node.js ç¯å¢ƒã€‚ é™¤äº† Electron æ¨¡ç»„ä¹‹å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Node.js å†…ç½®æ¨¡å— å’Œæ‰€æœ‰é€šè¿‡ npm å®‰è£…çš„è½¯ä»¶åŒ…ã€‚å¦ä¸€æ–¹é¢ï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œæ¸²æŸ“è¿›ç¨‹é»˜è®¤è·‘åœ¨ç½‘é¡µé¡µé¢ä¸Šï¼Œè€Œå¹¶é Node.jsé‡Œã€‚ä¸ºäº†å°† Electron çš„ä¸åŒç±»å‹çš„è¿›ç¨‹æ¡¥æ¥åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¢«ç§°ä¸º é¢„åŠ è½½ çš„ç‰¹æ®Šè„šæœ¬ã€‚\n\n#### **4. åˆ›å»ºçª—å£**\n\n|                                                              |              |\n| ------------------------------------------------------------ | ------------ |\n|![](https://xuhang.github.io/post-images/1733619943936.png)  | Windows   UI |\n| ![](https://xuhang.github.io/post-images/1733619968189.png) | MacOS UI     |\n\nè½¯ä»¶æ‰“å¼€ä¹‹åéœ€è¦å±•ç¤ºç»™ç”¨æˆ·ä½¿ç”¨çš„ç•Œé¢ï¼ŒELectronå°è£…äº†ä¸åŒæ“ä½œç³»ç»Ÿçš„UIç•Œé¢ï¼Œæ‰€ä»¥åœ¨ä¸åŒç³»ç»Ÿä¸Šä½¿ç”¨ä¼šæœ‰ä¸åŒçš„é£æ ¼ã€‚ä¸ºäº†ç»Ÿä¸€é£æ ¼ï¼Œæˆ‘ä»¬å»æ‰çª—å£çš„è¾¹æ¡†ï¼Œä½¿ç”¨HTML+CSSç»˜åˆ¶ä¸€å¥—ç»Ÿä¸€çš„ç•Œé¢ã€‚å¯ä»¥ä»ä¸Šé¢çš„å¯¹æ¯”å›¾çœ‹å‡ºï¼ŒWindowså’ŒMacOSä¸Šçš„é¡¶éƒ¨titleBarçš„æ ·å¼æ˜¯æœ‰åŒºåˆ«çš„ï¼ŒWindowsçš„titleBarä¼šæ˜¾ç¤ºèœå•ï¼ŒMacOSæ˜¯ç©ºç™½çš„ï¼Œå› ä¸ºMacOSçš„èœå•æ˜¯å½“ç¨‹åºçª—å£æ˜¯æ´»åŠ¨çª—å£æ—¶ï¼Œåœ¨æ˜¾ç¤ºå™¨å·¦ä¸Šè§’ä¼šæ˜¾ç¤ºå½“å‰ç¨‹åºçš„èœå•ï¼Œæ‰€ä»¥ä¸¤ä¸ªå¹³å°çš„èœå•ç»‘å®šæ˜¯æœ‰åŒºåˆ«çš„ã€‚\n\n![](https://xuhang.github.io/post-images/1733620004039.png)\n\n```javascript\n// åˆ›å»ºçª—å£è¦åœ¨appå¯åŠ¨å®Œæˆä¹‹åå¼€å§‹\napp.on('ready', createWindow);\n\nfunction createWindow() {\n    // è¯»å–package.jsonæ–‡ä»¶ä¸­çš„å±æ€§\n    var package = require('./package.json')\n    console.log('starting ' + package.name + ' ' + package.version)\n\n    // éšè—èœå• Menu.setApplicationMenu(null)\n    // è¿™é‡Œèœå•ä»…å¯¹MacOSæœ‰æ•ˆï¼Œå› ä¸ºWindowséšè—è¾¹æ¡†ä¹‹åæ²¡æœ‰èœå•æ \n    const appMenu = Menu.buildFromTemplate(appMenuTemplate);\n    Menu.setApplicationMenu(appMenu)\n\n    // åˆ›å»ºæµè§ˆå™¨çª—å£å¹¶è®¾ç½®å®½é«˜\n    win = new BrowserWindow({\n        width: 1200,\n        height: 800,\n        titleBarStyle: 'customButtonsOnHover',\n        icon: __dirname + './img/fily.png',\n        maximizable: false,\n        minimizable: false,\n        fullscreenable: false,\n        frame: false, // æ˜¯å¦æœ‰è¾¹æ¡†\n        // resizable: true,        // æ˜¯å¦å¯è°ƒæ•´å¤§å°\n        transparent: true, //æ˜¯å¦é€æ˜\n        webPreferences: { // æ–°ç‰ˆElectronæ·»åŠ äº†ä¸€äº›å®‰å…¨é™åˆ¶ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®\n            nodeIntegration: true,\n            enableRemoteModule: true,\n            contextIsolation: false\n        }\n    })\n    remoteMain.initialize()\n    remoteMain.enable(win.webContents);\n\n    // MacOSåº•éƒ¨çš„Dockæ å›¾æ ‡\n    if (systemType === \"Darwin\") {\n        app.dock.setIcon(path.join(__dirname, './img/icon_512x512.png'));\n        // è®¾ç½®Dockèœå•\n        const dockMenu = Menu.buildFromTemplate(dockMenuTempalte);\n        app.dock.setMenu(dockMenu);\n    }\n\n    // åŠ è½½é¡µé¢ -- å‘ç”¨æˆ·å±•ç¤ºçš„ç•Œé¢\n    win.loadFile('./page/projectRelatedFiles.html')\n\n    // Windows ä»»åŠ¡æ å›¾æ ‡èœå•ï¼ˆå³ä¸‹è§’ï¼‰ / MacOSä»»åŠ¡æ å›¾ç‰‡ï¼ˆå³ä¸Šè§’ï¼‰\n    // tray = new Tray(path.join(__dirname, \"./img/fily.png\"));\n    const trayImage = nativeImage.createFromPath(path.join(__dirname, \"./img/icons.iconset/file20Template.png\"));\n    trayImage.resize({ width: 16, height: 16 })\n    trayImage.setTemplateImage(true);\n    tray = new Tray(trayImage);\n    const contextMenu = Menu.buildFromTemplate([\n        { label: 'é€€å‡º', click: function() { app.quit() } }\n    ])\n    tray.setToolTip('Fily - File manager for you!')\n    tray.setContextMenu(contextMenu)\n\n    // æ·»åŠ windowå…³é—­è§¦å‘äº‹ä»¶\n    win.on('close', () => {\n        win = null;\n        app.quit();\n    });\n\n    win.setProgressBar(0.7);\n}\n\n```\n#### **5. æ·»åŠ å¿«æ·é”®æ³¨å†Œ**\n\nå¯ä»¥é€šè¿‡æ³¨å†Œå…¨å±€å¿«æ·é”®å¿«é€Ÿæ‰§è¡ŒæŸä¸ªæ“ä½œæˆ–è€…åœ¨èœå•é¡¹é‡Œå¯¹æŒ‡å®šçš„èœå•ç»‘å®šå¿«æ·é”®ã€‚\n\n```javascript\n// æ³¨å†Œå…¨å±€å¿«æ·é”®-é€€å‡ºåº”ç”¨\nglobalShortcut.register('Ctrl+W', () => {\n    win = null;\n    app.quit();\n});\n// å…¨å±€å¿«æ·é”®-æ‰“å¼€å¼€å‘ä¸­å·¥å…·\nglobalShortcut.register('Ctrl+Shift+I', () => {\n    win.webContents.toggleDevTools()\n})\n\n// é€šè¿‡æ„å»ºèœå•ç»‘å®šå¿«æ·é”®æ‰§è¡Œèœå•æ“ä½œ\nconst appMenuTemplate = [{\n    label: 'Projects',\n    submenu: [{\n        label: 'New Project',\n        accelerator: 'Cmd+N',\n        click: () => {\n            win.webContents.send('new-project-dialog', {})\n        }\n    }, {\n        label: 'Rename Project'\n    }, {\n        label: 'Delete Project'\n    }, {\n        type: 'separator'\n    }, {\n        label: 'Archive'\n    }]\n}, {\n    label: 'Files',\n    submenu: [{\n        label: 'Import File'\n    }, {\n        label: 'Import Folder'\n    }]\n}]\n```\n#### **6. æ·»åŠ è¿›åº¦æ¡**\n\nWindowså’ŒMacOSéƒ½å¯ä»¥åœ¨ä»»åŠ¡ï¼ˆDockï¼‰æ çš„å›¾æ ‡é‚£é‡Œæ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ï¼Œé€šå¸¸å¯ä»¥ç”¨æ¥æ˜¾ç¤ºä¸‹è½½è¿›åº¦æˆ–è€…ä»»åŠ¡å®Œæˆè¿›åº¦ã€‚\n\n| Windows UI                                                   | MacOS UI                                                     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n|![](https://xuhang.github.io/post-images/1733620043980.png)  |\n\n```javascript\n// è¿™é‡Œçš„è¿›åº¦æ¡åœ¨70%çš„è¿›åº¦\nwin.setProgressBar(0.7);\n```\n\n#### **7. ä»»åŠ¡æ é¢„è§ˆå¿«æ·æ“ä½œï¼ˆä»…Windowsï¼‰**\n\nåœ¨ä»»åŠ¡æ çš„é¢„è§ˆè§†å›¾é‚£é‡Œå¯ä»¥è®¾ç½®å¿«æ·æ“ä½œé”®ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡æ·»åŠ ä¸¤ä¸ªæŒ‰é’®ç”¨äºè®¿é—®â€œå‰ä¸€ä¸ªâ€å’Œâ€œåä¸€ä¸ªâ€é¡¹ç›®ã€‚\n\n![](https://xuhang.github.io/post-images/1733620060775.png)\n\n```javascript\n// ä¸»çº¿ç¨‹\nwin.setThumbarButtons([{\n    tooltip: 'ä¸Šä¸€å¼ ',\n    icon: path.join(__dirname, './resource/icos/pre.ico'),\n    click() { switchThumbImage(-1) }\n}, {\n    tooltip: 'ä¸‹ä¸€å¼ ',\n    icon: path.join(__dirname, './resource/icos/next.ico'),\n    click() { switchThumbImage(1) }\n}])\n\nfunction switchThumbImage(delta) {\n    if (delta > 0) {\n        win.webContents.send('show-next-project', {})\n    } else {\n        win.webContents.send('show-prev-project', {})\n    }\n}\n\n// æ¸²æŸ“è¿›ç¨‹\nipcRenderer.on('show-next-project', (event, message) => {\n    // document.getElementById('gallery_image').setAttribute('src', message['src']);\n    let curProj = $('.projlist ul li.active')\n    let nextProj;\n    if (!!curProj[0]) {\n        nextProj = curProj.next();\n        if (!nextProj[0]) {\n            nextProj = $('.projlist ul li').first()\n        }\n    } else {\n        nextProj = $('.projlist ul li').first();\n    }\n    nextProj.click();\n})\nipcRenderer.on('show-prev-project', (event, message) => {\n    let curProj = $('.projlist ul li.active')\n    let prevProj;\n    if (!!curProj[0]) {\n        prevProj = curProj.prev();\n        if (!prevProj[0]) {\n            prevProj = $('.projlist ul li').last()\n        }\n    } else {\n        prevProj = $('.projlist ul li').last();\n    }\n    prevProj.click();\n})\n```\n\n#### **8. é€šçŸ¥**\n\nè¿™é‡Œç›‘å¬å³ä¸Šè§’çš„å…³é—­æŒ‰é’®ï¼Œç‚¹å‡»å…³é—­ä¹‹åä¼šå¼¹å‡ºé€šçŸ¥ï¼Œå¹¶å»¶è¿Ÿ1såé€€å‡ºåº”ç”¨ã€‚\n\n| Windows UI                                                   | MacOS UI                                                     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n|![](https://xuhang.github.io/post-images/1733620099033.png) |\n\n```javascript\nipcMain.on('close-window', (event, data) => {\n    if (!Notification.isSupported()) {\n        console.log('å½“å‰ç³»ç»Ÿä¸æ”¯æŒé€šçŸ¥');\n    }\n    app.setAppUserModelId(\"æˆ‘çš„Electornç¤ºä¾‹\")\n    const notification = {\n        appId: \"com.xuhang.electron.demo\",\n        icon: path.join(__dirname, './img/icon_512x512.png'),\n        title: 'æ­£åœ¨å…³é—­â€¦â€¦',\n        body: 'Bye ãƒ¾(â€¢Ï‰â€¢`)o'\n    }\n    new Notification(notification).show()\n\n    setTimeout(() => {\n        console.log('fily is exiting ...')\n        app.quit();\n    }, 1000);\n});\n```\n\n#### **9. æ•°æ®å­˜å‚¨**\n\né¡¹ç›®åˆ—è¡¨å’Œé¡¹ç›®ç›¸å…³çš„æ–‡ä»¶å…³è”å…³ç³»éœ€è¦æŒä¹…åŒ–æ‰èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œé€šå¸¸å¯ä»¥é€‰æ‹©å°†æ•°æ®ä¿å­˜åˆ°è¿œç¨‹æ•°æ®åº“ï¼Œä½†æ˜¯è¿™æ ·å¿…é¡»è¦æœ‰ä¸€ä¸ªå®æ—¶åœ¨çº¿çš„æœåŠ¡ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©æ•°æ®ä¿å­˜åœ¨æœ¬åœ°ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯æ•°æ®å®æ—¶å¯ç”¨ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼Œä¸€æ¥ä¹Ÿæ˜¯å› ä¸ºæ•°æ®æ²¡æœ‰åœ¨çº¿è®¿é—®çš„å¿…è¦ã€‚\n\nç¦»çº¿å­˜å‚¨æœ‰å‡ ç§å¯é€‰æ–¹æ¡ˆï¼š\n\n1. åˆ©ç”¨æµè§ˆå™¨çš„localStorageå­˜å‚¨ï¼Œä¼˜ç‚¹æ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼ŒElectronæœ¬èº«å°±åŒ…å«äº†Chromiumï¼Œç¼ºç‚¹æ˜¯å¦‚æœæ¸…ç©ºæµè§ˆå™¨ç¼“å­˜æ•°æ®ä¹Ÿä¸¢å¤±äº†ã€‚\n2. åˆ©ç”¨Electronçš„æ–‡ä»¶è¯»å†™APIï¼Œè‡ªå®šä¹‰å­˜å‚¨æ ¼å¼å’Œå­˜å‚¨è·¯å¾„ï¼Œå°†æ•°æ®ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œä¼˜ç‚¹æ˜¯æ²¡æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œç¼ºç‚¹æ˜¯éœ€è¦è‡ªå·±å®ç°æ•°æ®çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚\n3. åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚lowdbå°†æ•°æ®ä»¥JSONæ ¼å¼å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ï¼Œä¼˜ç‚¹æ˜¯æä¾›äº†å¢åˆ æ”¹æŸ¥çš„APIï¼Œç¼ºç‚¹æ˜¯æœ‰å­¦ä¹ æˆæœ¬ã€‚\n4. é›†æˆSQLiteï¼Œä¼˜ç‚¹æ˜¯æ•°æ®æœ‰å„ç§å·¥å…·å¯ä»¥è¯»å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç›˜å°†æ•°æ®è¿›è¡ŒåŒæ­¥ï¼ŒSQLiteä¹Ÿæ¯”è¾ƒç¨³å®šæˆç†Ÿï¼Œç¼ºç‚¹æ˜¯Electronå¯¹SQLiteçš„é›†æˆæ¯”è¾ƒå¤æ‚ï¼Œæ‰“åŒ…åä½“ç§¯ä¹Ÿä¼šå˜å¤§ã€‚\n\nç»¼åˆå„ç§æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œæˆ‘ä»¬å‰æœŸéœ€è¦å¿«é€Ÿå‡ºä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥é€‰æ‹©äº†lowdbã€‚\n\n#### **10. å¼•å…¥jQuery**\n\nå‰ç«¯å¼€å‘çš„å‘å±•é€Ÿåº¦å¾ˆå¿«ï¼Œå¯èƒ½ä¸¤ä¸‰å¹´æŠ€æœ¯è·¯çº¿å°±ä¼šæ›´æ–°è¿­ä»£ï¼ŒjQueryè™½ç„¶è¿‡æ—¶äº†ï¼Œä½†æ˜¯å¯¹äºéå‰ç«¯å¼€å‘æ¥è¯´è¿˜æ˜¯ç›¸å¯¹ç†Ÿæ‚‰çš„æ¡†æ¶ï¼Œæ‰€ä»¥ä¸ºäº†å°½å¯èƒ½ç®€åŒ–å¼€å‘è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨jQueryã€‚\n\nElectroné»˜è®¤å¯ç”¨äº†Node.jsçš„requireæ¨¡å—ï¼Œè€ŒjQueryç­‰æ–°ç‰ˆæœ¬æ¡†æ¶ä¸ºäº†æ”¯æŒcommondJSæ ‡å‡†ï¼Œå½“Windowä¸­å­˜åœ¨requireæ—¶ï¼Œä¼šå¯ç”¨æ¨¡å—å¼•å…¥çš„æ–¹å¼ã€‚è¿™é‡Œä¸»è¦é’ˆå¯¹jQuery1.11.1åŠä»¥åçš„ç‰ˆæœ¬ã€‚\n\n```javascript\n<script src=\"../script/jquery.min.js\"></script>\n<script>\n    if (typeof module === 'object') {\n        window.jQuery = window.$ = module.exports;\n    }\n</script>\n```\n\nç”±äºElectronå’ŒES6å¯¹äºæ¨¡å—çš„å¯¼å…¥å¯¼å‡ºé‡‡ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼Œæ‰€ä»¥åœ¨å¼•ç”¨JSæ–‡ä»¶æ—¶å¾ˆå®¹å‡ºç°æŠ¥é”™ã€‚å…³äºå„ç§Javascriptè¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„æ¨¡å—å¯¼å…¥å¯¼å‡ºå¯ä»¥å‚è§ [ğŸ”—è¿™ç¯‡æ–‡ç« ](https://mp.weixin.qq.com/s?__biz=MzIzMDE5NTQyMQ==&mid=2247484053&idx=1&sn=dec6d77da1de255d1b9a92289c3a3df3)\n\n#### **11. å¼€å‘è€…å·¥å…·**\n\nä¸ºäº†æ–¹ä¾¿å¯¹é¡µé¢è¿›è¡Œè°ƒè¯•ï¼Œéœ€è¦ä¸ºæ¯ä¸ªçª—å£æ·»åŠ æ‰“å¼€/å…³é—­å¼€å‘è€…å·¥å…·çš„å¿«æ·é”®ç›‘å¬äº‹ä»¶ã€‚åœ¨é¡µé¢çš„jsæ–‡ä»¶ä¸­ä¸ºwindowå¯¹è±¡æ·»åŠ äº‹ä»¶ç›‘å¬å™¨å¹¶åœ¨æŒ‰é”®ä¸º`Ctrl+Shift+I`æ˜¯æ‰“å¼€/å…³é—­å¼€å‘è€…å·¥å…·ï¼Œé’ˆå¯¹å½“å‰æ´»åŠ¨çª—å£çš„å¿«æ·é”®æ‰ä¼šç”Ÿæ•ˆ ã€‚\n\n```javascript\nwindow.addEventListener('keydown', (event) => {\n    if (event.ctrlKey && event.shiftKey && event.key === 'I') {\n        remote.getCurrentWindow().toggleDevTools();\n    }\n})\n```\n\n#### **12. èŠå¤©åŠŸèƒ½**\n\nåœ¨ç•Œé¢å·¦ä¸Šè§’é‡è½½æŒ‰é’®çš„æ—è¾¹æœ‰ä¸ªèŠå¤©å›¾æ ‡ï¼Œç‚¹å‡»ä¼šåœ¨å±å¹•å³ä¾§å‡ºç°ä¸€ä¸ªé€æ˜çª—å£ï¼Œè¯¥çª—å£å®ç°äº†é¼ æ ‡ç‚¹å‡»ç©¿é€ï¼Œä½†åŒæ—¶ä¹Ÿä¿æŒçª—å£ç½®é¡¶ï¼Œæœ€ä¸‹æ–¹çš„æ–‡å­—è¾“å…¥åŒºåŸŸè®¾ç½®é€æ˜åº¦0.6ï¼Œä½†æ˜¯ä¸ºäº†èƒ½è¾“å…¥æ–‡å­—ï¼Œè¯¥åŒºåŸŸä¸ºç‚¹å‡»ä¸ç©¿é€ã€‚è¯¥èŠå¤©åŠŸèƒ½ä½¿ç”¨è…¾è®¯çš„IMäº‘æœåŠ¡ï¼Œæ¯ä¸ªæ‰“å¼€è¯¥èŠå¤©ç•Œé¢çš„ç»ˆç«¯ä¼šè‡ªåŠ¨ç”³è¯·åŠ å…¥ä¸€ä¸ªå¼€æ”¾ç¾¤ï¼Œç›®å‰ä»…å®ç°äº†æ–‡å­—èŠå¤©åŠŸèƒ½ã€‚\n\n| Windows UI                                                   | MacOS UI                                                     |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| ![](https://xuhang.github.io/post-images/1733620151597.png) |\n\n\n\n\n\n## ä¸‰ã€æ‰“åŒ…å‘å¸ƒ\n\nå¼€å‘å®Œæˆåå°†ä»£ç æ‰“åŒ…å¹¶ç”Ÿæˆç³»ç»Ÿå®‰è£…åŒ…ã€‚ä¹‹å‰ä¸»è¦ä½¿ç”¨`electron-package`å’Œ`electron-builder`æ¥æ‰“åŒ…ï¼Œç›®å‰Electronå®˜æ–¹æ¨èä½¿ç”¨`electron-forge`ï¼Œåè€…é’ˆå¯¹å‘å¸ƒå’Œæ›´æ–°ä¼šæ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚\n\nelectron-builderåœ¨package.jsonä¸­æ·»åŠ å¦‚ä¸‹å‚æ•°ï¼š\n\n```json\n\"build\": {\n    \"productName\": \"fily\",\n    \"appId\": \"com.xuhang.electron.demo\",\n    \"copyright\": \"Copyright Â© 2021-2022 xu\",\n    \"directories\": {\n        \"output\": \"build\"\n    },\n    \"nsis\": {\n        \"oneClick\": false,\n        \"allowElevation\": true,\n        \"allowToChangeInstallationDirectory\": true,\n        \"installerIcon\": \"./img/icon.ico\",\n        \"uninstallerIcon\": \"./img/icon.ico\",\n        \"installerHeaderIcon\": \"./img/icon.ico\",\n        \"createDesktopShortcut\": true,\n        \"createStartMenuShortcut\": true,\n        \"shortcutName\": \"Fily\"\n    },\n    \"win\": {\n        \"icon\": \"./img/icon.ico\",\n        \"target\": [\n            {\n                \"target\": \"nsis\",\n                \"arch\": [\n                    \"ia32\"\n                ]\n            }\n        ]\n    },\n    \"dmg\": {\n        \"background\": \"media/images/dmg-bg.png\",\n        \"icon\": \"media/images/icon.icns\",\n        \"iconSize\": 100,\n        \"sign\": false,\n        \"contents\": [\n            {\n                \"x\": 112,\n                \"y\": 165\n            },\n            {\n                \"type\": \"link\",\n                \"path\": \"/Applications\",\n                \"x\": 396,\n                \"y\": 165\n            }\n        ]\n    },\n    \"mac\": {\n        \"target\": [\n            \"dmg\"\n        ],\n        \"icon\": \"./img/Icon.icns\",\n        \"hardenedRuntime\": true,\n        \"identity\": null,\n        \"entitlements\": \"electron-builder/entitlements.plist\",\n        \"entitlementsInherit\": \"electron-builder/entitlements.plist\",\n        \"provisioningProfile\": \"electron-builder/comalibabaslobs.provisionprofile\"\n    },\n    \"pkg\": {\n        \"isRelocatable\": false,\n        \"overwriteAction\": \"upgrade\"\n    },\n    \"mas\": {\n        \"icon\": \"./img/Icon.icns\",\n        \"hardenedRuntime\": true,\n        \"entitlements\": \"electron-builder/entitlements.mas.plist\",\n        \"entitlementsInherit\": \"electron-builder/entitlements.mas.plist\"\n    }\n}\n```\n\nelectron-forgeæ·»åŠ å¦‚ä¸‹å‚æ•°ï¼š\n\n```json\n\"config\": {\n    \"forge\": {\n        \"packagerConfig\": {},\n        \"makers\": [\n            {\n                \"name\": \"@electron-forge/maker-squirrel\",\n                \"config\": {\n                    \"name\": \"fily\"\n                }\n            },\n            {\n                \"name\": \"@electron-forge/maker-zip\",\n                \"platforms\": [\n                    \"darwin\"\n                ]\n            },\n            {\n                \"name\": \"@electron-forge/maker-deb\",\n                \"config\": {}\n            },\n            {\n                \"name\": \"@electron-forge/maker-rpm\",\n                \"config\": {}\n            }\n        ]\n    }\n}\n```\n\nç„¶åé…ç½®scriptè„šæ­¥æŒ‡å®šæŒ‡å®šçš„ä»»åŠ¡ï¼š\n\n```json\n\"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"start\": \"electron-forge start\",\n    \"package\": \"electron-forge package\",\n    \"dist\": \"npm run package && electron-builder build\",\n    \"make\": \"electron-forge make\"\n}\n```\n\n## å››ã€æºç \n\nè¯¥å®éªŒé¡¹ç›®å¼€æºï¼Œä»£ç å­˜æ”¾åœ¨ [ğŸ”—Github](https://github.com/xuhang/fily.git)\n\n\n[1]: https://www.electronjs.org/apps\n[2]: https://github.com/xuhang/fily.git",
      "data": {
        "title": "Electron åº”ç”¨å¼€å‘",
        "date": "2024-12-08 09:00:31",
        "tags": [
          "electron",
          "note",
          "app",
          "fily"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/electron-ying-yong-kai-fa.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## ä¸€ã€äº†è§£Electron\n\nElectron æ˜¯ç”± Github å¼€å‘ï¼Œç”¨ HTMLï¼ŒCSS å’Œ JavaScript æ¥æ„å»ºè·¨å¹³å°æ¡Œé¢åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå¼€æºåº“ã€‚æœ€åˆçš„æ—¶å€™æ˜¯å±äº Github å¼€æºä»£ç ç¼–è¾‘å™¨ Atom çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ 2014 æ˜¥å­£è¿™ä¸¤ä¸ªé¡¹ç›®ç›¸ç»§å¼€æºã€‚",
      "fileName": "electron-ying-yong-kai-fa"
    },
    {
      "content": "## åŸºç¡€æ¶æ„\n![MySQL åŸºç¡€æ¶æ„](https://xuhang.github.io/post-images/1733619417022.png)\n\n### è¿æ¥å™¨\n\nè¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚\n- å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ª\"Access denied for user\"çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚\n-   å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚\n\n<!-- more -->\n\nå®¢æˆ·ç«¯å¦‚æœå¤ªé•¿æ—¶é—´æ²¡åŠ¨é™ï¼ˆshow processlistç»“æœçš„Commandåˆ—æ˜¾ç¤ºä¸ºsleepï¼‰ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚è¿™ä¸ªæ—¶é—´æ˜¯ç”±å‚æ•°wait_timeoutæ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯8å°æ—¶ã€‚\nMySQLåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ‰€ä»¥å¦‚æœé•¿è¿æ¥ç´¯ç§¯ä¸‹æ¥ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œå¯¼è‡´MySQLå¼‚å¸¸é‡å¯ã€‚\nè§£å†³åŠæ³•ï¼š\n1.  å®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿ã€‚\n2.  å¦‚æœä½ ç”¨çš„æ˜¯MySQL 5.7æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connectionæ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚\n\n### æŸ¥è¯¢ç¼“å­˜\næ‰§è¡Œè¿‡çš„è¯­å¥åŠå…¶ç»“æœå¯èƒ½ä¼šä»¥key-valueå¯¹çš„å½¢å¼ï¼Œè¢«ç›´æ¥ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚keyæ˜¯æŸ¥è¯¢çš„è¯­å¥ï¼Œvalueæ˜¯æŸ¥è¯¢çš„ç»“æœã€‚å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿç›´æ¥åœ¨è¿™ä¸ªç¼“å­˜ä¸­æ‰¾åˆ°keyï¼Œé‚£ä¹ˆè¿™ä¸ªvalueå°±ä¼šè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\næŸ¥è¯¢ç¼“å­˜çš„å¤±æ•ˆéå¸¸é¢‘ç¹ï¼Œ**åªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©º**ã€‚å› æ­¤å¾ˆå¯èƒ½ä½ è´¹åŠ²åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å‘¢ï¼Œå°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ã€‚å¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½ã€‚é™¤éä½ çš„ä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚\n\nå‚æ•°query_cache_typeè®¾ç½®æˆDEMANDï¼Œè¿™æ ·å¯¹äºé»˜è®¤çš„SQLè¯­å¥éƒ½ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚è€Œå¯¹äºä½ ç¡®å®šè¦ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜çš„è¯­å¥ï¼Œå¯ä»¥ç”¨SQL_CACHEæ˜¾å¼æŒ‡å®šï¼Œåƒä¸‹é¢è¿™ä¸ªè¯­å¥ä¸€æ ·ï¼š\n\n```sql\nmysql> select SQL_CACHE * from T where ID=10ï¼›\n```\n\n> MySQL 8.0ç‰ˆæœ¬ç›´æ¥å°†æŸ¥è¯¢ç¼“å­˜çš„æ•´å—åŠŸèƒ½åˆ æ‰äº†ï¼Œä¹Ÿå°±æ˜¯è¯´8.0å¼€å§‹å½»åº•æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½äº†ã€‚\n\n### åˆ†æå™¨\n\nåˆ†æå™¨å…ˆä¼šåšâ€œè¯æ³•åˆ†æâ€ã€‚ä½ è¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡SQLè¯­å¥ï¼ŒMySQLéœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»£è¡¨ä»€ä¹ˆã€‚\n\nåšå®Œäº†è¿™äº›è¯†åˆ«ä»¥åï¼Œå°±è¦åšâ€œè¯­æ³•åˆ†æâ€ã€‚æ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ªSQLè¯­å¥æ˜¯å¦æ»¡è¶³MySQLè¯­æ³•ã€‚\n\n### ä¼˜åŒ–å™¨\n\nä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåºã€‚\n\n### æ‰§è¡Œå™¨\n\nå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹ä½ å¯¹è¿™ä¸ªè¡¨Tæœ‰æ²¡æœ‰æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ã€‚\n\nå¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œã€‚æ‰“å¼€è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£ã€‚\n\n\n## æ—¥å¿—ç³»ç»Ÿ\n\n### æ—¥å¿—æ¨¡å—ï¼šredo log\n\nå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹IOæˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚MySQLä½¿ç”¨WALæŠ€æœ¯æ¥æå‡æ•ˆç‡ï¼ŒWALçš„å…¨ç§°æ˜¯Write-Ahead Loggingï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚å½“æœ‰ä¸€æ¡è®°å½•éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼ŒInnoDBå¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ°redo logé‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚åŒæ—¶ï¼ŒInnoDBå¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªæ“ä½œè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ï¼Œè€Œè¿™ä¸ªæ›´æ–°å¾€å¾€æ˜¯åœ¨ç³»ç»Ÿæ¯”è¾ƒç©ºé—²çš„æ—¶å€™åšã€‚\n\næœ‰äº†redo logï¼ŒInnoDBå°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸º**crash-safe**ã€‚\n\n### æ—¥å¿—æ¨¡å—ï¼šbinlog\n\nä¸Šé¢èŠåˆ°çš„redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„æ—¥å¿—ï¼Œè€ŒServerå±‚ä¹Ÿæœ‰è‡ªå·±çš„æ—¥å¿—ï¼Œç§°ä¸ºbinlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚\n\nå› ä¸ºæœ€å¼€å§‹MySQLé‡Œå¹¶æ²¡æœ‰InnoDBå¼•æ“ã€‚MySQLè‡ªå¸¦çš„å¼•æ“æ˜¯MyISAMï¼Œä½†æ˜¯MyISAMæ²¡æœ‰crash-safeçš„èƒ½åŠ›ï¼Œbinlogæ—¥å¿—åªèƒ½ç”¨äºå½’æ¡£ã€‚è€ŒInnoDBæ˜¯å¦ä¸€ä¸ªå…¬å¸ä»¥æ’ä»¶å½¢å¼å¼•å…¥MySQLçš„ï¼Œæ—¢ç„¶åªä¾é binlogæ˜¯æ²¡æœ‰crash-safeèƒ½åŠ›çš„ï¼Œæ‰€ä»¥InnoDBä½¿ç”¨å¦å¤–ä¸€å¥—æ—¥å¿—ç³»ç»Ÿâ€”â€”ä¹Ÿå°±æ˜¯redo logæ¥å®ç°crash-safeèƒ½åŠ›ã€‚\n\nä¸¤ç§æ—¥å¿—æœ‰ä»¥ä¸‹ä¸‰ç‚¹ä¸åŒã€‚\n\n1. redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚\n2. redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID=2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1 â€ã€‚\n3. redo logæ˜¯å¾ªç¯å†™çš„ï¼Œç©ºé—´å›ºå®šä¼šç”¨å®Œï¼›binlogæ˜¯å¯ä»¥è¿½åŠ å†™å…¥çš„ã€‚â€œè¿½åŠ å†™â€æ˜¯æŒ‡binlogæ–‡ä»¶å†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚\n\n```sql\nmysql> update T set c=c+1 where ID=2;\n```\n\næ‰§è¡Œä¸Šé¢è¿™æ¡updateè¯­å¥æ—¶æ‰§è¡Œå™¨å’ŒInnoDBå¼•æ“å†…éƒ¨çš„æµç¨‹ï¼š\n\n1. æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–ID=2è¿™ä¸€è¡Œã€‚IDæ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœID=2è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚\n\n2. æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯Nï¼Œç°åœ¨å°±æ˜¯N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚\n\n3. å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ°redo logé‡Œé¢ï¼Œæ­¤æ—¶redo logå¤„äºprepareçŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚\n\n4. æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„binlogï¼Œå¹¶æŠŠbinlogå†™å…¥ç£ç›˜ã€‚\n\n5. æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„redo logæ”¹æˆæäº¤ï¼ˆcommitï¼‰çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚\n\n![æ‰§è¡Œå™¨å’ŒInnoDBå¼•æ“å†…éƒ¨çš„æµç¨‹](https://xuhang.github.io/post-images/1733619501073.png)\n\ninnodb_flush_log_at_trx_commitè¿™ä¸ªå‚æ•°è®¾ç½®æˆ1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„redo logéƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚sync_binlogè¿™ä¸ªå‚æ•°è®¾ç½®æˆ1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„binlogéƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n\n> - binlog æœ‰ 3 ç§æ ¼å¼ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ STATEMENTï¼ˆé»˜è®¤æ ¼å¼ï¼‰ã€ROWã€ MIXEDï¼ŒåŒºåˆ«å¦‚ä¸‹ï¼š\n>   - STATEMENTï¼šæ¯ä¸€æ¡ä¿®æ”¹æ•°æ®çš„ SQL éƒ½ä¼šè¢«è®°å½•åˆ° binlog ä¸­ï¼ˆç›¸å½“äºè®°å½•äº†é€»è¾‘æ“ä½œï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æ ¼å¼ï¼Œ binlog å¯ä»¥ç§°ä¸ºé€»è¾‘æ—¥å¿—ï¼‰ï¼Œä¸»ä»å¤åˆ¶ä¸­ slave ç«¯å†æ ¹æ® SQL è¯­å¥é‡ç°ã€‚ä½† STATEMENT æœ‰åŠ¨æ€å‡½æ•°çš„é—®é¢˜ï¼Œæ¯”å¦‚ä½ ç”¨äº† uuid æˆ–è€… now è¿™äº›å‡½æ•°ï¼Œä½ åœ¨ä¸»åº“ä¸Šæ‰§è¡Œçš„ç»“æœå¹¶ä¸æ˜¯ä½ åœ¨ä»åº“æ‰§è¡Œçš„ç»“æœï¼Œè¿™ç§éšæ—¶åœ¨å˜çš„å‡½æ•°ä¼šå¯¼è‡´å¤åˆ¶çš„æ•°æ®ä¸ä¸€è‡´ï¼›\n>   - ROWï¼šè®°å½•è¡Œæ•°æ®æœ€ç»ˆè¢«ä¿®æ”¹æˆä»€ä¹ˆæ ·äº†ï¼ˆè¿™ç§æ ¼å¼çš„æ—¥å¿—ï¼Œå°±ä¸èƒ½ç§°ä¸ºé€»è¾‘æ—¥å¿—äº†ï¼‰ï¼Œä¸ä¼šå‡ºç° STATEMENT ä¸‹åŠ¨æ€å‡½æ•°çš„é—®é¢˜ã€‚ä½† ROW çš„ç¼ºç‚¹æ˜¯æ¯è¡Œæ•°æ®çš„å˜åŒ–ç»“æœéƒ½ä¼šè¢«è®°å½•ï¼Œæ¯”å¦‚æ‰§è¡Œæ‰¹é‡ update è¯­å¥ï¼Œæ›´æ–°å¤šå°‘è¡Œæ•°æ®å°±ä¼šäº§ç”Ÿå¤šå°‘æ¡è®°å½•ï¼Œä½¿ binlog æ–‡ä»¶è¿‡å¤§ï¼Œè€Œåœ¨ STATEMENT æ ¼å¼ä¸‹åªä¼šè®°å½•ä¸€ä¸ª update è¯­å¥è€Œå·²ï¼›\n>   - MIXEDï¼šåŒ…å«äº† STATEMENT å’Œ ROW æ¨¡å¼ï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„æƒ…å†µè‡ªåŠ¨ä½¿ç”¨ ROW æ¨¡å¼å’Œ STATEMENT æ¨¡å¼ï¼›\n> - redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯åœ¨æŸä¸ªæ•°æ®é¡µåšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œæ¯”å¦‚å¯¹ XXX è¡¨ç©ºé—´ä¸­çš„ YYY æ•°æ®é¡µ ZZZ åç§»é‡çš„åœ°æ–¹åšäº†AAA æ›´æ–°ï¼›\n\n## äº‹åŠ¡éš”ç¦»\n\n### éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«\n\näº‹åŠ¡æ‹¥æœ‰å››ä¸ªé‡è¦çš„ç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰\n\n- **åŸå­æ€§** ï¼ˆAtomicityï¼‰\n\näº‹åŠ¡å¼€å§‹åæ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸åšï¼Œä¸å¯èƒ½åœæ»åœ¨ä¸­é—´ç¯èŠ‚ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™ï¼Œä¼šå›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„æ“ä½œå°±åƒæ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚\n\n- **ä¸€è‡´æ€§** ï¼ˆConsistencyï¼‰\n\næŒ‡äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ç§çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ç§ä¸€è‡´çš„çš„çŠ¶æ€ã€‚äº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åã€‚\n\n- **éš”ç¦»æ€§** ï¼ˆIsolationï¼‰\n\nè¦æ±‚æ¯ä¸ªè¯»å†™äº‹åŠ¡çš„å¯¹è±¡å¯¹å…¶ä»–äº‹åŠ¡çš„æ“ä½œå¯¹è±¡èƒ½äº’ç›¸åˆ†ç¦»ï¼Œå³è¯¥äº‹åŠ¡æäº¤å‰å¯¹å…¶ä»–äº‹åŠ¡ä¸å¯è§ã€‚ ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¤šä¸ªäº‹åŠ¡å¹¶å‘è®¿é—®æ—¶ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸åº”è¯¥å½±å“å…¶å®ƒäº‹åŠ¡è¿è¡Œæ•ˆæœã€‚è¿™æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚\n\n> MySQL é€šè¿‡é”æœºåˆ¶æ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚\n\n- **æŒä¹…æ€§** ï¼ˆDurabilityï¼‰\n\näº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåˆ™å…¶ç»“æœå°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚å³ä½¿å‘ç”Ÿå®•æœºçš„æ•…éšœï¼Œæ•°æ®åº“ä¹Ÿèƒ½å°†æ•°æ®æ¢å¤ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡å®Œæˆåï¼Œäº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ–°å°†è¢«ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¸èƒ½å›æ»šã€‚\n\n| **éš”ç¦»çº§åˆ«**     | è„è¯» | **ä¸å¯é‡å¤è¯»** | **å¹»è¯»** |\n| ---------------- | ---- | -------------- | -------- |\n| SERIALIZABLE     | é¿å… | é¿å…           | é¿å…     |\n| REPEATABLE READ  | é¿å… | é¿å…           | å…è®¸     |\n| READ COMMITTED   | é¿å… | å…è®¸           | å…è®¸     |\n| READ UNCOMMITTED | å…è®¸ | å…è®¸           | å…è®¸     |\n\n>### å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«\n>\n>- ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹ï¼šåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æ¡ä»¶ï¼Œç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€è‡´ï¼ˆä¸­é—´æœ‰å…¶å®ƒäº‹åŠ¡æäº¤äº†ä¿®æ”¹ï¼‰ã€‚\n>- å¹»è¯»çš„é‡ç‚¹æ˜¯æ–°å¢æˆ–è€…åˆ é™¤ï¼šåœ¨åŒä¸€äº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æ¡ä»¶ï¼Œç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è¯»åˆ°çš„è®°å½•æ•°ä¸ä¸€æ ·ï¼ˆä¸­é—´æœ‰å…¶å®ƒäº‹åŠ¡æäº¤äº†æ–°å¢æˆ–è€…åˆ é™¤ï¼‰ã€‚\n\n![éš”ç¦»çº§åˆ«](https://xuhang.github.io/post-images/1733619524395.png)\n\nåœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Açš„è¿”å›ç»“æœï¼š\n\n- è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æœªæäº¤â€ï¼Œ åˆ™V1çš„å€¼å°±æ˜¯2ã€‚è¿™æ—¶å€™äº‹åŠ¡Bè™½ç„¶è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯ç»“æœå·²ç»è¢«Açœ‹åˆ°äº†ã€‚å› æ­¤ï¼ŒV2ã€V3ä¹Ÿéƒ½æ˜¯2ã€‚\n- è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œè¯»æäº¤â€ï¼Œåˆ™V1æ˜¯1ï¼ŒV2çš„å€¼æ˜¯2ã€‚äº‹åŠ¡Bçš„æ›´æ–°åœ¨æäº¤åæ‰èƒ½è¢«Açœ‹åˆ°ã€‚æ‰€ä»¥ï¼Œ V3çš„å€¼ä¹Ÿæ˜¯2ã€‚\n- è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œå¯é‡å¤è¯»â€ï¼Œåˆ™V1ã€V2æ˜¯1ï¼ŒV3æ˜¯2ã€‚ä¹‹æ‰€ä»¥V2è¿˜æ˜¯1ï¼Œéµå¾ªçš„å°±æ˜¯è¿™ä¸ªè¦æ±‚ï¼šäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®å‰åå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚\n- è‹¥éš”ç¦»çº§åˆ«æ˜¯â€œä¸²è¡ŒåŒ–â€ï¼Œåˆ™åœ¨äº‹åŠ¡Bæ‰§è¡Œâ€œå°†1æ”¹æˆ2â€çš„æ—¶å€™ï¼Œä¼šè¢«é”ä½ã€‚ç›´åˆ°äº‹åŠ¡Aæäº¤åï¼Œäº‹åŠ¡Bæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚æ‰€ä»¥ä»Açš„è§’åº¦çœ‹ï¼Œ V1ã€V2å€¼æ˜¯1ï¼ŒV3çš„å€¼æ˜¯2ã€‚\n\nåœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚åœ¨â€œ**å¯é‡å¤è¯»**â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨**äº‹åŠ¡å¯åŠ¨æ—¶**åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨â€œ**è¯»æäº¤**â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª**SQLè¯­å¥å¼€å§‹æ‰§è¡Œ**çš„æ—¶å€™åˆ›å»ºçš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ€œè¯»æœªæäº¤â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥è¿”å›è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µï¼›è€Œâ€œä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ã€‚\n\n### äº‹åŠ¡éš”ç¦»çš„å®ç°\n\nåœ¨MySQLä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚\n\n>ä¸ºä»€ä¹ˆå°½é‡ä¸è¦ä½¿ç”¨é•¿äº‹åŠ¡ï¼Ÿ\n>\n>é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚\n\n\n\n*å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶*ï¼ˆMultiversion Concurrency Controlï¼‰ï¼Œæ¯ä¸€ä¸ªå†™æ“ä½œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¯»æ“ä½œä¼šä»æœ‰é™å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ä¸­æŒ‘é€‰ä¸€ä¸ªæœ€åˆé€‚çš„ç»“æœç›´æ¥è¿”å›ï¼›åœ¨è¿™æ—¶ï¼Œè¯»å†™æ“ä½œä¹‹é—´çš„å†²çªå°±ä¸å†éœ€è¦è¢«å…³æ³¨ï¼Œè€Œç®¡ç†å’Œå¿«é€ŸæŒ‘é€‰æ•°æ®çš„ç‰ˆæœ¬å°±æˆäº† MVCC éœ€è¦è§£å†³çš„ä¸»è¦é—®é¢˜ã€‚\n\n#### MySQLä¸MVCC\n\nMySQL ä¸­å®ç°çš„å¤šç‰ˆæœ¬ä¸¤é˜¶æ®µé”åè®®ï¼ˆMultiversion 2PLï¼‰å°† MVCC å’Œ 2PL çš„ä¼˜ç‚¹ç»“åˆäº†èµ·æ¥ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®è¡Œéƒ½å…·æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ—¶é—´æˆ³ï¼Œå½“æœ‰è¯»äº‹åŠ¡è¯·æ±‚æ—¶ï¼Œæ•°æ®åº“ç¨‹åºä¼šç›´æ¥ä»å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®é¡¹ä¸­å…·æœ‰æœ€å¤§æ—¶é—´æˆ³çš„è¿”å›ã€‚\n\næ›´æ–°æ“ä½œå°±ç¨å¾®æœ‰äº›å¤æ‚äº†ï¼Œäº‹åŠ¡ä¼šå…ˆè¯»å–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®è®¡ç®—å‡ºæ•°æ®æ›´æ–°åçš„ç»“æœï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œæ–°æ•°æ®çš„æ—¶é—´æˆ³æ˜¯ç›®å‰æ•°æ®è¡Œçš„æœ€å¤§ç‰ˆæœ¬ `ï¼‹1`ï¼š\n\næ•°æ®ç‰ˆæœ¬çš„åˆ é™¤ä¹Ÿæ˜¯æ ¹æ®æ—¶é—´æˆ³æ¥é€‰æ‹©çš„ï¼ŒMySQL ä¼šå°†ç‰ˆæœ¬æœ€ä½çš„æ•°æ®å®šæ—¶ä»æ•°æ®åº“ä¸­æ¸…é™¤ä»¥ä¿è¯ä¸ä¼šå‡ºç°å¤§é‡çš„é—ç•™å†…å®¹ã€‚\n\n#### äº‹åŠ¡çš„èµ·ç‚¹\n\n`begin`/`start transaction` å‘½ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„èµ·ç‚¹ï¼Œåœ¨æ‰§è¡Œåˆ°å®ƒä»¬ä¹‹åçš„ç¬¬ä¸€ä¸ªæ“ä½œInnoDBè¡¨çš„è¯­å¥ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ã€‚å¦‚æœä½ æƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨`start transaction with consistent snapshot `è¿™ä¸ªå‘½ä»¤ã€‚\n\nåœ¨MySQLé‡Œï¼Œæœ‰ä¸¤ä¸ªâ€œè§†å›¾â€çš„æ¦‚å¿µï¼š\n\n- ä¸€ä¸ªæ˜¯viewã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯create view â€¦ ï¼Œè€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸è¡¨ä¸€æ ·ã€‚\n- å¦ä¸€ä¸ªæ˜¯InnoDBåœ¨å®ç°MVCCæ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³consistent read viewï¼Œç”¨äºæ”¯æŒRCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’ŒRRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚\n\n### äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼\n\nMySQLçš„äº‹åŠ¡å¯åŠ¨æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n1. æ˜¾å¼å¯åŠ¨äº‹åŠ¡è¯­å¥ï¼Œ begin æˆ– start transactionã€‚é…å¥—çš„æäº¤è¯­å¥æ˜¯commitï¼Œå›æ»šè¯­å¥æ˜¯rollbackã€‚\n2. set autocommit=0ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†è¿™ä¸ªçº¿ç¨‹çš„è‡ªåŠ¨æäº¤å…³æ‰ã€‚æ„å‘³ç€å¦‚æœä½ åªæ‰§è¡Œä¸€ä¸ªselectè¯­å¥ï¼Œè¿™ä¸ªäº‹åŠ¡å°±å¯åŠ¨äº†ï¼Œè€Œä¸”å¹¶ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚è¿™ä¸ªäº‹åŠ¡æŒç»­å­˜åœ¨ç›´åˆ°ä½ ä¸»åŠ¨æ‰§è¡Œcommit æˆ– rollback è¯­å¥ï¼Œæˆ–è€…æ–­å¼€è¿æ¥ã€‚\n\n## ç´¢å¼•\n\n### InnoDB çš„ç´¢å¼•æ¨¡å‹\n\nåœ¨InnoDBä¸­ï¼Œè¡¨éƒ½æ˜¯æ ¹æ®**ä¸»é”®é¡ºåº**ä»¥ç´¢å¼•çš„å½¢å¼å­˜æ”¾çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨ã€‚\n\næ¯ä¸€ä¸ªç´¢å¼•åœ¨InnoDBé‡Œé¢å¯¹åº”ä¸€æ£µB+æ ‘ã€‚\n\næ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚\n\n- ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚åœ¨InnoDBé‡Œï¼Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ï¼ˆclustered indexï¼‰ã€‚\n- éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å†…å®¹æ˜¯ä¸»é”®çš„å€¼ã€‚åœ¨InnoDBé‡Œï¼Œéä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼ˆsecondary indexï¼‰ã€‚\n\n\n> **åŸºäºä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•æŸ¥è¯¢çš„åŒºåˆ«**\n>\n> - å¦‚æœè¯­å¥æ˜¯select * from T where ID=500ï¼Œå³ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢IDè¿™æ£µB+æ ‘ï¼›\n> - å¦‚æœè¯­å¥æ˜¯select * from T where k=5ï¼Œå³æ™®é€šç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™éœ€è¦å…ˆæœç´¢kç´¢å¼•æ ‘ï¼Œå¾—åˆ°IDçš„å€¼ä¸º500ï¼Œå†åˆ°IDç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º**å›è¡¨**ã€‚\n>\n> *åŸºäºéä¸»é”®ç´¢å¼•çš„æŸ¥è¯¢éœ€è¦å¤šæ‰«æä¸€æ£µç´¢å¼•æ ‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­åº”è¯¥å°½é‡ä½¿ç”¨ä¸»é”®æŸ¥è¯¢ã€‚*\n\n### è¦†ç›–ç´¢å¼•\n\nå¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œç§°ä¸º**è¦†ç›–ç´¢å¼•**ï¼Œå³åªéœ€æ‰«æç´¢å¼•è€Œæ— é¡»å›è¡¨ã€‚ç”±äºè¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚\n\n### æœ€å·¦å‰ç¼€åŸåˆ™\n\nå¯¹äºè”åˆç´¢å¼•çš„ç´¢å¼•é¡¹æ˜¯æŒ‰ç…§ç´¢å¼•å®šä¹‰é‡Œé¢å‡ºç°çš„å­—æ®µé¡ºåºæ’åºçš„ï¼Œæ¯”å¦‚å¯¹åˆ—Aï¼ŒBï¼ŒCå»ºç«‹è”åˆç´¢å¼•ï¼Œå®é™…ä¸Šæ˜¯å»ºç«‹äº†(A)ï¼Œ(A, B)ï¼Œ(A, B, C)ä¸‰ä¸ªç´¢å¼•ã€‚\n\n1. MySQLä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(`>`ã€`<`ã€`between`ã€`like`)å°±åœæ­¢åŒ¹é…ï¼Œæ¯”å¦‚A = 1 and B = 2 and C > 3 and D = 4 å¦‚æœå»ºç«‹(Aï¼ŒBï¼ŒCï¼ŒD)é¡ºåºçš„ç´¢å¼•ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå¦‚æœå»ºç«‹(Aï¼ŒBï¼ŒDï¼ŒC)çš„ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼ŒAï¼ŒBï¼ŒDçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚\n\n2. `=`å’Œ`in`å¯ä»¥ä¹±åºï¼Œæ¯”å¦‚A = 1 and B = 2 and C = 3 å»ºç«‹(Aï¼ŒBï¼ŒC)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼ã€‚\n\n**ä¸ºä»€ä¹ˆè¦ç”¨è”åˆç´¢å¼•**\n\n- å‡å°‘å¼€é”€ã€‚å»ºä¸€ä¸ªï¼ˆAï¼ŒBï¼ŒCï¼‰çš„è”åˆç´¢å¼•ï¼Œå®é™…ä¸Šæ˜¯å»ºç«‹äº†(A)ï¼Œ(A, B)ï¼Œ(A, B, C)ä¸‰ä¸ªç´¢å¼•ã€‚\n- è¦†ç›–ç´¢å¼•ã€‚è”åˆç´¢å¼•ï¼ˆAï¼ŒBï¼ŒCï¼‰çš„å¶èŠ‚ç‚¹åŒ…å«ABCä¸‰åˆ—çš„æ•°æ®ï¼Œå¦‚æœæŸ¥è¯¢çš„åˆ—åœ¨ï¼ˆAï¼ŒBï¼ŒCï¼‰ä¹‹ä¸­å¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•è·å–åˆ°æ•°æ®ï¼Œæ— éœ€å›è¡¨ï¼Œå‡å°‘æ ‘çš„éšæœºIOã€‚\n- æ•ˆç‡é«˜ã€‚é€šè¿‡è”åˆç´¢å¼•ç­›é€‰å‡ºçš„æ•°æ®å°‘ï¼Œåˆ—è¶Šå¤šæ•°æ®è¶Šå°‘\n\n### ç´¢å¼•ä¸‹æ¨\n\nå¯¹äº**è”åˆç´¢å¼•**ä¸­ä¸ç¬¦åˆæœ€å·¦å‰ç¼€çš„éƒ¨åˆ†ï¼ŒMySQLçš„å¤„ç†æ–¹å¼ï¼š\n\n- åœ¨MySQL 5.6ä¹‹å‰ï¼Œåªèƒ½ä»ç¬¬ä¸€ä¸ªæ»¡è¶³æœ€å·¦å‰ç¼€ç´¢å¼•çš„æ•°æ®å¼€å§‹ä¸€ä¸ªä¸ªå›è¡¨ã€‚åˆ°ä¸»é”®ç´¢å¼•ä¸Šæ‰¾å‡ºæ•°æ®è¡Œï¼Œå†å¯¹æ¯”å­—æ®µå€¼ã€‚\n- è€ŒMySQL 5.6 å¼•å…¥çš„**ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–**ï¼ˆindex condition pushdown)ï¼Œ å¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚\n\nä¹Ÿå°±æ˜¯è¯´åœ¨5.6ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¸ç¬¦åˆæœ€å·¦å‰ç¼€çš„éƒ¨åˆ†å¯¹InnoDBå¼•æ“æ˜¯æ²¡ç”¨çš„ï¼Œ5.6åŠä»¥åçš„ç‰ˆæœ¬è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç›´æ¥åœ¨ç´¢å¼•ä¸Šè¿›è¡Œç­›é€‰ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚\n\n### æ™®é€šç´¢å¼•\n\nå½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDBä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨change bufferä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œchange bufferä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚\n\n> å”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨change buffer\n\nå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚\n\n## é”\n\n### å…¨å±€é”\n\nå…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ã€‚MySQLæä¾›äº†ä¸€ä¸ªåŠ å…¨å±€è¯»é”çš„æ–¹æ³•ï¼Œå‘½ä»¤æ˜¯ Flush tables with read lock (FTWRL)ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹åå…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚\n\n**å…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ã€‚**ä¹Ÿå°±æ˜¯æŠŠæ•´åº“æ¯ä¸ªè¡¨éƒ½selectå‡ºæ¥å­˜æˆæ–‡æœ¬ã€‚\n\nå¯¹äºæ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œæ¯”å¦‚InnoDBï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾ï¼Œè€Œä¸”ç”±äºMVCCçš„æ”¯æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é”åº“ã€‚å¯¹äºä¸æ”¯æŒäº‹åŠ¡çš„å¼•æ“ï¼Œæ¯”å¦‚MyISAMï¼Œå°±éœ€è¦å…¨å±€é”FTWRLæ¥é¿å…æ•°æ®çš„æ›´æ–°ã€‚\n\n> **set global readonly=true**çš„æ–¹å¼ä¹Ÿèƒ½ä½¿æ•´ä¸ªåº“åªè¯»ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸¤ä¸ªå¼Šç«¯ï¼š\n>\n> 1. åœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonlyçš„å€¼ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚\n> 2. åœ¨å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸Šæœ‰å·®å¼‚ã€‚å¦‚æœæ‰§è¡ŒFTWRLå‘½ä»¤ä¹‹åç”±äºå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼Œé‚£ä¹ˆMySQLä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ï¼Œæ•´ä¸ªåº“å›åˆ°å¯ä»¥æ­£å¸¸æ›´æ–°çš„çŠ¶æ€ã€‚è€Œå°†æ•´ä¸ªåº“è®¾ç½®ä¸ºreadonlyä¹‹åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æ•°æ®åº“å°±ä¼šä¸€ç›´ä¿æŒreadonlyçŠ¶æ€ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•´ä¸ªåº“é•¿æ—¶\n> 3. é—´å¤„äºä¸å¯å†™çŠ¶æ€ï¼Œé£é™©è¾ƒé«˜ã€‚\n\n### è¡¨çº§é”\n\nMySQLé‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)ã€‚\n\n**è¡¨é”çš„è¯­æ³•æ˜¯ lock tables â€¦ read/writeã€‚**ä¸FTWRLç±»ä¼¼ï¼Œå¯ä»¥ç”¨unlock tablesä¸»åŠ¨é‡Šæ”¾é”ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾ã€‚éœ€è¦æ³¨æ„ï¼Œlock tablesè¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚\n\n**å¦ä¸€ç±»è¡¨çº§çš„é”æ˜¯MDLï¼ˆmetadata lock)ã€‚**MDLä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚MDLçš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚\n\nMySQL 5.5ç‰ˆæœ¬ä¸­å¼•å…¥äº†MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚\n\n- è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨**å¢åˆ æ”¹æŸ¥**ã€‚\n- **è¯»å†™é”**ä¹‹é—´ã€**å†™é”**ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ã€‚\n\n| æ—¶é—´çº¿ | session A       | session B       | session C                        | session D               |\n| ------ | --------------- | --------------- | -------------------------------- | ----------------------- |\n| t1     | begin -> select |                 |                                  |                         |\n| t2     |                 | begin -> select |                                  |                         |\n| t3     |                 |                 | begin -> **alter table**ã€é˜»å¡ã€‘ |                         |\n| t4     |                 |                 |                                  | begin -> selectã€é˜»å¡ã€‘ |\n\n> **å¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ**\n>\n> æ¯”è¾ƒç†æƒ³çš„æœºåˆ¶æ˜¯ï¼Œåœ¨alter tableè¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°MDLå†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚\n\n```sql\nALTER TABLE tbl_name NOWAIT add column ...\nALTER TABLE tbl_name WAIT N add column ... \n```\n\n### è¡Œé”\n\nMySQLçš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚MyISAMå¼•æ“å°±ä¸æ”¯æŒè¡Œé”ã€‚ä¸æ”¯æŒè¡Œé”æ„å‘³ç€å¹¶å‘æ§åˆ¶åªèƒ½ä½¿ç”¨è¡¨é”ï¼Œå¯¹äºè¿™ç§å¼•æ“çš„è¡¨ï¼ŒåŒä¸€å¼ è¡¨ä¸Šä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°åœ¨æ‰§è¡Œï¼Œè¿™å°±ä¼šå½±å“åˆ°ä¸šåŠ¡å¹¶å‘åº¦ã€‚InnoDBæ˜¯æ”¯æŒè¡Œé”çš„ï¼Œè¿™ä¹Ÿæ˜¯MyISAMè¢«InnoDBæ›¿ä»£çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚\n\n#### ä¸¤é˜¶æ®µé”\n\n**åœ¨InnoDBäº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚**\n\n> å¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚è¿™æ ·äº‹åŠ¡ä¹‹é—´é”ç­‰å¾…çš„æ—¶é—´æœ€å°‘ï¼Œæé«˜å¹¶å‘åº¦ã€‚\n\n### æ­»é”å’Œæ­»é”æ£€æµ‹\n\nå½“å¹¶å‘ç³»ç»Ÿä¸­ä¸åŒçº¿ç¨‹å‡ºç°å¾ªç¯èµ„æºä¾èµ–ï¼Œæ¶‰åŠçš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…åˆ«çš„çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œå°±ä¼šå¯¼è‡´è¿™å‡ ä¸ªçº¿ç¨‹éƒ½è¿›å…¥æ— é™ç­‰å¾…çš„çŠ¶æ€ï¼Œç§°ä¸ºæ­»é”ã€‚\n\nè§£å†³æ­»é”çš„ä¸¤ç§ç­–ç•¥ï¼š\n\n1. ç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•°innodb_lock_wait_timeoutæ¥è®¾ç½®ï¼Œä½†æ˜¯ä¼šè¯¯ä¼¤ç­‰å¾…éæ­»é”çš„æŸ¥è¯¢ã€‚\n2. å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°innodb_deadlock_detectè®¾ç½®ä¸ºonï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚ä½†æ˜¯æ­»é”æ£€æµ‹åœ¨å¹¶å‘æƒ…å†µä¸‹ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºã€‚\n\nç»“åˆå®é™…æƒ…å†µä¸­çš„åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯å¯ç”¨æ­»é”æ£€æµ‹ï¼Œæ§åˆ¶å®¢æˆ·ç«¯çš„å¹¶å‘æ•°ï¼Œè¿™æ ·æ­»é”æ£€æµ‹ä¸è‡³äºå¤ªå ç”¨CPUèµ„æºã€‚\n\n## å¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±\n\n### binlogå†™å…¥æœºåˆ¶\n\näº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å°†æ—¥å¿—å†™åˆ° binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå°† binlog cache å†™å…¥ binlog æ–‡ä»¶ä¸­ã€‚ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†åˆ†çš„ï¼Œå¦‚æœè¿™ä¸ªäº‹åŠ¡å¤šçš„ï¼Œéƒ½è¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚ç³»ç»Ÿç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ª binlog cache å†…å­˜åŒºåŸŸï¼ˆä½†æ˜¯ binlog æ–‡ä»¶åªæœ‰ä¸€ä»½ï¼‰ï¼Œå‚æ•°`binlog_cache_size`ç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†… binlog cache æ‰€å å†…å­˜å¤§å°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ä¸Šã€‚äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼ŒæŠŠ binlog cache ä¸­çš„å®Œæ•´äº‹åŠ¡å†™å…¥ binlog ä¸­ï¼Œå¹¶æ¸…ç©º binlog cacheã€‚\n\nå‚æ•°`sync_binlog`çš„å«ä¹‰ï¼š\n\n+ `0` ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤åª writeï¼ˆå°† binlog cache ä¸­å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„ page cacheï¼‰ï¼Œä¸ fsyncï¼ˆå°† page cache ä¸­æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼‰\n+ `1`ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½ä¼šæ‰§è¡Œ fsync\n+ `N`ï¼šæ¯æ¬¡æäº¤éƒ½ writeï¼Œä½†æ˜¯ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsync\n\n### redo log å†™å…¥æœºåˆ¶\n\näº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å°†æ—¥å¿—å†™åˆ° redo log bufferï¼Œç„¶åç”±`innodb_flush_log_at_trx_commit`å‚æ•°æ§åˆ¶ redo log æŒä¹…åŒ–çš„é€»è¾‘ã€‚\n\nå‚æ•°`innodb_flush_log_at_trx_commit`çš„å«ä¹‰ï¼š\n\n+ `0`ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤åªæ˜¯æŠŠ redo log ç•™åœ¨ redo log buffer ä¸­ï¼›\n+ `1`ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤éƒ½å°† redo log æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼›\n+ `2`ï¼šæ¯æ¬¡äº‹åŠ¡æäº¤åªæ˜¯æŠŠ redo log å†™åˆ° page cacheã€‚\n\nåŒæ—¶ï¼ŒInnoDB åå°æœ‰ä¸ªçº¿ç¨‹ï¼Œæ¯éš” 1sï¼Œå°† redo log buffer ä¸­çš„æ—¥å¿—è°ƒç”¨ write å†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„ page cache ä¸­ï¼Œç„¶åè°ƒç”¨ fsync æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚æ‰€ä»¥äº‹åŠ¡æœªæäº¤æ—¶ï¼Œredo log buffer ä¸­çš„å†…å®¹ä¹Ÿæœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸Šã€‚\n\næ­¤å¤–ï¼Œè¿˜æœ‰ 2 ç§æƒ…å†µä¼šè®©æ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å†™å…¥ç£ç›˜ï¼š\n\n1. redo log buffer å ç”¨ç©ºé—´å³å°†è¾¾åˆ°`innodb_log_buffer_size`çš„ä¸€åŠæ—¶ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜(writeï¼Œæ²¡æœ‰ fsync)ã€‚\n2. å¹¶è¡Œäº‹åŠ¡æäº¤æ—¶ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„ redo log buffer æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚\n\n### ç»„æäº¤ï¼ˆGroup commitï¼‰æœºåˆ¶\n\næ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence number, LSNï¼‰:å•è°ƒé€’å¢ï¼Œå¯¹åº” redo log ä¸Šçš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ï¼Œæ¯æ¬¡å†™å…¥é•¿åº¦ä¸º length çš„ redo logï¼ŒLSN çš„å€¼å°±ä¼šåŠ ä¸Š lengthã€‚\n\nLSN ä¹Ÿä¼šå†™åˆ° InnoDB çš„æ•°æ®é¡µä¸­ï¼Œç”¨æ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„ redo logã€‚\n\nå¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œï¼Œæœ€å…ˆåˆ°è¾¾çš„ä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leaderï¼›leader å†™ç›˜çš„æ—¶å€™ä¼šå°†æ•´ç»„çš„ redo log ä¸€èµ·æŒä¹…åŒ–ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ IOPS çš„æ•ˆæœè¶Šå¥½ã€‚\n\n`binlog_group_commit_sync_delay`ï¼šbinlog è°ƒç”¨ write å¤šå°‘å¾®å¦™åæ‰è°ƒç”¨ fsync\n\n`binlog_group_commit_sync_no_delay_count`ï¼šç´¯ç§¯å¤šå°‘æ¬¡åè°ƒç”¨ fsync\n\n## å¦‚ä½•ä¿è¯ä¸»å¤‡ä¸€è‡´\n\né€šå¸¸å°†å¤‡åº“è®¾ç½®æˆåªè¯»(readonly)ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ¤æ–­èŠ‚ç‚¹çŠ¶æ€ï¼Œä½†æ˜¯ readonly å¹¶ä¸å½±å“å¤‡åº“å’Œä¸»åº“ä¿æŒåŒæ­¥ã€‚åŒæ­¥æ›´æ–°çš„çº¿ç¨‹ï¼Œæ‹¥æœ‰è¶…çº§æƒé™ï¼Œè€Œ readonly å¯¹è¶…çº§æƒé™ç”¨æˆ·æ˜¯æ— æ•ˆçš„ã€‚\n\näº‹åŠ¡æ—¥å¿—åŒæ­¥çš„å®Œæ•´è¿‡ç¨‹ï¼š\n\n1. å¤‡åº“ä¸Šé€šè¿‡`change master`å‘½ä»¤è®¾ç½®ä¸»åº“ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ä»¥åŠ binlog æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡ï¼ˆä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼‰\n2. åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ`start slave`å‘½ä»¤ï¼Œå¯åŠ¨`io_thread`å’Œ`sql_thread`ä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«ç”¨äºè´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥å’Œè§£ææ—¥å¿—æ‰§è¡Œ\n3. ä¸»åº“æ ¡éªŒå®Œç”¨æˆ·åå¯†ç åï¼ŒæŒ‰ç…§å¤‡åº“åˆ¶å®šçš„æ–‡ä»¶å’Œä½ç½®ï¼Œè¯»å– binlog å‘é€ç»™å¤‡åº“\n4. å¤‡åº“æ‹¿åˆ° binlog åå†™å…¥æœ¬åœ°æ–‡ä»¶ï¼ˆä¸­è½¬æ—¥å¿— relay logï¼‰\n5. sql_thread ä»ä¸­è½¬æ—¥å¿—è¯»å–å¹¶è§£æï¼Œç„¶åæ‰§è¡Œ\n\n### binlog çš„ä¸‰ç§æ ¼å¼\n\n+ `STATEMENT`ï¼šbinlog è®°å½•çš„æ—¶åŸå§‹ SQL è¯­å¥ï¼ˆå¯èƒ½å¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´ï¼‰\n+ `ROW`ï¼šè®°å½•çš„æ˜¯å—å½±å“çš„è®°å½•ï¼ˆå ç”¨ç©ºé—´ï¼‰ï¼Œä½†æ˜¯æ–¹ä¾¿æ¢å¤æ•°æ®\n+ `MIXED`ï¼šç”± MySQL åˆ¤æ–­æ˜¯å¦ä¼šå½±å“ä¸»å¤‡ä¸ä¸€è‡´é€‰æ‹© ROW æˆ– STATEMENT\n\n>é€šè¿‡ SQLæŸ¥çœ‹ binlog ä¸­çš„å†…å®¹ï¼š\n>\n>```show binlog events in 'xxxx.0000001';```\n>\n>å€ŸåŠ© mysqlbinlog å·¥å…·æŸ¥çœ‹ binlog è¯¦ç»†ä¿¡æ¯ï¼š\n>\n>```mysqlbinlog -vv data/master.000001[binlog æ–‡ä»¶] --start-position=9xxx[ä»æŒ‡å®šè¡Œå¼€å§‹è§£æ] --stop-position=9xxx[è§£ææˆªæ­¢åˆ°åˆ¶å®šè¡Œ]```\n\n",
      "data": {
        "title": "MySQL45 è®²ç¬”è®°",
        "date": "2024-12-08 08:56:12",
        "tags": [
          "mysql",
          "geektime",
          "note"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/mysql45-jiang-bi-ji.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## åŸºç¡€æ¶æ„\n![MySQL åŸºç¡€æ¶æ„](https://xuhang.github.io/post-images/1733619417022.png)\n\n### è¿æ¥å™¨\n\nè¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚\n- å¦‚æœç”¨æˆ·åæˆ–å¯†ç ä¸å¯¹ï¼Œä½ å°±ä¼šæ”¶åˆ°ä¸€ä¸ª\"Access denied for user\"çš„é”™è¯¯ï¼Œç„¶åå®¢æˆ·ç«¯ç¨‹åºç»“æŸæ‰§è¡Œã€‚\n-   å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚",
      "fileName": "mysql45-jiang-bi-ji"
    },
    {
      "content": "## æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„\n\n| æ•°æ®ç±»å‹   | æ•°æ®ç»“æ„                             |\n| ---------- | ------------------------------------ |\n| String     | SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰                |\n| List       | åŒå‘é“¾è¡¨ã€å‹ç¼©åˆ—è¡¨(ZipList)          |\n| Hash       | å‹ç¼©åˆ—è¡¨(ZipList)ã€å“ˆå¸Œè¡¨(HashTable) |\n| Set        | æ•´æ•°æ•°ç»„(IntSet)ã€å“ˆå¸Œè¡¨(HashTable)  |\n| Sorted Set | å‹ç¼©åˆ—è¡¨(ZipList)ã€è·³è¡¨(SkipList)    |\n\n### å‹ç¼©åˆ—è¡¨\n\nå‹ç¼©åˆ—è¡¨ç±»ä¼¼æ•°ç»„ï¼Œä¸åŒçš„æ˜¯å‹ç¼©åˆ—è¡¨è¡¨å¤´æœ‰3ä¸ªå­—æ®µ`zlbytes`ã€`zltail`ã€`zllen`ï¼Œåˆ†åˆ«è¡¨ç¤ºåˆ—è¡¨é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€åˆ—è¡¨å°¾å…ƒç´ åç§»é‡ã€åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°ã€‚æ­¤å¤–åˆ—è¡¨å°¾è¿˜æœ‰ä¸€ä¸ª`zlend`è¡¨ç¤ºåˆ—è¡¨ç»“æŸï¼Œå›ºå®šå€¼`0xFF`ã€‚\n<!-- more -->\n\n![](https://xuhang.github.io/post-images/1733574319043.png)\n\nå‹ç¼©åˆ—è¡¨åªæœ‰æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå…ƒç´ ã€æœ€åä¸€ä¸ªå…ƒç´ è·å–åˆ—è¡¨é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸º`O(1)`ï¼ŒæŸ¥æ‰¾å…¶ä»–å…ƒç´ ä¸º`O(N)`ã€‚\n\n```\narea        |<------------------- entry -------------------->|\n\n            +------------------+----------+--------+---------+\ncomponent   | pre_entry_length | encoding | length | content |\n            +------------------+----------+--------+---------+\n```\n\npre_entry_length:\n\n- `1` å­—èŠ‚ï¼šå¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å°äº `254` å­—èŠ‚ï¼Œä¾¿ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚ä¿å­˜å®ƒçš„å€¼ã€‚\n- `5` å­—èŠ‚ï¼šå¦‚æœå‰ä¸€èŠ‚ç‚¹çš„é•¿åº¦å¤§äºç­‰äº `254` å­—èŠ‚ï¼Œé‚£ä¹ˆå°†ç¬¬ `1` ä¸ªå­—èŠ‚çš„å€¼è®¾ä¸º `254` ï¼Œç„¶åç”¨æ¥ä¸‹æ¥çš„ `4` ä¸ªå­—èŠ‚ä¿å­˜å®é™…é•¿åº¦ã€‚\n\nRedis åŸºäºå‹ç¼©åˆ—è¡¨å®ç°äº† Listã€Hash å’Œ Sorted Set é›†åˆç±»å‹ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚\n\n### è·³è¡¨\n\næœ¬è´¨æ˜¯ä¸€ä¸ªæœ‰åºé“¾è¡¨ï¼Œé€šè¿‡å¢åŠ å¤šçº§ç´¢å¼•ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿå®šä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(LogN)`ã€‚\n\n### Hash\n\nRedis Hash ç±»å‹æœ‰ä¸¤ç§åº•å±‚å®ç°ï¼Œåˆ†åˆ«æ˜¯å‹ç¼©åˆ—è¡¨å’Œå“ˆå¸Œè¡¨ã€‚\n\n`hash-max-ziplist-entries`ï¼šç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜å“ˆå¸Œæ—¶çš„æœ€å¤§å…ƒç´ ä¸ªæ•°ï¼Œé»˜è®¤ 512\n\n`hash-max-ziplist-value`ï¼šç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜å“ˆå¸Œæ—¶å•ä¸ªå…ƒç´ çš„æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤ 64\n\näºŒè€…æ»¡è¶³ä¸€ä¸ªè¶…è¿‡é˜ˆå€¼ï¼ŒRedis å°±ä¼šè‡ªåŠ¨æŠŠ Hash çš„å®ç°ç”±å‹ç¼©åˆ—è¡¨è½¬ä¸ºå“ˆå¸Œè¡¨ï¼Œä¹‹åå°±ä¼šä¸€ç›´ç”¨å“ˆå¸Œè¡¨è¿›è¡Œä¿å­˜ï¼Œä¸ä¼šè½¬å›ä¸ºå‹ç¼©åˆ—è¡¨ã€‚\n\nå½“ä½¿ç”¨ `REDIS_ENCODING_ZIPLIST` ç¼–ç å“ˆå¸Œè¡¨æ—¶ï¼Œ ç¨‹åºé€šè¿‡å°†é”®å’Œå€¼ä¸€åŒæ¨å…¥å‹ç¼©åˆ—è¡¨ï¼Œ ä»è€Œå½¢æˆä¿å­˜å“ˆå¸Œè¡¨æ‰€éœ€çš„é”®-å€¼å¯¹ç»“æ„ã€‚\n\n![](https://xuhang.github.io/post-images/1733574355472.png)\n\næ–°æ·»åŠ çš„ key-value å¯¹ä¼šè¢«æ·»åŠ åˆ°å‹ç¼©åˆ—è¡¨çš„è¡¨å°¾ã€‚\n\nå½“è¿›è¡ŒæŸ¥æ‰¾/åˆ é™¤æˆ–æ›´æ–°æ“ä½œæ—¶ï¼Œç¨‹åºå…ˆå®šä½åˆ°é”®çš„ä½ç½®ï¼Œç„¶åå†é€šè¿‡å¯¹é”®çš„ä½ç½®æ¥å®šä½å€¼çš„ä½ç½®ã€‚\n\n## Redis 6.0æ–°ç‰¹æ€§\n\n### å¤šçº¿ç¨‹å¤„ç†ç½‘ç»œè¯·æ±‚\n\nåªæ˜¯ç”¨å¤šçº¿ç¨‹å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œè¯»å†™å‘½ä»¤ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹ã€‚å¯ä»¥æœ‰æ•ˆè§£å†³ç½‘ç»œIOçš„ç“¶é¢ˆï¼Œæå‡æ•´ä½“æ€§èƒ½ã€‚\n\n```ini\nio-threads-do-reads yes\n# å¯ç”¨å¤šçº¿ç¨‹å¤„ç†IO\n\nio-threads 6\n# çº¿ç¨‹æ•°\n```\n\n### Tracking\n\nä¸šåŠ¡åº”ç”¨ä¸­çš„Rediså®¢æˆ·ç«¯å¯ä»¥æŠŠè¯»å–çš„æ•°æ®ç¼“å­˜åœ¨ä¸šåŠ¡åº”ç”¨æœ¬åœ°ã€‚\n\n**æ™®é€šæ¨¡å¼**ï¼šå®ä¾‹ä¼šåœ¨æœåŠ¡ç«¯è®°å½•å®¢æˆ·ç«¯è¯»å–è¿‡çš„keyï¼Œå¹¶ç›‘æ§keyæ˜¯å¦æœ‰ä¿®æ”¹ï¼Œå¦‚æœå‘é€å˜åŒ–ï¼ŒæœåŠ¡ç«¯ä¼šç»™å®¢æˆ·ç«¯å‘é€`invalidate`æ¶ˆæ¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ç¼“å­˜å¤±æ•ˆã€‚ä½†æ˜¯è¯¥æ¶ˆæ¯åªä¼šå‘é€ä¸€æ¬¡ï¼Œåªæœ‰å®¢æˆ·ç«¯å†æ¬¡ä»æœåŠ¡ç«¯è¯»å–æ•°æ®æ—¶ï¼Œå¯èƒ½å†æ¬¡å‘é€ã€‚é€šè¿‡å‘½ä»¤`CLIENT TRACKING ON|OFF`å¯ç”¨æˆ–å…³é—­ã€‚\n\n**å¹¿æ’­æ¨¡å¼**ï¼šæœåŠ¡ç«¯ä¼šç»™å®¢æˆ·ç«¯å¹¿æ’­æ‰€æœ‰keyçš„å¤±æ•ˆæƒ…å†µï¼Œå¦‚æœkeyè¢«é¢‘ç¹ä¿®æ”¹ï¼Œå¯èƒ½ä¼šæ¶ˆè€—å¤§é‡ç½‘ç»œå¸¦å®½ã€‚\n\n```shell\nCLIENT TRACKING ON BCAST PREFIX user\n# å®¢æˆ·ç«¯æŒ‡å®šç›‘å¬çš„keyçš„å‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€çš„keyè¢«ä¿®æ”¹åï¼ŒæœåŠ¡ç«¯ä¼šç»™å®¢æˆ·ç«¯å‘é€invalidateæ¶ˆæ¯ã€‚éœ€è¦keyçš„å‘½åè§„èŒƒã€‚\n```\n\nä¸Šé¢çš„ä¸¤ç§æ¨¡å¼éœ€è¦ä½¿ç”¨6.0æ–°å¢çš„`RESP 3`é€šä¿¡åè®®ï¼Œå¯¹äºä½¿ç”¨`RESP 2`\tåè®®çš„å®¢æˆ·ç«¯ï¼Œéœ€è¦ä½¿ç”¨é‡å®šå‘æ¨¡å¼ï¼Œå³å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨`SUBSCRIBE`å‘½ä»¤è®¢é˜…`_redis_:invalidate`é¢‘é“ç”¨äºç›‘å¬keyå¤±æ•ˆçš„æ¶ˆæ¯ï¼ŒåŒæ—¶è¿˜éœ€è¦æ‰§è¡Œ`CLIENT TRACKING`å‘½ä»¤ï¼Œç”¨äºæ¥æ”¶`RESP 2`å®¢æˆ·ç«¯é‡å®šå‘è¿‡æ¥çš„æ¶ˆæ¯ã€‚\n\n### æƒé™æ§åˆ¶\n\n6.0ä¹‹å‰åªèƒ½é€šè¿‡è®¾ç½®å¯†ç æ¥æ§åˆ¶å®‰å…¨è®¿é—®ï¼Œ6.0æä¾›äº†æ›´åŠ ç»†ç²’åº¦çš„è®¿é—®æƒé™æ§åˆ¶ã€‚\n\n**ç”¨æˆ·**ï¼š6.0ä¹‹å‰æ²¡æœ‰ç”¨æˆ·æ¦‚å¿µï¼Œ6.0å¯ä»¥åˆ›å»ºç”¨æˆ·å¹¶å•ç‹¬è®¾ç½®å¯†ç \n\n```shell\nACL SETUSER <USER-NAME> on > <PSSWORD>\n```\n\n**æƒé™**ï¼šå¯ä»¥å°†å…·ä½“çš„æ“ä½œæƒé™ï¼Œèµ‹äºˆç»™ç”¨æˆ·æˆ–æ’¤é”€\n\n```shell\nACL SETUSER <USER-NAME> +@hash -@string\n```\n\n|      å‘½ä»¤      | è¯´æ˜                                   |\n| :------------: | -------------------------------------- |\n|  `+<COMMAND>`  | å°†==ä¸€ä¸ªå‘½ä»¤==æ·»åŠ åˆ°ç”¨æˆ·çš„å¯æ‰§è¡Œåˆ—è¡¨ä¸­ |\n|  `-<COMMOND>`  | å°†==ä¸€ä¸ªå‘½ä»¤==ä»ç”¨æˆ·å¯æ‰§è¡Œåˆ—è¡¨ä¸­ç§»é™¤   |\n| `+@<CATEGORY>` | å°†==ä¸€ç±»å‘½ä»¤==æ·»åŠ åˆ°ç”¨æˆ·çš„å¯æ‰§è¡Œåˆ—è¡¨ä¸­ |\n| `-@<CATEGORY>` | å°†==ä¸€ç±»å‘½ä»¤==ä»ç”¨æˆ·å¯æ‰§è¡Œåˆ—è¡¨ä¸­ç§»é™¤   |\n|    `+@ALL`     | è¿è¡Œæ‰§è¡Œ==æ‰€æœ‰==å‘½ä»¤                   |\n|    `-@ALL`     | ç¦æ­¢æ‰§è¡Œ==æ‰€æœ‰==å‘½ä»¤                   |\n\nè¿˜å¯ä»¥ä»¥keyçš„ç²’åº¦è®¾ç½®è®¿é—®æƒé™ã€‚\n\n```shell\nACL SETUSER <USER-NAME> ~KEY:* +@ALL\n```\n\nå…è®¸ç”¨æˆ·å¯¹KEYä¸ºå‰ç¼€çš„keyçš„æ‰€æœ‰æ“ä½œã€‚\n\n## rehash\n\nRedisä½¿ç”¨2ä¸ªå…¨å±€å“ˆå¸Œè¡¨ï¼Œç±»ä¼¼JVMå †å†…å­˜ä¸­çš„SurvivoråŒºçš„S1å’ŒS2ï¼Œå§‹ç»ˆåªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œrehashè¿‡ç¨‹ä¸­ä½¿ç”¨å¦ä¸€ä¸ªè¿›è¡Œæ›¿æ¢ã€‚\n\n1. ç»™å“ˆå¸Œè¡¨2åˆ†é…æ›´å¤§çš„ç©ºé—´\n2. æŠŠå“ˆå¸Œè¡¨1ä¸­çš„æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°å“ˆå¸Œè¡¨2ä¸­\n3. é‡Šæ”¾å“ˆå¸Œè¡¨1çš„ç©ºé—´\n\nä½†æ˜¯æ­¥éª¤ 2 åœ¨æ‹·è´æ•°æ®æ—¶ï¼Œå¦‚æœä¸€æ¬¡æ€§æ‹·è´å¤§é‡æ•°æ®ä¼šé€ æˆRedisçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚ã€‚ä¸ºé¿å…è¿™ä¸ªé—®é¢˜ï¼ŒRedisé‡‡ç”¨äº†**<u>æ¸è¿›å¼rehash</u>**ã€‚\n\nå…·ä½“æ­¥éª¤æ˜¯åœ¨ç¬¬2æ­¥æ‹·è´æ•°æ®æ—¶ï¼Œä»ç„¶æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒåŒæ—¶ä»åŸå“ˆå¸Œè¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•ä½ç½®å¼€å§‹ï¼Œè¿åŒæœ¬æ¬¡è¯·æ±‚æ‰€åœ¨çš„ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰entriesæ‹·è´åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ï¼Œå¯¹äºæ–°å¢æ“ä½œåªä¼šåœ¨æ–°çš„å“ˆå¸Œè¡¨ä¸­æ–°å¢ï¼Œä¿è¯åŸå“ˆå¸Œè¡¨é€æ¸å‡å°ã€‚ä½†æ˜¯å³ä½¿æ²¡æœ‰æ–°çš„è¯·æ±‚ï¼ŒRedisä¹Ÿä¼šä»¥ä¸€å®šçš„é¢‘ç‡å®šæ—¶åœ°æ‰§è¡Œä¸€æ¬¡rehashï¼Œä¸”æ¯æ¬¡æ—¶é•¿ä¸è¶…è¿‡1msã€‚\n\nrehashæ—¶æœºï¼š\n\nload factor >= 1 ä¸” æ²¡æœ‰æ­£åœ¨è¿›è¡ŒRDBç”Ÿæˆå’Œé‡æ–°AOF\n\nload facotr >= 5 ä¸ç®¡æœ‰æ²¡æœ‰æ­£åœ¨è¿›è¡ŒRDBç”Ÿæˆæˆ–é‡æ–°AOF\n\n## bigkey\n\né€šè¿‡å‘½ä»¤`./redis-cli --bigkeys -i 0.1 -a å¯†ç `æ¥æŸ¥çœ‹æ•´ä¸ªæ•°æ®åº“ä¸­bigkeyæƒ…å†µï¼Œè¯¥å‘½ä»¤ä¼šè¾“å‡ºæ¯ç§ç±»å‹çš„é”®å€¼å¯¹ä¸ªæ•°å’Œå¹³å‡å¤§å°ï¼Œè¿˜ä¼šè¾“å‡ºæ¯ç§æ•°æ®ç±»å‹ä¸­æœ€å¤§çš„bigkeyä¿¡æ¯ã€‚å› ä¸ºè¿™ä¸ªå·¥å…·ä¼šæ‰«ææ•´ä¸ªæ•°æ®åº“ï¼Œå¯èƒ½ä¼šå¯¹Redisæ€§èƒ½äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥æœ€åæ˜¯åœ¨ä»åº“ä¸Šæ‰§è¡Œï¼ŒåŒæ—¶åŠ ä¸Š`-i`é€‰é¡¹æŒ‡å®šæ‰«æé—´éš”ï¼Œé¿å…é•¿æ—¶é—´çš„æ‰«æã€‚ä½†æ˜¯æ•´ä¸ªå‘½ä»¤åªè¿”å›äº†æ¯ä¸ªæ•°æ®ç±»å‹ä¸­æœ€å¤§çš„bigkeyï¼Œå¯¹äºé›†åˆç±»å‹æ˜¯å…ƒç´ ä¸ªæ•°ï¼Œæ— æ³•æŸ¥çœ‹Top-Nçš„æƒ…å†µã€‚æ‰€ä»¥æœ€å¥½æ˜¯é€šè¿‡`SCAN`å‘½ä»¤æ‰«ææ•°æ®åº“ï¼Œç„¶åç”¨`TYPE`å‘½ä»¤è·å–å€¼çš„ç±»å‹ï¼›å¯¹äºé›†åˆç±»å‹ï¼Œä½¿ç”¨`LLEN(List)`ã€`HLEN(Hash)`ã€`SCARD(Set)`ã€`ZCARD(Sorted Set)`è·å–å…ƒç´ ä¸ªæ•°ï¼Œå¯¹äºå­—ç¬¦ä¸²ï¼Œä½¿ç”¨`STRLEN`è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼›æˆ–è€…ä½¿ç”¨`MEMROY USAGE <KEY>`è·å–å ç”¨çš„å†…å­˜ç©ºé—´ã€‚\n\n## é«˜æ€§èƒ½çš„IOæ¨¡å‹\n\né€šå¸¸è¯´çš„Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸»è¦æ˜¯å€¼Redisçš„ç½‘ç»œIOå’Œé”®å€¼å¯¹çš„è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„ã€‚Redisåœ¨6.0ä¸­åŠ å…¥äº†å¤šçº¿ç¨‹IOï¼Œæé«˜ç½‘ç»œè¯·æ±‚å¤„ç†çš„å¹¶è¡Œåº¦ï¼Œä½†æ˜¯ä»…ä»…æ˜¯å¯¹äºç½‘ç»œè¯·æ±‚çš„å¤„ç†æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå‘½ä»¤çš„è¯»å†™ä»ç„¶æ˜¯å•çº¿ç¨‹ã€‚\n\n## AOFæ—¥å¿—\n\nAOFæ—¥å¿—æ˜¯å†™åæ—¥å¿—ï¼Œå³å…ˆæ‰§è¡Œå‘½ä»¤ï¼Œæ•°æ®å†™å…¥å†…å­˜åå†è®°å½•æ—¥å¿—ã€‚AOFè®°å½•çš„æ˜¯Redisæ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œä»¥æ–‡æœ¬å½¢å¼ä¿å­˜ã€‚\n\næ¯”å¦‚å‘½ä»¤`set testkey testvalue`ï¼Œå…¶AOFæ—¥å¿—å½¢å¼ä¸ºï¼š\n\n| AOFè®°å½•   | è¯´æ˜                                                         |\n| --------- | ------------------------------------------------------------ |\n| *3        | å½“å‰å‘½ä»¤æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯éƒ¨åˆ†ç”±`$æ•°å­—`å¼€å¤´ï¼Œå…¶ä¸­æ•°å­—è¡¨ç¤ºå‘½ä»¤ã€é”®ã€å€¼çš„å­—èŠ‚é•¿åº¦ |\n| $3        | è¿™éƒ¨åˆ†åŒ…å«3å­—èŠ‚å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯set                               |\n| set       | å‘½ä»¤                                                         |\n| $7        | 7å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯testkey                                         |\n| testkey   |                                                              |\n| $9        | 9å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯testvalue                                       |\n| testvalue |                                                              |\n\nä½†æ˜¯ä¸ºäº†é¿å…é¢å¤–çš„æ£€æŸ¥å¼€é”€ï¼ŒRedisä¸ä¼šæ£€æŸ¥è¿™äº›å‘½ä»¤çš„è¯­æ³•ï¼Œæ‰€ä»¥åªæœ‰å…ˆæ‰§è¡Œå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡ŒæˆåŠŸåæ‰ä¼šè®°å½•AOFæ—¥å¿—ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è®°å½•çš„æ˜¯æ­£ç¡®çš„å‘½ä»¤ã€‚æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œï¼ˆå¯èƒ½ä¼šé˜»å¡ä¸‹ä¸€ä¸ªæ“ä½œï¼Œå› ä¸ºAOFæ—¥å¿—æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼‰ã€‚\n\nAOFçš„å†™å›ç­–ç•¥ï¼š\n\n| ç­–ç•¥         | è¿‡ç¨‹                                                         | è¯´æ˜                               |\n| ------------ | ------------------------------------------------------------ | ---------------------------------- |\n| **Always**   | åŒæ­¥å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹å³åŒæ­¥å†™å›ç£ç›˜                 | åŸºæœ¬ä¸ä¸¢æ•°æ®ï¼Œä½†æ˜¯ä¼šå½±å“ä¸»çº¿ç¨‹æ€§èƒ½ |\n| **Everysec** | æ¯ç§’å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºå†…å®¹å†™å…¥ç£ç›˜ | å®•æœºä¸¢å¤±æ•°æ®                       |\n| **No**       | ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶å†™å›ï¼Œæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼ŒåªæŠŠæ—¥å¿—å†™åˆ°AOFæ–‡ä»¶ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†å†…å®¹å†™å›ç£ç›˜ | åœ¨æ€§èƒ½å’Œæ•°æ®ä¸¢å¤±å–æŠ˜ä¸­             |\n\nAOFæ–‡ä»¶è¿‡å¤§å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼š\n\n1. æ–‡ä»¶ç³»ç»Ÿå¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œä¸èƒ½æ— é™å¤§\n2. è¿‡å¤§çš„æ–‡ä»¶å†™å…¥æ€§èƒ½ä¼šå—åˆ°å½±å“\n3. å‘ç”Ÿå®•æœºåˆ©ç”¨AOFè®°å½•æ¢å¤æ•°æ®ï¼Œæ–‡ä»¶è¿‡å¤§ä¼šå¯¼è‡´æ•´ä¸ªè¿‡ç¨‹å¾ˆæ…¢\n\n### AOFé‡å†™\n\nè§£å†³AOFæ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ï¼Œé‡å†™æ—¶ï¼Œæ ¹æ®Redisæ•°æ®åº“ç°çŠ¶ç”Ÿæˆä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶ã€‚å¯¹ä¸€ä¸ªé”®è¿›è¡Œçš„å¤šæ¬¡å†™æ“ä½œï¼Œæœ€ç»ˆä¼šç”Ÿæˆä¸€æ¡å†™å‘½ä»¤ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°AOFæ–‡ä»¶çš„å¤§å°ã€‚AOFé‡å†™è¿‡ç¨‹ç”±åå°çº¿ç¨‹`bgrewriteaof`å®Œæˆï¼Œå¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚\n\n**ä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—**ï¼šä¸»çº¿ç¨‹forkå‡ºåå°çš„`bgrewriteaof`å­è¿›ç¨‹ï¼Œä¼šæŠŠä¸»çº¿ç¨‹çš„å†…å­˜**æ‹·è´ï¼ˆçˆ¶è¿›ç¨‹çš„é¡µè¡¨ï¼Œè€Œéç‰©ç†å†…å­˜ï¼‰**ä¸€ä»½ç»™`bgrewriteaof`å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æŠŠæ‹·è´çš„æ•°æ®è®¡å…¥é‡å†™æ—¥å¿—ã€‚åŒæ—¶ï¼Œæ–°çš„å†™æ“ä½œä¼šå†™å…¥**åŸæ¥çš„AOFæ—¥å¿—**ï¼ˆå®Œæ•´çš„AOFï¼‰å’Œ**æ–°çš„AOFé‡å†™æ—¥å¿—**ï¼ˆç­‰æ‹·è´ç”Ÿæˆçš„é‡å†™æ—¥å¿—å®Œæˆåï¼Œè¿½åŠ ä¸Šè¿™ä¸ªé‡å†™æœŸé—´çš„å¢é‡æ—¥å¿—ï¼Œå‡‘æˆä¸€ä»½å®Œæ•´çš„æ—¥å¿—ï¼Œæ›¿æ¢åŸæ¥çš„AOFæ—¥å¿—ï¼‰\n\n## å†…å­˜å¿«ç…§RDB\n\nä½¿ç”¨AOFè¿›è¡Œæ•…éšœæ¢å¤éœ€è¦æŠŠæ“ä½œæ—¥å¿—é‡æ–°æ‰§è¡Œä¸€éï¼Œè€—æ—¶è¾ƒé•¿ï¼Œä½¿ç”¨å†…å­˜å¿«ç…§å°†å¤§å¤§æå‡æ¢å¤é€Ÿåº¦ã€‚å†…å­˜å¿«ç…§æŒ‡çš„æ˜¯å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚\n\nRedisæä¾›äº†ä¸¤ä¸ªå‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶ï¼š`save` ï¼ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šé˜»å¡ï¼‰å’Œ `bgsave`ï¼ˆforkå­è¿›ç¨‹æ‰§è¡Œï¼Œé»˜è®¤ï¼‰\n\n`bgsave`æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹ä»èƒ½å¤„ç†å†™è¯·æ±‚ï¼ŒRedisä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿæä¾›çš„å†™æ—¶å¤åˆ¶(Copy-on-write, COW)æ­£å¸¸å¤„ç†å†™è¯·æ±‚ã€‚\n\nå¦‚æœé¢‘ç¹åœ°ç”ŸæˆRDBæ–‡ä»¶ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œè€Œä¸”forkåˆ›å»º`bgsave`å­è¿›ç¨‹çš„åˆ›å»ºè¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå½±å“Redisæ€§èƒ½ã€‚\n\nRedis4.0æå‡ºäº†AOFå’Œå†…å­˜å¿«ç…§çš„æ··åˆä½¿ç”¨ï¼šå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œä¸¤æ¬¡å¿«ç…§æœŸé—´ä½¿ç”¨AOFæ—¥å¿—è®°å½•ã€‚\n\n## ä¸»ä»æ¨¡å¼\n\né€šå¸¸è¯´Rediså…·æœ‰é«˜å¯é æ€§ï¼Œæ˜¯æŒ‡æ•°æ®å°½é‡å°‘ä¸¢å¤±ã€æœåŠ¡å°½é‡å°‘ä¸­æ–­ã€‚å‰è€…é€šè¿‡AOFå’ŒRDBä¿è¯ï¼Œåè€…åˆ™æ˜¯é€šè¿‡å†—ä½™å‰¯æœ¬ï¼Œå³ä¸€ä»½æ•°æ®ä¿å­˜åœ¨å¤šä¸ªå®ä¾‹ä¸Šã€‚\n\nä¸»ä»è¯»å†™åˆ†ç¦»ä¸­ï¼Œå†™æ“ä½œåªåœ¨ä¸»åº“ä¸Šæ‰§è¡Œï¼Œç„¶ååŒæ­¥åˆ°ä»åº“ï¼Œè¯»æ“ä½œåˆ™æ˜¯ä¸»ä»åº“éƒ½å¯ä»¥ã€‚\n\né€šè¿‡å‘½ä»¤è®¾ç½®ä»åº“ï¼š\n\n```shell\nreplicaof MASTER_IP MASTER_PORT\n# 5.0ä¹‹å‰ä½¿ç”¨slaveofå‘½ä»¤\n```\n\n1. ä»åº“å‘ä¸»åº“å‘é€å‘½ä»¤`psync ? -1`è¿›è¡Œå…¨é‡åŒæ­¥ï¼Œå‘½ä»¤çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸»åº“çš„`runID`ï¼Œç”±äºç¬¬ä¸€æ¬¡å¤åˆ¶ä»åº“ä¸çŸ¥é“ä¸»åº“çš„`runID`ï¼Œç”¨`?`è¡¨ç¤ºï¼Œç¬¬äºŒä¸ªå‚æ•°`-1`è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ï¼›\n2. ä¸»åº“å“åº”`FULLRESYNC {runID} {offset}`ç»™ä»åº“ï¼Œ`runID`ä¸ºä¸»åº“çš„å®ä¾‹IDï¼Œoffsetè¡¨ç¤ºå¤åˆ¶è¿›åº¦\n3. ä¸»åº“æ‰§è¡Œ`bgsave`ç”ŸæˆRDBæ–‡ä»¶ï¼Œå¹¶å‘é€ç»™ä»åº“ï¼ŒåŒæ—¶ç”ŸæˆRDBæ–‡ä»¶è¿‡ç¨‹ä¸­çš„å†™æ“ä½œè®°å½•åˆ°`replication buffer`ä¸­\n4. ä»åº“æ”¶åˆ°RDBæ–‡ä»¶åå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½RDBæ–‡ä»¶\n5. ä¸»åº“å°†`replication buffer`å‘é€ç»™ä»åº“ï¼Œä»åº“æ‰§è¡Œæ“ä½œ\n\nå¦‚æœä»åº“æ•°é‡å¾ˆå¤šï¼Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œä¸»åº“å°±ä¼šå¿™äºforkå­è¿›ç¨‹ç”ŸæˆRDBæ–‡ä»¶ï¼Œä¸”å ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼Œå¯ä»¥é‡‡ç”¨â€œä¸»-ä»-ä»â€çš„æ¨¡å¼ï¼Œä»¥çº§è”çš„æ¨¡å¼å°†å‹åŠ›åˆ†æ•£åˆ°ä»åº“ä¸Šã€‚\n\n```shell\nreplicaof SLAVE_IP SLAVE_PORT\n```\n\nä¸€æ—¦å®Œæˆä¸»ä»å…¨é‡å¤åˆ¶ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´å°±ä¼šä¸€ç›´ç»´æŠ¤ä¸€ä¸ªç½‘ç»œé•¿è¿æ¥ï¼Œä¸»åº“é€šè¿‡è¿™ä¸ªè¿æ¥å°†åç»­æ”¶åˆ°çš„å‘½ä»¤åŒæ­¥ç»™ä»åº“ï¼Œé•¿è¿æ¥å¯ä»¥é¿å…é¢‘ç¹å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚\n\nå¦‚æœå‘é€ç½‘ç»œæ–­è¿ï¼ŒRedis2.8ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚ä¸»åº“ä¼šæŠŠæ–­è¿æœŸé—´æ”¶åˆ°çš„å†™å‘½ä»¤ï¼Œå†™å…¥`replication buffer`å’Œ`repl_backlog_buffer`ç¼“å†²åŒºï¼Œ`repl_backlog_buffer`æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œä¸»åº“è®°å½•è‡ªå·±å†™åˆ°çš„ä½ç½®(`master_repl_offset`)ï¼Œä»åº“è®°å½•è‡ªå·±è¯»åˆ°çš„ä½ç½®(`slave_repl_offset`)ã€‚ä¸»ä»åº“çš„è¿æ¥æ¢å¤ä¹‹åï¼Œä»åº“ç»™ä¸»åº“å‘é€`psync`å‘½ä»¤ï¼Œå¸¦ç€`slave_repl_offset`ï¼Œä¸»åº“åˆ™å°†`slave_repl_offset`~ `master_repl_offset`ä¹‹é—´çš„å‘½ä»¤æ“ä½œåŒæ­¥ç»™ä»åº“ã€‚\n\n> å‚æ•°`repl_backlog_size`è¡¨ç¤ºç¯å½¢ç¼“å†²åŒºçš„å¤§å°\n\n### ä¸»ä»åŒæ­¥çš„é—®é¢˜\n\nä¸»ä»æ•°æ®ä¸ä¸€è‡´æ˜¯æŒ‡å®¢æˆ·ç«¯ä»ä»åº“è¯»åˆ°çš„å€¼å’Œä¸»åº“ä¸­çš„æœ€æ–°å€¼ä¸ä¸€è‡´ã€‚å› ä¸ºä¸»ä»åº“é—´çš„å‘½ä»¤æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œå¦å¤–ï¼Œä¸»ä»åº“é—´çš„ç½‘ç»œå¯èƒ½æœ‰å»¶è¿Ÿï¼Œå¯¼è‡´ä»åº“æ¥æ”¶åˆ°ä¸»åº“çš„åŒæ­¥å‘½ä»¤å»¶åï¼›æˆ–è€…ä»åº“æ­£åœ¨è¿›è¡Œå¤æ‚åº¦é«˜çš„å‘½ä»¤è¢«é˜»å¡ï¼Œéœ€è¦ç­‰å‘½ä»¤ç»“æŸäº†æ‰èƒ½ç»§ç»­æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„å‘½ä»¤ã€‚\n\n`INFO replication`å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸»åº“æ¥æ”¶å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯(`master_repl_offset`)å’Œä»åº“åŒæ­¥å†™å‘½ä»¤çš„è¿›åº¦ä¿¡æ¯(`slave_repl_offset`)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤ç›‘æ§ä¸»ä»çš„åŒæ­¥è¿›åº¦ï¼Œå¯¹äºåŒæ­¥è¿›åº¦å·®å¤ªå¤šçš„ä»åº“å¯ä»¥é€‰æ‹©ä»å®¢æˆ·ç«¯çš„è¿æ¥ä¿¡æ¯ä¸­ç§»é™¤ï¼Œç­‰æ¢å¤æ­£å¸¸äº†å†æ·»åŠ è¿›æ¥ã€‚\n\nå®¢æˆ·ç«¯å¯èƒ½åœ¨ä»åº“ä¸Šè¯»åˆ°è¿‡æœŸçš„æ•°æ®ï¼ŒRedis é‡‡ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤çš„ç­–ç•¥åˆ é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå®¢æˆ·ç«¯åœ¨è®¿é—®è¿‡æœŸæ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å·²è¿‡æœŸï¼Œåˆ™ä¼šè¢«åˆ é™¤ï¼Œç»™å®¢æˆ·ç«¯è¿”å›ç©ºï¼›åŒæ—¶ï¼ŒRedis ä¼šå®šæœŸéšæœºé€‰å‡ºä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œå¹¶æŠŠè¿‡æœŸçš„æ•°æ®åˆ é™¤ã€‚ä½†æ˜¯å®¢æˆ·ç«¯ä»ä»åº“è¯»å–åˆ°è¿‡æœŸæ•°æ®æ—¶ï¼Œæ˜¯ä¸ä¼šä¸»åŠ¨åˆ é™¤çš„ã€‚ï¼ˆè¿™ä¸ªé—®é¢˜åœ¨ Redis3.2 ä¹‹åçš„ç‰ˆæœ¬ä¼˜åŒ–ï¼Œä»åº“è¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œè™½ç„¶ä¸ä¼šåˆ ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯ç©ºå€¼ï¼‰å¦å¤–ï¼Œå¦‚æœè®¾ç½®è¿‡æœŸæ—¶é—´ä½¿ç”¨çš„æ˜¯`EXPIRE key 60`ï¼Œå‘½ä»¤åŒæ­¥åˆ°ä»åº“ï¼Œå†åˆ°æ‰§è¡Œï¼Œå¯èƒ½ä¼šå»¶åä¸€æ®µæ—¶é—´ï¼Œå¯¼è‡´ä»åº“ä¸Šçš„æœ‰æ•ˆæœŸåœ¨ä¸»åº“ä¹‹åï¼›å¦‚æœä½¿ç”¨çš„æ˜¯`EXPIREAT key <TIMESTAMP>`ï¼Œä¹Ÿå¯èƒ½ç”±äºä¸»ä»èŠ‚ç‚¹ä¸Šçš„æ—¶é’Ÿä¸ä¸€è‡´ï¼Œå¯¼è‡´æ•°æ®çš„è¿‡æœŸæ—¶é—´ä¸ä¸€è‡´ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯å°½é‡ä½¿ç”¨`EXPIREAT`å‘½ä»¤è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒåŒæ—¶ä¸»ä»èŠ‚ç‚¹å’Œç›¸åŒçš„ NTP è¿›è¡Œæ—¶é’ŸåŒæ­¥ã€‚\n\n> å°†`slave-serve-stale-data`è®¾ç½®ä¸º noï¼Œè¿™æ ·ä»åº“å°±åªèƒ½æœåŠ¡ INFOã€SLAVEOF å‘½ä»¤ï¼Œé¿å…ä»åº“æ‰§è¡Œå†™å‘½ä»¤å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚\n>\n> `slave-read-only`ä¸º yes æ—¶ï¼Œä»åº“åªèƒ½å¤„ç†è¯»è¯·æ±‚ï¼Œæ— æ³•å¤„ç†å†™è¯·æ±‚ï¼ŒäºŒè€…æœ‰åŒºåˆ«\n\n### è„‘è£‚\n\nåœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼Œéƒ½èƒ½æ¥æ”¶å†™è¯·æ±‚ã€‚ç»“æœæ˜¯å®¢æˆ·ç«¯å¯èƒ½å¾€ä¸åŒçš„ä¸»èŠ‚ç‚¹ä¸Šå†™æ•°æ®ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚\n\nå¦‚æœæ˜¯ä¸»åº“çš„æ•°æ®è¿˜æ²¡åŒæ­¥åˆ°ä»åº“ï¼Œä¸»åº“æ•…éšœï¼Œå‘ç”Ÿä¸»ä»åˆ‡æ¢å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ï¼Œ å¯ä»¥é€šè¿‡åŸä¸»åº“çš„`master_repl_offset`å’ŒåŸä»åº“çš„`slave_repl_offset`çš„å·®å€¼æ¥åˆ¤æ–­ã€‚â€”â€”å¦‚æœoffsetä¸€è‡´ï¼Œåˆ™è¯´æ˜ä¸¢æ•°æ®ä¸æ˜¯ç”±è„‘è£‚å¯¼è‡´çš„ã€‚\n\nè„‘è£‚å‘ç”Ÿå¯èƒ½æ˜¯ç”±äºä¸»åº“â€œå‡æ•…éšœâ€å¯¼è‡´çš„ï¼Œä¸»åº“CPUæ»¡è½½ï¼Œå¯¼è‡´æ— æ³•å“åº”å¿ƒè·³ï¼Œå“¨å…µä¼šå°†ä¸»åº“æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼Œç„¶åå¼€å§‹æ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚ä½†æ˜¯ä¸»åº“åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­æ¢å¤æ­£å¸¸ï¼Œå¯ä»¥æ­£å¸¸å¤„ç†è¯·æ±‚ï¼Œä¸»ä»åˆ‡æ¢å®Œæˆåï¼Œå®¢æˆ·ç«¯çš„å†™å‘½ä»¤æ‰ä¼šå‘é€åˆ°æ–°çš„ä¸»åº“ä¸Šï¼Œä¸»åº“ä¹Ÿå¼€å§‹æ‰§è¡Œ`slave of`å’Œæ–°ä¸»åº“è¿›è¡Œå…¨é‡åŒæ­¥ï¼Œæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚\n\né€šè¿‡å‚æ•°`min-slaves-to-write`å’Œ`min-slaves-max-lag`é™åˆ¶è‡³å°‘æœ‰Nä¸ªä»åº“å’Œä¸»åº“è¿›è¡Œæ•°æ®å¤åˆ¶æ—¶çš„ACKæ¶ˆæ¯å»¶è¿Ÿä¸è¶…è¿‡Tç§’ï¼Œä¸»åº“æ‰ä¼šæ­£å¸¸æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¦‚æœä¸»åº“â€œå‡æ•…éšœâ€æ—¶ï¼Œæ— æ³•å“åº”å“¨å…µå¿ƒè·³ï¼Œä¹Ÿå°±æ— æ³•ä¿è¯ä¸Šé¢çš„é™åˆ¶ï¼Œä¸»åº“å°±ä¸å†æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚äº†ã€‚\n\n## å“¨å…µæœºåˆ¶\n\nå“¨å…µæœºåˆ¶æ˜¯å®ç°ä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢çš„å…³é”®æœºåˆ¶ï¼Œæœ‰æ•ˆè§£å†³ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹æ•…éšœè½¬ç§»çš„é—®é¢˜ã€‚\n\nå“¨å…µæ˜¯è¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„Redisè¿›ç¨‹ï¼Œé€šå¸¸ä»¥é›†ç¾¤çš„æ¨¡å¼è¿è¡Œï¼Œå“¨å…µä¸»è¦è´Ÿè´£ä¸‰ä¸ªä»»åŠ¡ï¼šç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥ã€‚\n\n```shell\n#é…ç½®å“¨å…µ\nsentinel monitor MASTER_NAME MASTER_IP MASTER_PORT QUORUM\n```\n\nä¸»åº“ä¸Šæœ‰ä¸€ä¸ªåä¸º`__sentinel__:hello`çš„é¢‘é“ï¼Œæ‰€æœ‰çš„å“¨å…µéƒ½ä¼šè®¢é˜…è¿™ä¸ªé¢‘é“ï¼Œå®ç°ç›¸äº’é€šä¿¡ã€‚å“¨å…µä¼šå°†è‡ªå·±çš„IPå’Œç«¯å£å‘å¸ƒåˆ°`__sentinel__:hello`é¢‘é“ï¼Œå…¶ä»–å“¨å…µå°±åªåˆ°äº†æ–°å“¨å…µçš„åœ°å€å’Œç«¯å£ï¼Œç„¶åå’Œå…¶å»ºç«‹è¿æ¥ã€‚\n\nå“¨å…µå’Œå®¢æˆ·ç«¯è¿›è¡Œä¿¡æ¯åŒæ­¥é€šç”¨æ˜¯é€šè¿‡pub/subæœºåˆ¶\n\n|                 äº‹ä»¶                  |          é¢‘é“          |\n| :-----------------------------------: | :--------------------: |\n|           ä¸»åº“ä¸‹çº¿-ä¸»è§‚ä¸‹çº¿           |        `+sdown`        |\n|         ä¸»åº“ä¸‹çº¿-é€€å‡ºä¸»è§‚ä¸‹çº¿         |        `-sdown`        |\n|           ä¸»åº“ä¸‹çº¿-å®¢è§‚ä¸‹çº¿           |        `+odown`        |\n|         ä¸»åº“ä¸‹çº¿-é€€å‡ºå®¢è§‚ä¸‹çº¿         |        `-odown`        |\n|   ä»åº“é‡æ–°é…ç½®-å“¨å…µå‘é€SLAVEOFå‘½ä»¤    |  `+slave-reconf-sent`  |\n| ä»åº“é‡æ–°é…ç½®-ä»åº“é…ç½®æ–°ä¸»åº“ï¼Œå°šæœªå®Œæˆ | `+slave-reconf-inprog` |\n|   ä»åº“é‡æ–°é…ç½®-ä»åº“é…ç½®æ–°ä¸»åº“ï¼Œå®Œæˆ   |  `+slave_reconf-down`  |\n|               ä¸»ä»åˆ‡æ¢                |    `+switch-master`    |\n\nå“¨å…µæŠŠæ–°çš„ä¸»åº“é€‰å‡ºæ¥åï¼Œå®¢æˆ·ç«¯æ ¹æ®è®¢é˜…å¾—åˆ°çš„äº‹ä»¶(`switch-master`)å’Œæ–°ä¸»åº“è¿›è¡Œé€šä¿¡\n\n```shell\nswitch-master MASTER_NAME OLD_IP OLD_PORT NEW_IP NEW_PORT\n```\n\nå“¨å…µä¼šå‘ä¸»åº“å‘é€`INFO`å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šè¿”å›ä»åº“åˆ—è¡¨ï¼Œå“¨å…µæ ¹æ®è¿”å›çš„ä¿¡æ¯å’Œä»åº“å»ºç«‹è¿æ¥ï¼Œé€šè¿‡æ­¤è¿æ¥æŒç»­åœ°å¯¹ä»åº“è¿›è¡Œç›‘æ§ã€‚\n\nå“¨å…µåœ¨è¿è¡Œæ—¶ï¼Œå‘¨æœŸæ€§åœ°ç»™æ‰€æœ‰**ä¸»ä»**åº“å‘é€PINGå‘½ä»¤ï¼Œæ£€æŸ¥å®ƒä»¬æ˜¯å¦åœ¨çº¿ï¼Œå¦‚æœæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„PINGå‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å…¶æ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ï¼Œå¦‚æœæ˜¯ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€ï¼Œè¯¥å“¨å…µå°±ä¼šç»™å…¶ä»–å“¨å…µå®ä¾‹å‘é€`is-master-down-by-addr`å‘½ä»¤ï¼Œå…¶ä»–å®ä¾‹ä¼šæ ¹æ®è‡ªå·±å’Œä¸»åº“çš„è¿æ¥æƒ…å†µï¼Œå“åº”`Y` æˆ– `N`ï¼Œå¦‚æœå¾—åˆ°çš„èµæˆç¥¨è¾¾åˆ°é…ç½®çš„`QUORUM`å€¼ï¼Œå°±å¯ä»¥å°†ä¸»åº“æ ‡è®°ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚ç„¶åå“¨å…µç»™å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›ç”±è‡ªå·±æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå…¶ä»–å“¨å…µæŠ•ç¥¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œLeaderé€‰ä¸¾â€ã€‚ä½†æ˜¯åŒä¸€æ—¶é—´å¯èƒ½æœ‰å¤šä¸ªå“¨å…µåˆ¤æ–­ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œå¤šä¸ªå“¨å…µéƒ½ä¼šå‘èµ·â€œLeaderé€‰ä¸¾â€ï¼Œå…¶ä»–å“¨å…µä¼šç»™ç¬¬ä¸€ä¸ªå‘å…¶å‘é€å‘½ä»¤çš„å“¨å…µæŠ•Yï¼Œç»™åç»­å…¶ä»–å“¨å…µæŠ•Nã€‚æœ€ç»ˆæ‹¿åˆ°èµæˆç¥¨`>= N/2 + 1 && >= QUORUM`çš„å“¨å…µå½“é€‰ä¸ºâ€œLeanderâ€æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ã€‚å¦‚æœä¸æ»¡è¶³â€œLeaderâ€ç¥¨æ•°ï¼Œå“¨å…µé›†ç¾¤ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´(å“¨å…µæ•…éšœè½¬ç§»æ—¶é—´*2)ï¼Œå†æ¬¡é‡æ–°é€‰ä¸¾ã€‚\n\n> ä¿è¯æ‰€æœ‰å“¨å…µå®ä¾‹çš„é…ç½®æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™å¯èƒ½ç”±äºä¸»è§‚ä¸‹çº¿çš„æ—¶é—´(down-after-milliseconds)ä¸ä¸€è‡´å¯¼è‡´ä¸»åº“æ•…éšœåˆ‡æ¢ä¸åŠæ—¶ã€‚\n\n## åˆ‡ç‰‡é›†ç¾¤\n\nå¦‚æœRedisæ•°æ®åº“æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œå ç”¨å¾ˆå¤§å†…å­˜ï¼Œä¼šå¯¼è‡´RDBéå¸¸è€—æ—¶ï¼ŒåŒæ—¶forkåˆ›å»ºå­è¿›ç¨‹é˜»å¡ä¸»çº¿ç¨‹çš„æ—¶é—´ä¹Ÿä¼šç›¸å¯¹è¾ƒé•¿ã€‚å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤ï¼Œæˆ–è€…åˆ†ç‰‡é›†ç¾¤ï¼Œå³å¯åŠ¨å¤šä¸ªRediså®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å°†æ•°æ®åˆ’åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½ä¿å­˜åœ¨ä¸€ä¸ªå®ä¾‹ä¸Šã€‚è¿™æ ·æ¯ä¸€ä¸ªå®ä¾‹ç”ŸæˆRDBçš„æ–‡ä»¶å°±å°äº†å¾ˆå¤šã€‚\n\nçºµå‘æ‰©å±•(scale up)ï¼šå‡çº§å•ä¸ªRediså®ä¾‹çš„é…ç½®ï¼Œå¦‚å†…å­˜ã€ç£ç›˜ï¼ŒCPU\n\næ¨ªå‘æ‰©å±•(scale out)ï¼šå¢åŠ Rediså®ä¾‹ä¸ªæ•°\n\nåˆ‡ç‰‡é›†ç¾¤æ˜¯ä¸€ç§ä¿å­˜å¤§é‡æ•°æ®çš„é€šç”¨æœºåˆ¶ï¼ŒRedis3.0ä¹‹åï¼Œå®˜æ–¹æä¾›äº†åä¸ºRedis Clusterçš„å®ç°æ–¹æ¡ˆã€‚Redis Clusteræ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½(Hash Slot)æ¥å¤„ç†æ•°æ®å’Œå®ä¾‹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚ä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰16384($2^{14}$)ä¸ªå“ˆå¸Œæ§½ï¼Œç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªæ•°æ®éƒ½ä¼šæ ¹æ®å…¶key(CRC16ç®—æ³•)è¢«æ˜ å°„åˆ°ä¸€ä¸ªæ§½ä¸­ã€‚\n\nRediså®ä¾‹ä¼šæŠŠè‡ªå·±çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘é€ç»™å’Œå®ƒç›¸è¿çš„å…¶ä»–å®ä¾‹ï¼Œæ¥å®Œæˆå“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯çš„æ‰©æ•£ï¼Œå®ä¾‹ä¹‹é—´äº’è”åï¼Œæ‰€æœ‰å®ä¾‹å°±éƒ½æœ‰å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»äº†ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“ˆå¸Œæ§½ä¿¡æ¯åä¼šç¼“å­˜åœ¨æœ¬åœ°ï¼Œè¯·æ±‚æ—¶å…ˆè®¡ç®—é”®å¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œç„¶åç»™å“åº”çš„å®ä¾‹å‘é€è¯·æ±‚ã€‚ä½†æ˜¯å¦‚æœé›†ç¾¤å®ä¾‹æœ‰åˆ å‡ã€æˆ–è€…å®ä¾‹è´Ÿè½½ä¸å‡è¡¡éƒ½å¯èƒ½éœ€è¦é‡æ–°åˆ†é…å“ˆå¸Œæ§½ã€‚é‡æ–°åˆ†é…ä¹‹åï¼Œå„å®ä¾‹ä¹‹é—´ä»ç„¶å¯ä»¥é€šè¿‡è¿æ¥ç›¸äº’ä¼ é€’åˆ†é…ä¿¡æ¯å®ç°åŒæ­¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ— æ³•æ„ŸçŸ¥è¿™äº›å˜åŒ–ã€‚æ‰€ä»¥Redis Clusteræä¾›äº†ä¸€ç§é‡å®šå‘æœºåˆ¶ï¼Œå³å®¢æˆ·ç«¯æŒ‰åŸæ¥çš„æµç¨‹ç»™å®ä¾‹å‘é€å‘½ä»¤ï¼Œä½†æ˜¯å®ä¾‹ä¸Šæ²¡æœ‰è¯¥é”®æ˜ å°„çš„å“ˆå¸Œæ§½ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª`MOVED`å“åº”ï¼ŒåŒ…å«æ–°å®ä¾‹çš„åœ°å€å’Œç«¯å£ï¼Œå®¢æˆ·ç«¯é‡æ–°å‘æ–°å®ä¾‹å‘é€è¯·æ±‚ï¼ŒåŒæ—¶æ›´æ–°ç¼“å­˜çš„æ˜ å°„å…³ç³»ã€‚\n\nä½¿ç”¨`cluster create`å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼ŒRedisé»˜è®¤ä¼šæŠŠè¿™äº›æ§½å¹³å‡åˆ†å¸ƒåœ¨é›†ç¾¤å®ä¾‹ä¸Šã€‚ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤`cluster meet`æ‰‹åŠ¨å»ºç«‹å®ä¾‹é—´çš„è¿æ¥ï¼Œå†ç”¨`cluster addslots`æŒ‡å®šæ¯ä¸ªå®ä¾‹ä¸Šçš„slotã€‚\n\n```shell\n#åŠ å…¥é›†ç¾¤\nredis-cli -p 6379 cluster meet 127.0.0.1 6380\n# æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯\ncluster nodes\ncluster info\n# åˆ†é…æ§½\nredis-cli -h IP -p PORT cluster addslots {0..5461}\n```\n\n**é‡æ–°åˆ†ç‰‡çš„æµç¨‹**\n\n1. å¯¹ç›®æ ‡èŠ‚ç‚¹å‘é€`cluster setslot <slot> importing <source-node-id>`å‘½ä»¤ï¼Œè®©ç›®æ ‡èŠ‚ç‚¹å‡†å¤‡å¯¼å…¥æ§½çš„æ•°æ®ã€‚\n\n2. å¯¹æºèŠ‚ç‚¹å‘é€`cluster setslot <slot> migrating <destination-node-id>`å‘½ä»¤ï¼Œè®©æºèŠ‚ç‚¹å‡†å¤‡è¿å‡ºæ§½çš„æ•°æ®ã€‚\n\n3. æºèŠ‚ç‚¹å¾ªç¯æ‰§è¡Œ`cluster getkeysinslot {slot} {count}`å‘½ä»¤ï¼Œè·å–countä¸ªå±äºæ§½{slot}çš„é”®ã€‚\n\n4. å¯¹äºæ­¥éª¤3ä¸­è·å–çš„æ¯ä¸ªkeyï¼Œ`redis-trib.rb`éƒ½å‘æºèŠ‚ç‚¹å‘é€ä¸€ä¸ª`MIGRATE <target_ip> <target_port> <key_name> 0 <timeout> `å‘½ä»¤ï¼Œå°†è¢«é€‰ä¸­çš„é”®åŸå­æ€§åœ°ä»æºèŠ‚ç‚¹è¿ç§»è‡³ç›®æ ‡èŠ‚ç‚¹ã€‚\n\n5. é‡å¤æ‰§è¡Œæ­¥éª¤3å’Œ4ï¼Œç›´åˆ°æºèŠ‚ç‚¹ä¿å­˜çš„æ‰€æœ‰å±äºæ§½slotçš„é”®å€¼å¯¹éƒ½è¢«è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹ä¸ºæ­¢ã€‚\n\n6. `redis-trib.rb`å‘é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å‘é€`CLUSTER SETSLOT <slot> NODE <node-id>`å‘½ä»¤ï¼Œå°†æ§½slotæŒ‡æ´¾ç»™ç›®æ ‡èŠ‚ç‚¹ã€‚è¿™ä¸€æ¶ˆæ¯ä¼šå‘é€ç»™æ•´ä¸ªé›†ç¾¤ã€‚\n\n**å®¢æˆ·ç«¯ASKé‡å®šå‘æµç¨‹**\n\nRedisé›†ç¾¤æ”¯æŒåœ¨çº¿è¿ç§»slotå’Œæ•°æ®æ¥å®Œæˆæ°´å¹³ä¼¸ç¼©ï¼Œå½“slotå¯¹åº”çš„æ•°æ®ä»æºèŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦åšåˆ°æ™ºèƒ½è¯†åˆ«ï¼Œä¿è¯é”®å‘½ä»¤å¯æ­£å¸¸æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªslotæ•°æ®ä»æºèŠ‚ç‚¹è¿ç§»åˆ°ç›®æ ‡èŠ‚ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€éƒ¨åˆ†æ•°æ®åœ¨æºèŠ‚ç‚¹ï¼Œå¦ä¸€éƒ¨åˆ†åœ¨ç›®æ ‡èŠ‚ç‚¹ã€‚\n\nå¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯é”®æ‰§è¡Œæµç¨‹å°†å‘ç”Ÿå˜åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ\n\n1. å®¢æˆ·ç«¯æ ¹æ®slotç¼“å­˜å‘é€å‘½ä»¤åˆ°æºèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨keyåˆ™ç›´æ¥æ‰§è¡Œå¹¶è¿”å›ç»“æœã€‚\n\n2. å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å¯èƒ½å­˜åœ¨äºç›®æ ‡èŠ‚ç‚¹ï¼Œè¿™æ—¶ä¼šå›å¤ASKé‡å®šå‘å¼‚å¸¸ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š`(error) ASK {slot} {targetIP}:{targetPort}`ã€‚\n\n3. å®¢æˆ·ç«¯ä»ASKé‡å®šå‘å¼‚å¸¸æå‡ºç›®æ ‡èŠ‚ç‚¹ä¿¡æ¯ï¼Œå‘é€askingå‘½ä»¤åˆ°ç›®æ ‡èŠ‚ç‚¹æ‰“å¼€å®¢æˆ·ç«¯è¿æ¥æ ‡è¯†ï¼Œå†æ‰§è¡Œé”®å‘½ä»¤ã€‚å¦‚æœå­˜åœ¨åˆ™æ‰§è¡Œï¼Œä¸å­˜åœ¨åˆ™è¿”å›ä¸å­˜åœ¨ä¿¡æ¯ã€‚\n\nASKä¸MOVEDè™½ç„¶éƒ½æ˜¯å¯¹å®¢æˆ·ç«¯è¿›çš„é‡å®šå‘ï¼Œä½†æ˜¯æœ‰ç€æœ¬è´¨åŒºåˆ«ï¼Œå‰è€…è¯´æ˜é›†ç¾¤æ­£åœ¨è¿›è¡Œslotæ•°æ®è¿ç§»ï¼Œæ‰€ä»¥åªæ˜¯ä¸´æ—¶æ€§çš„é‡å®šå‘ï¼Œä¸ä¼šæ›´æ–°slotç¼“å­˜ï¼Œä½†æ˜¯MOVEDé‡å®šå‘è¯´æ˜é”®å¯¹åº”çš„æ§½å·²ç»æ˜ç¡®æŒ‡å®šåˆ°æ–°çš„èŠ‚ç‚¹ï¼Œä¼šæ›´æ–°slotç¼“å­˜ã€‚\n\n## å­—ç¬¦ä¸²\n\nç®€å•åŠ¨æ€å­—ç¬¦ä¸² SDS çš„ç»“æ„ï¼š\n\n```c\nstruct __attribute__((__packed)) hisdshdr8 {\n    uint8_t len;\n    uint8_t alloc;\n    unsigned char flags;\n    char buf[];\n}\n```\n\nRedis ä¸­å­—ç¬¦ä¸²æœ‰ 5 ç§ç»“æ„ä½“ï¼š~~`hisdshdr5`~~ã€`hisdshdr8`ã€`hisdshdr16`ã€`hisdshdr32`ã€`hisdshdr64`ï¼Œåˆ†åˆ«è¡¨ç¤º len å’Œ alloc å ç”¨çš„ä½æ•°ï¼Œå…¶ä¸­`len`è¡¨ç¤º buf å·²ç”¨é•¿åº¦ï¼Œ`alloc`è¡¨ç¤ºåˆ†é…çš„é•¿åº¦ï¼Œ`flags`è¡¨ç¤ºå­—ç¬¦ä¸²ç±»å‹ï¼Œ`buf`æ•°ç»„å­˜å‚¨å®é™…çš„æ•°æ®ï¼Œä¸ºäº†è¡¨ç¤ºæ•°ç»„çš„ç»“æŸï¼ŒRedis ä¼šè‡ªåŠ¨åœ¨æ•°ç»„æœ€åæ·»åŠ `'\\0'`ï¼Œä¼šé¢å¤–å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¯¹äº String ç±»å‹æ¥è¯´ï¼Œé™¤äº† SDS çš„å¼€é”€ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¥è‡ª`RedisObject`ç»“æ„ä½“çš„å¼€é”€ã€‚\n\n```c\ntypedef struct redisObject {\n    unsigned type:4; // æ•°æ®ç±»å‹ï¼Œå¦‚å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œç­‰\n    unsigned encoding:4; // ç¼–ç æ–¹å¼ï¼Œå¦‚ intã€rawã€hashtable ç­‰\n    unsigned lru:LRU_BITS; // Least Recently Usedï¼Œç”¨äºè®°å½•å¯¹è±¡æœ€è¿‘è¢«è®¿é—®çš„æ—¶é—´\n    int refcount; // å¼•ç”¨è®¡æ•°ï¼Œç”¨äºè‡ªåŠ¨å†…å­˜ç®¡ç†\n    void *ptr; // æŒ‡å‘å®é™…å­˜å‚¨æ•°æ®çš„æŒ‡é’ˆ\n} robj;\n```\n\nå½“ä¿å­˜çš„æ˜¯ Long ç±»å‹æ•´æ•°æ—¶ï¼ŒRedisObject ä¸­çš„æŒ‡é’ˆå°±ç›´æ¥èµ‹å€¼ä¸ºæ•´æ•°æ•°æ®ï¼Œå°±ä¸ç”¨é¢å¤–æŒ‡å‘æ•´æ•°äº†ï¼ˆint ç¼–ç ï¼‰ï¼›å½“ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”é•¿åº¦å°äºç­‰äº 44 å­—èŠ‚æ—¶ï¼ŒRedisObject ä¸­å…ƒæ•°æ®ã€æŒ‡é’ˆå’Œ SDSæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜åŒºåŸŸï¼ˆembstr ç¼–ç ï¼‰ï¼›å½“ä¿å­˜çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äº44 å­—èŠ‚æ—¶ï¼ŒRedisObject å’Œ SDS å°±ä¸åœ¨è¿ç»­çš„å†…å­˜åŒºåŸŸäº†ï¼Œè€Œæ˜¯ç»™ SDS åˆ†é…ç‹¬ç«‹çš„ç©ºé—´ï¼Œå¹¶ç”¨æŒ‡é’ˆæŒ‡å‘å®ƒï¼ˆraw ç¼–ç ï¼‰\n\n![image-20241009210128383](%E5%9B%BE%E7%89%87%E7%B4%A0%E6%9D%90%E6%96%87%E4%BB%B6%E5%A4%B9/image-20241009210128383.png)\n\n> å­—ç¬¦ä¸²é•¿åº¦å°äºç­‰äº 44 å­—èŠ‚æ—¶ï¼Œä½¿ç”¨ hisdshdr8å³å¯ä¿å­˜ï¼Œæ ¹æ®hisdshdr8çš„ç»“æ„ä½“å¯çŸ¥ï¼ŒSDS å ç”¨å†…å­˜ï¼š1(len) + 1(alloc) + 1(flags) + 44(å­—ç¬¦ä¸²) + 1('\\0') = 48 Bytesï¼ŒRedisObject å ç”¨å†…å­˜ï¼š8(å…ƒæ•°æ®) + 8 (æŒ‡é’ˆ) = 16Bytesï¼Œä¸€å…± 48+16 = 64 å­—èŠ‚ã€‚\n\nRedis ä½¿ç”¨çš„å†…å­˜åˆ†é…åº“æ˜¯`jemalloc`ï¼Œåˆ†é…å†…å­˜æ—¶ï¼Œä¼šæ ¹æ®ç”³è¯·çš„å­—èŠ‚æ•°Nï¼Œæ‰¾ä¸€ä¸ª>=Nï¼Œä½†æ˜¯æœ€æ¥è¿‘ N çš„ $2^{n}$æ•°ä½œä¸ºåˆ†é…çš„ç©ºé—´ã€‚\n\n## æ¶ˆæ¯é˜Ÿåˆ—\n\næ¶ˆæ¯é˜Ÿåˆ—çš„3ä¸ªåŸºæœ¬éœ€æ±‚ï¼šæ¶ˆæ¯ä¿åºã€é‡å¤æ¶ˆæ¯å¤„ç†ã€æ¶ˆæ¯å¯é æ€§ã€‚\n\nä¿åºå°±æ˜¯æ¶ˆè´¹è€…éœ€è¦æŒ‰ç…§ç”Ÿäº§è€…å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„é¡ºåºå¤„ç†æ¶ˆæ¯ï¼›\n\né‡å¤æ¶ˆæ¯å¤„ç†æ˜¯åœ¨ç½‘ç»œå µå¡æ—¶å‡ºç°æ¶ˆæ¯é‡ä¼ çš„æƒ…å†µï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šæ”¶åˆ°å¤šæ¡é‡å¤çš„æ¶ˆæ¯ï¼›\n\næ¶ˆæ¯å¯é æ€§æ˜¯æ¶ˆè´¹è€…å‡ºç°æ¶ˆæ¯æ—¶å¯èƒ½å‡ºç°æ•…éšœå¯¼è‡´å®•æœºï¼Œæ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆçš„æƒ…å†µï¼›\n\nRedisçš„Listå’ŒStreamä¸¤ç§æ•°æ®ç±»å‹æ»¡è¶³ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§éœ€æ±‚ã€‚\n\nListä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨æ—¶æ˜¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè¿›è¡Œå­˜å–çš„ï¼Œæ¯”å¦‚`LPUSH`å†™å…¥æ¶ˆæ¯ï¼Œ`RPOP`æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™å®¢æˆ·ç«¯éœ€è¦å¾ªç¯åœ°å»è¯·æ±‚ã€‚Redisæä¾›äº†`BRPOP`å‘½ä»¤ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸ºç©ºï¼Œå®¢æˆ·ç«¯åˆ™ä¼šé˜»å¡ç›´åˆ°æœ‰æ¶ˆæ¯å†™å…¥é˜Ÿåˆ—ã€‚å¯¹äºæ¶ˆæ¯çš„é‡å¤å¤„ç†ï¼Œåˆ™æ˜¯é ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¦å®šçš„å…¨å±€å”¯ä¸€IDå®ç°ï¼Œç”Ÿäº§è€…ç»™æ¯ä¸ªå†™å…¥çš„æ¶ˆæ¯ä¸€ä¸ªå…¨å±€å”¯ä¸€IDï¼Œæ¶ˆè´¹æ¶ˆè´¹æ—¶åˆ™è®°å½•å¤„ç†è¿‡çš„IDï¼Œå¯¹æ¯ä¸ªIDçš„æ¶ˆæ¯åªå¤„ç†ä¸€æ¬¡ã€‚Rediså¯¹æ¶ˆæ¯çš„å¯é æ€§æ˜¯é€šè¿‡å‘½ä»¤`BRPOPLPUSH`å‘½ä»¤å®ç°çš„ï¼Œè¿™ä¸ªå‘½ä»¤è®©æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è¯»å–æ¶ˆæ¯çš„åŒæ—¶ï¼ŒæŠŠè¿™ä¸ªæ¶ˆæ¯æ’å…¥åˆ°å¦ä¸€ä¸ªListä¸­å¤‡ä»½ã€‚å½“å®•æœºé‡å¯åï¼Œæ²¡å¤„ç†å®Œæˆçš„æ¶ˆæ¯ä»å¤‡ä»½åˆ—è¡¨ä¸­è¯»å–å†æ¬¡è¿›è¡Œå¤„ç†ã€‚`BRPOPLPUSH MQ_LIST BACKUP_LIST TIMEOUT`\n\n> Redisåœ¨6.2.0ç‰ˆæœ¬åªä¼šå¼•å…¥äº†BLMOVEç”¨æ¥æ›¿ä»£ä¸Šé¢çš„å‘½ä»¤\n\nStreamsæ˜¯Redis5.0ä¸“ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„æ•°æ®ç±»å‹ã€‚\n\n```shell\nXADD MQ_LIST * KEY VALUE\n# å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŠ å…¥æ¶ˆæ¯ï¼Œ*è¡¨ç¤ºç”±Redisç”Ÿæˆå…¨å±€å”¯ä¸€IDï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œè®¾å®šï¼Œä½†æ˜¯è¦ä¿è¯å…¨å±€å”¯ä¸€\nXREAD BLOCK 100 STREAMS MQ_LIST <ID>|$\n# ä»æŒ‡å®šçš„IDå¼€å§‹ï¼Œè¯»å–åé¢çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œ$è¡¨ç¤ºè¯»å–æœ€æ–°æ¶ˆæ¯ï¼ŒBLOCKè¡¨ç¤ºé˜»å¡è¯»ï¼Œé˜»å¡è¶…æ—¶æ—¶é•¿100ms\n```\n\nStreamsæ”¯æŒä»¥æ¶ˆè´¹ç»„çš„å½¢å¼æ¶ˆè´¹æ¶ˆæ¯\n\n```shell\nXGROUP create MQ_LIST <GROUP_NAME> 0\n# åˆ›å»ºæ¶ˆè´¹ç»„æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—MQ_LIST\nXREADGROUP group <GROUP_NAME> <CONSUMER_NAME> streams MQ_LIST >\n# è®©ç»„å†…çš„æ¶ˆè´¹ç»„ä»MQ_LISTä¸­è¯»å–æ¶ˆæ¯ï¼Œ> è¡¨ç¤ºä»ç¬¬ä¸€æ¡æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹è¯»å–\n```\n\nä¸ºäº†ä¿è¯æ¶ˆè´¹ç»„åœ¨æ•…éšœæˆ–å®•æœºé‡å¯åï¼Œä»ç„¶èƒ½è¯»å–æœªå¤„ç†å®Œçš„æ¶ˆæ¯ï¼ŒStreamsä¼šè‡ªåŠ¨ä½¿ç”¨å†…éƒ¨é˜Ÿåˆ—(PENDING list)ç•™å­˜ç»„é‡Œæ¯ä¸ªæ¶ˆè´¹è€…è¯»å–çš„æ¶ˆæ¯ï¼Œç›´åˆ°æ¶ˆè´¹è€…ç”¨`XACK`å‘½ä»¤é€šçŸ¥Streamsæ¶ˆæ¯å·²å¤„ç†å®Œã€‚æ¶ˆè´¹è€…é‡å¯åï¼Œå¯ä»¥ç”¨`XPENDING`å‘½ä»¤æŸ¥çœ‹å·²è¯»å–ä½†æœªACKçš„æ¶ˆæ¯ã€‚\n\n```shell\nXPENDING MQ_LIST <GROUP_NAME> - + 10 <CUSOMER_NAME>\n# æŸ¥è¯¢æŸä¸ªæ¶ˆè´¹è€…å·²è¯»å–ï¼Œä½†æ˜¯æœªACKçš„æ¶ˆæ¯\nXACK MQ_LIST <GROUP_NAME> <ID>\n```\n\n## å¼‚æ­¥æœºåˆ¶\n\n| é˜»å¡ç‚¹                                    | é˜»å¡ç»“æœ                                            | èƒ½å¦å¼‚æ­¥å¤„ç†                                                 |\n| ----------------------------------------- | --------------------------------------------------- | ------------------------------------------------------------ |\n| ç½‘ç»œIO                                    | ä½¿ç”¨IOå¤šè·¯å¤ç”¨ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹                      |                                                              |\n| å¢åˆ æ”¹æŸ¥                                  | âœ–ï¸O(N)å¤æ‚åº¦çš„æ“ä½œï¼Œåˆ é™¤å¤§é›†åˆï¼ˆbigkeyï¼‰ä¼šå¯¼è‡´é˜»å¡   | âœ–ï¸è¯»æ“ä½œä¸èƒ½å¼‚æ­¥ï¼Œä½†æ˜¯åˆ é™¤åªç”¨è¿”å›ç»™å®¢æˆ·ç«¯OKï¼Œå¯ä»¥å¼‚æ­¥è¿›è¡Œï¼ˆæƒ°æ€§åˆ é™¤ï¼‰ |\n| æ•°æ®åº“æ“ä½œ                                | âœ–ï¸æ¸…ç©ºæ•°æ®åº“ï¼ˆFLUSHDBã€FLUSHALLï¼‰ä¼šé˜»å¡              | åªç”¨è¿”å›ç»™å®¢æˆ·ç«¯OKï¼Œå¯ä»¥å¼‚æ­¥è¿›è¡Œ                             |\n| ç”ŸæˆRDBæ–‡ä»¶                               | forkå­è¿›ç¨‹è¿›è¡Œï¼Œåˆ›å»ºå­è¿›ç¨‹è¿‡ç¨‹ä¼šçŸ­æš‚é˜»å¡ï¼Œå½±å“ä¸å¤§  |                                                              |\n| è®°å½•AOFæ–‡ä»¶                               | âœ–ï¸alwaysåŒæ­¥å†™å›ç­–ç•¥ä¼šé˜»å¡ä¸»çº¿ç¨‹                     | å†™å›ç­–ç•¥æ”¹ä¸ºeverysecï¼ŒRedisä¼šå¯åŠ¨å­çº¿ç¨‹æ¥æ‰§è¡ŒAOFæ—¥å¿—çš„å†™ç›˜   |\n| é‡å†™AOF                                   | forkå­è¿›ç¨‹è¿›è¡Œï¼Œåˆ›å»ºå­è¿›ç¨‹è¿‡ç¨‹ä¼šçŸ­æš‚é˜»å¡ï¼Œå½±å“ä¸å¤§  |                                                              |\n| ä¸»ä»å¤åˆ¶-ç”Ÿæˆã€ä¼ è¾“RDBæ–‡ä»¶                | å­è¿›ç¨‹å¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹                            |                                                              |\n| ä¸»ä»å¤åˆ¶-ä»åº“æ¥æ”¶RDBã€æ¸…ç©ºæ•°æ®åº“ã€åŠ è½½RDB | âœ–ï¸FLUSHDBæ¸…ç©ºæ•°æ®åº“ä¼šé˜»å¡ï¼ŒåŠ è½½RDBä¼šé˜»å¡             | âœ–ï¸åŠ è½½RDBå¿…é¡»ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¸èƒ½å¼‚æ­¥                             |\n| åˆ‡ç‰‡é›†ç¾¤-åŒæ­¥å“ˆå¸Œæ§½ä¿¡æ¯                   | å“ˆå¸Œæ§½ä¿¡æ¯é‡ä¸å¤§ï¼Œå½±å“ä¸å¤§                          |                                                              |\n| åˆ‡ç‰‡é›†ç¾¤-æ•°æ®è¿ç§»                         | Redis Clusteræ–¹æ¡ˆä½¿ç”¨åŒæ­¥è¿ç§»ï¼Œåœ¨è¿ç§»bigkeyæ—¶ä¼šé˜»å¡ |                                                              |\n\n> å¼‚æ­¥çš„é”®å€¼å¯¹åˆ é™¤å’Œæ•°æ®åº“æ¸…ç©ºæ˜¯Redis4.0ä¹‹åæä¾›çš„.\n>\n> åˆ é™¤å¤§é‡å…ƒç´ çš„é›†åˆæ—¶ï¼Œä½¿ç”¨`UNLINK`ï¼Œæ¸…ç©ºæ•°æ®åº“ä½¿ç”¨`FLUSHDB ASYNC`å’Œ`FLUSHALL ASYNC`\n\n## Rediså˜æ…¢çš„åŸå› \n\n### æ…¢æŸ¥è¯¢å‘½ä»¤\n\nåœ¨Redisä¸­æ‰§è¡Œé€Ÿåº¦æ…¢çš„å‘½ä»¤ï¼Œä¼šå¯¼è‡´Rediså»¶è¿Ÿå¢åŠ ã€‚\n\né’ˆå¯¹æ…¢æŸ¥è¯¢çš„å‘½ä»¤ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–é«˜æ•ˆçš„å‘½ä»¤è¿›è¡Œæ›¿ä»£ï¼Œæ¯”å¦‚`SSCAN`å¤šæ¬¡è¿­ä»£æ›¿æ¢`SMEMBERS`ç”¨äºæŸ¥è¯¢Setä¸­æ‰€æœ‰æˆå‘˜ã€‚æˆ–è€…é’ˆå¯¹Seté›†åˆçš„æ’åºã€äº¤é›†ã€å¹¶é›†å¯ä»¥åœ¨å®¢æˆ·ç«¯å®Œæˆã€‚\n\n> `KEYS *`å‘½ä»¤ä¼šéå†æ‰€æœ‰é”®å€¼å¯¹ï¼Œå»¶æ—¶é«˜ï¼Œåº”è¯¥é¿å…ä½¿ç”¨\n\n```ini\nslowlog-log-slower-than\n# æ…¢æŸ¥è¯¢æ—¥å¿—å¯¹æ‰§è¡Œæ—¶é—´å¤§äºå¤šå°‘å¾®ç§’çš„å‘½ä»¤è¿›è¡Œè®°å½•\n\nslowlog-max-len 1000\n# æ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤šèƒ½è®°å½•1000æ¡å‘½ä»¤ï¼Œé»˜è®¤128\n```\n\nä½¿ç”¨`SLOWLOG GET`å‘½ä»¤æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•çš„æ“ä½œå‘½ä»¤ã€‚Redis2.8.13å¼€å§‹æä¾›`latency monitor`ç›‘æ§å·¥å…·ï¼Œç”¨æ¥ç›‘æ§Redisè¿è¡ŒæœŸé—´å³°å€¼å»¶è¿Ÿæƒ…å†µï¼Œé¦–å…ˆè®¾ç½®è¦ç›‘æ§çš„é˜ˆå€¼`config set latency-monitor-threshold 1000`ï¼Œç„¶åä½¿ç”¨å‘½ä»¤`latency latest`å‘½ä»¤æŸ¥çœ‹è¶…è¿‡1000å¾®ç§’çš„å»¶è¿Ÿæƒ…å†µã€‚\n\n### è¿‡æœŸKeyæ“ä½œ\n\né»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæ¯100msä¼šåˆ é™¤ä¸€äº›è¿‡æœŸçš„keyã€‚æ­¥éª¤å¦‚ä¸‹ï¼šé‡‡æ ·`ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOK`ä¸ªæ•°ï¼ˆé»˜è®¤20ï¼‰çš„keyï¼Œå°†å…¶ä¸­è¿‡æœŸçš„keyåˆ é™¤ï¼›å¦‚æœè¿‡æœŸçš„keyå æ¯”æ‰¾è¿‡`25%`ï¼Œåˆ™é‡å¤æ­¤æ­¥éª¤ï¼Œç›´åˆ°å æ¯”ä½äº`25%`ã€‚\n\n> é™¤äº†ä¸Šé¢çš„å®šæ—¶ä»»åŠ¡ï¼Œå½“è®¿é—®ä¸€ä¸ªé”®æ—¶ï¼Œä¹Ÿä¼šå¯¹é”®çš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœè¿‡æœŸï¼Œå°±å°†é”®åˆ æ‰ã€‚\n>\n> ä¸¤ç§æ–¹å¼åˆ é™¤è¿‡æœŸé”®æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªexpiredé€šçŸ¥ï¼Œäº§ç”Ÿ expired é€šçŸ¥çš„æ—¶é—´ä¸ºè¿‡æœŸé”®è¢«åˆ é™¤çš„æ—¶å€™ï¼Œ è€Œä¸æ˜¯é”®çš„ç”Ÿå­˜æ—¶é—´å˜ä¸º 0 çš„æ—¶å€™ã€‚\n\nå¦‚æœä½¿ç”¨`EXPIREAT`å‘½ä»¤è®¾ç½®å¤§é‡åŒä¸€æ—¶é—´è¿‡æœŸçš„é”®ï¼Œä¼šå¯¼è‡´Redisä¸€ç›´å¿™äºåˆ é™¤è¿‡æœŸé”®æ¥é‡Šæ”¾ç©ºé—´ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ—¶å»¶å¢åŠ ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨`EXPIREAT`æˆ–`EXPIRE`è®¾ç½®è¿‡æœŸå‚æ•°æ—¶åŠ ä¸€ä¸ªå¯ä»¥æ¥æ”¶çš„éšæœºæ•°ã€‚\n\n### AOFå†™ç›˜\n\nAOFé‡å†™æ—¶ï¼Œä¼šè¿›è¡Œå¤§é‡çš„ç£ç›˜IOï¼Œå¯èƒ½ä¼šå¯¼è‡´AOFæ—¥å¿—(`everysec`æˆ–`always`ç­–ç•¥)çš„`fsync`è¢«é˜»å¡ï¼Œè™½ç„¶`fsync`ç”±å­çº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯ä¸»çº¿ç¨‹ä¼šç›‘æ§`fsync`çš„è¿›åº¦ï¼Œå¦‚æœä¸Šä¸€æ¬¡çš„`fsync`æœªå®Œæˆï¼Œä¸»çº¿ç¨‹å°±ä¼šé˜»å¡ã€‚\n\n`no-appendfsync-on-rewrite yes`é…ç½®ï¼ˆé»˜è®¤`no`ï¼‰è¡¨ç¤ºåœ¨AOFé‡å†™æ—¶ä¸è¿›è¡Œ`fsync`æ“ä½œï¼Œä½†æ˜¯æ­¤æ—¶å®•æœºä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚\n\n### swap\n\nå†…å­˜swapæ˜¯æ“ä½œç³»ç»Ÿå°†å†…å­˜æ•°æ®åœ¨å†…å­˜å’Œç£ç›˜é—´æ¥å›æ¢å…¥æ¢å‡ºçš„æœºåˆ¶ï¼Œæ¶‰åŠç£ç›˜çš„è¯»å†™ï¼Œå½±å“æ€§èƒ½ã€‚å½“Rediså®ä¾‹å ç”¨å¤§é‡å†…å­˜ï¼Œæˆ–è€…åŒä¸€æœºå™¨ä¸Šè¿è¡Œå…¶ä»–è¿›ç¨‹å ç”¨å¤§é‡å†…å­˜æ—¶ï¼Œä¼šå¯¼è‡´åˆ†é…ç»™Rediså®ä¾‹çš„å†…å­˜ä¸è¶³ï¼Œè¿›è€Œè§¦å‘swapã€‚\n\n## å†…å­˜ç¢ç‰‡\n\n`INFO memory`å‘½ä»¤ç”¨äºæŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œ`used_memory`æ˜¯Redisä¸ºä¿å­˜æ•°æ®å®é™…ä½¿ç”¨çš„ç©ºé—´ï¼Œ`used_memory_rss`æ˜¯æ“ä½œç³»ç»Ÿå®é™…åˆ†é…ç»™Redisçš„ç©ºé—´ï¼Œ`mem_fragmentation_ratio = used_memory_rss / used_memory` æ˜¯è¡¨ç¤ºå½“å‰å†…å­˜ç¢ç‰‡ç‡çš„æŒ‡æ ‡ã€‚\n\nRedisä»4.0-RC3ç‰ˆæœ¬å¼€å§‹ï¼Œæä¾›äº†è‡ªåŠ¨æ¸…ç†å†…å­˜ç¢ç‰‡æœºåˆ¶ï¼Œé€šè¿‡å‘½ä»¤`config set activedefrag yes`å¼€å¯è¯¥æœºåˆ¶ã€‚åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªé…ç½®å‚æ•°æ—¶è‡ªåŠ¨è§¦å‘å†…å­˜æ¸…ç†ï¼š\n\n```ini\n# å†…å­˜ç¢ç‰‡å­—èŠ‚æ•°è¾¾åˆ°100MB\nactive-defrag-ignore-bytes 100mb\n# å†…å­˜ç¢ç‰‡ç©ºé—´å æ¯”è¾¾åˆ° 10%\nactive-defrag-threshold-lower 10\n```\n\nä½†æ˜¯å†…å­˜ç¢ç‰‡æ¸…ç†æ—¶ï¼Œéœ€è¦æŠŠå¤šä»½æ•°æ®æ‹·è´åˆ°æ–°çš„ä½ç½®ï¼Œä¼šé˜»å¡å…¶ä»–æ“ä½œã€‚\n\n```ini\n# å†…å­˜æ¸…ç†è¿‡ç¨‹ä¸­æ‰€ç”¨CPUæ—¶é—´æ¯”ä¾‹æœ€ä½ 25%ï¼Œ ä¿è¯æ¸…ç†èƒ½æ­£å¸¸å¼€å±•\nactive-defrag-cycle-min 25\n# å†…å­˜æ¸…ç†è¿‡ç¨‹ä¸­æ‰€ç”¨CPUæ—¶é—´å æ¯”æœ€é«˜ 75%ï¼Œ ä¿è¯ä¸å½±å“å…¶ä»–æ“ä½œ\nactive-defrag-cycle-max 75\n```\n\n## ç¼“å†²åŒº\n\næœåŠ¡å™¨ç»™æ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯é…ç½®äº†ä¸€ä¸ªè¾“å…¥è¾“å‡ºç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºä¼šæŠŠå®¢æˆ·ç«¯å‘è¿‡æ¥çš„å‘½ä»¤æš‚å­˜èµ·æ¥ï¼ŒRedisä¸»çº¿ç¨‹ä»è¾“å…¥ç¼“å†²åŒºè¯»å–å‘½ä»¤å†æ‰§è¡Œï¼›æ‰§è¡Œå®Œæˆåå°†ç»“æœå†™å…¥è¾“å‡ºç¼“å†²åŒºï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\n### è¾“å…¥ç¼“å†²åŒº\n\n```shell\nclient list\n\n# æŸ¥çœ‹å’ŒRedisæœåŠ¡å™¨ç›¸è¿çš„æ¯ä¸ªå®¢æˆ·ç«¯å¯¹è¾“å…¥ç¼“å†²åŒºçš„ä½¿ç”¨æƒ…å†µ\n# ... qbuf=xxx qbuf-free=xxx cmd=xxx\n# qbufè¡¨ç¤ºç¼“å†²åŒºå·²ä½¿ç”¨å¤§å°ï¼Œqbuf-freeè¡¨ç¤ºç¼“å†²åŒºæœªä½¿ç”¨çš„å¤§å°ï¼Œcmdè¡¨ç¤ºæœ€æ–°æ‰§è¡Œçš„å‘½ä»¤\n```\n\nå½“å®¢æˆ·ç«¯å†™å…¥`bigkey`ï¼Œæˆ–è€…Redisä¸»çº¿ç¨‹é˜»å¡æ— æ³•åŠæ—¶å¤„ç†å®¢æˆ·ç«¯å‘½ä»¤ï¼Œå¯¼è‡´å †ç§¯åœ¨ç¼“å†²åŒºæº¢å‡ºï¼ŒRediså°±ä¼šå°†è¿æ¥å…³é—­ã€‚è¾“å…¥ç¼“å†²åŒºçš„å¤§å°æ— æ³•è°ƒæ•´ï¼ŒRedisè®¾å®šçš„æ˜¯`1G`ã€‚\n\n### è¾“å‡ºç¼“å†²åŒº\n\nRedisä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„è¾“å‡ºç¼“å†²åŒºåŒ…å«ä¸¤éƒ¨åˆ†ï¼šå¤§å°å›ºå®šä¸º`16KB`çš„å›ºå®šç¼“å†²åŒºï¼Œæš‚å­˜`OK`å’Œå‡ºé”™ä¿¡æ¯ï¼›å¯ä»¥åŠ¨æ€å¢åŠ çš„ç¼“å†²åŒºï¼Œå­˜æ”¾å¤§å°å¯å˜çš„å“åº”ç»“æœã€‚\n\n`MONITOR`å‘½ä»¤æ˜¯ç”¨æ¥æŒç»­ç›‘æµ‹Redisæ‰§è¡Œçš„ï¼Œè¯¥å‘½ä»¤çš„è¾“å‡ºä¼šæŒç»­å ç”¨è¾“å‡ºç¼“å†²åŒºï¼Œæœ€ç»ˆå‘ç”Ÿæº¢å‡ºï¼Œæ‰€ä»¥ä¸è¦åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚\n\nè¾“å‡ºç¼“å†²åŒºå¯ä»¥é€šè¿‡å‚æ•°`client-output-buffer-limit`æ¥è¿›è¡Œé…ç½®\n\n```ini\n# normal: æ™®é€šclient,åŒ…æ‹¬monitor çš„ bufferé™åˆ¶ ï¼Œ3ä¸ª0è¡¨ç¤ºä¸åšé™åˆ¶\nclient-output-buffer-limit normal 0 0 0\n# slaveï¼šä¸»ä»çš„slave client bufferé™åˆ¶ï¼Œè¶…è¿‡256mï¼Œæˆ–è€…è¶…è¿‡64mæŒç»­60sï¼Œåˆ™å…³é—­å®¢æˆ·ç«¯è¿æ¥\nclient-output-buffer-limit slave 256mb 64mb 60\n# pubsubï¼špubsubæ¨¡å¼ä¸­çš„ client bufferé™åˆ¶ï¼Œè¶…è¿‡32mï¼Œæˆ–è€…è¶…è¿‡8mæŒç»­60sï¼Œåˆ™å…³é—­å®¢æˆ·ç«¯è¿æ¥\nclient-output-buffer-limit pubsub 32mb 8mb 60\n```\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºæ™®é€šå®¢æˆ·ç«¯ï¼Œclient-output-buffer æ˜¯ä¸è®¾é™åˆ¶çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œä¼šç­‰åˆ°å“åº”ç»“æœåï¼Œå†è¿›è¡Œä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œé™¤é`bigkey`ï¼Œä¸€èˆ¬ä¸ä¼šç§¯å‹åœ¨ç¼“å†²åŒºã€‚å¯¹äºç”¨ä½œ Pub/Sub å’Œ slave çš„å®¢æˆ·ç«¯ï¼Œserver ä¼šä¸»åŠ¨æŠŠæ•°æ®æ¨é€ç»™ä»–ä»¬ï¼Œæ•…éœ€è¦è®¾ç½® client-output-buffer çš„é™åˆ¶ã€‚\n\n### å¤åˆ¶ç¼“å†²åŒº\n\nä¸»ä»å…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹å‘ä»èŠ‚ç‚¹ä¼ è¾“RDBæ–‡ä»¶çš„åŒæ—¶ï¼Œå°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯å†™å‘½ä»¤ä¿å­˜åœ¨å¤åˆ¶ç¼“å†²åŒºä¸­ï¼Œç­‰RDBæ–‡ä»¶ä¼ è¾“å®Œæˆåï¼Œå†å‘ç”Ÿç»™ä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹ä¼šä¸ºæ¯ä¸ªä»èŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶ç¼“å†²åŒºã€‚\n\næ‰€ä»¥å¤åˆ¶ç¼“å†²åŒºæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªç”¨äºä»èŠ‚ç‚¹ä½¿ç”¨çš„è¾“å‡ºç¼“å†²åŒºï¼Œå‘ç”Ÿæº¢å‡ºä¹Ÿä¼šç›´æ¥å…³é—­ã€‚è®¾ç½®ç¼“å†²åŒºå¤§å°è§ä¸Šé¢(slave)ã€‚\n\n### å¤åˆ¶ç§¯å‹ç¼“å†²åŒº\n\nä¸»èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ°å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹æ—¶ï¼Œä¼šåŒæ—¶å†™åˆ°å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œç”¨äºåœ¨ç½‘ç»œæ–­å¼€æ¢å¤åï¼Œå°†æ–­è¿æœŸé—´çš„å†™å‘½ä»¤ï¼Œå¢é‡åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚å¤åˆ¶ç§¯å‹ç¼“å†²åŒºæ˜¯ä¸€ä¸ªæœ‰é™çš„ç¯å½¢ç¼“å†²åŒºï¼Œå†™æ»¡åä¼šè¦†ç›–ä¹‹å‰çš„æ—§æ•°æ®ï¼Œå¦‚æœä»èŠ‚ç‚¹è¿˜æ²¡æœ‰åŒæ­¥è¿™äº›æ—§å‘½ä»¤ï¼Œä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹é—´é‡æ–°å¼€å§‹å…¨é‡å¤åˆ¶ã€‚å¯¹æ¯”å¤åˆ¶ç¼“å†²åŒºï¼Œå‘é€å‡ºå»çš„æ•°æ®ä¼šæ¸…é™¤ï¼Œå¤åˆ¶ç§¯å‹ç¼“å†²åŒºåªä¼šè¦†ç›–æ—§æ•°æ®ï¼Œä»ç„¶ä¿ç•™äº†æœ€æ–°çš„å‘½ä»¤ã€‚é€šè¿‡`repl_backlog_size`é…ç½®å¤åˆ¶ç§¯å‹ç¼“å†²åŒºçš„å¤§å°ã€‚\n\n## æ·˜æ±°æœºåˆ¶\n\n```shell\nconfig set maxmemory 4gb\n```\n\nè®¾ç½®Redisä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œç¼“å­˜å†™æ»¡åä¼šè§¦å‘ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚\n\n| ç­–ç•¥            | è¯´æ˜                                               |\n| --------------- | -------------------------------------------------- |\n| noeviction      | ä¸è¿›è¡Œæ•°æ®æ·˜æ±°(é»˜è®¤)                               |\n| volatile-random | é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œéšæœºåˆ é™¤               |\n| volatile-ttl    | é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œæ ¹æ®è¿‡æœŸçš„å…ˆåè¿›è¡Œåˆ é™¤ |\n| volatile-lru    | é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œåˆ é™¤æœ€è¿‘æœ€æ²¡ä½¿ç”¨çš„     |\n| volatile-lfu    | é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„     |\n| allkeys-random  | ä»æ‰€æœ‰é”®å€¼å¯¹ä¸­éšæœºé€‰æ‹©åˆ é™¤                         |\n| allkeys-lru     | ä»æ‰€æœ‰é”®å€¼å¯¹ä¸­åˆ é™¤æœ€è¿‘æœ€æ²¡æœ‰ä½¿ç”¨çš„                 |\n| allkeys-lfu     | ä»æ‰€æœ‰é”®å€¼å¯¹ä¸­åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„                   |\n\nRedisé»˜è®¤è®°å½•æ¯ä¸ªæ•°æ®çš„æœ€è¿‘ä¸€æ¬¡è®¿é—®æ—¶é—´æˆ³ï¼Œä¿å­˜åœ¨RedisObjectçš„lruå­—æ®µï¼Œåœ¨å†³å®šæ·˜æ±°æ•°æ®æ—¶ï¼Œç¬¬ä¸€æ¬¡ä¼šéšæœºé€‰å‡ºNä¸ªæ•°æ®ï¼Œæ¯”è¾ƒè¿™Nä¸ªæ•°æ®çš„lruå­—æ®µï¼ŒæŠŠlruæœ€å°çš„åˆ é™¤ã€‚é€šè¿‡é…ç½®å‚æ•°`CONFIG SET maxmemory-samples 100`è®¾ç½®é€‰å‡ºçš„æ ·æœ¬æ•°Nã€‚å†æ¬¡æ·˜æ±°æ•°æ®æ—¶ï¼ŒRediséœ€è¦æŒ‘é€‰æ•°æ®è¿›å…¥ç¬¬ä¸€æ¬¡æ·˜æ±°æ—¶åˆ›å»ºçš„å€™é€‰é›†åˆï¼Œèƒ½è¿›å…¥å€™é€‰é›†åˆçš„æ•°æ®lruå¿…é¡»å°äºé›†åˆä¸­æœ€å°çš„lrjå€¼ã€‚å½“å€™é€‰æ•°æ®ä¸ªæ•°è¾¾åˆ°`maxmemory-samples`æ—¶ï¼ŒæŠŠlruæœ€å°çš„æ·˜æ±°å‡ºå»ã€‚\n\n## ç¼“å­˜å¼‚å¸¸\n\n### ç¼“å­˜é›ªå´©\n\nç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡çš„åº”ç”¨è¯·æ±‚æ— æ³•åœ¨Redisç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œå¤§é‡çš„è¯·æ±‚é€åˆ°æ•°æ®åº“å±‚ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢ã€‚ä¸€èˆ¬æ˜¯ç”±äºç¼“å­˜ä¸­å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ— æ³•å¾—åˆ°å¤„ç†ï¼Œæˆ–è€…Redisç¼“å­˜å®ä¾‹å‘ç”Ÿæ•…éšœå®•æœºäº†ï¼Œæ— æ³•å¤„ç†è¯·æ±‚ã€‚\n\né’ˆå¯¹å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯ä»¥åœ¨ç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼ŒåŠ ä¸€ä¸ªè¾ƒå°çš„éšæœºæ•°ï¼Œé¿å…å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼›\n\nå¤„ç†æ–¹å¼ä¸€èˆ¬æ˜¯æœåŠ¡é™çº§ï¼šéæ ¸å¿ƒä¸šåŠ¡ï¼Œæš‚æ—¶åœæ­¢ä»ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œè€Œæ˜¯è¿”å›é¢„å®šä¹‰ä¿¡æ¯æˆ–è€…é”™è¯¯ä¿¡æ¯ï¼›æ ¸å¿ƒä¸šåŠ¡ï¼Œä»ç„¶è¿è¡ŒæŸ¥è¯¢ç¼“å­˜ï¼Œç¼“å­˜ç¼ºå¤±åˆ™è®¿é—®æ•°æ®åº“ã€‚\n\nå¦‚æœæ˜¯æœåŠ¡å®•æœºï¼Œä¸ºäº†é˜²æ­¢å¼•å‘è¿é”çš„æ•°æ®åº“é›ªå´©ï¼Œç”šè‡³æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒï¼Œåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å®ç°æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµã€‚\n\n### ç¼“å­˜å‡»ç©¿\n\næŸä¸ªçƒ­ç‚¹æ•°æ®å¤±æ•ˆçš„åœºæ™¯ã€‚ç›¸æ¯”ç¼“å­˜é›ªå´©ï¼Œç¼“å­˜å‡»ç©¿çš„æ•°æ®é‡è¦å°å¾ˆå¤šã€‚\n\nå¤„ç†æ–¹å¼æ˜¯é’ˆå¯¹çƒ­ç‚¹æ•°æ®ï¼Œä¸è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚\n\n### ç¼“å­˜ç©¿é€\n\nè¦è®¿é—®çš„æ•°æ®æ—¢ä¸åœ¨Redisç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ï¼Œå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½è¦è®¿é—®æ•°æ®åº“ã€‚å¤„ç†æ–¹å¼æ˜¯ç¼“å­˜ç©ºå€¼æˆ–é»˜è®¤å€¼ï¼Œè¿™æ ·é¿å…è¯·æ±‚åˆ°åº•æ•°æ®åº“ï¼›æˆ–è€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¸ç”¨è®¿é—®æ•°æ®åº“äº†ï¼›æˆ–è€…é’ˆå¯¹æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®ï¼Œåœ¨å‰ç«¯å¯¹è¯·æ±‚è¿›è¡Œè¿‡æ»¤ã€‚\n\n### ç¼“å­˜æ±¡æŸ“\n\nç•™å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä½†æ˜¯è®¿é—®æ¬¡æ•°å¾ˆå°‘ï¼Œæˆ–è€…ä»¥åä¸ä¼šå†è¢«è®¿é—®çš„æ•°æ®ã€‚ä½¿ç”¨LFUç®—æ³•çš„æ·˜æ±°ç­–ç•¥èƒ½æœ‰æ•ˆè§£å†³ç¼“å­˜æ±¡æŸ“çš„é—®é¢˜ã€‚Redisåœ¨å®ç°LFUç­–ç•¥æ—¶ï¼Œå°†`lru`å­—æ®µæ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå‰16bitçš„æ—¶é—´æˆ³(åˆ†é’Ÿçº§åˆ«)å’Œå8bitçš„è®¿é—®æ¬¡æ•°ã€‚\n\n8bitçš„è®¿é—®æ¬¡æ•°ç†è®ºæœ€å¤§åªæœ‰255ï¼Œä½†æ˜¯Redisçš„å®ç°æ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ã€‚è®¡ç®— $ 1 / (counter * lfu\\_log\\_factor + 1) $ å¾—åˆ°çš„å€¼å’Œä¸€ä¸ª$(0, 1)$åŒºé—´çš„éšæœºæ•°`r`æ¯”è¾ƒï¼Œæ¯” `r`å¤§`counter++`ï¼Œæ‰€ä»¥è®¡æ•°å™¨å¢åŠ æ˜¯ä¸€ä¸ªæ¦‚ç‡äº‹ä»¶ï¼Œè€Œä¸”è®¡æ•°å™¨è¶Šå¤§ï¼Œè¿™ä¸ªæ¦‚ç‡è¶Šä½ã€‚åŒæ—¶ï¼ŒRedisè¿˜åŠ å…¥äº†è®¡æ•°å™¨è¡°å‡çš„æœºåˆ¶ï¼Œé¦–å…ˆè®¡ç®—å½“å‰æ—¶é—´å’Œ`lru`æ—¶é—´æˆ³çš„åˆ†é’Ÿå·®å€¼ï¼Œç”¨å·®å€¼é™¤ä»¥`lfu_decay_time`å¾—åˆ°è®¡æ•°å™¨è¦è¡°å‡çš„å€¼ã€‚\n\n> ç”¨`lfu_log_factor`é™åˆ¶è®¡æ•°å™¨å¢é•¿çš„é€Ÿåº¦ï¼Œç”¨`lfu_decay_time`æ§åˆ¶è®¡æ•°å™¨è¡°å‡çš„é€Ÿåº¦ã€‚\n>\n> è¿™é‡ŒçŒœæµ‹å¯èƒ½æœ‰ä¸ªé—®é¢˜ï¼Œå‰16bitè¡¨ç¤ºçš„`ldt`ä¸Šæ¬¡è¡°å‡æ—¶é—´è®¡ç®—ä¸º` ((unixtime / 60) & 65535)`ï¼Œæœ€å¤§æ—¶é—´é—´éš”æ˜¯65535åˆ†é’Ÿï¼Œçº¦45å¤©ã€‚è‹¥åˆšå¥½65535åˆ†é’Ÿåï¼Œè®¿é—®è§¦å‘è¡°å‡æ—¶ï¼Œè¡°å‡å€¼` (now >= ldt ? (now - ldt) : (65535 - ldt + now)) / lfu_decay_time â€‹` å¾ˆå°ï¼Œå¯¼è‡´æœ¬è¯¥è¢«æ·˜æ±°çš„å€¼ç»§ç»­ç•™å­˜ä¸‹æ¥ã€‚\n\n## åŸå­æ“ä½œ\n\n### å•å‘½ä»¤æ“ä½œ\n\nRedisæ˜¯å•çº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯å‘½ä»¤çš„ï¼Œæ‰€ä»¥å¯¹äºå•æ¡å‘½ä»¤æ˜¯åŸå­æ“ä½œã€‚å¦‚æœå¤šä¸ªæ“ä½œå¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤å®ç°ç›¸åŒçš„æ•ˆæœï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨è¿™ä¸ªå•å‘½ä»¤æ¥å®ç°åŸå­æ“ä½œã€‚æ¯”å¦‚`DECR <KEY>`ç”¨æ¥æ›¿ä»£\"GET, -1, SET\"çš„æ“ä½œã€‚\n\n### LUAè„šæœ¬\n\nå¯¹äºè¾ƒä¸ºå¤æ‚çš„æ“ä½œï¼Œæ— æ³•ç”¨å•æ¡å‘½ä»¤å®ç°çš„ï¼Œç”¨LUAè„šæœ¬æ¥ä¿è¯åŸå­æ“ä½œã€‚\n\n```lua\nlocal current\ncurrent = redis.call(\"incr\", KEYS[1])\nif tonumber(current) == 1 then\n    redis.call(\"expire\", KEYS[1], 60)\nend\n```\n\nç„¶åè°ƒç”¨è„šæœ¬`redis-cli --eval xxx.lua keys, args`\n\n### åˆ†å¸ƒå¼é”\n\n**åŸºäºå•ä¸ªRedisèŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”**\n\nåŠ é”ï¼š`SET lock_key <RANDOM_STR> NX EX 5`ï¼Œå•å‘½ä»¤ä¿è¯åŸå­æ€§ï¼Œ`NX`åªæœ‰é”®ä¸å­˜åœ¨æ—¶æ‰èƒ½åˆ›å»ºæˆåŠŸï¼Œ`EX`è®¾ç½®è¿‡æœŸæ—¶é—´5sï¼Œéšæœºå­—ç¬¦ä¸²é¿å…è¢«å…¶ä»–å®¢æˆ·ç«¯åˆ é™¤ã€‚\n\nè§£é”ï¼š`redis-cli --eval unlock.lua lock_key, <RANDOM_STR>`ï¼Œluaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œå‚æ•°åŒ…å«åŠ é”æ—¶çš„éšæœºå­—ç¬¦ä¸²ï¼Œé¿å…é”çš„è¯¯åˆ ã€‚\n\n```lua\nif redis.call(\"get\", KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\", KEYS[1])\nelse\n    return 0\nend\n```\n\n**åŸºäºå¤šä¸ªRedisèŠ‚ç‚¹çš„é«˜å¯é åˆ†å¸ƒå¼é”**\n\nåˆ†å¸ƒå¼é”ç®—æ³•Redlockï¼š\n\n1. å®¢æˆ·ç«¯è·å–å½“å‰æ—¶é—´\n2. å®¢æˆ·ç«¯ä¾æ¬¡å‘Nä¸ªRediså®ä¾‹æ‰§è¡ŒåŠ é”æ“ä½œï¼ŒåŠ é”æ“ä½œçš„è¶…æ—¶æ—¶é—´è¿œå°äºé”çš„æœ‰æ•ˆæ—¶é—´\n3. å®¢æˆ·ç«¯å®Œæˆå‘æ‰€æœ‰Rediså®ä¾‹çš„åŠ é”æ“ä½œï¼Œè®¡ç®—æ•´ä¸ªè¿‡ç¨‹çš„è€—æ—¶\n\nåŒæ—¶æ»¡è¶³è¶…è¿‡åŠæ•°($N/2 + 1$)çš„å®ä¾‹åŠ é”è¶…è¿‡å’Œæ€»è€—æ—¶ä¸è¶…è¿‡é”çš„æœ‰æ•ˆæ—¶é—´æ‰ç®—åŠ é”è¶…è¿‡ã€‚å¦‚æœä¸æˆåŠŸï¼Œå®¢æˆ·ç«¯å°±å‘æ‰€æœ‰Rediså®ä¾‹å‘èµ·é‡Šæ”¾é”çš„æ“ä½œã€‚\n\n## äº‹åŠ¡\n\näº‹åŠ¡çš„ACIDç‰¹æ€§ï¼š\n\n+ AtomicityåŸå­æ€§\n+ Consistencyä¸€è‡´æ€§\n+ Isolationéš”ç¦»æ€§\n+ DurabilityæŒä¹…æ€§\n\nRedisé€šè¿‡`MULTI`å’Œ`EXEC`å‘½ä»¤æä¾›äº‹åŠ¡çš„æ”¯æŒã€‚\n\né€šè¿‡è¿™ä¸¤ä¸ªå‘½ä»¤æäº¤çš„äº‹åŠ¡å‘½ä»¤è¦ä¹ˆéƒ½**æ‰§è¡Œ**ï¼Œè¦ä¹ˆéƒ½**ä¸æ‰§è¡Œ**ã€‚å¼ºè°ƒçš„æ˜¯æ‰§è¡Œï¼Œè€Œä¸ç®¡æˆä¸æˆåŠŸï¼Œå¦‚æœï¼šå‘½ä»¤æœ‰è¯­æ³•é”™è¯¯ï¼Œå‘½ä»¤å…¥é˜Ÿæ—¶ä¼šæŠ¥é”™ï¼Œåˆ™ä¼šæ”¾å¼ƒï¼Œéƒ½ä¸æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ï¼›å¦‚æœéè¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡Œæ—¶æŠ¥é”™ï¼Œå…¨éƒ¨æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ï¼›å¦‚æœä½¿ç”¨`DISCARD`æ”¾å¼ƒäº‹åŠ¡ï¼Œåˆ™å…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ï¼›å¦‚æœRediså®ä¾‹æ•…éšœï¼Œåœ¨å¼€å¯AOFæ—¥å¿—çš„å‰æä¸‹ï¼Œä½¿ç”¨å·¥å…·`redis-check-aof`å¯ä»¥æ£€æµ‹æœªå®Œæˆçš„äº‹åŠ¡ï¼Œæ¢å¤æ—¶ä¸æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ã€‚\n\nRedis æä¾›äº† `WATCH`å‘½ä»¤æ¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œä½¿ç”¨`WATCH`å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªkey è¿›è¡Œç›‘æ§ï¼Œåœ¨`EXEC`ä¹‹å‰ï¼Œå¦‚æœæœ‰å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†ç›‘æ§çš„ keyï¼Œäº‹åŠ¡ä¼šè¢«æ”¾å¼ƒã€‚\n\nRedis åœ¨ä¸¤æ¬¡ RDB ä¹‹é—´ï¼Œæˆ–è€… AOF åˆ·ç›˜å‰å®•æœºï¼Œæ˜¯ä¿è¯ä¸äº†æŒä¹…æ€§çš„ã€‚\n",
      "data": {
        "title": "Redisæ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ç¬”è®°",
        "date": "2024-12-07 20:23:23",
        "tags": [
          "redis",
          "geektime",
          "note"
        ],
        "published": true,
        "hideInList": false,
        "feature": "/post-images/redis-he-xin-ji-zhu-yu-shi-zhan-bi-ji.png",
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "## æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„\n\n| æ•°æ®ç±»å‹   | æ•°æ®ç»“æ„                             |\n| ---------- | ------------------------------------ |\n| String     | SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰                |\n| List       | åŒå‘é“¾è¡¨ã€å‹ç¼©åˆ—è¡¨(ZipList)          |\n| Hash       | å‹ç¼©åˆ—è¡¨(ZipList)ã€å“ˆå¸Œè¡¨(HashTable) |\n| Set        | æ•´æ•°æ•°ç»„(IntSet)ã€å“ˆå¸Œè¡¨(HashTable)  |\n| Sorted Set | å‹ç¼©åˆ—è¡¨(ZipList)ã€è·³è¡¨(SkipList)    |\n\n### å‹ç¼©åˆ—è¡¨\n\nå‹ç¼©åˆ—è¡¨ç±»ä¼¼æ•°ç»„ï¼Œä¸åŒçš„æ˜¯å‹ç¼©åˆ—è¡¨è¡¨å¤´æœ‰3ä¸ªå­—æ®µ`zlbytes`ã€`zltail`ã€`zllen`ï¼Œåˆ†åˆ«è¡¨ç¤ºåˆ—è¡¨é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€åˆ—è¡¨å°¾å…ƒç´ åç§»é‡ã€åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°ã€‚æ­¤å¤–åˆ—è¡¨å°¾è¿˜æœ‰ä¸€ä¸ª`zlend`è¡¨ç¤ºåˆ—è¡¨ç»“æŸï¼Œå›ºå®šå€¼`0xFF`ã€‚",
      "fileName": "redis-he-xin-ji-zhu-yu-shi-zhan-bi-ji"
    },
    {
      "content": "> æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤\n\n## ğŸ  å…³äºæœ¬ç«™\n\n## ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°\n\n## â›¹ å…´è¶£çˆ±å¥½\n\n## ğŸ“¬ è”ç³»æˆ‘å‘€\n",
      "data": {
        "title": "å…³äº",
        "date": "2019-01-25 19:09:48",
        "tags": null,
        "published": true,
        "hideInList": true,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "about"
    }
  ],
  "tags": [
    {
      "name": "charset",
      "slug": "LAmDOO6ZAH",
      "used": true
    },
    {
      "name": "å­—ç¬¦ç¼–ç ",
      "slug": "EW01U2P9Pxj",
      "used": true
    },
    {
      "name": "unicode",
      "slug": "D5ByN-WUfIa",
      "used": true
    },
    {
      "name": "debug",
      "slug": "bYJHrIt4iL",
      "used": true
    },
    {
      "name": "Java",
      "slug": "UcD7YoRwr9G",
      "used": true
    },
    {
      "name": "James",
      "slug": "7fpwmYgCIx",
      "used": true
    },
    {
      "name": "é‚®ä»¶æœåŠ¡å™¨",
      "slug": "8wyKh9Ri_L5",
      "used": true
    },
    {
      "name": "JavaScript",
      "slug": "1_sYLEQcq5",
      "used": true
    },
    {
      "name": "çˆ¬è™«",
      "slug": "b5Ycy1BiBE",
      "used": true
    },
    {
      "name": "chrome æ’ä»¶",
      "slug": "Bv1ZpNk-8gU",
      "used": true
    },
    {
      "name": "python",
      "slug": "3DI6gYWcbcS",
      "used": true
    },
    {
      "name": "è®¾è®¡æ¨¡å¼",
      "slug": "JBWj8Qw6SL",
      "used": true
    },
    {
      "name": "kafka",
      "slug": "UyO6XEvkoC",
      "used": true
    },
    {
      "name": "electron",
      "slug": "WetOSYckMA",
      "used": true
    },
    {
      "name": "app",
      "slug": "wtiPysiBope",
      "used": true
    },
    {
      "name": "fily",
      "slug": "85SfQ7PAmp-",
      "used": true
    },
    {
      "name": "mysql",
      "slug": "2d7R1MdKlx",
      "used": true
    },
    {
      "name": "redis",
      "slug": "hxSlzNMtB2",
      "used": true
    },
    {
      "name": "geektime",
      "slug": "YAtQZtegtFw",
      "used": true
    },
    {
      "name": "note",
      "slug": "cwZ4pi0gPZa",
      "used": true
    },
    {
      "name": "Gridea",
      "slug": "GoYwNhP9tS",
      "used": false
    }
  ],
  "menus": [
    {
      "link": "/",
      "name": "é¦–é¡µ",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "å½’æ¡£",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "æ ‡ç­¾",
      "openType": "Internal"
    },
    {
      "link": "/post/about",
      "name": "å…³äº",
      "openType": "Internal"
    },
    {
      "link": "https://popgame.fun",
      "name": "POPGAME",
      "openType": "External"
    }
  ]
}